<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
  <title>GAMbler</title>
  <link>https://ecogambler.netlify.app/blog/</link>
  <description>Recent content on GAMbler</description>
  <generator>Hugo</generator>
  <language>en</language>
<copyright>© Nicholas J Clark (2024)</copyright>
<lastBuildDate>Wed, 05 Nov 2025 00:00:00 +0000</lastBuildDate>
<atom:link href="https://ecogambler.netlify.app/blog/index.xml" rel="self" type="application/rss+xml" />
<item>
  <title>Building an Interactive Emergency Department Dashboard with Shiny</title>
  <link>https://ecogambler.netlify.app/blog/emergency-department-shiny/</link>
  <pubDate>Wed, 05 Nov 2025 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/emergency-department-shiny/</guid>
  <description>&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/jquery/jquery-3.6.0.min.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;link href=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/leaflet/leaflet.css&#34; rel=&#34;stylesheet&#34; /&gt;&#xD;&#xA;&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/leaflet/leaflet.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;link href=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/leafletfix/leafletfix.css&#34; rel=&#34;stylesheet&#34; /&gt;&#xD;&#xA;&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/proj4/proj4.min.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/Proj4Leaflet/proj4leaflet.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;link href=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/rstudio_leaflet/rstudio_leaflet.css&#34; rel=&#34;stylesheet&#34; /&gt;&#xD;&#xA;&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/leaflet-binding/leaflet.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/leaflet-providers/leaflet-providers_2.0.0.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;script src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/leaflet-providers-plugin/leaflet-providers-plugin.js&#34;&gt;&lt;/script&gt;&#xD;&#xA;&lt;p&gt;Healthcare systems generate enormous amounts of data, but turning these numbers into actionable insights requires more than static plots. Emergency department (ED) presentations are particularly rich datasets that capture both temporal patterns (seasonal flu spikes, weekend surges) and spatial distributions (urban vs rural access, network capacity). Static visualizations can show us snapshots, but interactive dashboards let us explore the full complexity of these patterns.&lt;/p&gt;&#xA;&lt;p&gt;In this post, I’ll show you how to transform simple exploratory plots into a fully interactive Shiny dashboard for analyzing NSW and ACT emergency department data. We’ll start with basic static visualizations, progressively add interactivity, and ultimately build a dashboard that healthcare administrators, researchers, or curious citizens could use to understand ED utilization patterns. Along the way, I’ll cover reactive programming concepts, performance optimization strategies, and deployment considerations.&lt;/p&gt;&#xA;&lt;p&gt;If you’ve worked with &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time series visualization in GAMs&lt;/a&gt; like I have, you’ll appreciate how interactive dashboards can make complex temporal patterns more accessible to non-technical audiences. And unlike my usual posts about &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;statistical modeling&lt;/a&gt;, this one focuses on making data exploration intuitive and engaging through interactivity.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;overview-of-this-post&#34;&gt;Overview of this post&#xA;  &lt;a href=&#34;#overview-of-this-post&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Emergency departments are the frontline of healthcare systems, and understanding their utilization patterns is crucial for resource planning, policy decisions, and public health monitoring. This post addresses three key challenges in healthcare data visualization:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Static limitations&lt;/strong&gt;: Traditional plots can’t capture the multidimensional nature of ED data—how do you simultaneously show temporal trends, geographic distributions, triage severity, and hospital-specific patterns?&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Interactivity needs&lt;/strong&gt;: Different stakeholders need different views. Hospital administrators want network-level summaries, researchers need granular temporal data, and policymakers require population-adjusted metrics.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Performance at scale&lt;/strong&gt;: Healthcare datasets are large. How do we build responsive dashboards that can handle millions of records without frustrating users?&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;I’ll walk through building a dashboard that solves these challenges, starting with NSW and ACT hospital emergency admission data from the Australian Institute of Health and Welfare’s MyHospitals portal. We’ll build features incrementally: static exploration, basic Shiny conversion, reactive filtering, interactive maps, population adjustments, spatial smoothing, and linked visualizations.&lt;/p&gt;&#xA;&lt;p&gt;By the end, you’ll know how to build production-ready Shiny dashboards that transform complex healthcare data into intuitive, interactive tools for exploration and decision-making.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This tutorial uses data from the Australian Institute of Health and Welfare’s MyHospitals portal. If you can’t access the API directly, you can download sample data from &#xA;&lt;a href=&#34;https://www.aihw.gov.au/reports-data/myhospitals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this link&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(tidyverse)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(viridis)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(scales)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(leaflet)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(sf)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(readaihw)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;data-acquisition-and-initial-exploration&#34;&gt;Data acquisition and initial exploration&#xA;  &lt;a href=&#34;#data-acquisition-and-initial-exploration&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Let’s start by loading the emergency department data and understanding its structure. The MyHospitals dataset contains ED presentations broken down by hospital, time period, and triage category.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Load hospital location mappings and ED presentation data&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hosp_locs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;get_hospital_mappings&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ed_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;read_flat_data_extract&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;MYH-ED&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now let’s clean and prepare the data for analysis:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Clean and prepare the data - Focus on NSW and ACT&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ed_clean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; ed_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    value &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.numeric&lt;/span&gt;(value),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    date &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.Date&lt;/span&gt;(reporting_end_date),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    triage_category &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; reported_measure_category_name,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    state &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mapped_state&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Include NSW and ACT&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.na&lt;/span&gt;(value), value &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, state &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%in%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;NSW&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;ACT&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Quick summary of the data structure&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ed_clean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    n_hospitals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n_distinct&lt;/span&gt;(reporting_unit_code),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    n_months &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n_distinct&lt;/span&gt;(date),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    date_range &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(date), &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;to&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(date)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    total_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(value)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  knitr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;kable&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;&#xA;&lt;thead&gt;&#xA;&lt;tr&gt;&#xA;&lt;th style=&#34;text-align:right&#34;&gt;n_hospitals&lt;/th&gt;&#xA;&lt;th style=&#34;text-align:right&#34;&gt;n_months&lt;/th&gt;&#xA;&lt;th style=&#34;text-align:left&#34;&gt;date_range&lt;/th&gt;&#xA;&lt;th style=&#34;text-align:right&#34;&gt;total_presentations&lt;/th&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/thead&gt;&#xA;&lt;tbody&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:right&#34;&gt;205&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:right&#34;&gt;13&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:left&#34;&gt;2012-06-30 to 2024-06-30&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:right&#34;&gt;95277754&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;static-visualizations-understanding-the-data&#34;&gt;Static visualizations: Understanding the data&#xA;  &lt;a href=&#34;#static-visualizations-understanding-the-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Before diving into interactivity, let’s create the three foundational visualizations from our exploratory analysis. These will form the core components of our dashboard.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;plot-1-nsw--act-ed-presentations-over-time&#34;&gt;Plot 1: NSW + ACT ED Presentations Over Time&#xA;  &lt;a href=&#34;#plot-1-nsw--act-ed-presentations-over-time&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Plot 1: NSW + ACT ED Presentations Over Time&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nsw_ed_trend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; ed_clean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(reporting_unit_type_name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;State&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;group_by&lt;/span&gt;(date) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    total_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(value, na.rm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .groups &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;drop&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(nsw_ed_trend, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; date, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; total_presentations)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt;, color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;NSW + ACT ED Presentations Over Time&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Date&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Total ED Presentations&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;comma_format&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/figure-html/unnamed-chunk-4-1.png&#34; alt=&#34;Time series plot showing NSW and ACT emergency department presentations over time with seasonal patterns&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;plot-2-nsw--act-triage-category-distribution&#34;&gt;Plot 2: NSW + ACT Triage Category Distribution&#xA;  &lt;a href=&#34;#plot-2-nsw--act-triage-category-distribution&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Plot 2: NSW + ACT Triage Category Distribution&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;triage_summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; ed_clean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;group_by&lt;/span&gt;(triage_category) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    total_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(value, na.rm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .groups &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;drop&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;arrange&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;desc&lt;/span&gt;(total_presentations))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  triage_summary, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;reorder&lt;/span&gt;(triage_category, total_presentations), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; total_presentations, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; triage_category&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_col&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coord_flip&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;NSW + ACT ED Presentations by Triage Category&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Triage Category&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Total Presentations&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_viridis_d&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;comma_format&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/emergency-department-shiny/index_files/figure-html/unnamed-chunk-5-1.png&#34; alt=&#34;Horizontal bar chart showing NSW and ACT emergency department presentations by triage category&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;plot-3-interactive-map-of-nsw--act-hospitals-with-ed-activity&#34;&gt;Plot 3: Interactive Map of NSW + ACT Hospitals with ED Activity&#xA;  &lt;a href=&#34;#plot-3-interactive-map-of-nsw--act-hospitals-with-ed-activity&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Plot 3: Interactive Map of NSW + ACT Hospitals with ED Activity&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nsw_hospital_activity &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; ed_clean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(reporting_unit_type_name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Hospital&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;group_by&lt;/span&gt;(reporting_unit_code, reporting_unit_name) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    total_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(value, na.rm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    avg_annual &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(value, na.rm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    years_reporting &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n_distinct&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;year&lt;/span&gt;(date)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .groups &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;drop&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;left_join&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    hosp_locs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        state &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%in%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;New South Wales&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Australian Capital Territory&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        lat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.numeric&lt;/span&gt;(latitude),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        lon &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.numeric&lt;/span&gt;(longitude)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        code, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        name, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        lat, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        lon, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sector, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        local_hospital_network_lhn&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;reporting_unit_code&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;code&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.na&lt;/span&gt;(lat), &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.na&lt;/span&gt;(lon), total_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Load Australian state boundaries for mask layer&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;aus_states &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;read_sf&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;https://raw.githubusercontent.com/rowanhogan/australian-states/master/states.geojson&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create interactive map with minimal basemap&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;map &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;leaflet&lt;/span&gt;(nsw_hospital_activity, width &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;100%&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add state boundaries with NSW and ACT highlighted&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;addPolygons&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; aus_states,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fillColor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ifelse&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      STATE_NAME &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%in%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;New South Wales&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Australian Capital Territory&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;transparent&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fillOpacity &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ifelse&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      STATE_NAME &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%in%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;New South Wales&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Australian Capital Territory&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    weight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opacity &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;addCircleMarkers&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lng &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;lon,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;lat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Scale by annual average&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    radius &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sqrt&lt;/span&gt;(total_presentations &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; years_reporting) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;18&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fillColor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fillOpacity &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    stroke &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    weight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    popup &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;&amp;lt;b&amp;gt;&amp;#34;&lt;/span&gt;, name, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;&amp;lt;/b&amp;gt;&amp;lt;br/&amp;gt;&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Total ED Presentations: &amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;comma&lt;/span&gt;(total_presentations), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;&amp;lt;br/&amp;gt;&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Network: &amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      local_hospital_network_lhn, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;&amp;lt;br/&amp;gt;&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Years Reporting: &amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      years_reporting&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;addProviderTiles&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;CartoDB.Positron&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Clean, minimal basemap&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add combined title and legend&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;addControl&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    html &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;background: white; padding: 8px; border-radius: 5px; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;box-shadow: 0 0 10px rgba(0,0,0,0.2); font-family: Arial, sans-serif;&amp;#34;&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;font-size: 12px; font-weight: bold; color: #333; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;margin-bottom: 10px; border-bottom: 1px solid #ddd; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;padding-bottom: 8px;&amp;#34;&amp;gt;NSW &amp;amp; ACT Emergencies&amp;lt;/div&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;margin: 5px 0; display: flex; align-items: center;&amp;#34;&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;width: 20px; height: 10px; display: flex; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;justify-content: center; align-items: center; margin-right: 8px;&amp;#34;&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;span style=&amp;#34;width: 20px; height: 20px; border-radius: 50%; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;background: darkred; display: block;&amp;#34;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;span style=&amp;#34;font-size: 11px;&amp;#34;&amp;gt;High Volume&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;margin: 8px 0; display: flex; align-items: center;&amp;#34;&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;width: 20px; height: 10px; display: flex; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;justify-content: center; align-items: center; margin-right: 8px;&amp;#34;&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;span style=&amp;#34;width: 12px; height: 12px; border-radius: 50%; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;background: darkred; display: block;&amp;#34;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;span style=&amp;#34;font-size: 11px;&amp;#34;&amp;gt;Medium Volume&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;margin: 8px 0; display: flex; align-items: center;&amp;#34;&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;div style=&amp;#34;width: 20px; height: 10px; display: flex; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;justify-content: center; align-items: center; margin-right: 8px;&amp;#34;&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;span style=&amp;#34;width: 6px; height: 6px; border-radius: 50%; &amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;background: darkred; display: block;&amp;#34;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;lt;span style=&amp;#34;font-size: 11px;&amp;#34;&amp;gt;Low Volume&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;topright&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Center on Dubbo with fixed zoom&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;setView&lt;/span&gt;(lng &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;148.6019&lt;/span&gt;, lat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-32.2431&lt;/span&gt;, zoom &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;map&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div id=&#34;htmlwidget-1&#34; style=&#34;width:100%;height:450px;&#34; class=&#34;leaflet html-widget&#34;&gt;&lt;/div&gt;&#xD;&#xA;&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-1&#34;&gt;{&#34;x&#34;:{&#34;options&#34;:{&#34;crs&#34;:{&#34;crsClass&#34;:&#34;L.CRS.EPSG3857&#34;,&#34;code&#34;:null,&#34;proj4def&#34;:null,&#34;projectedBounds&#34;:null,&#34;options&#34;:{}}},&#34;calls&#34;:[{&#34;method&#34;:&#34;addPolygons&#34;,&#34;args&#34;:[[[[{&#34;lng&#34;:[159.10542,159.09775,159.099634,159.094217,159.074599,159.06874,159.077238,159.056995,159.038463,159.03796,159.064657,159.06379,159.081178,159.081913,159.094678,159.10542],&#34;lat&#34;:[-31.563994,-31.564275,-31.573372,-31.57097,-31.597285,-31.595697,-31.543533,-31.519772,-31.522425,-31.512156,-31.509666,-31.517379,-31.526607,-31.539767,-31.545036,-31.563994]}],[{&#34;lng&#34;:[151.14555,151.143844,151.169325,151.180206,151.174277,151.143088,151.135902,151.148783,151.133837,151.112863,151.108625,151.092828,151.070345,151.051336,151.084007,151.075192,151.080873,151.083228,151.093817,151.089778,151.098921,151.093602,151.102215,151.099653,151.104144,151.120767,151.113783,151.122305,151.11907,151.128397,151.122165,151.126983,151.142064,151.142273,151.149526,151.144434,151.154043,151.164849,151.14452,151.149559,151.141168,151.15087,151.18549,151.190538,151.184547,151.196507,151.173504,151.189337,151.185985,151.194011,151.201538,151.200176,151.208045,151.2097,151.222724,151.220606,151.229928,151.231825,151.240091,151.246131,151.252331,151.254657,151.266971,151.264376,151.277581,151.281068,151.287848,151.285699,151.274326,151.271398,151.257621,151.265693,151.257087,151.265965,151.251886,151.258952,151.251185,151.249211,151.230804,151.226024,151.208864,151.22008,151.207515,151.211072,151.192349,151.192722,151.186067,151.18172,151.168033,151.139781,151.1227,151.13074,151.118302,151.112694,151.117358,151.107858,151.109517,151.126957,151.137635,151.159864,151.141756,151.157393,151.162119,151.178624,151.158315,151.159558,151.196318,151.20643,151.186751,151.221931,151.231455,151.230295,151.21452,151.185918,151.165543,151.15588,151.153407,151.147416,151.148906,151.140341,151.133934,151.129658,151.111637,151.114401,151.105961,151.112134,151.105231,151.10177,151.096978,151.092183,151.077022,151.089079,151.088837,151.061128,151.057465,151.063033,151.088446,151.095785,151.10198,151.105556,151.078582,151.099223,151.110204,151.132195,151.124191,151.135161,151.13315,151.136951,151.150032,151.168974,151.171761,151.151792,151.135794,151.127882,151.118696,151.11144,151.045254,150.988696,150.928023,150.924432,150.930286,150.919412,150.9313,150.902085,150.904246,150.910846,150.902392,150.901079,150.90981,150.898757,150.894896,150.884085,150.907936,150.913644,150.921906,150.90884,150.891364,150.87457,150.862742,150.873463,150.886849,150.886605,150.832395,150.837644,150.811748,150.819484,150.80893,150.812573,150.807644,150.813506,150.796795,150.810358,150.795312,150.804238,150.81644,150.832287,150.837573,150.862037,150.873652,150.868446,150.877301,150.875128,150.904456,150.887547,150.876885,150.866629,150.855877,150.862068,150.856594,150.865478,150.854772,150.864679,150.855094,150.860942,150.833299,150.837007,150.822899,150.825135,150.811494,150.782121,150.760547,150.749538,150.751467,150.760049,150.770895,150.768621,150.785753,150.776325,150.784718,150.810238,150.821423,150.829846,150.849715,150.831646,150.842983,150.833758,150.805821,150.786259,150.776154,150.775738,150.787111,150.767252,150.778271,150.750987,150.726267,150.728397,150.692061,150.67113,150.67951,150.676828,150.697959,150.691608,150.701604,150.661053,150.657742,150.647068,150.638256,150.614193,150.620558,150.59525,150.58714,150.586233,150.576903,150.579468,150.563048,150.549499,150.565456,150.568716,150.54138,150.544818,150.565494,150.574358,150.569959,150.586461,150.598912,150.585885,150.605105,150.601334,150.591249,150.59742,150.572751,150.540543,150.5302,150.545226,150.478024,150.471901,150.487294,150.475899,150.475586,150.485034,150.474882,150.492479,150.478544,150.452093,150.449098,150.423084,150.410745,150.415734,150.406091,150.403749,150.392847,150.390874,150.401584,150.406331,150.396202,150.385042,150.386919,150.375839,150.376802,150.364873,150.346391,150.340029,150.34564,150.322605,150.326048,150.313561,150.299254,150.29743,150.307557,150.299687,150.306552,150.299061,150.29744,150.280941,150.2766,150.270352,150.265411,150.262428,150.251028,150.250492,150.233969,150.212214,150.210273,150.177263,150.21448,150.211872,150.234944,150.237379,150.230108,150.237153,150.224191,150.230793,150.224934,150.235278,150.217544,150.210168,150.199136,150.186699,150.189893,150.17766,150.191359,150.169215,150.150243,150.152075,150.161817,150.155057,150.160404,150.151067,150.154079,150.164327,150.157407,150.164553,150.149238,150.144535,150.134469,150.13396,150.141502,150.124334,150.125418,150.135854,150.130935,150.142489,150.148569,150.130773,150.139723,150.089788,150.066831,150.06764,150.08476,150.054818,150.062206,150.055537,150.068288,150.055783,150.056813,150.044143,149.999881,149.999328,149.992487,149.997116,149.982757,149.979306,149.991869,149.98185,149.977198,149.940621,149.934352,149.950011,149.939116,149.930172,149.935305,149.929592,149.938102,149.919697,149.904788,149.913436,149.945918,149.933505,149.926665,149.930788,149.947732,149.939898,149.944652,149.923414,149.909916,149.914847,149.901876,149.872514,149.878305,149.893487,149.911385,149.929726,149.926203,149.953789,149.95232,149.971312,149.968962,149.987616,150.004869,150.00955,150.002958,150.02086,150.015523,150.023399,150.010766,150.027744,150.030825,150.051842,150.013021,149.98678,149.966025,149.944008,149.950848,149.969726,149.972162,149.949831,149.956554,149.97541,149.976679,148.194946,148.182473,148.179595,148.156663,148.126771,148.120152,148.108888,148.097983,148.126081,148.120472,148.132654,148.136703,148.130703,148.170243,148.211171,148.219547,148.214196,148.202781,148.217563,148.20599,148.19033,148.190134,148.169411,148.160713,148.150489,148.13341,148.124337,148.139815,148.11763,148.126424,148.119093,148.124663,148.087601,148.08028,148.059945,148.058163,148.037583,148.045966,148.037836,148.048959,148.055613,148.051243,148.058941,148.035011,148.043928,148.035234,148.040119,148.033753,148.032828,148.038676,148.02884,148.0349,148.026096,148.04062,148.021819,148.034795,148.022899,148.035191,148.037726,148.002388,148.000537,147.990652,147.998229,147.991074,147.999218,147.980247,147.982389,147.992889,147.989467,147.999692,147.99126,147.981774,147.973234,147.97426,147.964964,147.958994,147.934261,147.923974,147.923752,147.931559,147.91149,147.917083,147.908543,147.912342,147.895698,147.897506,147.88288,147.873121,147.817498,147.806153,147.776849,147.766797,147.773261,147.741292,147.718672,147.708415,147.68001,147.646777,147.637771,147.601438,147.591893,147.549115,147.547654,147.558887,147.584027,147.551873,147.521359,147.514925,147.525267,147.511421,147.494112,147.481553,147.478835,147.464072,147.450685,147.404631,147.390342,147.392344,147.383679,147.358193,147.355287,147.345681,147.352825,147.319949,147.285177,147.242378,147.206299,147.164456,147.144361,147.127391,147.123357,147.111931,147.11628,147.10682,147.109228,147.098074,147.106364,147.097671,147.099095,147.09214,147.103712,147.097003,147.091582,147.095444,147.0904,147.061812,147.052963,147.042344,147.034141,147.022777,147.013473,147.016319,147.006396,147.007444,146.981298,146.972589,146.956824,146.952498,146.943705,146.926804,146.924058,146.907763,146.90691,146.880556,146.872952,146.86453,146.857158,146.8367,146.825026,146.825542,146.816301,146.81838,146.803936,146.79457,146.796181,146.762818,146.762315,146.749851,146.752929,146.730065,146.731645,146.708878,146.707141,146.689603,146.695002,146.685812,146.675365,146.680199,146.655996,146.650336,146.658574,146.650178,146.650868,146.614299,146.60782,146.618716,146.61252,146.584147,146.583967,146.560301,146.552029,146.555958,146.549581,146.532293,146.519681,146.502585,146.500674,146.49248,146.502134,146.499726,146.467407,146.469966,146.454595,146.444738,146.437159,146.421673,146.425169,146.402962,146.399134,146.380606,146.379594,146.387557,146.368684,146.33889,146.325022,146.329072,146.315875,146.312986,146.300963,146.299009,146.291396,146.283023,146.293104,146.282181,146.291125,146.278803,146.282895,146.27503,146.272859,146.257183,146.244593,146.250889,146.241433,146.24298,146.222171,146.211155,146.211581,146.204747,146.199244,146.185976,146.173104,146.15468,146.145863,146.131357,146.132045,146.14065,146.134761,146.118718,146.107678,146.112378,146.09147,146.092199,146.075639,146.07355,146.059295,146.052346,146.048421,146.031488,146.016143,146.005866,145.97207,145.971314,145.958336,145.964818,145.945744,145.951071,145.944304,145.953701,145.928,145.925821,145.902934,145.900756,145.910314,145.902693,145.854042,145.847975,145.858624,145.845548,145.848589,145.840021,145.827548,145.828252,145.811353,145.81668,145.811662,145.80798,145.793445,145.792732,145.777006,145.778211,145.746109,145.731027,145.734238,145.716766,145.7263,145.720274,145.697327,145.695763,145.703269,145.698181,145.685852,145.673992,145.679053,145.669121,145.657449,145.63973,145.62957,145.620321,145.628134,145.614857,145.62832,145.626347,145.601748,145.606474,145.601134,145.598028,145.586792,145.59323,145.564011,145.56684,145.557997,145.562836,145.546741,145.538763,145.541889,145.535398,145.52251,145.502556,145.491977,145.472128,145.46344,145.450658,145.442293,145.412575,145.410625,145.38715,145.3554,145.324453,145.296542,145.272698,145.258317,145.260717,145.246178,145.225029,145.22276,145.189806,145.181014,145.153456,145.15917,145.139579,145.136636,145.127683,145.126435,145.114092,145.091922,145.089998,145.061056,145.049713,145.018998,144.992263,144.991436,144.968187,144.974954,144.948917,144.957378,144.931005,144.923606,144.945759,144.945499,144.961831,144.967808,144.985932,144.981909,144.94829,144.932614,144.86346,144.861373,144.857534,144.856474,144.847176,144.850851,144.841901,144.841922,144.819903,144.809893,144.81634,144.806398,144.813362,144.80787,144.794782,144.777064,144.771896,144.748239,144.740569,144.726379,144.717445,144.725675,144.715385,144.706461,144.698886,144.697522,144.683907,144.689004,144.667856,144.664631,144.658022,144.654966,144.653191,144.643921,144.632744,144.624999,144.626288,144.6183,144.628221,144.61767,144.608432,144.617551,144.615473,144.605957,144.608761,144.598917,144.590991,144.582515,144.586445,144.571127,144.563385,144.557655,144.553661,144.51614,144.512009,144.521099,144.50995,144.513047,144.501128,144.5019,144.493963,144.488638,144.48123,144.487583,144.479758,144.479415,144.466691,144.472233,144.464123,144.466553,144.460553,144.446974,144.426505,144.423428,144.416979,144.424381,144.407927,144.418183,144.403628,144.410936,144.401926,144.411388,144.398635,144.388885,144.390318,144.381433,144.384314,144.372936,144.382044,144.372189,144.384118,144.364806,144.377484,144.366709,144.37685,144.362329,144.355338,144.360283,144.351546,144.349111,144.318651,144.327832,144.295276,144.301278,144.29606,144.264496,144.24815,144.215952,144.221647,144.213483,144.195139,144.186788,144.162351,144.152629,144.142927,144.131488,144.117546,144.105015,144.062285,144.063958,144.0468,144.039215,144.034082,144.012702,144.009646,143.989865,143.999221,143.996841,143.974476,143.962441,143.972536,143.970101,143.933355,143.935045,143.906183,143.907733,143.876584,143.87138,143.858784,143.855435,143.813021,143.818018,143.790117,143.762852,143.765962,143.758802,143.768823,143.751004,143.709175,143.711685,143.703349,143.702284,143.693148,143.684521,143.682627,143.667922,143.668081,143.65714,143.642338,143.629381,143.633019,143.620416,143.616037,143.603015,143.598448,143.562074,143.569019,143.577937,143.59086,143.583507,143.57169,143.574076,143.563717,143.580984,143.570828,143.547023,143.548335,143.529155,143.518322,143.471482,143.449486,143.394677,143.386969,143.39182,143.381936,143.390647,143.361967,143.360762,143.348103,143.340858,143.345023,143.337446,143.34552,143.339058,143.350838,143.337663,143.337264,143.330492,143.336543,143.328679,143.322081,143.335987,143.331864,143.338117,143.329708,143.318825,143.323717,143.317704,143.322014,143.339492,143.342789,143.340526,143.321389,143.341732,143.338404,143.352563,143.34521,143.354957,143.341191,143.359559,143.347559,143.347876,143.318269,143.308844,143.294285,143.284327,143.286873,143.276736,143.273005,143.25213,143.274016,143.265285,143.248933,143.24066,143.228775,143.224384,143.213847,143.218847,143.200006,143.199179,143.179282,143.180987,143.173197,143.16536,143.161689,143.1474,143.133463,143.117841,143.127791,143.107243,143.111605,143.121272,143.112525,143.092828,143.076222,143.070763,143.054822,143.040422,143.039468,143.029424,143.032502,143.010179,143.017281,142.994573,142.989313,142.975282,142.982428,142.972708,142.959264,142.948867,142.932606,142.922267,142.923844,142.901526,142.893269,142.900176,142.886815,142.886457,142.875881,142.872151,142.860551,142.871867,142.855209,142.868177,142.852466,142.840679,142.83824,142.825038,142.823118,142.818507,142.804997,142.810259,142.797919,142.787687,142.810104,142.791428,142.782512,142.769991,142.784068,142.748291,142.746897,142.763405,142.759173,142.743192,142.723616,142.714821,142.69998,142.703966,142.689504,142.708789,142.700788,142.689206,142.708607,142.710754,142.684144,142.678899,142.691089,142.684489,142.699406,142.678646,142.676553,142.686657,142.678954,142.667412,142.661412,142.637334,142.618316,142.620498,142.646364,142.639323,142.616821,142.567176,142.556744,142.53356,142.524215,142.507428,142.511671,142.499559,142.518864,142.49906,142.51417,142.498646,142.497078,142.479002,142.471582,142.472261,142.483644,142.452327,142.463988,142.45916,142.468257,142.461307,142.471264,142.458363,142.472705,142.467968,142.448847,142.458747,142.451622,142.444922,142.430178,142.426062,142.407693,142.405558,142.390211,142.376705,142.378183,142.367695,142.400571,142.374942,142.394681,142.377726,142.369722,142.359576,142.364268,142.384163,142.379267,142.353334,142.367936,142.359897,142.364539,142.351836,142.360695,142.350969,142.363897,142.373927,142.368057,142.378269,142.36353,142.389752,142.384459,142.397,142.396566,142.367747,142.330924,142.294386,142.283873,142.284023,142.298886,142.286132,142.273673,142.267332,142.253057,142.235894,142.232465,142.248845,142.248993,142.23229,142.243579,142.24403,142.235334,142.244111,142.236518,142.23313,142.220713,142.198195,142.183613,142.167293,142.166529,142.159255,142.166629,142.14829,142.138001,142.120113,142.119613,142.08277,142.077538,142.065345,142.075638,142.027564,142.023852,142.0294,142.042265,142.037535,142.012927,142.022207,141.977651,141.969742,141.970437,141.945003,141.934053,141.925629,141.929784,141.922592,141.903505,141.884744,141.888789,141.876627,141.867763,141.853257,141.850694,141.841383,141.786445,141.776886,141.777897,141.756947,141.752623,141.761836,141.746343,141.731459,141.725469,141.729871,141.719012,141.708284,141.67745,141.632653,141.627982,141.611817,141.618538,141.60458,141.583902,141.602959,141.589383,141.604947,141.603285,141.589743,141.583921,141.560468,141.547738,141.533546,141.533863,141.510071,141.506149,141.518577,141.506669,141.518744,141.496794,141.465933,141.450241,141.444539,141.432802,141.433901,141.407404,141.408248,141.388118,141.381587,141.369693,141.368758,141.358972,141.348504,141.346407,141.324937,141.325922,141.31353,141.317451,141.30079,141.283701,141.259566,141.242543,141.247217,141.241808,141.228468,141.222119,141.205907,141.187449,141.193531,141.184951,141.174668,141.165854,141.15367,141.15318,141.143847,141.153443,141.153111,141.142973,141.137307,141.120338,141.094238,141.087257,141.097587,141.089218,141.08491,141.071951,141.065601,141.042463,141.04358,141.036145,141.024324,141.001935,141.003776,141.012366,141.002957,140.999278,148.958308,148.976321,148.998297,149.009223,149.032686,149.04832,149.058652,149.063984,149.055338,149.080061,149.080762,149.097078,149.103225,149.112444,149.128192,149.143444,149.139757,149.160386,149.179183,149.19236,149.188805,149.224974,149.246912,149.253764,149.262342,149.269197,149.297081,149.317964,149.329862,149.346685,149.358975,149.387389,149.393867,149.405469,149.423022,149.417037,149.426129,149.432856,149.428298,149.442976,149.439518,149.452554,149.474862,149.481514,149.502704,149.502977,149.513949,149.528925,149.552587,149.568553,149.587938,149.610654,149.625491,149.642282,149.647886,149.655991,149.660712,149.674008,149.666654,149.703104,149.709917,149.7039,149.721169,149.74497,149.754943,149.784005,149.811439,149.819292,149.83036,149.844852,149.8623,149.899141,149.917404,149.936331,149.941892,149.950561,149.976953,150.016091,150.045836,150.04874,150.073281,150.079904,150.085176,150.092923,150.091932,150.110908,150.121475,150.138555,150.15228,150.15409,150.169233,150.171551,150.182694,150.17789,150.186598,150.186688,150.192465,150.212287,150.213149,150.229074,150.230399,150.238805,150.236053,150.289648,150.320591,150.327556,150.3513,150.352542,150.369675,150.363767,150.370045,150.387493,150.387879,150.401823,150.413973,150.415222,150.429277,150.445551,150.460085,150.487084,150.51481,150.525002,150.5392,150.527008,150.544079,150.552333,150.548167,150.554094,150.561392,150.580641,150.600191,150.625827,150.632541,150.6734,150.681695,150.708625,150.728255,150.752343,150.795757,150.818847,150.819279,150.848417,150.874008,150.906384,150.930908,150.938189,151.01065,151.028277,151.028963,151.019308,151.024763,151.041903,151.037362,151.045321,151.054835,151.083206,151.102759,151.1044,151.132965,151.200196,151.208752,151.234722,151.243908,151.274808,151.28234,151.272148,151.282556,151.276414,151.283956,151.271058,151.284865,151.288861,151.275509,151.279649,151.315471,151.308844,151.314762,151.33931,151.393784,151.410638,151.428307,151.451744,151.463025,151.486066,151.502292,151.49149,151.49823,151.536094,151.545566,151.566806,151.577091,151.609616,151.634688,151.644389,151.674758,151.706536,151.73386,151.743471,151.772735,151.770227,151.777834,151.806394,151.813804,151.832232,151.839557,151.837909,151.849363,151.900358,151.916048,151.968198,151.997593,152.00109,152.009703,152.038126,152.036909,152.025956,152.015064,152.017057,152.037291,152.034743,152.041726,152.036326,152.047714,152.042726,152.076049,152.066079,152.066354,152.052567,152.03915,152.010168,151.990804,151.985979,151.957677,151.955645,151.982893,151.988951,152.016864,152.045672,152.067033,152.0702,152.121134,152.160504,152.184519,152.190266,152.217189,152.267606,152.288432,152.309659,152.341582,152.355946,152.38616,152.417259,152.409517,152.414572,152.444831,152.442877,152.463586,152.508643,152.534221,152.525981,152.548142,152.555508,152.556437,152.568635,152.579242,152.6017,152.600303,152.614517,152.624513,152.638288,152.667228,152.679339,152.72288,152.751062,152.775455,152.804226,152.831138,152.880013,152.933856,152.972614,153.008199,153.04606,153.108829,153.12989,153.124665,153.143405,153.154794,153.168505,153.161067,153.174911,153.177921,153.231833,153.245848,153.262409,153.278912,153.330213,153.33958,153.361237,153.389527,153.40661,153.4356,153.457134,153.476931,153.534643,153.542419,153.556101,153.54439,153.546326,153.538953,153.545506,153.542434,153.528129,153.508776,153.511639,153.507945,153.493754,153.500088,153.500738,153.494688,153.518655,153.509758,153.517015,153.535176,153.537846,153.542877,153.55437,153.561819,153.554756,153.559427,153.541705,153.552827,153.53941,153.541272,153.554731,153.5652,153.549948,153.556465,153.571431,153.568614,153.586296,153.571396,153.580705,153.555192,153.55335,153.568497,153.590668,153.618008,153.638727,153.617653,153.618866,153.595813,153.608834,153.592039,153.577043,153.574869,153.563443,153.571057,153.576789,153.526945,153.570746,153.572912,153.590086,153.539511,153.463999,153.4328,153.435275,153.451395,153.448568,153.456659,153.400519,153.344322,153.344441,153.353928,153.362896,153.376682,153.363282,153.372817,153.363994,153.372774,153.35837,153.368842,153.358735,153.362578,153.349468,153.332441,153.334558,153.342784,153.326894,153.32059,153.333974,153.305161,153.291992,153.303944,153.288043,153.294417,153.282471,153.267648,153.267554,153.276875,153.272771,153.261147,153.260047,153.233366,153.197084,153.19634,153.206343,153.207861,153.199641,153.213714,153.199564,153.206858,153.166987,153.140185,153.147838,153.139825,153.154572,153.142501,153.140125,153.152929,153.136083,153.113451,153.104516,153.075807,153.076319,153.045956,153.031711,153.025013,153.02959,153.017103,153.010084,153.020362,152.997491,152.988454,153.001661,152.997264,153.013744,153.037184,153.060289,153.069048,153.06637,153.075491,153.088672,153.09054,153.056592,153.038958,153.041007,153.054389,153.065814,153.064737,153.053565,153.05528,153.006635,152.97736,152.97639,152.984243,152.966471,152.960197,152.97116,152.964537,152.976418,152.93773,152.914979,152.937829,152.876935,152.845329,152.840123,152.848288,152.833993,152.849523,152.804917,152.792759,152.80563,152.76395,152.736092,152.73665,152.754557,152.690985,152.608794,152.565872,152.569525,152.547924,152.541556,152.54789,152.512818,152.50565,152.508886,152.536228,152.543249,152.570872,152.566357,152.536688,152.523695,152.523441,152.53638,152.55169,152.534505,152.533712,152.522735,152.516316,152.519552,152.537527,152.539907,152.418854,152.33563,152.302933,152.285026,152.231255,152.195678,152.186671,152.191883,152.208707,152.205043,152.191753,152.173103,152.145532,152.12949,152.127617,152.137652,152.121898,152.114385,152.068787,152.050357,152.061384,152.061467,152.04379,152.042612,152.029803,151.994013,151.99168,151.984275,151.968364,151.963409,151.957776,151.956364,151.944606,151.954872,151.960137,151.977628,151.978206,151.969262,151.944489,151.946428,151.936455,151.987309,151.988084,151.997967,152.021508,152.048507,152.058568,152.059998,152.069545,152.071941,152.059497,152.063803,152.091073,152.102071,152.103643,152.145766,152.161846,152.17616,152.187501,152.18685,152.170981,152.172615,152.121561,152.116236,152.123304,152.111698,152.115602,152.053106,151.885443,151.801417,151.786574,151.777611,151.793943,151.783797,151.774851,151.774609,151.733832,151.768029,151.776972,151.770255,151.764245,151.761465,151.763509,151.785514,151.803968,151.737709,151.726931,151.728705,151.668856,151.658193,151.66112,151.640292,151.641187,151.649545,151.638894,151.651868,151.657496,151.633459,151.628274,151.640583,151.629554,151.64325,151.643898,151.616572,151.60807,151.62106,151.616745,151.589056,151.584081,151.59257,151.589852,151.597706,151.595758,151.619654,151.613787,151.593563,151.577324,151.600043,151.594665,151.600064,151.585937,151.581997,151.58852,151.580757,151.611159,151.613787,151.607169,151.594108,151.571749,151.549206,151.550349,151.541549,151.525678,151.512457,151.509516,151.537841,151.548437,151.565141,151.568733,151.550304,151.552476,151.538059,151.541834,151.525946,151.522107,151.509848,151.527274,151.522881,151.530182,151.54118,151.544865,151.56787,151.571936,151.552814,151.557224,151.566724,151.583901,151.58141,151.590516,151.584364,151.591254,151.587921,151.597195,151.603313,151.614959,151.617358,151.627493,151.636071,151.640623,151.654694,151.64299,151.642009,151.657848,151.665749,151.64704,151.65351,151.647489,151.643037,151.630001,151.638668,151.622819,151.625142,151.599754,151.566629,151.563591,151.579025,151.525332,151.503129,151.502808,151.545637,151.537339,151.520419,151.539206,151.553239,151.557901,151.562175,151.547632,151.534677,151.527336,151.508584,151.519037,151.494578,151.488073,151.475091,151.465006,151.45251,151.441615,151.449002,151.468581,151.441795,151.439052,151.448791,151.474091,151.494014,151.504234,151.504443,151.487366,151.485003,151.444997,151.452589,151.435481,151.446881,151.427905,151.417169,151.364297,151.345402,151.335924,151.346747,151.3634,151.347599,151.350263,151.336359,151.312461,151.30974,151.273893,151.258662,151.245917,151.255013,151.236771,151.237267,151.247042,151.245737,151.259087,151.265719,151.231401,151.227008,151.226676,151.210233,151.197561,151.206701,151.212717,151.214263,151.237683,151.237478,151.229342,151.232011,151.214715,151.191913,151.193563,151.204685,151.199445,151.181942,151.170437,151.164381,151.159804,151.162607,151.153503,151.162184,151.172142,151.153539,151.172882,151.166434,151.145703,151.148157,151.138847,151.114844,151.09705,151.079385,151.07276,151.074647,151.069064,151.076489,151.079761,151.085611,151.102507,151.122384,151.138404,151.15553,151.143281,151.131294,151.155275,151.153931,151.140763,151.133765,151.125504,151.121259,151.130175,151.111449,151.121711,151.131303,151.12637,151.135789,151.14335,151.137583,151.127088,151.116951,151.128267,151.138763,151.144903,151.15146,151.130975,151.131477,151.120054,151.102778,151.116067,151.120785,151.125734,151.118642,151.12343,151.144343,151.133713,151.15015,151.162249,151.151753,151.169581,151.148863,151.170059,151.164184,151.175085,151.186148,151.19994,151.19853,151.225898,151.228985,151.202188,151.231422,151.221956,151.211241,151.212894,151.224131,151.231023,151.24708,151.232759,151.186312,151.209258,151.213153,151.163926,151.170368,151.158467,151.162978,151.149449,151.158845,151.15969,151.173247,151.218503,151.228875,151.219376,151.236764,151.24354,151.256728,151.251948,151.262623,151.250085,151.273011,151.283609,151.292976,151.310837,151.292518,151.304428,151.302857,151.28291,151.290538,151.270419,151.282663,151.269812,151.284916,151.304603,151.301046,151.312041,151.301965,151.309411,151.30467,151.314897,151.316085,151.332148,151.315979,151.322838,151.335315,151.325275,151.343021,151.309786,151.315268,151.310084,151.30777,151.300198,151.317714,151.291375,151.303191,151.297447,151.302525,151.293171,151.295954,151.287866,151.307405,151.301448,151.285578,151.291085,151.282571,151.281754,151.265818,151.27512,151.261106,151.250481,151.235145,151.230781,151.224654,151.204366,151.213378,151.232505,151.214736,151.222836,151.217667,151.230871,151.230544,151.217526,151.230558,151.23213,151.219385,151.238973,151.235118,151.245898,151.252506,151.268876,151.254319,151.246155,151.246701,151.232521,151.232899,151.224781,151.224854,151.215204,151.218865,151.207956,151.203597,151.199094,151.192949,151.189009,151.187598,151.181118,151.181633,151.173094,151.16898,151.152033,151.145874,151.14555],&#34;lat&#34;:[-33.824079,-33.829174,-33.839309,-33.836165,-33.843006,-33.835565,-33.836469,-33.839386,-33.844837,-33.829724,-33.835555,-33.819609,-33.816445,-33.823662,-33.82208,-33.832683,-33.84575,-33.827897,-33.824443,-33.833044,-33.831641,-33.839764,-33.838102,-33.844209,-33.834387,-33.841788,-33.853971,-33.856994,-33.864711,-33.860961,-33.848934,-33.844195,-33.845845,-33.853358,-33.846908,-33.843531,-33.84207,-33.855249,-33.863162,-33.866131,-33.869844,-33.872265,-33.846008,-33.852375,-33.853645,-33.859694,-33.871203,-33.87584,-33.868381,-33.862376,-33.873175,-33.855383,-33.853512,-33.861004,-33.859227,-33.869096,-33.858256,-33.874752,-33.866392,-33.873421,-33.863738,-33.870793,-33.870651,-33.850885,-33.85109,-33.832821,-33.850202,-33.891955,-33.893627,-33.914235,-33.922461,-33.941447,-33.95232,-33.96803,-33.964671,-33.975768,-33.978936,-34.001814,-33.992554,-33.976737,-33.982165,-33.967204,-33.969846,-33.961847,-33.954223,-33.973925,-33.952356,-33.967898,-33.949774,-34.003281,-34.000518,-33.983977,-33.990491,-34.005369,-34.013775,-34.014364,-34.022705,-34.009899,-34.037053,-34.032201,-34.014559,-34.013218,-34.000028,-34.012843,-34.014511,-34.023258,-34.021228,-34.014045,-34.00753,-34.001214,-34.011663,-34.026401,-34.04193,-34.034563,-34.040719,-34.051861,-34.073152,-34.073366,-34.054581,-34.073794,-34.05555,-34.069298,-34.072455,-34.059429,-34.059439,-34.043153,-34.042091,-34.058999,-34.047053,-34.057661,-34.053923,-34.058214,-34.065546,-34.064351,-34.073609,-34.06465,-34.069568,-34.058002,-34.065367,-34.079512,-34.089316,-34.089631,-34.078284,-34.075984,-34.092213,-34.08226,-34.073528,-34.0817,-34.083695,-34.074918,-34.086503,-34.115075,-34.120303,-34.137919,-34.137011,-34.148009,-34.186193,-34.231862,-34.316624,-34.327458,-34.331102,-34.358542,-34.368752,-34.407696,-34.42078,-34.421307,-34.433215,-34.459318,-34.464763,-34.462019,-34.451032,-34.457706,-34.475512,-34.4648,-34.493851,-34.49317,-34.506365,-34.538312,-34.529093,-34.498847,-34.497801,-34.491595,-34.486299,-34.500485,-34.507363,-34.517631,-34.524891,-34.530276,-34.525073,-34.534186,-34.546199,-34.549251,-34.555201,-34.561351,-34.553547,-34.556869,-34.542704,-34.537457,-34.544441,-34.570207,-34.579955,-34.589351,-34.596968,-34.598338,-34.608024,-34.604505,-34.614649,-34.628953,-34.64603,-34.64889,-34.663378,-34.671917,-34.676398,-34.688143,-34.738644,-34.754547,-34.773159,-34.782505,-34.772974,-34.791323,-34.820646,-34.85516,-34.890586,-34.900442,-34.895815,-34.926048,-34.930429,-34.947837,-34.986574,-35.012456,-35.014745,-35.002907,-35.012891,-35.041184,-35.050636,-35.074355,-35.094438,-35.072542,-35.083012,-35.054144,-35.036227,-35.015173,-35.002448,-34.990845,-34.99665,-35.007549,-35.014115,-35.037153,-35.049259,-35.069026,-35.071135,-35.083161,-35.122862,-35.117824,-35.105186,-35.101652,-35.116681,-35.116536,-35.106175,-35.101546,-35.088315,-35.093915,-35.088371,-35.099236,-35.093674,-35.10304,-35.102507,-35.112856,-35.118777,-35.12293,-35.119567,-35.122863,-35.13035,-35.120235,-35.127192,-35.138164,-35.156175,-35.170066,-35.172472,-35.190064,-35.193035,-35.215675,-35.235074,-35.248436,-35.291824,-35.316547,-35.324977,-35.330281,-35.346446,-35.353284,-35.356554,-35.366331,-35.367845,-35.389968,-35.406757,-35.420975,-35.436522,-35.445422,-35.445871,-35.458115,-35.464609,-35.498431,-35.506192,-35.533928,-35.53312,-35.546132,-35.562708,-35.563551,-35.571802,-35.570642,-35.587906,-35.597308,-35.604252,-35.613539,-35.637215,-35.635562,-35.647388,-35.663088,-35.668763,-35.678853,-35.686106,-35.683723,-35.6961,-35.703348,-35.723524,-35.719129,-35.726463,-35.717863,-35.7194,-35.711488,-35.702933,-35.711807,-35.702356,-35.703075,-35.737926,-35.75999,-35.771762,-35.791939,-35.801106,-35.801716,-35.808749,-35.818402,-35.827793,-35.835527,-35.830701,-35.835846,-35.828596,-35.833116,-35.838464,-35.850199,-35.860505,-35.86252,-35.891139,-35.907795,-35.908667,-35.945862,-35.953897,-35.97886,-35.991911,-35.99364,-36.007989,-36.013024,-36.02881,-36.056992,-36.06594,-36.090214,-36.094435,-36.141924,-36.16014,-36.172495,-36.199788,-36.217796,-36.266969,-36.288866,-36.304902,-36.353992,-36.398525,-36.41941,-36.429194,-36.488115,-36.50655,-36.540206,-36.554137,-36.570668,-36.582939,-36.589002,-36.665002,-36.685645,-36.687797,-36.692217,-36.702281,-36.722228,-36.725572,-36.73708,-36.769631,-36.811683,-36.844126,-36.85539,-36.857512,-36.873988,-36.884159,-36.894714,-36.902453,-36.895441,-36.914648,-36.944592,-36.94913,-36.959335,-36.99206,-37.007831,-37.017556,-37.031216,-37.053996,-37.046306,-37.062083,-37.076119,-37.069158,-37.083208,-37.101044,-37.097087,-37.1118,-37.110113,-37.100315,-37.100888,-37.108727,-37.117834,-37.125682,-37.141124,-37.141269,-37.161268,-37.168505,-37.185414,-37.201106,-37.211966,-37.211813,-37.222497,-37.23786,-37.262255,-37.255478,-37.239932,-37.249843,-37.277729,-37.295648,-37.309697,-37.328523,-37.374669,-37.423509,-37.44545,-37.50506,-36.796253,-36.804895,-36.796326,-36.790013,-36.796451,-36.806079,-36.800865,-36.787161,-36.759417,-36.756303,-36.750847,-36.738436,-36.734683,-36.712799,-36.650519,-36.619558,-36.61049,-36.611915,-36.598239,-36.586932,-36.584891,-36.57662,-36.573696,-36.579776,-36.558336,-36.566921,-36.550642,-36.525445,-36.495476,-36.485274,-36.481884,-36.464713,-36.451895,-36.422101,-36.415538,-36.400804,-36.390225,-36.367038,-36.366246,-36.355632,-36.334386,-36.324557,-36.320046,-36.310577,-36.299479,-36.292329,-36.284157,-36.28223,-36.26586,-36.259221,-36.247044,-36.234116,-36.223042,-36.206951,-36.176462,-36.162983,-36.153457,-36.152536,-36.140797,-36.140057,-36.124355,-36.121272,-36.115919,-36.111251,-36.098655,-36.086482,-36.077891,-36.081071,-36.068478,-36.046204,-36.052559,-36.040254,-36.046314,-36.038505,-36.046853,-36.040974,-36.047637,-36.042491,-36.035709,-36.035267,-36.026597,-36.011204,-36.001473,-35.995198,-35.993018,-35.999861,-36.001798,-35.991006,-35.979741,-35.965057,-35.968614,-35.964158,-35.958863,-35.95649,-35.945513,-35.928545,-35.944439,-35.946008,-35.96211,-35.979118,-35.969859,-35.96455,-35.978625,-35.972489,-35.984648,-36.004095,-35.986936,-35.976369,-35.963338,-35.962412,-35.943549,-35.949223,-35.942689,-35.944137,-35.960804,-35.943495,-35.949266,-35.973533,-35.972352,-35.991276,-36.009832,-36.018772,-36.031749,-36.060987,-36.039439,-36.038482,-36.050136,-36.030798,-36.037765,-36.018047,-35.994498,-36.000922,-36.007635,-36.004825,-36.012549,-36.010246,-36.016455,-36.015823,-36.026194,-36.02765,-36.032854,-36.046784,-36.043861,-36.05271,-36.049226,-36.066155,-36.107881,-36.104305,-36.115239,-36.099895,-36.104721,-36.089798,-36.089115,-36.083732,-36.094876,-36.082113,-36.078061,-36.110788,-36.115989,-36.097178,-36.108315,-36.111284,-36.084946,-36.087524,-36.073681,-36.073084,-36.084918,-36.082073,-36.088724,-36.070847,-36.074377,-36.067834,-36.055194,-36.058545,-36.065138,-36.059519,-36.051665,-36.061277,-36.042113,-36.044724,-36.023725,-36.029435,-36.036122,-36.030446,-36.034315,-36.040576,-36.028599,-36.022376,-36.026252,-36.018411,-36.014488,-36.013796,-36.007735,-35.99648,-35.986372,-35.975937,-35.972858,-35.974987,-35.983864,-35.976391,-35.979592,-35.989182,-35.992457,-35.984299,-35.960604,-35.958235,-35.979244,-35.985012,-35.983188,-35.99087,-35.98424,-35.976201,-35.962247,-35.977991,-35.967015,-35.965831,-35.973027,-35.98878,-36.007199,-36.012895,-36.028127,-36.035639,-36.050862,-36.026395,-36.033543,-36.043144,-36.038453,-36.045568,-36.03659,-36.047859,-36.038952,-36.041488,-36.029503,-36.026188,-36.020163,-36.01585,-36.011048,-36.012441,-36.026631,-36.012053,-36.01834,-36.02313,-36.023524,-36.028784,-36.029921,-36.03886,-36.028559,-36.039158,-36.027453,-36.042071,-36.019293,-36.025159,-36.013776,-36.019413,-36.010095,-36.008954,-36.002547,-36.018014,-36.014369,-36.006811,-36.009477,-36.021266,-36.018177,-36.009637,-36.014548,-35.995465,-36.003158,-35.994714,-36.006962,-36.003569,-36.015747,-36.005651,-36.006973,-35.99677,-35.983809,-35.976626,-35.966495,-35.9615,-35.973947,-35.964563,-35.968856,-35.961529,-35.955962,-35.952496,-35.959927,-35.968689,-35.974814,-35.97346,-35.980899,-35.983244,-35.975438,-35.982982,-35.984102,-35.9882,-35.991769,-35.983762,-35.982817,-35.972801,-35.972559,-35.960243,-35.964239,-35.958734,-35.951348,-35.950594,-35.942312,-35.934449,-35.936501,-35.925792,-35.925702,-35.920977,-35.930615,-35.925924,-35.916829,-35.919586,-35.900686,-35.894239,-35.880105,-35.883884,-35.875409,-35.87257,-35.867775,-35.862758,-35.867857,-35.874998,-35.875008,-35.861458,-35.861245,-35.849077,-35.83419,-35.826497,-35.82823,-35.813449,-35.812894,-35.821813,-35.808905,-35.801983,-35.818486,-35.809449,-35.815076,-35.80923,-35.826274,-35.821418,-35.835642,-35.830601,-35.848613,-35.850142,-35.867067,-35.850686,-35.860566,-35.845203,-35.850588,-35.835426,-35.830321,-35.832184,-35.84244,-35.834267,-35.842026,-35.843045,-35.831077,-35.828538,-35.83427,-35.820716,-35.829671,-35.820548,-35.835957,-35.825457,-35.837309,-35.833671,-35.856647,-35.852338,-35.858984,-35.865528,-35.883845,-35.931602,-35.961005,-35.96847,-35.988768,-36.004312,-36.012186,-36.018216,-36.042078,-36.056509,-36.072316,-36.082904,-36.067049,-36.059112,-36.071838,-36.065171,-36.073553,-36.072881,-36.080645,-36.083098,-36.100576,-36.107947,-36.102428,-36.109865,-36.107457,-36.113912,-36.123628,-36.117285,-36.129837,-36.116132,-36.121746,-36.107576,-36.117781,-36.112113,-36.089438,-36.086214,-36.092948,-36.087259,-36.094047,-36.095138,-36.061417,-36.068596,-36.077042,-36.07038,-36.075349,-36.05324,-36.056664,-36.048097,-36.052081,-36.0618,-36.059708,-36.065259,-36.077192,-36.063641,-36.046904,-36.031593,-36.036542,-36.041808,-36.037411,-36.043318,-36.038135,-36.027182,-36.024079,-36.007806,-36.014107,-36.002984,-35.995438,-35.988895,-35.970266,-35.973945,-35.965202,-35.970606,-35.958039,-35.968592,-35.957123,-35.958609,-35.949511,-35.953295,-35.945275,-35.945927,-35.940725,-35.940942,-35.933602,-35.939596,-35.935531,-35.918744,-35.906005,-35.910472,-35.900194,-35.904013,-35.89322,-35.880666,-35.871189,-35.86802,-35.859003,-35.862667,-35.85848,-35.850553,-35.852423,-35.841922,-35.83815,-35.833175,-35.83195,-35.819565,-35.820937,-35.814346,-35.811253,-35.792979,-35.795834,-35.788479,-35.784811,-35.785069,-35.767142,-35.766574,-35.752646,-35.754379,-35.742986,-35.737091,-35.751403,-35.721034,-35.706477,-35.693952,-35.686671,-35.685858,-35.670431,-35.671526,-35.642678,-35.647253,-35.640761,-35.625926,-35.59078,-35.576768,-35.570545,-35.563141,-35.549257,-35.555971,-35.554073,-35.563307,-35.554663,-35.545367,-35.53625,-35.532309,-35.51398,-35.509249,-35.500078,-35.50661,-35.499288,-35.499958,-35.494162,-35.486166,-35.477828,-35.479978,-35.461838,-35.446265,-35.437545,-35.422477,-35.423066,-35.415858,-35.415427,-35.401809,-35.387835,-35.392538,-35.38469,-35.389408,-35.377882,-35.383917,-35.368446,-35.374091,-35.371554,-35.385735,-35.384999,-35.401037,-35.392368,-35.383467,-35.387682,-35.368884,-35.365407,-35.352111,-35.337244,-35.302447,-35.303197,-35.281659,-35.265005,-35.267959,-35.256505,-35.243545,-35.220036,-35.206905,-35.206173,-35.21379,-35.219921,-35.21162,-35.219293,-35.189112,-35.192377,-35.183462,-35.172567,-35.17312,-35.145107,-35.1169,-35.103032,-35.10544,-35.095714,-35.08702,-35.080418,-35.074056,-35.068191,-35.064702,-35.061294,-35.048645,-35.05388,-35.043219,-35.0459,-35.036727,-35.037375,-35.023804,-35.010891,-34.995744,-34.992943,-34.979085,-34.952598,-34.942339,-34.943632,-34.932533,-34.91374,-34.88846,-34.88112,-34.870312,-34.858235,-34.853463,-34.846039,-34.846309,-34.816899,-34.807302,-34.791635,-34.790842,-34.779939,-34.790822,-34.785245,-34.794985,-34.79226,-34.776412,-34.772803,-34.752685,-34.748558,-34.757853,-34.74546,-34.747789,-34.758733,-34.738496,-34.729471,-34.733418,-34.717034,-34.717329,-34.709482,-34.719709,-34.718136,-34.697916,-34.714757,-34.700577,-34.703076,-34.692661,-34.701466,-34.687127,-34.687401,-34.680819,-34.701273,-34.695958,-34.67838,-34.698855,-34.685888,-34.702611,-34.691851,-34.682928,-34.693658,-34.67366,-34.673872,-34.662579,-34.670861,-34.68274,-34.695207,-34.664982,-34.669674,-34.655515,-34.656482,-34.647856,-34.654958,-34.665679,-34.671464,-34.679808,-34.672085,-34.674859,-34.664119,-34.665162,-34.650292,-34.639522,-34.627306,-34.619195,-34.625752,-34.613044,-34.60878,-34.600251,-34.612357,-34.608401,-34.589093,-34.597628,-34.590178,-34.560855,-34.546389,-34.564933,-34.568882,-34.580393,-34.576759,-34.587779,-34.590436,-34.600136,-34.602811,-34.592285,-34.600442,-34.59938,-34.613507,-34.618298,-34.622664,-34.624516,-34.652547,-34.662167,-34.675769,-34.670884,-34.680848,-34.701397,-34.714057,-34.724474,-34.722345,-34.729046,-34.733929,-34.739202,-34.735908,-34.721707,-34.735043,-34.728751,-34.757128,-34.763315,-34.780272,-34.785499,-34.766928,-34.775373,-34.753067,-34.75938,-34.748839,-34.740888,-34.739117,-34.703671,-34.700026,-34.690931,-34.681025,-34.669376,-34.673551,-34.666869,-34.650003,-34.636435,-34.633498,-34.626677,-34.616289,-34.612934,-34.606565,-34.592677,-34.587575,-34.576695,-34.564295,-34.559483,-34.581498,-34.584265,-34.57549,-34.574793,-34.562348,-34.567972,-34.541508,-34.549119,-34.540985,-34.532145,-34.530446,-34.522747,-34.515284,-34.493484,-34.491397,-34.503819,-34.498779,-34.484715,-34.478091,-34.466704,-34.469582,-34.435415,-34.431933,-34.422704,-34.422288,-34.411768,-34.396629,-34.38568,-34.388151,-34.37065,-34.36475,-34.362158,-34.362799,-34.346915,-34.343802,-34.337749,-34.326908,-34.339378,-34.32345,-34.326567,-34.31076,-34.305703,-34.296536,-34.304021,-34.295284,-34.306139,-34.306973,-34.296749,-34.284983,-34.265054,-34.255036,-34.245768,-34.232457,-34.223748,-34.21093,-34.203765,-34.214407,-34.182046,-34.183432,-34.175672,-34.183487,-34.171395,-34.171482,-34.153134,-34.148718,-34.160131,-34.156891,-34.174909,-34.173545,-34.157346,-34.150611,-34.131418,-34.122981,-34.115054,-34.118211,-34.105298,-34.099426,-34.105246,-34.12495,-34.112702,-34.119898,-34.136107,-34.119477,-34.138257,-34.134605,-34.12579,-34.11457,-34.11115,-34.114984,-34.124415,-34.137418,-34.128652,-34.131233,-34.124307,-34.132452,-34.111685,-34.116878,-34.101774,-34.112097,-34.106242,-34.097537,-34.103403,-34.090957,-34.094023,-34.105577,-34.114894,-34.096352,-34.101225,-34.121484,-34.145417,-34.139023,-34.156287,-34.149115,-34.151965,-34.162254,-34.177353,-34.183933,-34.191228,-34.186893,-34.198816,-34.1909,-34.200841,-34.191434,-34.210697,-34.216479,-34.210498,-34.203159,-34.190619,-34.18091,-34.155523,-34.165754,-34.161077,-34.168015,-34.15994,-34.145904,-34.1464,-34.127856,-34.13473,-34.122143,-34.120204,-34.127115,-34.110723,-34.112311,-34.124348,-34.138782,-34.126866,-34.12486,-34.112413,-34.113718,-34.103874,-34.078134,-34.087341,-34.073209,-34.061315,-34.073651,-34.061677,-34.061723,-34.079294,-34.089576,-34.091951,-34.073334,-34.083212,-34.082118,-34.068915,-34.067799,-34.064189,-34.054521,-34.063534,-34.057561,-34.064866,-34.050656,-34.057173,-34.070035,-34.076696,-34.062288,-34.06291,-34.050062,-34.061101,-34.0432,-34.03605,-34.059906,-34.039284,-34.027604,-34.024736,-34.022537,-28.999103,-28.999064,-28.976413,-28.972645,-28.956919,-28.955958,-28.916989,-28.910358,-28.888645,-28.884099,-28.858362,-28.841801,-28.83168,-28.838124,-28.829575,-28.835262,-28.822215,-28.807197,-28.810739,-28.802996,-28.7806,-28.775118,-28.764462,-28.738899,-28.742235,-28.734297,-28.743452,-28.709947,-28.714058,-28.698194,-28.696672,-28.68433,-28.695803,-28.677292,-28.675241,-28.655209,-28.651315,-28.650136,-28.635031,-28.629225,-28.620323,-28.612053,-28.594867,-28.593894,-28.582818,-28.580399,-28.574351,-28.581674,-28.57422,-28.580137,-28.571079,-28.572815,-28.60088,-28.593342,-28.599207,-28.61211,-28.615489,-28.609311,-28.624156,-28.631859,-28.633712,-28.620299,-28.616464,-28.609183,-28.618388,-28.609441,-28.614132,-28.605773,-28.615843,-28.603748,-28.610477,-28.602199,-28.621909,-28.608056,-28.610132,-28.617922,-28.60804,-28.613464,-28.580656,-28.582399,-28.589196,-28.576562,-28.584396,-28.575843,-28.578618,-28.564239,-28.570297,-28.559734,-28.565316,-28.55021,-28.557155,-28.550587,-28.56389,-28.556287,-28.563474,-28.565211,-28.572795,-28.566742,-28.574181,-28.567549,-28.567687,-28.555713,-28.559711,-28.55381,-28.537157,-28.557182,-28.571045,-28.575348,-28.587759,-28.598511,-28.60751,-28.62068,-28.625354,-28.633924,-28.627281,-28.633892,-28.650834,-28.651122,-28.665141,-28.668912,-28.657421,-28.661759,-28.654311,-28.660519,-28.668879,-28.671524,-28.668026,-28.658494,-28.653064,-28.661817,-28.655465,-28.670758,-28.668979,-28.676572,-28.65018,-28.661351,-28.651951,-28.63449,-28.633464,-28.655236,-28.657336,-28.666631,-28.673119,-28.693797,-28.687706,-28.705519,-28.730938,-28.740805,-28.761415,-28.770497,-28.772049,-28.793127,-28.799153,-28.827649,-28.844482,-28.849373,-28.83438,-28.836369,-28.844291,-28.860242,-28.884349,-28.90147,-28.904656,-28.924297,-28.938926,-28.95408,-28.973172,-28.980593,-28.986967,-29.005871,-29.030275,-29.037356,-29.050251,-29.077791,-29.100769,-29.134499,-29.147526,-29.165531,-29.177266,-29.177893,-29.152566,-29.147477,-29.126859,-29.098943,-29.088818,-29.070805,-29.056244,-29.019909,-28.980619,-28.952998,-28.941731,-28.945031,-28.923279,-28.929234,-28.916839,-28.907595,-28.871784,-28.871578,-28.918646,-28.938251,-28.955846,-28.959885,-28.944636,-28.959374,-28.959829,-28.942665,-28.916547,-28.90785,-28.914966,-28.929307,-28.916567,-28.895483,-28.90973,-28.907663,-28.864696,-28.851794,-28.858253,-28.850626,-28.838514,-28.819231,-28.79071,-28.778581,-28.756992,-28.740329,-28.731623,-28.708175,-28.697454,-28.680968,-28.68194,-28.664448,-28.664951,-28.6244,-28.581498,-28.563409,-28.518904,-28.503395,-28.525613,-28.525281,-28.494966,-28.48559,-28.468003,-28.462669,-28.433123,-28.438872,-28.433948,-28.449236,-28.390047,-28.393151,-28.363168,-28.36786,-28.361197,-28.368554,-28.333089,-28.315734,-28.298101,-28.298822,-28.290442,-28.259373,-28.249249,-28.262631,-28.30625,-28.321019,-28.316663,-28.323355,-28.323575,-28.338976,-28.307381,-28.283836,-28.269555,-28.298204,-28.310997,-28.311752,-28.330416,-28.344096,-28.363914,-28.346625,-28.353594,-28.320265,-28.309607,-28.338311,-28.331853,-28.341717,-28.339455,-28.357543,-28.330665,-28.318641,-28.311993,-28.295691,-28.294163,-28.279824,-28.274777,-28.24752,-28.26511,-28.245832,-28.246788,-28.233636,-28.237064,-28.250311,-28.24835,-28.234935,-28.210415,-28.187207,-28.18054,-28.15702,-28.17763,-28.168567,-28.168449,-28.169618,-28.184622,-28.1831,-28.183393,-28.178038,-28.1908,-28.190014,-28.201256,-28.194172,-28.207082,-28.205997,-28.213867,-28.220227,-28.221669,-28.217616,-28.193591,-28.191657,-28.183815,-28.194353,-28.192899,-28.208462,-28.209336,-28.2169,-28.234473,-28.234553,-28.236277,-28.243385,-28.236006,-28.204997,-28.17138,-28.170067,-28.199438,-28.238466,-28.258206,-28.32713,-28.362971,-28.452871,-28.531179,-28.589701,-28.624827,-28.642001,-28.636102,-28.678142,-28.722255,-28.775189,-28.843251,-28.875592,-28.868449,-28.840165,-28.847083,-28.849291,-28.869838,-28.872891,-28.88507,-28.876931,-28.877612,-28.923112,-29.018714,-29.10083,-29.113103,-29.118875,-29.133389,-29.140191,-29.201378,-29.296579,-29.344446,-29.357709,-29.355398,-29.365596,-29.421572,-29.425122,-29.430211,-29.440342,-29.466503,-29.484052,-29.496081,-29.5254,-29.539915,-29.586645,-29.604816,-29.608281,-29.632866,-29.661397,-29.674551,-29.715407,-29.753621,-29.774537,-29.798317,-29.82508,-29.83383,-29.86525,-29.885679,-29.893112,-29.916864,-29.930649,-29.952097,-29.979753,-30.040577,-30.054904,-30.058314,-30.068526,-30.103902,-30.109724,-30.141272,-30.156386,-30.198029,-30.255886,-30.277603,-30.299669,-30.305148,-30.303102,-30.309882,-30.309492,-30.315935,-30.340617,-30.376997,-30.410593,-30.43189,-30.467008,-30.499017,-30.533623,-30.546964,-30.564111,-30.607866,-30.647583,-30.678914,-30.731967,-30.748638,-30.786115,-30.860782,-30.882482,-30.886687,-30.881776,-30.875077,-30.877935,-30.911293,-30.922062,-30.959548,-31.003181,-31.041426,-31.053706,-31.046969,-31.056619,-31.069897,-31.079436,-31.123408,-31.171432,-31.184027,-31.186655,-31.212969,-31.242051,-31.252606,-31.30634,-31.314141,-31.360849,-31.409392,-31.47576,-31.529605,-31.572928,-31.58938,-31.601575,-31.632314,-31.641347,-31.68186,-31.710722,-31.73032,-31.768836,-31.811104,-31.836518,-31.845077,-31.877659,-31.94714,-32.004019,-32.009961,-32.028103,-32.046409,-32.073587,-32.116957,-32.14506,-32.172395,-32.182798,-32.201587,-32.215633,-32.229514,-32.259276,-32.29441,-32.311726,-32.328984,-32.33461,-32.35565,-32.37977,-32.388081,-32.408505,-32.428291,-32.433604,-32.443464,-32.482549,-32.527079,-32.559295,-32.594775,-32.615845,-32.647922,-32.685393,-32.694347,-32.695583,-32.70122,-32.70048,-32.67834,-32.67743,-32.685677,-32.676114,-32.67098,-32.657751,-32.681105,-32.689564,-32.676504,-32.669615,-32.65,-32.660358,-32.679646,-32.664021,-32.668876,-32.659583,-32.664883,-32.654379,-32.671408,-32.666832,-32.674973,-32.676772,-32.677334,-32.697447,-32.687684,-32.705855,-32.714807,-32.71705,-32.733945,-32.736885,-32.725755,-32.719213,-32.727457,-32.72038,-32.728703,-32.716154,-32.735879,-32.735976,-32.726715,-32.710303,-32.698469,-32.728176,-32.726871,-32.716227,-32.719509,-32.709604,-32.719839,-32.711553,-32.741132,-32.744437,-32.761656,-32.769243,-32.777911,-32.784799,-32.787974,-32.792876,-32.78531,-32.838213,-32.88492,-32.919935,-32.911426,-32.882876,-32.884869,-32.902307,-32.889578,-32.877639,-32.894878,-32.92356,-32.916329,-32.922065,-32.90766,-32.924458,-32.925525,-32.915741,-32.963353,-32.978167,-33.01075,-33.051945,-33.070693,-33.08383,-33.084991,-33.064539,-33.062843,-33.055128,-33.053377,-33.036095,-33.028544,-33.015497,-33.003987,-32.993874,-32.984246,-32.974847,-32.962553,-32.966099,-32.976261,-33.005668,-32.989255,-32.996124,-32.998229,-33.004481,-32.997245,-33.010552,-33.047954,-33.050514,-33.026737,-33.032883,-33.04114,-33.043292,-33.059344,-33.047209,-33.056642,-33.059987,-33.068462,-33.072148,-33.082133,-33.085181,-33.071742,-33.075132,-33.062517,-33.073672,-33.072959,-33.090967,-33.090022,-33.102519,-33.104583,-33.088561,-33.100586,-33.114279,-33.114624,-33.120858,-33.114729,-33.126061,-33.130739,-33.124081,-33.137719,-33.139059,-33.147104,-33.160823,-33.143798,-33.15742,-33.175275,-33.154804,-33.145742,-33.131612,-33.13629,-33.122911,-33.102652,-33.12014,-33.126462,-33.131842,-33.14991,-33.161559,-33.131872,-33.124545,-33.100809,-33.093656,-33.069334,-33.095894,-33.093899,-33.095275,-33.08724,-33.092206,-33.086915,-33.111626,-33.120664,-33.121138,-33.140524,-33.154232,-33.175835,-33.188011,-33.19803,-33.210699,-33.244307,-33.271727,-33.282227,-33.314954,-33.343895,-33.326908,-33.277746,-33.266962,-33.262676,-33.261537,-33.244192,-33.252009,-33.237346,-33.233061,-33.239427,-33.220286,-33.222659,-33.261667,-33.263796,-33.280616,-33.282436,-33.301936,-33.298624,-33.30706,-33.319884,-33.328497,-33.329918,-33.34166,-33.354628,-33.365857,-33.336508,-33.345265,-33.362511,-33.374543,-33.398629,-33.435403,-33.451147,-33.468021,-33.486472,-33.494641,-33.523284,-33.530711,-33.547164,-33.522342,-33.527254,-33.520863,-33.506378,-33.515864,-33.515189,-33.530086,-33.554623,-33.550947,-33.570636,-33.555585,-33.535301,-33.528081,-33.510917,-33.508309,-33.499693,-33.499089,-33.484947,-33.507395,-33.530454,-33.521859,-33.521154,-33.495174,-33.48124,-33.486223,-33.476384,-33.47559,-33.453752,-33.456264,-33.473148,-33.470455,-33.488793,-33.512028,-33.520701,-33.536131,-33.50083,-33.502055,-33.515279,-33.511002,-33.493346,-33.486741,-33.470601,-33.469454,-33.455007,-33.43806,-33.426707,-33.447874,-33.461168,-33.469669,-33.463841,-33.480337,-33.445388,-33.449154,-33.459803,-33.456876,-33.461394,-33.448845,-33.475512,-33.484221,-33.466638,-33.475394,-33.467097,-33.490999,-33.491264,-33.49895,-33.523913,-33.524378,-33.513375,-33.517763,-33.510594,-33.50509,-33.507042,-33.521528,-33.519283,-33.531096,-33.522252,-33.529813,-33.541965,-33.537627,-33.546207,-33.541631,-33.550485,-33.542073,-33.56195,-33.567866,-33.578359,-33.586003,-33.587778,-33.587465,-33.599548,-33.600316,-33.590379,-33.585845,-33.587085,-33.57096,-33.568554,-33.575775,-33.551425,-33.55851,-33.536804,-33.538633,-33.529131,-33.514246,-33.536773,-33.541837,-33.549974,-33.54703,-33.541529,-33.544055,-33.538989,-33.569449,-33.567209,-33.572681,-33.574986,-33.561429,-33.579071,-33.594043,-33.592116,-33.594065,-33.607756,-33.625865,-33.629078,-33.641126,-33.646504,-33.655463,-33.652388,-33.660497,-33.626361,-33.609099,-33.618176,-33.599658,-33.602641,-33.594445,-33.605445,-33.598074,-33.597718,-33.588022,-33.588959,-33.572979,-33.571875,-33.579569,-33.605329,-33.603191,-33.620541,-33.62185,-33.628413,-33.631536,-33.636655,-33.656249,-33.644351,-33.660531,-33.667283,-33.666731,-33.651961,-33.639235,-33.635343,-33.631082,-33.614179,-33.623364,-33.601569,-33.579441,-33.582332,-33.597025,-33.624508,-33.68635,-33.696384,-33.703966,-33.703902,-33.727048,-33.74198,-33.746666,-33.746821,-33.753568,-33.768177,-33.773222,-33.781772,-33.791943,-33.807083,-33.823391,-33.8189,-33.80805,-33.809236,-33.798739,-33.798401,-33.810006,-33.817937,-33.800292,-33.803407,-33.77272,-33.783754,-33.772481,-33.784277,-33.787491,-33.789889,-33.79426,-33.797279,-33.795676,-33.802375,-33.805385,-33.805497,-33.813652,-33.818789,-33.816961,-33.811573,-33.803343,-33.827195,-33.827056,-33.844043,-33.842673,-33.853448,-33.836312,-33.848749,-33.839354,-33.84664,-33.841088,-33.852803,-33.844141,-33.850528,-33.841172,-33.847731,-33.833486,-33.843118,-33.842257,-33.82952,-33.828188,-33.836077,-33.821841,-33.828989,-33.824079]},{&#34;lng&#34;:[151.145228,151.144157,151.143724,151.136883,151.145228],&#34;lat&#34;:[-33.819212,-33.802992,-33.816767,-33.815139,-33.819212]},{&#34;lng&#34;:[151.306067,151.297748,151.293722,151.28119,151.269693,151.274725,151.282554,151.293206,151.299954,151.306067],&#34;lat&#34;:[-33.703855,-33.703626,-33.714532,-33.708689,-33.714981,-33.723664,-33.713518,-33.721428,-33.704976,-33.703855]},{&#34;lng&#34;:[151.696572,151.696455,151.726219,151.72816,151.746513,151.773765,151.783752,151.794071,151.792438,151.818614,151.808691,151.783973,151.770283,151.768297,151.756742,151.727293,151.685247,151.696572],&#34;lat&#34;:[-32.844091,-32.832942,-32.838129,-32.84691,-32.853629,-32.856276,-32.884307,-32.880601,-32.856892,-32.830965,-32.820564,-32.820293,-32.828355,-32.852278,-32.852628,-32.835469,-32.824087,-32.844091]},{&#34;lng&#34;:[151.700776,151.711837,151.732806,151.700776],&#34;lat&#34;:[-32.851517,-32.871054,-32.879605,-32.851517]},{&#34;lng&#34;:[151.585876,151.577003,151.557077,151.563648,151.554302,151.568557,151.585876],&#34;lat&#34;:[-33.207801,-33.196558,-33.197317,-33.207493,-33.227804,-33.232948,-33.207801]},{&#34;lng&#34;:[151.455178,151.44399,151.448047,151.455178],&#34;lat&#34;:[-33.417566,-33.423311,-33.429788,-33.417566]},{&#34;lng&#34;:[151.435641,151.422558,151.429533,151.425744,151.435641],&#34;lat&#34;:[-33.456501,-33.460044,-33.46304,-33.471373,-33.456501]},{&#34;lng&#34;:[151.382814,151.365287,151.373431,151.352561,151.335922,151.359859,151.353753,151.369466,151.351264,151.345341,151.341916,151.338695,151.318424,151.33211,151.328932,151.31861,151.313467,151.324561,151.336551,151.333613,151.344635,151.352265,151.341328,151.352491,151.358572,151.36991,151.366009,151.377349,151.382048,151.372977,151.382814],&#34;lat&#34;:[-33.471893,-33.477195,-33.490622,-33.488875,-33.474252,-33.469491,-33.459686,-33.438742,-33.445212,-33.44061,-33.450655,-33.429917,-33.431432,-33.436342,-33.45156,-33.451542,-33.460629,-33.483225,-33.484434,-33.502023,-33.507517,-33.501627,-33.489082,-33.501436,-33.48978,-33.493748,-33.50247,-33.49962,-33.490067,-33.486403,-33.471893]},{&#34;lng&#34;:[151.316571,151.323983,151.307118,151.304525,151.316571],&#34;lat&#34;:[-33.486321,-33.482929,-33.467896,-33.481579,-33.486321]},{&#34;lng&#34;:[151.033594,151.03281,151.066072,151.039851,151.048829,151.051443,151.046488,151.058809,151.059507,151.069702,151.072161,151.075292,151.08941,151.077713,151.090471,151.094428,151.097649,151.109528,151.11551,151.102494,151.103798,151.086437,151.085403,151.071663,151.074759,151.054461,151.061823,151.049359,151.052862,151.03653,151.033594],&#34;lat&#34;:[-33.984756,-33.992545,-33.991887,-34.005495,-34.02058,-34.016762,-34.00761,-34.008153,-33.998177,-33.995968,-34.00609,-33.997841,-33.997472,-34.01258,-34.011887,-33.997849,-34.005821,-34.006689,-33.997327,-34.000906,-33.989403,-33.990453,-33.992662,-33.994262,-33.984036,-33.985123,-33.975238,-33.980172,-33.991004,-33.990931,-33.984756]},{&#34;lng&#34;:[151.033626,151.046513,151.044672,151.04434,151.024802,151.022601,151.015331,151.034336,151.033626],&#34;lat&#34;:[-33.984447,-33.970533,-33.947705,-33.970126,-33.977307,-33.964096,-33.982597,-33.977395,-33.984447]},{&#34;lng&#34;:[149.399284,149.39479,149.361948,149.341384,149.322394,149.315286,149.272048,149.273132,149.234884,149.24679,149.238597,149.214063,149.204883,149.208568,149.189701,149.197037,149.183629,149.189097,149.167696,149.164312,149.146775,149.149637,149.1386,149.138819,149.120902,148.807854,148.793247,148.808702,148.795719,148.796119,148.785764,148.788868,148.767058,148.774354,148.762675,148.772364,148.769231,148.778231,148.773039,148.788758,148.768473,148.783462,148.767495,148.798434,148.791182,148.822423,148.835715,148.856132,148.855652,148.872491,148.877693,148.886633,148.894087,148.903348,148.894887,148.897776,148.886623,148.907065,148.909367,148.959133,149.012198,149.048811,149.064408,149.095682,149.093517,149.101481,149.090716,149.109483,149.095379,149.097495,149.087612,149.078043,149.084514,149.14251,149.131376,149.151279,149.13555,149.155134,149.139052,149.146586,149.207546,149.254815,149.336502,149.352134,149.399284],&#34;lat&#34;:[-35.319175,-35.303157,-35.308998,-35.286648,-35.286708,-35.276286,-35.273644,-35.259287,-35.242822,-35.229217,-35.222127,-35.219507,-35.229549,-35.211501,-35.203308,-35.185499,-35.175618,-35.165677,-35.159881,-35.142046,-35.144856,-35.138669,-35.135257,-35.128466,-35.124517,-35.309647,-35.339156,-35.382373,-35.39292,-35.406549,-35.408748,-35.426382,-35.465405,-35.486003,-35.495505,-35.529329,-35.544096,-35.558852,-35.568157,-35.588179,-35.603186,-35.628342,-35.647323,-35.666492,-35.703449,-35.7209,-35.741884,-35.753518,-35.760874,-35.721422,-35.714936,-35.719136,-35.751288,-35.757798,-35.771654,-35.79465,-35.810063,-35.829563,-35.853065,-35.895456,-35.899697,-35.92041,-35.874932,-35.845716,-35.824221,-35.803698,-35.7656,-35.69664,-35.679285,-35.647313,-35.639697,-35.586127,-35.580594,-35.59257,-35.554173,-35.506926,-35.454422,-35.436628,-35.432543,-35.414836,-35.345305,-35.330079,-35.339914,-35.351317,-35.319175]}],[{&#34;lng&#34;:[152.328627,152.315824,152.319219,152.312026,152.305258,152.328627],&#34;lat&#34;:[-32.617406,-32.617576,-32.627907,-32.626782,-32.607247,-32.617406]}],[{&#34;lng&#34;:[152.2287,152.223921,152.222668,152.2287],&#34;lat&#34;:[-32.687163,-32.692407,-32.684061,-32.687163]}],[{&#34;lng&#34;:[152.203513,152.184939,152.192662,152.203513],&#34;lat&#34;:[-32.747611,-32.749721,-32.739777,-32.747611]}],[{&#34;lng&#34;:[151.982089,151.979795,151.973989,151.982089],&#34;lat&#34;:[-32.670746,-32.677524,-32.665379,-32.670746]}],[{&#34;lng&#34;:[151.975014,151.965513,151.969517,151.975014],&#34;lat&#34;:[-32.679871,-32.674177,-32.667628,-32.679871]}],[{&#34;lng&#34;:[150.421112,150.411333,150.42057,150.421112],&#34;lat&#34;:[-35.531174,-35.530274,-35.525966,-35.531174]}],[{&#34;lng&#34;:[150.230948,150.22909,150.222919,150.224006,150.230948],&#34;lat&#34;:[-36.250533,-36.258943,-36.25637,-36.243903,-36.250533]}]],[[{&#34;lng&#34;:[145.131889,145.129935,145.096149,145.076384,145.050185,145.025135,145.032399,145.010999,144.976631,144.948813,144.93741,144.918641,144.911152,144.887256,144.886653,144.838574,144.741749,144.651908,144.680224,144.734143,144.766733,144.814684,144.850929,144.923174,144.988387,144.994327,144.98283,145.02561,145.03242,145.044952,145.061688,145.08755,145.118468,145.124504,145.119793,145.125612,145.119588,145.099517,145.062214,145.051408,145.037916,145.017945,144.985526,144.985912,144.970308,144.935592,144.929856,144.925849,144.913404,144.912499,144.905739,144.907213,144.897148,144.905593,144.895277,144.903624,144.915524,144.904253,144.878621,144.868582,144.81439,144.79795,144.79917,144.735586,144.651639,144.592488,144.558663,144.515692,144.506846,144.487431,144.470912,144.464016,144.444841,144.397943,144.38069,144.381575,144.361606,144.366582,144.355617,144.365166,144.3848,144.40264,144.416599,144.425598,144.442823,144.478136,144.557972,144.631382,144.692223,144.7202,144.71963,144.706371,144.695743,144.703393,144.686582,144.623171,144.637022,144.632984,144.672246,144.659776,144.620173,144.613879,144.538709,144.508432,144.494878,144.499893,144.428618,144.332286,144.327444,144.30348,144.27951,144.256633,144.254013,144.200022,144.180587,144.184016,144.133818,144.104758,144.036497,143.979728,143.977136,143.986836,143.974348,143.923066,143.910271,143.870284,143.866226,143.842147,143.837008,143.756722,143.681545,143.670413,143.679941,143.666695,143.666012,143.646427,143.616031,143.554064,143.510919,143.428687,143.403133,143.356589,143.327535,143.302169,143.267387,143.259696,143.232964,143.080833,143.05499,143.05503,143.015378,142.947884,142.937026,142.90065,142.857631,142.852333,142.787658,142.684028,142.563319,142.492181,142.478862,142.480598,142.471653,142.372518,142.309371,142.28596,142.261528,142.244323,142.243958,142.255037,142.244905,142.1458,142.00267,141.929505,141.88151,141.742014,141.679524,141.601621,141.607931,141.623594,141.625059,141.650257,141.627968,141.626417,141.614846,141.573078,141.557894,141.555861,141.542787,141.521271,141.528466,141.519235,141.46102,141.434371,141.407068,141.413232,141.374319,141.364091,141.365531,141.397693,141.392104,141.35761,141.29528,141.227776,141.150129,141.028512,140.965735,140.973872,140.963103,140.963616,140.969273,140.980575,140.97532,140.986747,140.980453,140.988431,140.998139,141.012311,141.003776,141.00187,141.023262,141.034336,141.043439,141.042463,141.065601,141.071951,141.08491,141.089218,141.097587,141.087257,141.094238,141.120338,141.137307,141.142973,141.153111,141.153443,141.143847,141.15318,141.15367,141.165854,141.174668,141.18623,141.194437,141.187449,141.205907,141.222119,141.228468,141.241808,141.247217,141.242543,141.259566,141.283701,141.30079,141.317451,141.31353,141.325922,141.324937,141.346407,141.348504,141.358972,141.368758,141.369693,141.381587,141.388118,141.408248,141.407404,141.433901,141.432802,141.444539,141.450643,141.482801,141.494967,141.518744,141.506669,141.518577,141.506149,141.510071,141.533863,141.533546,141.547738,141.560468,141.583921,141.589743,141.603285,141.604947,141.589383,141.602959,141.584484,141.60458,141.618538,141.611817,141.627982,141.632653,141.67745,141.707415,141.720288,141.729935,141.729691,141.746343,141.761836,141.752623,141.756947,141.777897,141.776886,141.786445,141.841383,141.850694,141.853257,141.867763,141.876627,141.888789,141.884744,141.900686,141.922592,141.929784,141.925629,141.93299,141.945003,141.970437,141.969742,141.978235,142.02124,142.012927,142.036848,142.042265,142.0294,142.023852,142.027564,142.075638,142.065345,142.077538,142.08277,142.119613,142.120343,142.135161,142.146367,142.165577,142.159255,142.166529,142.166148,142.178309,142.183613,142.19858,142.219102,142.23313,142.235645,142.24372,142.235334,142.24403,142.243579,142.23229,142.248993,142.248845,142.232465,142.235894,142.253057,142.267332,142.273673,142.286132,142.298886,142.284023,142.283873,142.294386,142.330924,142.368436,142.396798,142.384459,142.389752,142.36353,142.378269,142.368057,142.373927,142.363897,142.350969,142.360695,142.351836,142.364539,142.359897,142.367936,142.353334,142.379267,142.384163,142.364268,142.359576,142.369722,142.377726,142.394681,142.374942,142.400571,142.367695,142.378183,142.376705,142.390211,142.405558,142.407693,142.426062,142.430178,142.444922,142.451622,142.458747,142.448847,142.467968,142.472705,142.458363,142.471264,142.461307,142.468257,142.45916,142.463988,142.45239,142.471077,142.483148,142.471654,142.472932,142.497078,142.498646,142.51417,142.49906,142.518864,142.499673,142.511671,142.507428,142.524612,142.533406,142.538793,142.55014,142.556744,142.567176,142.61578,142.632212,142.64444,142.646391,142.620498,142.618316,142.637334,142.661412,142.667412,142.678954,142.686657,142.676553,142.678646,142.698961,142.684489,142.691089,142.678929,142.68496,142.710436,142.709066,142.689172,142.700788,142.708902,142.689383,142.703692,142.700852,142.714821,142.722756,142.743966,142.761766,142.762411,142.745699,142.748291,142.784068,142.769991,142.782512,142.791428,142.810104,142.787687,142.797919,142.810259,142.804997,142.818507,142.823118,142.825038,142.83824,142.840679,142.852466,142.868177,142.855209,142.871867,142.860551,142.872151,142.875881,142.886457,142.886815,142.900176,142.893269,142.901526,142.923844,142.922267,142.932606,142.948867,142.959264,142.972708,142.982428,142.975282,142.989313,142.994573,143.017281,143.010179,143.032502,143.029424,143.039468,143.040422,143.054822,143.070763,143.076222,143.092828,143.112525,143.121272,143.111605,143.107243,143.127791,143.117841,143.133463,143.1474,143.161689,143.16536,143.173197,143.180987,143.179282,143.199179,143.200006,143.218847,143.213847,143.224384,143.228775,143.24066,143.248933,143.265285,143.274016,143.25213,143.273005,143.276736,143.286873,143.284327,143.294285,143.308844,143.318269,143.347876,143.347559,143.359559,143.341191,143.354957,143.34521,143.352563,143.338404,143.341732,143.321389,143.340526,143.342789,143.339492,143.322014,143.317704,143.323717,143.318825,143.329708,143.338117,143.331864,143.335987,143.322081,143.328679,143.336543,143.330492,143.337264,143.337663,143.350838,143.339058,143.34552,143.337446,143.345023,143.340858,143.348103,143.360762,143.361967,143.390647,143.381936,143.39182,143.386969,143.394677,143.449486,143.471482,143.518322,143.529155,143.548335,143.547023,143.570828,143.580984,143.563717,143.574076,143.57169,143.583507,143.59086,143.577937,143.569019,143.562074,143.598448,143.603015,143.616037,143.620416,143.633019,143.629381,143.642338,143.65714,143.668081,143.667922,143.682627,143.684521,143.693148,143.702284,143.703349,143.711685,143.709175,143.751004,143.768823,143.758802,143.765962,143.762852,143.790117,143.818018,143.813021,143.855435,143.858784,143.87138,143.876584,143.907733,143.906183,143.935045,143.933355,143.970101,143.972536,143.962441,143.974476,143.996841,143.999221,143.989865,144.009646,144.012702,144.034082,144.039215,144.0468,144.063958,144.062285,144.105015,144.117546,144.131488,144.142927,144.152629,144.162351,144.186788,144.195139,144.213483,144.221647,144.215952,144.24815,144.264496,144.29606,144.301278,144.295276,144.327832,144.318651,144.349111,144.351546,144.360283,144.355338,144.362329,144.37685,144.366709,144.377484,144.364806,144.384118,144.372189,144.382044,144.372936,144.384314,144.381433,144.390318,144.388885,144.398635,144.411388,144.401926,144.410936,144.403628,144.418183,144.407927,144.424381,144.416979,144.423428,144.426505,144.446974,144.460553,144.466553,144.464123,144.472233,144.466691,144.479415,144.479758,144.487583,144.48123,144.488638,144.493963,144.5019,144.501128,144.513047,144.50995,144.521099,144.512009,144.51614,144.553661,144.557655,144.563385,144.571127,144.586445,144.582515,144.590991,144.598917,144.608761,144.605957,144.615473,144.617551,144.608432,144.61767,144.628221,144.6183,144.626288,144.624999,144.632744,144.643921,144.653191,144.654966,144.658022,144.664631,144.667856,144.689004,144.683907,144.697522,144.698886,144.706461,144.715385,144.725675,144.717445,144.726379,144.740569,144.748239,144.771896,144.777064,144.794782,144.80787,144.813362,144.806398,144.81634,144.809893,144.819903,144.841922,144.841901,144.850851,144.847176,144.856474,144.857534,144.861373,144.86346,144.932614,144.94829,144.981909,144.985932,144.967808,144.961831,144.945499,144.945759,144.923606,144.931005,144.957378,144.948917,144.974954,144.968187,144.991436,144.992263,145.018998,145.049713,145.061056,145.089998,145.091922,145.114092,145.126435,145.127683,145.136636,145.139579,145.15917,145.153456,145.181014,145.189806,145.22276,145.225029,145.246178,145.260717,145.258317,145.272698,145.296542,145.324453,145.3554,145.38715,145.410625,145.412575,145.442293,145.450658,145.46344,145.472128,145.491977,145.502556,145.52251,145.535398,145.541889,145.538763,145.546741,145.562836,145.557997,145.56684,145.564011,145.59323,145.586792,145.598028,145.601134,145.606474,145.601748,145.626347,145.62832,145.614857,145.628134,145.620321,145.62957,145.63973,145.657449,145.669121,145.679053,145.673992,145.685852,145.698181,145.703269,145.695763,145.697327,145.720274,145.7263,145.716766,145.734238,145.731027,145.746109,145.778211,145.777006,145.792732,145.793445,145.80798,145.811662,145.81668,145.811353,145.828252,145.827548,145.840021,145.848589,145.845548,145.858624,145.847975,145.854042,145.902693,145.910314,145.900756,145.902934,145.925821,145.928,145.953701,145.944304,145.951071,145.945744,145.964818,145.958336,145.971314,145.97207,146.005866,146.016143,146.031488,146.048421,146.052346,146.059295,146.07355,146.075639,146.092199,146.09147,146.112378,146.107678,146.118718,146.134761,146.14065,146.132045,146.131357,146.145863,146.15468,146.173104,146.185976,146.199244,146.204747,146.211581,146.211155,146.222171,146.24298,146.241433,146.250889,146.244593,146.257183,146.272859,146.27503,146.282895,146.278803,146.291125,146.282181,146.293104,146.283023,146.291396,146.299009,146.300963,146.312986,146.315875,146.329072,146.325022,146.33889,146.368684,146.387557,146.379594,146.380606,146.399134,146.402962,146.425169,146.421673,146.437159,146.444738,146.454595,146.469966,146.467407,146.499726,146.502134,146.49248,146.500674,146.502585,146.519681,146.532293,146.549581,146.555958,146.552029,146.560301,146.583967,146.584147,146.61252,146.618716,146.60782,146.614299,146.650868,146.650178,146.658574,146.650336,146.655996,146.680199,146.675365,146.685812,146.695002,146.689603,146.707141,146.708878,146.731645,146.730065,146.752929,146.749851,146.762315,146.762818,146.796181,146.79457,146.803936,146.81838,146.816301,146.825542,146.825026,146.8367,146.857158,146.86453,146.872952,146.880556,146.90691,146.907763,146.924058,146.926804,146.943705,146.952498,146.956824,146.972589,146.981298,147.007444,147.006396,147.016319,147.013473,147.022777,147.034141,147.042344,147.052963,147.061812,147.0904,147.095444,147.091582,147.097003,147.103712,147.09214,147.099095,147.097671,147.106364,147.098074,147.109228,147.10682,147.11628,147.111931,147.123357,147.127391,147.144361,147.164456,147.206299,147.242378,147.285177,147.319949,147.352825,147.345681,147.355287,147.358193,147.383679,147.392344,147.390342,147.404631,147.450685,147.464072,147.478835,147.481553,147.494112,147.511421,147.525267,147.514925,147.521359,147.551873,147.584027,147.558887,147.547654,147.549115,147.591893,147.601438,147.637771,147.646777,147.68001,147.708415,147.718672,147.741292,147.773261,147.766797,147.776849,147.806153,147.817498,147.873121,147.88288,147.897506,147.895698,147.912342,147.908543,147.917083,147.91149,147.931559,147.923752,147.923974,147.934261,147.958994,147.964964,147.97426,147.973234,147.981774,147.99126,147.999692,147.989467,147.992889,147.982389,147.980247,147.999218,147.991074,147.998229,147.990652,148.000537,148.002388,148.037726,148.035191,148.022899,148.034795,148.021819,148.04062,148.026096,148.0349,148.02884,148.038676,148.032828,148.033753,148.040119,148.035234,148.043928,148.035011,148.058941,148.051243,148.055613,148.048959,148.037836,148.045966,148.037583,148.058163,148.059945,148.08028,148.087601,148.124663,148.119093,148.126424,148.11763,148.139815,148.124337,148.13341,148.150489,148.160713,148.169411,148.190134,148.19033,148.20599,148.217563,148.202781,148.214196,148.219547,148.211171,148.170243,148.130703,148.136703,148.132654,148.120472,148.126081,148.097983,148.108888,148.120152,148.126771,148.156663,148.179595,148.182473,148.194946,149.976679,149.964395,149.92477,149.906609,149.819715,149.775248,149.760994,149.765416,149.738748,149.706531,149.682392,149.677329,149.616596,149.600828,149.595839,149.56629,149.525501,149.516419,149.496934,149.495556,149.484958,149.461888,149.431022,149.340379,149.292448,149.275498,149.265391,149.265928,149.246711,149.124226,148.926358,148.88415,148.808733,148.749187,148.727786,148.717029,148.691027,148.626577,148.448176,148.289615,148.179178,147.951982,147.788216,147.642131,147.476303,147.067248,146.883139,146.887146,146.925517,146.898674,146.886424,146.882549,146.844005,146.842214,146.851407,146.880623,146.87821,146.815353,146.793687,146.791507,146.785908,146.766508,146.776554,146.753518,146.742174,146.712913,146.716388,146.696106,146.697708,146.657551,146.670659,146.65312,146.645934,146.652795,146.641029,146.58442,146.59367,146.582693,146.580423,146.576824,146.572005,146.57214,146.562535,146.54651,146.563125,146.566746,146.562451,146.552764,146.551209,146.539161,146.5412,146.514712,146.494669,146.492968,146.463062,146.437202,146.4391,146.410331,146.411203,146.387054,146.380986,146.350706,146.331821,146.33884,146.291719,146.26056,146.252627,146.243754,146.243941,146.227605,146.231156,146.212059,146.229248,146.202718,146.213181,146.199527,146.192048,146.200636,146.210668,146.204663,146.210699,146.195376,146.192597,146.18556,146.218497,146.233048,146.272814,146.263936,146.270271,146.292728,146.287195,146.292616,146.323098,146.352575,146.393215,146.414861,146.42073,146.435645,146.43796,146.467056,146.478636,146.46785,146.484472,146.480599,146.48741,146.489295,146.474089,146.450981,146.43611,146.445691,146.431755,146.437194,146.475392,146.464,146.470757,146.460439,146.477728,146.47446,146.48335,146.47977,146.455289,146.43112,146.425291,146.441603,146.434851,146.42686,146.431753,146.424079,146.42651,146.416015,146.389544,146.387825,146.374563,146.345818,146.342561,146.321444,146.32143,146.340665,146.342982,146.352339,146.316942,146.326362,146.316484,146.304711,146.303027,146.283915,146.291848,146.274329,146.248966,146.267295,146.269497,146.233903,146.189408,146.133534,146.083966,146.033608,146.009458,145.997901,146.006286,145.979368,145.940007,145.921197,145.910638,145.914922,145.869527,145.818249,145.765547,145.729472,145.714004,145.688938,145.672021,145.656874,145.638566,145.606696,145.560625,145.537514,145.483686,145.423688,145.372012,145.36342,145.41917,145.43448,145.432528,145.417718,145.428272,145.433813,145.416381,145.453556,145.481275,145.489876,145.515409,145.548933,145.552463,145.545145,145.515332,145.522134,145.497964,145.488988,145.459991,145.438385,145.410917,145.347072,145.341337,145.324841,145.298309,145.274132,145.278629,145.271575,145.254773,145.253302,145.261731,145.225654,145.22302,145.206203,145.199986,145.192934,145.199945,145.192849,145.218781,145.213463,145.221952,145.210923,145.196407,145.183986,145.215199,145.234486,145.131889],&#34;lat&#34;:[-38.390694,-38.390452,-38.402507,-38.425446,-38.430022,-38.475332,-38.486451,-38.479662,-38.490335,-38.488548,-38.497082,-38.497017,-38.489253,-38.498852,-38.477217,-38.430328,-38.353947,-38.304077,-38.305219,-38.32248,-38.356385,-38.368549,-38.368747,-38.349256,-38.316711,-38.304469,-38.296413,-38.253352,-38.212673,-38.213405,-38.201202,-38.164238,-38.145695,-38.108031,-38.074099,-38.071656,-38.073219,-38.026878,-37.990841,-37.986726,-37.996447,-37.981804,-37.926238,-37.893195,-37.860787,-37.842548,-37.847323,-37.839845,-37.841967,-37.849458,-37.840155,-37.849526,-37.842552,-37.851732,-37.848421,-37.861466,-37.865543,-37.872525,-37.868083,-37.858712,-37.875144,-37.905305,-37.92317,-37.943135,-38.001638,-38.004581,-38.037541,-38.045604,-38.091508,-38.07828,-38.083542,-38.076715,-38.0918,-38.073816,-38.085264,-38.097352,-38.105136,-38.109905,-38.137201,-38.144831,-38.143255,-38.155458,-38.155329,-38.123813,-38.149522,-38.164482,-38.154858,-38.107385,-38.119967,-38.146631,-38.173256,-38.21022,-38.21976,-38.201527,-38.197462,-38.251465,-38.2661,-38.269788,-38.265268,-38.273912,-38.275913,-38.292253,-38.271631,-38.274791,-38.282627,-38.29049,-38.281629,-38.323258,-38.340177,-38.348258,-38.372347,-38.382747,-38.395472,-38.406675,-38.418909,-38.428699,-38.434529,-38.469255,-38.475775,-38.532276,-38.542552,-38.548451,-38.565237,-38.593108,-38.623094,-38.655271,-38.671668,-38.679003,-38.692793,-38.706707,-38.737487,-38.752384,-38.760838,-38.768315,-38.779379,-38.791286,-38.795509,-38.855695,-38.85758,-38.783354,-38.780987,-38.75395,-38.757208,-38.750179,-38.763093,-38.772964,-38.766436,-38.651018,-38.64787,-38.641398,-38.6245,-38.619768,-38.627336,-38.610166,-38.605289,-38.591827,-38.569124,-38.495133,-38.422004,-38.393871,-38.395027,-38.401392,-38.40431,-38.349483,-38.356322,-38.366494,-38.364586,-38.378032,-38.387985,-38.39119,-38.396468,-38.391487,-38.310335,-38.278215,-38.265811,-38.253109,-38.267864,-38.313185,-38.342272,-38.341701,-38.361992,-38.393048,-38.393458,-38.406344,-38.39302,-38.389705,-38.405684,-38.42627,-38.432968,-38.41471,-38.404854,-38.390029,-38.362096,-38.360306,-38.369077,-38.396287,-38.386757,-38.377011,-38.365317,-38.338554,-38.319729,-38.274759,-38.220641,-38.170649,-38.126841,-38.071588,-38.055989,-37.462093,-35.748535,-33.980648,-33.997216,-33.999996,-34.009321,-34.010237,-34.016013,-34.030777,-34.019698,-34.024655,-34.027604,-34.039103,-34.059699,-34.035735,-34.042704,-34.061101,-34.050062,-34.06291,-34.062288,-34.076696,-34.070035,-34.057173,-34.050656,-34.064866,-34.057561,-34.063534,-34.054521,-34.064189,-34.067799,-34.068915,-34.082118,-34.083212,-34.073334,-34.091977,-34.087608,-34.079294,-34.061723,-34.061677,-34.073651,-34.061315,-34.073209,-34.087341,-34.078134,-34.103874,-34.113718,-34.112413,-34.12486,-34.126866,-34.138782,-34.124348,-34.112311,-34.110723,-34.127115,-34.120204,-34.122143,-34.13473,-34.127856,-34.1464,-34.145904,-34.15994,-34.168015,-34.161004,-34.163425,-34.154611,-34.18091,-34.190619,-34.203159,-34.210498,-34.216479,-34.210697,-34.191434,-34.200841,-34.1909,-34.198816,-34.186893,-34.191228,-34.183933,-34.177353,-34.162254,-34.151403,-34.149115,-34.156287,-34.139023,-34.145417,-34.121484,-34.101225,-34.096068,-34.114589,-34.105442,-34.090896,-34.103403,-34.097537,-34.106242,-34.112097,-34.101774,-34.116878,-34.111685,-34.132452,-34.124307,-34.131233,-34.128652,-34.137418,-34.124415,-34.114984,-34.111198,-34.11457,-34.12579,-34.134605,-34.138238,-34.119477,-34.136107,-34.119898,-34.112616,-34.125258,-34.105246,-34.099306,-34.105298,-34.118211,-34.115054,-34.122981,-34.131418,-34.150611,-34.157346,-34.173545,-34.174909,-34.156705,-34.160738,-34.148972,-34.152124,-34.171482,-34.171395,-34.182923,-34.183743,-34.175672,-34.183496,-34.181064,-34.214407,-34.204042,-34.20987,-34.223748,-34.232457,-34.245768,-34.255036,-34.265054,-34.284983,-34.296749,-34.306973,-34.306139,-34.295284,-34.304021,-34.296536,-34.305703,-34.31076,-34.326567,-34.32345,-34.339378,-34.326913,-34.338095,-34.346915,-34.362799,-34.362158,-34.36475,-34.37065,-34.388151,-34.38568,-34.396629,-34.411768,-34.422288,-34.422704,-34.431933,-34.435415,-34.469582,-34.466704,-34.478091,-34.484715,-34.498779,-34.503819,-34.491397,-34.493484,-34.515284,-34.522747,-34.530446,-34.532145,-34.540985,-34.549119,-34.541508,-34.567972,-34.562348,-34.574793,-34.57549,-34.584265,-34.581498,-34.559483,-34.564295,-34.576695,-34.587575,-34.592677,-34.606565,-34.612934,-34.616289,-34.626677,-34.63365,-34.640135,-34.635824,-34.651796,-34.670098,-34.669376,-34.681025,-34.690931,-34.700026,-34.703671,-34.739364,-34.740888,-34.748839,-34.759584,-34.753025,-34.762876,-34.76266,-34.775373,-34.766928,-34.785261,-34.784136,-34.775338,-34.763394,-34.757128,-34.728751,-34.735043,-34.721707,-34.735908,-34.739202,-34.733929,-34.729046,-34.722345,-34.725138,-34.714057,-34.701397,-34.680153,-34.670774,-34.676748,-34.662674,-34.651925,-34.624516,-34.621788,-34.61664,-34.613953,-34.598276,-34.600442,-34.59236,-34.60296,-34.598485,-34.589287,-34.586273,-34.576759,-34.580393,-34.568882,-34.564933,-34.546389,-34.560855,-34.590178,-34.597628,-34.589093,-34.608401,-34.612357,-34.600251,-34.60878,-34.613044,-34.625752,-34.619195,-34.627306,-34.639522,-34.650292,-34.665162,-34.664119,-34.674859,-34.672085,-34.679808,-34.671464,-34.665679,-34.654958,-34.647856,-34.656482,-34.655515,-34.669674,-34.664982,-34.695207,-34.68274,-34.670861,-34.662579,-34.673872,-34.67366,-34.693658,-34.682928,-34.691851,-34.702611,-34.685888,-34.698855,-34.67838,-34.695958,-34.701273,-34.680819,-34.687401,-34.687127,-34.701466,-34.692661,-34.703076,-34.700577,-34.714757,-34.697916,-34.718136,-34.719709,-34.709482,-34.717329,-34.717034,-34.733418,-34.729471,-34.738496,-34.758733,-34.747789,-34.74546,-34.757853,-34.748558,-34.752685,-34.772803,-34.776412,-34.79226,-34.794985,-34.785245,-34.790822,-34.779939,-34.790842,-34.791635,-34.807302,-34.816899,-34.846309,-34.846039,-34.853463,-34.858235,-34.870312,-34.88112,-34.88846,-34.91374,-34.932533,-34.943632,-34.942339,-34.952598,-34.979085,-34.992943,-34.995744,-35.010891,-35.023804,-35.037375,-35.036727,-35.0459,-35.043219,-35.05388,-35.048645,-35.061294,-35.064702,-35.068191,-35.074056,-35.080418,-35.08702,-35.095714,-35.10544,-35.103032,-35.1169,-35.145107,-35.17312,-35.172567,-35.183462,-35.192377,-35.189112,-35.219293,-35.21162,-35.219921,-35.21379,-35.206173,-35.206905,-35.220036,-35.243545,-35.256505,-35.267959,-35.265005,-35.281659,-35.303197,-35.302447,-35.337244,-35.352111,-35.365407,-35.368884,-35.387682,-35.383467,-35.392368,-35.401037,-35.384999,-35.385735,-35.371554,-35.374091,-35.368446,-35.383917,-35.377882,-35.389408,-35.38469,-35.392538,-35.387835,-35.401809,-35.415427,-35.415858,-35.423066,-35.422477,-35.437545,-35.446265,-35.461838,-35.479978,-35.477828,-35.486166,-35.494162,-35.499958,-35.499288,-35.50661,-35.500078,-35.509249,-35.51398,-35.532309,-35.53625,-35.545367,-35.554663,-35.563307,-35.554073,-35.555971,-35.549257,-35.563141,-35.570545,-35.576768,-35.59078,-35.625926,-35.640761,-35.647253,-35.642678,-35.671526,-35.670431,-35.685858,-35.686671,-35.693952,-35.706477,-35.721034,-35.751403,-35.737091,-35.742986,-35.754379,-35.752646,-35.766574,-35.767142,-35.785069,-35.784811,-35.788479,-35.795834,-35.792979,-35.811253,-35.814346,-35.820937,-35.819565,-35.83195,-35.833175,-35.83815,-35.841922,-35.852423,-35.850553,-35.85848,-35.862667,-35.859003,-35.86802,-35.871189,-35.880666,-35.89322,-35.904013,-35.900194,-35.910472,-35.906005,-35.918744,-35.935531,-35.939596,-35.933602,-35.940942,-35.940725,-35.945927,-35.945275,-35.953295,-35.949511,-35.958609,-35.957123,-35.968592,-35.958039,-35.970606,-35.965202,-35.973945,-35.970266,-35.988895,-35.995438,-36.002984,-36.014107,-36.007806,-36.024079,-36.027182,-36.038135,-36.043318,-36.037411,-36.041808,-36.036542,-36.031593,-36.046904,-36.063641,-36.077192,-36.065259,-36.059708,-36.0618,-36.052081,-36.048097,-36.056664,-36.05324,-36.075349,-36.07038,-36.077042,-36.068596,-36.061417,-36.095138,-36.094047,-36.087259,-36.092948,-36.086214,-36.089438,-36.112113,-36.117781,-36.107576,-36.121746,-36.116132,-36.129837,-36.117285,-36.123628,-36.113912,-36.107457,-36.109865,-36.102428,-36.107947,-36.100576,-36.083098,-36.080645,-36.072881,-36.073553,-36.065171,-36.071838,-36.059112,-36.067049,-36.082904,-36.072316,-36.056509,-36.042078,-36.018216,-36.012186,-36.004312,-35.988768,-35.96847,-35.961005,-35.931602,-35.883845,-35.865528,-35.858984,-35.852338,-35.856647,-35.833671,-35.837309,-35.825457,-35.835957,-35.820548,-35.829671,-35.820716,-35.83427,-35.828538,-35.831077,-35.843045,-35.842026,-35.834267,-35.84244,-35.832184,-35.830321,-35.835426,-35.850588,-35.845203,-35.860566,-35.850686,-35.867067,-35.850142,-35.848613,-35.830601,-35.835642,-35.821418,-35.826274,-35.80923,-35.815076,-35.809449,-35.818486,-35.801983,-35.808905,-35.821813,-35.812894,-35.813449,-35.82823,-35.826497,-35.83419,-35.849077,-35.861245,-35.861458,-35.875008,-35.874998,-35.867857,-35.862758,-35.867775,-35.87257,-35.875409,-35.883884,-35.880105,-35.894239,-35.900686,-35.919586,-35.916829,-35.925924,-35.930615,-35.920977,-35.925702,-35.925792,-35.936501,-35.934449,-35.942312,-35.950594,-35.951348,-35.958734,-35.964239,-35.960243,-35.972559,-35.972801,-35.982817,-35.983762,-35.991769,-35.9882,-35.984102,-35.982982,-35.975438,-35.983244,-35.980899,-35.97346,-35.974814,-35.968689,-35.959927,-35.952496,-35.955962,-35.961529,-35.968856,-35.964563,-35.973947,-35.9615,-35.966495,-35.976626,-35.983809,-35.99677,-36.006973,-36.005651,-36.015747,-36.003569,-36.006962,-35.994714,-36.003158,-35.995465,-36.014548,-36.009637,-36.018177,-36.021266,-36.009477,-36.006811,-36.014369,-36.018014,-36.002547,-36.008954,-36.010095,-36.019413,-36.013776,-36.025159,-36.019293,-36.042071,-36.027453,-36.039158,-36.028559,-36.03886,-36.029921,-36.028784,-36.023524,-36.02313,-36.01834,-36.012053,-36.026631,-36.012441,-36.011048,-36.01585,-36.020163,-36.026188,-36.029503,-36.041488,-36.038952,-36.047859,-36.03659,-36.045568,-36.038453,-36.043144,-36.033543,-36.026395,-36.050862,-36.035639,-36.028127,-36.012895,-36.007199,-35.98878,-35.973027,-35.965831,-35.967015,-35.977991,-35.962247,-35.976201,-35.98424,-35.99087,-35.983188,-35.985012,-35.979244,-35.958235,-35.960604,-35.984299,-35.992457,-35.989182,-35.979592,-35.976391,-35.983864,-35.974987,-35.972858,-35.975937,-35.986372,-35.99648,-36.007735,-36.013796,-36.014488,-36.018411,-36.026252,-36.022376,-36.028599,-36.040576,-36.034315,-36.030446,-36.036122,-36.029435,-36.023725,-36.044724,-36.042113,-36.061277,-36.051665,-36.059519,-36.065138,-36.058545,-36.055194,-36.067834,-36.074377,-36.070847,-36.088724,-36.082073,-36.084918,-36.073084,-36.073681,-36.087524,-36.084946,-36.111284,-36.108315,-36.097178,-36.115989,-36.110788,-36.078061,-36.082113,-36.094876,-36.083732,-36.089115,-36.089798,-36.104721,-36.099895,-36.115239,-36.104305,-36.107881,-36.066155,-36.049226,-36.05271,-36.043861,-36.046784,-36.032854,-36.02765,-36.026194,-36.015823,-36.016455,-36.010246,-36.012549,-36.004825,-36.007635,-36.000922,-35.994498,-36.018047,-36.037765,-36.030798,-36.050136,-36.038482,-36.039439,-36.060987,-36.031749,-36.018772,-36.009832,-35.991276,-35.972352,-35.973533,-35.949266,-35.943495,-35.960804,-35.944137,-35.942689,-35.949223,-35.943549,-35.962412,-35.963338,-35.976369,-35.986936,-36.004095,-35.984648,-35.972489,-35.978625,-35.96455,-35.969859,-35.979118,-35.96211,-35.946008,-35.944439,-35.928545,-35.945513,-35.95649,-35.958863,-35.964158,-35.968614,-35.965057,-35.979741,-35.991006,-36.001798,-35.999861,-35.993018,-35.995198,-36.001473,-36.011204,-36.026597,-36.035267,-36.035709,-36.042491,-36.047637,-36.040974,-36.046853,-36.038505,-36.046314,-36.040254,-36.052559,-36.046204,-36.068478,-36.081071,-36.077891,-36.086482,-36.098655,-36.111251,-36.115919,-36.121272,-36.124355,-36.140057,-36.140797,-36.152536,-36.153457,-36.162983,-36.176462,-36.206951,-36.223042,-36.234116,-36.247044,-36.259221,-36.26586,-36.28223,-36.284157,-36.292329,-36.299479,-36.310577,-36.320046,-36.324557,-36.334386,-36.355632,-36.366246,-36.367038,-36.390225,-36.400804,-36.415538,-36.422101,-36.451895,-36.464713,-36.481884,-36.485274,-36.495476,-36.525445,-36.550642,-36.566921,-36.558336,-36.579776,-36.573696,-36.57662,-36.584891,-36.586932,-36.598239,-36.611915,-36.61049,-36.619558,-36.650519,-36.712799,-36.734683,-36.738436,-36.750847,-36.756303,-36.759417,-36.787161,-36.800865,-36.806079,-36.796451,-36.790013,-36.796326,-36.804895,-36.796253,-37.50506,-37.517956,-37.526348,-37.542865,-37.544829,-37.557838,-37.566909,-37.573855,-37.585037,-37.643525,-37.664158,-37.685082,-37.700613,-37.712062,-37.726576,-37.724577,-37.737284,-37.749082,-37.753367,-37.768225,-37.775441,-37.769302,-37.777377,-37.776913,-37.78746,-37.803777,-37.798457,-37.789319,-37.780474,-37.777287,-37.781403,-37.789958,-37.786417,-37.797037,-37.815437,-37.804438,-37.801441,-37.808219,-37.80172,-37.810988,-37.831635,-37.894066,-37.955322,-38.036875,-38.15175,-38.475119,-38.634634,-38.620153,-38.594225,-38.612218,-38.614398,-38.604607,-38.604835,-38.615343,-38.612415,-38.616834,-38.626484,-38.648874,-38.644809,-38.633329,-38.646241,-38.650138,-38.654217,-38.652583,-38.664925,-38.647777,-38.660899,-38.669995,-38.67535,-38.671491,-38.66291,-38.642985,-38.650711,-38.658737,-38.668902,-38.677087,-38.684768,-38.698475,-38.679462,-38.692143,-38.6777,-38.683307,-38.67824,-38.68452,-38.68318,-38.691119,-38.698048,-38.68929,-38.703789,-38.698269,-38.685376,-38.694242,-38.679739,-38.69676,-38.70208,-38.694436,-38.699711,-38.711911,-38.721218,-38.720748,-38.685645,-38.67292,-38.681068,-38.690666,-38.695268,-38.687323,-38.697512,-38.695281,-38.682832,-38.689144,-38.695179,-38.692854,-38.701188,-38.71335,-38.719708,-38.716096,-38.726245,-38.733016,-38.728486,-38.735404,-38.737946,-38.735871,-38.728737,-38.74337,-38.771826,-38.809044,-38.806048,-38.823443,-38.86014,-38.876466,-38.894454,-38.904551,-38.903579,-38.868224,-38.850494,-38.852078,-38.803807,-38.795912,-38.778922,-38.780916,-38.79178,-38.871049,-38.883179,-38.89139,-38.894269,-38.910464,-38.916245,-38.947851,-38.981022,-39.003708,-39.010977,-39.021014,-39.025666,-39.028932,-39.035718,-39.036915,-39.043765,-39.05494,-39.061028,-39.066834,-39.054116,-39.065527,-39.083549,-39.089754,-39.107727,-39.108278,-39.114822,-39.114799,-39.129986,-39.125521,-39.133959,-39.125091,-39.136721,-39.125384,-39.1106,-39.087887,-39.077981,-39.076953,-39.060987,-39.058857,-39.052255,-39.041118,-39.033666,-39.039363,-39.02347,-39.024887,-39.013118,-38.996389,-38.99602,-38.991191,-38.97296,-38.918669,-38.873545,-38.837409,-38.815933,-38.813189,-38.825703,-38.846406,-38.87792,-38.895077,-38.896113,-38.90961,-38.892758,-38.872133,-38.776148,-38.712973,-38.666752,-38.64484,-38.645141,-38.651209,-38.671595,-38.676923,-38.672436,-38.678782,-38.651407,-38.61109,-38.556001,-38.536479,-38.536297,-38.52097,-38.51319,-38.493623,-38.480368,-38.471373,-38.46083,-38.434868,-38.406995,-38.41266,-38.407126,-38.415096,-38.415475,-38.371688,-38.35245,-38.339536,-38.3378,-38.298944,-38.274077,-38.233414,-38.228038,-38.214401,-38.228048,-38.21357,-38.229565,-38.242155,-38.248493,-38.244101,-38.2344,-38.222965,-38.223062,-38.235679,-38.242426,-38.272428,-38.306462,-38.3038,-38.293078,-38.296557,-38.310851,-38.324507,-38.347604,-38.365909,-38.377797,-38.378673,-38.366586,-38.374587,-38.383113,-38.409689,-38.390694]},{&#34;lng&#34;:[146.84068,146.825352,146.798097,146.799439,146.794402,146.79191,146.800977,146.803176,146.819121,146.825275,146.84068],&#34;lat&#34;:[-38.615832,-38.609723,-38.620209,-38.628656,-38.626652,-38.632399,-38.632991,-38.620368,-38.613196,-38.620739,-38.615832]}],[{&#34;lng&#34;:[149.918469,149.906303,149.904809,149.918469],&#34;lat&#34;:[-37.568333,-37.567536,-37.548305,-37.568333]}],[{&#34;lng&#34;:[146.879039,146.828437,146.858094,146.835528,146.879039],&#34;lat&#34;:[-38.638149,-38.679496,-38.652723,-38.654171,-38.638149]}],[{&#34;lng&#34;:[146.826421,146.787947,146.752869,146.798672,146.826421],&#34;lat&#34;:[-38.683449,-38.68068,-38.689586,-38.675767,-38.683449]}],[{&#34;lng&#34;:[146.815451,146.786029,146.794058,146.815451],&#34;lat&#34;:[-38.659376,-38.669118,-38.65682,-38.659376]}],[{&#34;lng&#34;:[146.739461,146.726511,146.71549,146.709894,146.72062,146.727793,146.739461],&#34;lat&#34;:[-38.672911,-38.672302,-38.683892,-38.676575,-38.67646,-38.661227,-38.672911]}],[{&#34;lng&#34;:[146.715739,146.696231,146.707733,146.715739],&#34;lat&#34;:[-38.687077,-38.690865,-38.67673,-38.687077]}],[{&#34;lng&#34;:[146.685401,146.676565,146.683364,146.668862,146.685401],&#34;lat&#34;:[-38.677859,-38.684137,-38.689702,-38.684012,-38.677859]}],[{&#34;lng&#34;:[146.677547,146.626289,146.60183,146.606399,146.601021,146.595562,146.602819,146.585294,146.618435,146.614453,146.636787,146.630293,146.642945,146.677547],&#34;lat&#34;:[-38.708481,-38.724626,-38.722403,-38.717974,-38.71654,-38.720188,-38.726884,-38.715426,-38.697518,-38.701181,-38.698702,-38.705779,-38.699638,-38.708481]}],[{&#34;lng&#34;:[146.669254,146.652636,146.62974,146.669254],&#34;lat&#34;:[-38.718406,-38.727206,-38.724665,-38.718406]}],[{&#34;lng&#34;:[146.620487,146.597634,146.54534,146.494759,146.464605,146.471343,146.495,146.509663,146.503076,146.515585,146.508177,146.541851,146.508245,146.523886,146.500179,146.547905,146.54172,146.576886,146.59191,146.584271,146.60293,146.601349,146.620487],&#34;lat&#34;:[-38.75788,-38.759484,-38.790889,-38.774837,-38.739122,-38.728367,-38.729122,-38.718527,-38.726791,-38.730698,-38.73723,-38.728365,-38.752904,-38.752655,-38.762913,-38.757144,-38.756131,-38.735022,-38.742404,-38.747864,-38.744193,-38.752087,-38.75788]}],[{&#34;lng&#34;:[146.623101,146.667725,146.656002,146.623101],&#34;lat&#34;:[-38.757696,-38.747737,-38.755387,-38.757696]}],[{&#34;lng&#34;:[146.634077,146.621698,146.626852,146.634077],&#34;lat&#34;:[-38.697163,-38.694456,-38.690059,-38.697163]}],[{&#34;lng&#34;:[146.501883,146.493338,146.468395,146.438615,146.451102,146.501883],&#34;lat&#34;:[-38.716446,-38.725194,-38.717321,-38.727515,-38.710531,-38.716446]}],[{&#34;lng&#34;:[146.329832,146.325447,146.312072,146.329832],&#34;lat&#34;:[-39.141577,-39.14728,-39.134765,-39.141577]}],[{&#34;lng&#34;:[146.246238,146.240787,146.236406,146.24111,146.246238],&#34;lat&#34;:[-39.024357,-39.029639,-39.022245,-39.016688,-39.024357]}],[{&#34;lng&#34;:[146.241476,146.23555,146.222171,146.241476],&#34;lat&#34;:[-39.089053,-39.097594,-39.07132,-39.089053]}],[{&#34;lng&#34;:[145.503419,145.476252,145.406087,145.390367,145.386038,145.363825,145.352532,145.287996,145.275541,145.281426,145.272813,145.265575,145.27667,145.27351,145.287229,145.297586,145.285955,145.289378,145.297026,145.33036,145.351993,145.45237,145.503419],&#34;lat&#34;:[-38.354364,-38.366455,-38.372763,-38.385129,-38.406628,-38.405562,-38.419991,-38.395663,-38.394869,-38.404317,-38.409592,-38.402882,-38.391631,-38.357488,-38.309622,-38.30934,-38.305325,-38.284665,-38.282054,-38.292367,-38.311261,-38.306856,-38.354364]}],[{&#34;lng&#34;:[145.364351,145.360927,145.351273,145.34216,145.344009,145.316751,145.271133,145.240044,145.221203,145.203572,145.17066,145.116156,145.127384,145.147128,145.165431,145.200057,145.290603,145.302496,145.275161,145.27325,145.310365,145.290741,145.293145,145.305573,145.297319,145.35916,145.363649,145.347089,145.340937,145.364351],&#34;lat&#34;:[-38.553403,-38.566071,-38.567099,-38.559018,-38.54938,-38.524459,-38.504866,-38.506828,-38.529953,-38.517309,-38.509575,-38.518351,-38.505541,-38.503198,-38.465358,-38.451025,-38.450182,-38.453855,-38.454122,-38.460288,-38.460544,-38.48049,-38.488543,-38.485438,-38.506446,-38.509312,-38.515623,-38.520963,-38.535771,-38.553403]}],[{&#34;lng&#34;:[145.346151,145.332958,145.336761,145.346151],&#34;lat&#34;:[-38.508609,-38.499493,-38.493663,-38.508609]}],[{&#34;lng&#34;:[144.702137,144.667849,144.672019,144.663095,144.67872,144.678828,144.702137],&#34;lat&#34;:[-38.243412,-38.255016,-38.264367,-38.252993,-38.237599,-38.250631,-38.243412]}],[{&#34;lng&#34;:[142.014239,141.999012,141.993481,142.014239],&#34;lat&#34;:[-38.412576,-38.425446,-38.417372,-38.412576]}]],[[{&#34;lng&#34;:[141.663509,141.590263,141.566982,141.553601,141.52561,141.552048,141.601637,141.593972,141.599046,141.568572,141.481812,141.468182,141.467192,141.523282,141.550602,141.593261,141.625401,141.682104,141.69539,141.690764,141.679924,141.657764,141.645073,141.629493,141.613943,141.617772,141.604512,141.588712,141.583162,141.599741,141.63598,141.64099,141.65275,141.67029,141.710019,141.739899,141.762458,141.795327,141.803777,141.820167,141.827282,141.817508,141.830572,141.854522,141.863112,141.877741,141.859246,141.839532,141.827326,141.859272,141.886082,141.893743,141.879236,141.819877,141.811457,141.793507,141.768407,141.769747,141.760047,141.709417,141.702007,141.695757,141.694807,141.654488,141.643238,141.625708,141.600688,141.591918,141.673419,141.714829,141.735389,141.81038,141.85044,141.87998,141.90902,141.89585,141.8865,141.91417,141.922475,141.944354,141.915249,141.929601,141.947961,141.928906,141.932345,141.957978,141.994195,142.012235,142.000825,141.971675,141.942845,141.942175,141.961964,141.977424,142.001893,142.015953,142.026003,142.051312,142.088582,142.100492,142.097332,142.119961,142.126801,142.116221,142.12858,142.13768,142.1475,142.157281,142.147351,142.152941,142.144731,142.125936,142.132786,142.193636,142.221806,142.248187,142.284486,142.313237,142.315016,142.334127,142.351137,142.365382,142.390446,142.424926,142.422807,142.438257,142.459356,142.498206,142.530935,142.540634,142.541305,142.551724,142.556824,142.567004,142.573964,142.581064,142.583224,142.609273,142.597024,142.599654,142.578574,142.566455,142.549255,142.517215,142.510445,142.516095,142.501115,142.503365,142.488695,142.497815,142.500065,142.482115,142.498655,142.512395,142.525665,142.543325,142.555785,142.542645,142.557545,142.558225,142.571019,142.568985,142.575055,142.593516,142.585455,142.592885,142.589235,142.616544,142.616744,142.604285,142.619144,142.609294,142.614774,142.629875,142.638005,142.646005,142.644395,142.649785,142.667844,142.680704,142.698134,142.716333,142.752619,142.749459,142.756439,142.786058,142.787679,142.799359,142.783159,142.793549,142.802399,142.819809,142.828869,142.840358,142.868658,142.832959,142.826833,142.839668,142.834328,142.852167,142.859487,142.862418,142.850378,142.854158,142.847488,142.856358,142.881798,142.901078,142.909318,142.928968,142.922478,142.945898,142.974597,143.015387,143.060916,143.066136,143.066476,143.093195,143.098295,143.109465,143.122104,143.147504,143.149524,143.161964,143.167454,143.209833,143.213153,143.224633,143.244062,143.228083,143.216553,143.185584,143.101208,143.092949,143.078709,143.084929,143.094913,143.087593,143.095072,143.097043,143.086043,143.094903,143.081253,143.078573,143.084633,143.115583,143.128013,143.180291,143.182601,143.194901,143.21504,143.23012,143.24737,143.2498,143.266129,143.273859,143.27246,143.29689,143.30315,143.33136,143.354819,143.393429,143.414238,143.418829,143.438448,143.438164,143.402469,143.402929,143.418729,143.418861,143.390015,143.38211,143.357726,143.351337,143.359586,143.375846,143.391466,143.392776,143.401416,143.40512,143.449499,143.475459,143.502498,143.533628,143.544117,143.512348,143.498648,143.512858,143.504298,143.515448,143.503408,143.507368,143.523068,143.515869,143.533418,143.557388,143.580587,143.598187,143.579913,143.584876,143.579608,143.587831,143.543529,143.550189,143.54303,143.53174,143.54556,143.59135,143.601575,143.622395,143.681059,143.70369,143.69848,143.7038,143.73039,143.745771,143.781071,143.81912,143.88442,143.9323,143.94828,143.960259,144.029259,144.095208,144.130827,144.141677,144.151137,144.168306,144.196716,144.196065,144.208905,144.216345,144.231915,144.244555,144.262295,144.281934,144.293414,144.315604,144.343043,144.359763,144.374703,144.396752,144.436141,144.465391,144.49145,144.51621,144.558109,144.577539,144.576479,144.596249,144.581119,144.58704,144.622369,144.644159,144.651099,144.620731,144.614721,144.621871,144.618812,144.665112,144.679311,144.693331,144.692962,144.695181,144.715111,144.77426,144.782671,144.838781,144.910229,144.923899,144.92384,144.94268,144.950221,144.956112,144.961102,144.981992,144.980012,144.993822,144.994052,145.004272,145.004732,145.021562,145.024112,145.090172,145.135112,145.190621,145.188641,145.229631,145.220029,145.264669,145.282239,145.298157,145.314186,145.332776,145.340665,145.351825,145.354425,145.289367,145.23379,145.24,145.23821,145.263337,145.271207,145.314836,145.339456,145.356166,145.329736,145.285636,145.282996,145.297105,145.284765,145.287255,145.247296,145.240617,145.228487,145.240813,145.251703,145.2616,145.283008,145.272518,145.272019,145.287289,145.304239,145.322768,145.319399,145.328879,145.316379,145.31913,145.31275,145.33305,145.3355,145.361279,145.368609,145.351779,145.358289,145.376669,145.35641,145.35734,145.362645,145.382119,145.413839,145.434348,145.450718,145.463617,145.464827,145.476887,145.451968,145.439888,145.450448,145.441278,145.444913,145.469257,145.470347,145.481937,145.478937,145.488897,145.447568,145.418168,145.412129,145.419868,145.404883,145.410108,145.432268,145.442218,145.468583,145.470043,145.500033,145.513664,145.522083,145.523001,145.564978,145.581937,145.62153,145.651225,145.670996,145.682708,145.695344,145.714992,145.724854,145.744836,145.774867,145.765473,145.777029,145.768622,145.762438,145.764944,145.782282,145.779215,145.785005,145.793096,145.810054,145.848883,145.86975,145.906489,145.919205,145.95765,145.956178,145.944284,145.931008,145.934326,145.900704,145.889406,145.916021,145.929016,145.949206,145.952926,145.964546,145.961341,145.971611,145.995681,146.020756,146.050956,146.073196,146.064886,146.077936,146.076972,146.051617,146.057537,146.056347,146.036087,146.032707,146.027815,146.033216,146.058607,146.060287,146.068176,146.092116,146.127926,146.128606,146.112666,146.125846,146.126126,146.132366,146.140586,146.149046,146.113397,146.104528,146.111788,146.090909,146.105828,146.099739,146.106509,146.119588,146.097949,146.091528,146.101389,146.094319,146.07386,146.041036,146.027261,146.008032,146.016188,146.081542,146.085113,146.102762,146.133202,146.141122,146.159162,146.161223,146.173552,146.167503,146.190742,146.200462,146.188522,146.189373,146.213052,146.225892,146.257262,146.267952,146.290691,146.313471,146.337881,146.345431,146.321141,146.334071,146.322262,146.339171,146.341551,146.338922,146.319377,146.332142,146.339212,146.338512,146.301843,146.273274,146.273046,146.289834,146.321254,146.335829,146.363769,146.380119,146.396268,146.454158,146.472922,146.490402,146.516612,146.562233,146.597675,146.619064,146.678484,146.71422,146.723095,146.751196,146.730586,146.736162,146.767909,146.790875,146.805157,146.820076,146.833297,146.826132,146.835727,146.846774,146.835115,146.847858,146.842853,146.882572,146.942462,146.95803,146.960511,146.978229,147.001846,147.002298,147.021775,147.016266,147.039992,147.044939,147.060578,147.061436,147.046654,147.039126,147.047864,147.064978,147.113928,147.110219,147.1261,147.135756,147.135054,147.161539,147.212841,147.234598,147.246905,147.304177,147.410445,147.441009,147.455161,147.446045,147.417069,147.421087,147.4572,147.486996,147.501095,147.510235,147.500249,147.507735,147.559283,147.580988,147.574092,147.585439,147.600985,147.615437,147.616991,147.599654,147.586804,147.601361,147.663298,147.671351,147.70592,147.699507,147.707429,147.703843,147.738402,147.760707,147.773234,147.766767,147.780695,147.776332,147.782421,147.771729,147.767967,147.777875,147.769586,147.771169,147.767568,147.767896,147.744959,147.761022,147.752342,147.82355,147.851391,147.845667,147.864839,147.917833,147.99218,148.01756,148.026229,148.080109,148.097219,148.111949,148.164528,148.186208,148.220127,148.239247,148.255476,148.260137,148.266897,148.267497,148.25924,148.248892,148.251479,148.248641,148.239668,148.228018,148.230578,148.270267,148.266597,148.274777,148.283517,148.274217,148.277677,148.303397,148.320827,148.338647,148.352527,148.369406,148.396116,148.396146,148.421776,148.434856,148.441666,148.465955,148.478765,148.443805,148.441465,148.452014,148.474521,148.487234,148.494194,148.495044,148.513314,148.529864,148.540884,148.562873,148.566083,148.552724,148.554834,148.567884,148.566974,148.578393,148.579903,148.565994,148.576944,148.570314,148.598013,148.582774,148.582644,148.599234,148.619933,148.601154,148.614644,148.630043,148.628603,148.639393,148.646263,148.642903,148.652973,148.677932,148.660643,148.667703,148.662783,148.678973,148.685113,148.673151,148.689291,148.693727,148.702819,148.708756,148.738593,148.733082,148.753196,148.752342,148.769282,148.777648,148.801845,148.790971,148.793544,148.766376,148.769116,148.792996,148.791925,148.816349,148.822346,148.807002,148.816608,148.818407,148.825698,148.840711,148.837212,148.827887,148.831062,148.816384,148.820008,148.823733,148.839583,148.838684,148.846807,148.88024,148.902785,148.91123,148.890949,148.884123,148.919725,148.930143,148.906041,148.899025,148.884806,148.85686,148.856562,148.850387,148.846327,148.844955,148.821488,148.823216,148.831079,148.817398,148.823336,148.831756,148.824021,148.820537,148.813447,148.813726,148.800674,148.790881,148.793852,148.785911,148.75613,148.775656,148.784429,148.782173,148.763609,148.752566,148.736461,148.692808,148.684255,148.680172,148.692066,148.692698,148.713484,148.715093,148.662046,148.690309,148.686869,148.699939,148.71806,148.727163,148.730859,148.706317,148.732576,148.730798,148.758577,148.766828,148.777901,148.78081,148.80267,148.82966,148.84079,148.81466,148.82043,148.81328,148.79629,148.80082,148.787301,148.81119,148.820245,148.82386,148.83889,148.84944,148.83247,148.847055,148.843075,148.866225,148.87545,148.874915,148.884825,148.880975,148.892585,148.89018,148.915065,148.927934,148.938464,148.951184,148.971014,148.995409,149.005394,149.017403,149.029033,149.046113,149.046153,149.058963,149.028223,149.011654,149.030694,149.015949,149.021634,149.015164,149.019894,149.014244,149.041614,149.050123,149.064828,149.066118,149.067978,149.085758,149.064883,149.088933,149.108093,149.128642,149.122743,149.131763,149.132972,149.158072,149.157542,149.170522,149.174732,149.186722,149.205562,149.227032,149.223252,149.231109,149.223573,149.222753,149.209083,149.216853,149.209433,149.196026,149.192723,149.204033,149.199243,149.163474,149.152814,149.172634,149.215163,149.199823,149.192474,149.195984,149.185574,149.173918,149.214069,149.199274,149.181725,149.179245,149.201364,149.189155,149.198084,149.224904,149.255873,149.273993,149.298663,149.291203,149.301543,149.297233,149.315143,149.308573,149.31185,149.318603,149.317293,149.306444,149.302154,149.276174,149.283194,149.276359,149.288904,149.282184,149.295364,149.331263,149.338223,149.335483,149.322024,149.312554,149.297954,149.289124,149.298454,149.274255,149.289045,149.290455,149.300485,149.307665,149.326874,149.309214,149.334729,149.339589,149.357094,149.350059,149.395788,149.373619,149.398989,149.392779,149.400439,149.408694,149.400444,149.400979,149.414233,149.437813,149.444238,149.422019,149.436898,149.432349,149.449683,149.443393,149.453323,149.453323,149.465008,149.457373,149.472358,149.457713,149.468202,149.484592,149.486188,149.477748,149.473293,149.453473,149.438644,149.455934,149.444764,149.452744,149.458184,149.449284,149.470634,149.479704,149.455057,149.439715,149.425215,149.42165,149.430795,149.434306,149.438966,149.458355,149.463105,149.455936,149.471685,149.462276,149.465736,149.459826,149.465416,149.485256,149.490087,149.523372,149.517052,149.543228,149.553658,149.558938,149.566948,149.554378,149.562268,149.574128,149.598798,149.603203,149.597293,149.629358,149.656283,149.658283,149.684217,149.710507,149.713257,149.731057,149.766696,149.746857,149.743592,149.752103,149.774279,149.784309,149.811071,149.849895,149.88826,149.96283,149.991289,149.99137,150.003914,150.018199,150.046749,150.010519,150.002839,149.984749,149.976789,149.912858,149.961867,149.932098,149.971857,149.914938,149.922368,149.915778,149.917967,149.931137,149.955936,150.001079,150.035524,150.030279,150.042988,150.052448,150.059018,150.065568,150.080833,150.099653,150.092564,150.151598,150.157403,150.192233,150.178843,150.177423,150.205838,150.217108,150.293686,150.300536,150.301027,150.322206,150.331906,150.383866,150.40289,150.405021,150.424345,150.435425,150.430725,150.439275,150.44867,150.450725,150.483905,150.497645,150.50167,150.48868,150.4862,150.491779,150.502094,150.544769,150.53787,150.5148,150.522485,150.515765,150.532524,150.53039,150.544059,150.52984,150.538025,150.548565,150.537365,150.547444,150.559934,150.551534,150.562364,150.573019,150.591803,150.588413,150.597558,150.585279,150.581708,150.587458,150.569588,150.568933,150.552458,150.574145,150.556283,150.533073,150.534573,150.590022,150.575547,150.539083,150.539942,150.556417,150.541432,150.544817,150.529952,150.539347,150.561946,150.604135,150.62591,150.64579,150.640065,150.617505,150.6425,150.623376,150.615216,150.618636,150.610936,150.630696,150.64387,150.65778,150.650201,150.627986,150.646286,150.627336,150.65529,150.650306,150.666336,150.661376,150.672305,150.650465,150.667129,150.680935,150.678459,150.687049,150.693215,150.716555,150.753324,150.747379,150.758515,150.748255,150.74088,150.730955,150.723931,150.697536,150.696196,150.685971,150.678336,150.671906,150.681416,150.673656,150.674301,150.644267,150.673771,150.664957,150.667047,150.688867,150.679552,150.685717,150.681407,150.691721,150.717236,150.724826,150.718972,150.732174,150.714551,150.715323,150.694127,150.707253,150.727109,150.733302,150.728307,150.736141,150.748397,150.758852,150.748735,150.738273,150.751641,150.743647,150.741311,150.748526,150.752966,150.740966,150.742876,150.748196,150.744116,150.753556,150.748401,150.75604,150.762627,150.774148,150.756248,150.754424,150.783941,150.789315,150.780256,150.790639,150.784333,150.779138,150.777735,150.786458,150.80373,150.804404,150.812327,150.835158,150.821845,150.825062,150.812284,150.805956,150.815439,150.806843,150.810789,150.803827,150.796933,150.789701,150.786974,150.799992,150.777351,150.771499,150.749647,150.774816,150.794481,150.792261,150.799901,150.793094,150.791628,150.787931,150.798692,150.819339,150.82139,150.828377,150.825005,150.789579,150.767831,150.775645,150.792315,150.799482,150.793388,150.790968,150.810145,150.871371,150.860914,150.850034,150.79615,150.789945,150.878143,150.876483,150.834244,150.833894,150.866233,150.857223,150.874813,150.934553,150.959092,150.959182,150.932532,150.92531,150.968042,150.975392,151.026551,151.037969,151.041751,151.046681,151.040249,151.047795,151.068466,151.084687,151.079727,151.085843,151.092258,151.086404,151.097211,151.088649,151.109457,151.121765,151.134643,151.111054,151.117694,151.109567,151.124057,151.123751,151.132696,151.151126,151.159405,151.144189,151.17292,151.191392,151.192115,151.193076,151.236605,151.244858,151.235699,151.232966,151.271431,151.278032,151.296245,151.29762,151.318017,151.315069,151.302712,151.304569,151.324134,151.354824,151.366421,151.426636,151.429165,151.435432,151.424559,151.435346,151.437907,151.447977,151.442315,151.448235,151.440366,151.443492,151.457268,151.455317,151.460416,151.46195,151.466803,151.465782,151.47178,151.471903,151.48053,151.484324,151.493784,151.479508,151.474802,151.470354,151.441582,151.440501,151.467554,151.543937,151.544387,151.526828,151.501059,151.526838,151.517318,151.524738,151.547727,151.545417,151.552067,151.552807,151.555147,151.559857,151.563632,151.560467,151.580087,151.575937,151.555317,151.564917,151.573657,151.582697,151.610386,151.621031,151.634676,151.645036,151.65195,151.657295,151.665305,151.671165,151.67551,151.67826,151.682465,151.684115,151.664655,151.685655,151.677475,151.669105,151.651965,151.637586,151.64683,151.632866,151.634283,151.630156,151.604366,151.610556,151.644285,151.67305,151.697639,151.730299,151.704559,151.711524,151.702789,151.715804,151.720819,151.715844,151.732154,151.725309,151.738344,151.741424,151.734919,151.744894,151.738409,151.753378,151.764638,151.767938,151.786728,151.771478,151.784248,151.785098,151.784748,151.793108,151.804748,151.840618,151.821308,151.835928,151.875817,151.849138,151.878977,151.869007,151.882817,151.886317,151.906147,151.920427,151.943407,152.005857,152.040527,152.057576,152.044022,152.058583,152.064714,152.092274,152.148304,152.206262,152.274277,152.347777,152.33365,152.365042,152.346558,152.37888,152.396717,152.391174,152.377633,152.38135,152.384354,152.412788,152.421184,152.468174,152.494549,152.486776,152.486069,152.550688,152.542139,152.533094,152.536084,152.533678,152.546227,152.577064,152.633032,152.617739,152.577962,152.555448,152.540259,152.54703,152.548334,152.557037,152.614968,152.649715,152.644218,152.651022,152.663543,152.722444,152.806173,152.804595,152.81388,152.827847,152.834364,152.85972,152.899632,152.914399,152.901449,152.917988,152.909563,152.924357,152.909435,152.896511,152.889863,152.908245,152.871627,152.850713,152.823736,152.84854,152.885249,152.927981,152.934231,152.956344,152.948351,152.941699,152.946577,152.926372,152.896595,152.895778,152.903208,152.90995,152.897264,152.902572,152.875293,152.861913,152.87792,152.877635,152.883284,152.884657,152.880632,152.877291,152.875166,152.89211,152.901161,152.896449,152.911482,152.883661,152.878424,152.920244,152.907195,152.916792,152.912192,152.937548,152.937109,152.95667,152.97329,152.976007,152.971981,152.950656,152.939799,152.936701,152.941105,152.949192,152.944386,152.978301,152.983162,152.987162,153.020496,153.025888,153.015011,153.016583,152.993584,153.010355,153.009254,153.022094,153.031811,153.029973,153.025816,153.019815,153.003841,153.009335,153.001382,153.016418,153.006708,153.015653,152.997193,153.031298,152.998456,153.003359,153.009004,152.999139,153.007302,153.005557,153.016279,153.011199,153.016521,153.018696,153.026671,153.01478,153.031164,153.023982,153.03005,153.039089,153.042294,153.03225,153.040705,153.049083,153.046251,153.056353,153.027653,153.024576,153.034727,153.029748,153.037302,153.0514,153.050271,153.058282,153.052986,153.057335,153.066124,153.061091,153.047323,153.046452,153.054275,153.071615,153.046437,153.072249,153.085906,153.119893,153.161979,153.176516,153.182262,153.192335,153.152157,153.113189,153.076557,153.061367,153.063427,153.077224,153.092898,153.107715,153.119947,153.091911,153.102645,153.098687,153.108823,153.127094,153.139398,153.136998,153.151353,153.124729,153.11943,153.109102,153.112183,153.102459,153.094822,153.10171,153.092061,153.083224,153.069828,153.061082,153.061998,153.043135,153.06636,153.065016,153.043374,153.045258,153.024597,153.060155,153.075697,153.085032,153.083213,153.100416,153.111963,153.107325,153.096659,153.100203,153.110051,153.0989,153.126057,153.144158,153.132981,153.099109,153.066494,153.043352,153.035471,153.037897,153.022017,153.035161,153.033133,153.043356,153.030614,153.036581,153.029627,153.037481,153.088845,153.106349,153.116631,153.117923,153.107842,153.092921,153.077528,153.068411,153.075715,153.053859,153.077877,153.063699,153.069598,153.086758,153.082602,153.094306,153.155628,153.160525,153.146237,153.150412,153.141523,153.109678,153.090074,153.049781,153.053307,153.053493,153.088144,153.110598,153.142465,153.154775,153.165017,153.15799,153.1773,153.191259,153.179168,153.183347,153.165137,153.174157,153.173696,153.167551,153.175427,153.191389,153.189305,153.192153,153.194716,153.188581,153.194586,153.201022,153.207301,153.231516,153.241007,153.241638,153.260585,153.261627,153.290715,153.277905,153.281099,153.290254,153.307839,153.305318,153.317869,153.297344,153.311751,153.315098,153.308149,153.320757,153.315871,153.323032,153.30149,153.293164,153.298842,153.318216,153.327968,153.3481,153.356505,153.383078,153.369041,153.366158,153.378633,153.366053,153.367568,153.401058,153.402865,153.415913,153.388259,153.397494,153.385484,153.392498,153.412276,153.439283,153.426636,153.384271,153.385483,153.406446,153.411637,153.394902,153.373671,153.39207,153.390442,153.391554,153.381539,153.371244,153.381149,153.373182,153.370365,153.366521,153.371704,153.385794,153.377288,153.376473,153.392663,153.385722,153.381797,153.395478,153.39643,153.393036,153.395584,153.398364,153.401922,153.39515,153.40019,153.40012,153.410678,153.400363,153.400211,153.396297,153.407553,153.410302,153.421129,153.41898,153.427548,153.421281,153.434598,153.429127,153.431462,153.450361,153.477935,153.486379,153.514318,153.55214,153.534643,153.476931,153.457134,153.4356,153.40661,153.389527,153.356812,153.33518,153.330213,153.278912,153.262409,153.245848,153.231833,153.178049,153.174911,153.161067,153.168505,153.154794,153.143405,153.124665,153.12989,153.108829,153.04606,153.008199,152.972614,152.933856,152.880013,152.831138,152.804226,152.775455,152.751062,152.72288,152.679339,152.667228,152.638288,152.624513,152.614517,152.600303,152.6017,152.579242,152.568635,152.556437,152.555508,152.548142,152.525981,152.534221,152.508643,152.463586,152.442877,152.444831,152.414572,152.409517,152.417259,152.38616,152.355946,152.341582,152.309659,152.288432,152.267606,152.217189,152.190266,152.184519,152.160504,152.121134,152.0702,152.067033,152.045672,152.016864,151.988951,151.982893,151.955645,151.957677,151.985979,151.990804,152.010168,152.03915,152.052567,152.066354,152.066079,152.076049,152.042726,152.047714,152.036326,152.041726,152.034743,152.037291,152.017057,152.015064,152.025956,152.036909,152.038126,152.009703,152.00109,151.997593,151.968198,151.916048,151.900358,151.849363,151.837909,151.839557,151.832232,151.813804,151.806394,151.777834,151.770227,151.772735,151.743471,151.73386,151.706536,151.674758,151.644389,151.634688,151.609616,151.577091,151.566806,151.545566,151.536094,151.49823,151.49149,151.502292,151.486066,151.463025,151.451744,151.428307,151.410638,151.393784,151.33931,151.314762,151.308844,151.315471,151.279649,151.275509,151.288861,151.284865,151.271058,151.283956,151.276414,151.282556,151.272148,151.28234,151.274808,151.243908,151.234722,151.208752,151.200196,151.132965,151.1044,151.102759,151.083206,151.054835,151.045321,151.037362,151.041903,151.024763,151.019308,151.028963,151.028277,151.01065,150.938189,150.930908,150.906384,150.874008,150.848417,150.819279,150.818847,150.795757,150.752343,150.728255,150.708625,150.681695,150.6734,150.632541,150.625827,150.600191,150.580641,150.561392,150.554094,150.548167,150.552333,150.544079,150.527008,150.5392,150.525002,150.51481,150.487084,150.460085,150.445551,150.429277,150.415222,150.413973,150.401823,150.387879,150.387493,150.370045,150.363767,150.369675,150.352542,150.3513,150.327556,150.320591,150.289648,150.236053,150.238805,150.230399,150.229074,150.213149,150.212287,150.192465,150.186688,150.186598,150.17789,150.182694,150.171551,150.169233,150.15409,150.15228,150.138555,150.121475,150.110908,150.091932,150.092923,150.085176,150.079904,150.073281,150.04874,150.045836,150.016091,149.976953,149.950561,149.941892,149.936331,149.917404,149.899141,149.8623,149.844852,149.83036,149.819292,149.811439,149.784005,149.754943,149.74497,149.721169,149.7039,149.709917,149.703104,149.666654,149.674008,149.660712,149.655991,149.647886,149.642282,149.625491,149.610654,149.587938,149.568553,149.552587,149.528925,149.513949,149.502977,149.502704,149.481514,149.474862,149.452554,149.439518,149.442976,149.428298,149.432856,149.426129,149.417037,149.423022,149.405469,149.393867,149.387389,149.358975,149.346685,149.329862,149.317964,149.297081,149.269197,149.262342,149.253764,149.246912,149.224974,149.188805,149.19236,149.179183,149.160386,149.139757,149.143444,149.128192,149.112444,149.103225,149.097078,149.080762,149.080061,149.055338,149.063984,149.058652,149.04832,149.032686,149.009223,148.998297,148.976321,148.958308,140.999278,140.999394,137.999054,138.00118,138.047224,138.116737,138.175687,138.272896,138.323615,138.329075,138.362114,138.427904,138.450593,138.479513,138.471573,138.486433,138.539991,138.628959,138.657419,138.658579,138.650929,138.681159,138.822848,138.844638,138.880648,138.883798,138.915967,138.945167,138.979207,139.038676,139.034787,139.043217,139.079236,139.086716,139.157926,139.140556,139.155047,139.201159,139.23767,139.3058,139.34151,139.41741,139.45049,139.436441,139.4525,139.4769,139.53532,139.55236,139.550341,139.59095,139.603281,139.64669,139.7123,139.721619,139.751769,139.757299,139.808928,139.821768,139.839198,139.833888,139.845078,139.847208,139.937737,139.948817,140.004377,140.093435,140.199923,140.216683,140.384571,140.44792,140.46221,140.47918,140.565939,140.593629,140.709837,140.735497,140.769436,140.828396,140.828816,140.887415,140.893405,140.900835,140.893715,140.904994,140.899394,140.909664,140.912554,140.925543,140.940433,140.953912,140.962232,140.946891,140.958021,140.97359,141.01122,141.064849,141.082288,141.093878,141.128817,141.204446,141.221186,141.233035,141.251375,141.270655,141.296484,141.304864,141.287214,141.286073,141.320833,141.351082,141.41237,141.43277,141.40966,141.392669,141.373379,141.397569,141.409308,141.434677,141.479496,141.497286,141.541205,141.548655,141.545115,141.569345,141.580144,141.575594,141.580104,141.585964,141.580264,141.632334,141.642174,141.631654,141.641753,141.660193,141.667143,141.663509],&#34;lat&#34;:[-15.003962,-14.857313,-14.740314,-14.592565,-14.487086,-14.375277,-14.242417,-14.155358,-14.101668,-14.051248,-13.953329,-13.923139,-13.864249,-13.572129,-13.506939,-13.459149,-13.378009,-13.302759,-13.270078,-13.236639,-13.217539,-13.204199,-13.16893,-13.15943,-13.09195,-13.03996,-13.0204,-13.017231,-12.996721,-12.952071,-12.90875,-12.91839,-12.91676,-12.89413,-12.87898,-12.85347,-12.81661,-12.72914,-12.67953,-12.67181,-12.67682,-12.700095,-12.68633,-12.68623,-12.69341,-12.67131,-12.664557,-12.66828,-12.64855,-12.63774,-12.61729,-12.593527,-12.5839,-12.60146,-12.58422,-12.5822,-12.56566,-12.552661,-12.539141,-12.518951,-12.519571,-12.533801,-12.556981,-12.563411,-12.577601,-12.583261,-12.571791,-12.558962,-12.369542,-12.234722,-12.218212,-12.048632,-11.984452,-11.954412,-11.955462,-11.964312,-11.985032,-12.032331,-12.107571,-12.148747,-12.165088,-12.167335,-12.151173,-12.104043,-12.070881,-12.042323,-12.059651,-12.039111,-12.012891,-11.980111,-11.976481,-11.945512,-11.820772,-11.776973,-11.753273,-11.673083,-11.662313,-11.554844,-11.464734,-11.463214,-11.445034,-11.368544,-11.268365,-11.224665,-11.221675,-11.206955,-11.138305,-11.121775,-11.098745,-11.093865,-11.039075,-10.981375,-10.948445,-10.914974,-10.922214,-10.909323,-10.917763,-10.901143,-10.915153,-10.890193,-10.883343,-10.846412,-10.826413,-10.742142,-10.727902,-10.708162,-10.720282,-10.716813,-10.687543,-10.696253,-10.709483,-10.708363,-10.726463,-10.722073,-10.732813,-10.724803,-10.733843,-10.749023,-10.758393,-10.764393,-10.795782,-10.795322,-10.831822,-10.843762,-10.861152,-10.909442,-10.917702,-10.930662,-10.944083,-10.939062,-10.954432,-10.978373,-10.968122,-10.939722,-10.934882,-10.907892,-10.913442,-10.902232,-10.874102,-10.880092,-10.877778,-10.872312,-10.869602,-10.888215,-10.874932,-10.875162,-10.868152,-10.892262,-10.915102,-10.912142,-10.916462,-10.933852,-10.941882,-10.945182,-10.937162,-10.939311,-10.945761,-10.940001,-10.944651,-10.971581,-10.977901,-10.961072,-11.007101,-11.026831,-11.042091,-11.074181,-11.12676,-11.15723,-11.22267,-11.27855,-11.29145,-11.29181,-11.31444,-11.319459,-11.381579,-11.433529,-11.476509,-11.492619,-11.559689,-11.586389,-11.635889,-11.750998,-11.806098,-11.822658,-11.823918,-11.845518,-11.871858,-11.872128,-11.890098,-11.904377,-11.892658,-11.900438,-11.932917,-11.937648,-11.923668,-11.928258,-11.920118,-11.904088,-11.892178,-11.906108,-11.905138,-11.919368,-11.948888,-11.954358,-11.973298,-11.962188,-11.954438,-11.954128,-11.968728,-11.989087,-11.974818,-11.990818,-12.145645,-12.157625,-12.159225,-12.172775,-12.173455,-12.201015,-12.203964,-12.218295,-12.242135,-12.25907,-12.288905,-12.337485,-12.348225,-12.338685,-12.347365,-12.343105,-12.350445,-12.349076,-12.362706,-12.382005,-12.379146,-12.390095,-12.394355,-12.407105,-12.507515,-12.532535,-12.551605,-12.565215,-12.563915,-12.595554,-12.593244,-12.615954,-12.611814,-12.623334,-12.662274,-12.678584,-12.676014,-12.681659,-12.714834,-12.749964,-12.798353,-12.899033,-12.890613,-12.899373,-12.884773,-12.897983,-12.900213,-12.867803,-12.848823,-12.864103,-12.858603,-12.838973,-12.842773,-12.903583,-12.949623,-12.962453,-12.986533,-13.007853,-13.109882,-13.152892,-13.176492,-13.259291,-13.341301,-13.365201,-13.371951,-13.42231,-13.48572,-13.478674,-13.51031,-13.532395,-13.638879,-13.631199,-13.719418,-13.754558,-13.800278,-13.857577,-13.914237,-13.967536,-14.014576,-14.126626,-14.180085,-14.208565,-14.266395,-14.333114,-14.399224,-14.441843,-14.482093,-14.483533,-14.495552,-14.484892,-14.481322,-14.445142,-14.402042,-14.405022,-14.389712,-14.381412,-14.339412,-14.260973,-14.262473,-14.254143,-14.269092,-14.264172,-14.290752,-14.302552,-14.297952,-14.308632,-14.307922,-14.291142,-14.291072,-14.273062,-14.258592,-14.227732,-14.166023,-14.166643,-14.228472,-14.235062,-14.247362,-14.260612,-14.306081,-14.360741,-14.362041,-14.348301,-14.358361,-14.43746,-14.43067,-14.44582,-14.47539,-14.51104,-14.546729,-14.553299,-14.567079,-14.555449,-14.561019,-14.545499,-14.593619,-14.614338,-14.614048,-14.638778,-14.663168,-14.663748,-14.677187,-14.744837,-14.738857,-14.749587,-14.755117,-14.751967,-14.763596,-14.751736,-14.772406,-14.782686,-14.795106,-14.802785,-14.834964,-14.843184,-14.837424,-14.831414,-14.882814,-14.926825,-14.955165,-14.963165,-14.953105,-14.955005,-14.945055,-14.951025,-14.982535,-15.042444,-15.139043,-15.150834,-15.195553,-15.251053,-15.258093,-15.258792,-15.226402,-15.276531,-15.278191,-15.316242,-15.328312,-15.343302,-15.363112,-15.375332,-15.416212,-15.460111,-15.461961,-15.466201,-15.457451,-15.459583,-15.49854,-15.51791,-15.541291,-15.559111,-15.551411,-15.570271,-15.586971,-15.601031,-15.605362,-15.632262,-15.646802,-15.662612,-15.681492,-15.719592,-15.762102,-15.806742,-15.830392,-15.838852,-15.890132,-15.910472,-15.922011,-15.924162,-15.951002,-15.998091,-16.009321,-16.035981,-16.066401,-16.076101,-16.141161,-16.141941,-16.142751,-16.174651,-16.20087,-16.210901,-16.235841,-16.241411,-16.267991,-16.276681,-16.289641,-16.338301,-16.376181,-16.387931,-16.433469,-16.45929,-16.47657,-16.47237,-16.479899,-16.514379,-16.552869,-16.584406,-16.586255,-16.600962,-16.643166,-16.687196,-16.699544,-16.729489,-16.737356,-16.775579,-16.775609,-16.802725,-16.803881,-16.845446,-16.870016,-16.869253,-16.880369,-16.882253,-16.897883,-16.907311,-16.916654,-16.940451,-16.94112,-16.910558,-16.909296,-16.871187,-16.906641,-16.897216,-16.864294,-16.896578,-16.905488,-16.906528,-16.922994,-16.947528,-16.981681,-17.057605,-17.087024,-17.117334,-17.130704,-17.157714,-17.168464,-17.190143,-17.242033,-17.273253,-17.346753,-17.384523,-17.394723,-17.458893,-17.478233,-17.504552,-17.505453,-17.507143,-17.520933,-17.523053,-17.512255,-17.550271,-17.525349,-17.524883,-17.511283,-17.510403,-17.561573,-17.592542,-17.599332,-17.608882,-17.612542,-17.601472,-17.601382,-17.639712,-17.648552,-17.692952,-17.727952,-17.771592,-17.799982,-17.815632,-17.833242,-17.852022,-17.855802,-17.896852,-17.95512,-17.976861,-17.973781,-17.989941,-18.04366,-18.091021,-18.120531,-18.245019,-18.314669,-18.331279,-18.348539,-18.368729,-18.364079,-18.396929,-18.424498,-18.434868,-18.445338,-18.443998,-18.452338,-18.460048,-18.473828,-18.472768,-18.498278,-18.494938,-18.505198,-18.506847,-18.521937,-18.526627,-18.559257,-18.557277,-18.565267,-18.577727,-18.564467,-18.570227,-18.606837,-18.646066,-18.640977,-18.623337,-18.630337,-18.705106,-18.811606,-18.860081,-18.891896,-18.923686,-18.955955,-18.967975,-18.997654,-18.998504,-19.073694,-19.076499,-19.095135,-19.099867,-19.142458,-19.148266,-19.166734,-19.190592,-19.193935,-19.181596,-19.184335,-19.181629,-19.180332,-19.184747,-19.240479,-19.238539,-19.253125,-19.243609,-19.25537,-19.242859,-19.255496,-19.270653,-19.273273,-19.274131,-19.303572,-19.295367,-19.308763,-19.293305,-19.284667,-19.24938,-19.234673,-19.215849,-19.182294,-19.206935,-19.237325,-19.25631,-19.276699,-19.274518,-19.296994,-19.299327,-19.342182,-19.387779,-19.3971,-19.422471,-19.4176,-19.406806,-19.405439,-19.423941,-19.41863,-19.43246,-19.407635,-19.42596,-19.421161,-19.395188,-19.365197,-19.333208,-19.322341,-19.374345,-19.465523,-19.485051,-19.484808,-19.469631,-19.476318,-19.55051,-19.624886,-19.629301,-19.648531,-19.646408,-19.6731,-19.685965,-19.68704,-19.725095,-19.757456,-19.809681,-19.828357,-19.832018,-19.835572,-19.840872,-19.836084,-19.847056,-19.841212,-19.826567,-19.81572,-19.817997,-19.807068,-19.805358,-19.803795,-19.794397,-19.788982,-19.791693,-19.786103,-19.790298,-19.783452,-19.769102,-19.727363,-19.706598,-19.709652,-19.739251,-19.782071,-19.850986,-19.908314,-19.927621,-19.913135,-19.894015,-19.881865,-19.924945,-19.941575,-19.957954,-19.944074,-19.956044,-19.984565,-19.986003,-19.976814,-19.985984,-20.023654,-20.012547,-20.017802,-20.024241,-20.017995,-20.021594,-20.035494,-20.045324,-20.070613,-20.078323,-20.072213,-20.077473,-20.086573,-20.099563,-20.110673,-20.136103,-20.139583,-20.162703,-20.156962,-20.169042,-20.161722,-20.160522,-20.168462,-20.149432,-20.138392,-20.116602,-20.111202,-20.074542,-20.059357,-20.064583,-20.081482,-20.079252,-20.088462,-20.093272,-20.093762,-20.076322,-20.066731,-20.082151,-20.094191,-20.113871,-20.118811,-20.132731,-20.127301,-20.134421,-20.150001,-20.154511,-20.170281,-20.166331,-20.181651,-20.197641,-20.201281,-20.176701,-20.210931,-20.220381,-20.219521,-20.190981,-20.170921,-20.178171,-20.213891,-20.21614,-20.17869,-20.2167,-20.23335,-20.24748,-20.23098,-20.2414,-20.282328,-20.278935,-20.270449,-20.273368,-20.262698,-20.281753,-20.253784,-20.264379,-20.23568,-20.23596,-20.274114,-20.277982,-20.278788,-20.29125,-20.286925,-20.299708,-20.313718,-20.321269,-20.321452,-20.331937,-20.342616,-20.343832,-20.354473,-20.337722,-20.351944,-20.366232,-20.365425,-20.384403,-20.384908,-20.392198,-20.386794,-20.391641,-20.430952,-20.431738,-20.472264,-20.467044,-20.479457,-20.477035,-20.488102,-20.51364,-20.533787,-20.535454,-20.545231,-20.523211,-20.527893,-20.515517,-20.510276,-20.515312,-20.503168,-20.496763,-20.477737,-20.475004,-20.459189,-20.44958,-20.450811,-20.426102,-20.44354,-20.43992,-20.420824,-20.423677,-20.415232,-20.45366,-20.430393,-20.41892,-20.431747,-20.451789,-20.464256,-20.479701,-20.472877,-20.482013,-20.441293,-20.436008,-20.441259,-20.446153,-20.462628,-20.483623,-20.49484,-20.585768,-20.59909,-20.620521,-20.639731,-20.642498,-20.633001,-20.644586,-20.670681,-20.688476,-20.716657,-20.724379,-20.734395,-20.732122,-20.762469,-20.775879,-20.776589,-20.791109,-20.791019,-20.799629,-20.803679,-20.796999,-20.806699,-20.816599,-20.814179,-20.832048,-20.821449,-20.824539,-20.846558,-20.849719,-20.855967,-20.875967,-20.867587,-20.883038,-20.862527,-20.848777,-20.856047,-20.862157,-20.877908,-20.891977,-20.883797,-20.888287,-20.875587,-20.900376,-20.892247,-20.912346,-20.912206,-20.897706,-20.903015,-20.919995,-20.928685,-20.923366,-20.935396,-20.956846,-20.954407,-20.962556,-20.967326,-20.975846,-20.991906,-20.989315,-20.978825,-20.985346,-20.995176,-20.984136,-20.989966,-20.974855,-20.975915,-20.998435,-21.006634,-21.033304,-21.031464,-20.996144,-21.000314,-21.016234,-21.042154,-21.032668,-21.034064,-21.076763,-21.062793,-21.103103,-21.109737,-21.118223,-21.147693,-21.131273,-21.122653,-21.130033,-21.125687,-21.132243,-21.132753,-21.137633,-21.132023,-21.143013,-21.134123,-21.145353,-21.158963,-21.182703,-21.211013,-21.198633,-21.198783,-21.241534,-21.268113,-21.274403,-21.284683,-21.277253,-21.294003,-21.296443,-21.263713,-21.244713,-21.277593,-21.273292,-21.318022,-21.335132,-21.340672,-21.354472,-21.364672,-21.37425,-21.369572,-21.392722,-21.391423,-21.400023,-21.389093,-21.394693,-21.400724,-21.401673,-21.409603,-21.415743,-21.410262,-21.426922,-21.432352,-21.418312,-21.426832,-21.426223,-21.463072,-21.470812,-21.477703,-21.491282,-21.506842,-21.511112,-21.499432,-21.505092,-21.496712,-21.486543,-21.474553,-21.496232,-21.509373,-21.493103,-21.535083,-21.540593,-21.549993,-21.560443,-21.558751,-21.558961,-21.549823,-21.546251,-21.553781,-21.577572,-21.575102,-21.579872,-21.584292,-21.578201,-21.593361,-21.581671,-21.562711,-21.561192,-21.555811,-21.559562,-21.553101,-21.534871,-21.531711,-21.570652,-21.571612,-21.589341,-21.602891,-21.639991,-21.679621,-21.687921,-21.688321,-21.708031,-21.713171,-21.708411,-21.74289,-21.731123,-21.743471,-21.743441,-21.771692,-21.745901,-21.8181,-21.8104,-21.8175,-21.82221,-21.8301,-21.83852,-21.87593,-21.90254,-21.90404,-21.92568,-21.9585,-21.9895,-22.027111,-22.07532,-22.134179,-22.140479,-22.168229,-22.171939,-22.187319,-22.191469,-22.233208,-22.253918,-22.271639,-22.281469,-22.297178,-22.336049,-22.354889,-22.345097,-22.369737,-22.356637,-22.347777,-22.371347,-22.386997,-22.421438,-22.436384,-22.41592,-22.380323,-22.382068,-22.416176,-22.492757,-22.539457,-22.586706,-22.601826,-22.608705,-22.639636,-22.661066,-22.581976,-22.530116,-22.506977,-22.473387,-22.342687,-22.343817,-22.333577,-22.329777,-22.321237,-22.305077,-22.295177,-22.274397,-22.264297,-22.185317,-22.143836,-22.146437,-22.136456,-22.126106,-22.135446,-22.132686,-22.152926,-22.151857,-22.212336,-22.217556,-22.259825,-22.304966,-22.325246,-22.340896,-22.360496,-22.369094,-22.393924,-22.403134,-22.397664,-22.421344,-22.426824,-22.440323,-22.465443,-22.481274,-22.498314,-22.498903,-22.508913,-22.517263,-22.512443,-22.534734,-22.522673,-22.534313,-22.560233,-22.543484,-22.529174,-22.521384,-22.521424,-22.537953,-22.561384,-22.572384,-22.557444,-22.567523,-22.572433,-22.573123,-22.581344,-22.573554,-22.602304,-22.598413,-22.617093,-22.590183,-22.576043,-22.603412,-22.566492,-22.564322,-22.577264,-22.574782,-22.559092,-22.559433,-22.555244,-22.545414,-22.544174,-22.527184,-22.504732,-22.483994,-22.482119,-22.477022,-22.450022,-22.445182,-22.464062,-22.451013,-22.442962,-22.426962,-22.430584,-22.422692,-22.408894,-22.402422,-22.351894,-22.316763,-22.335093,-22.327672,-22.345502,-22.363963,-22.347693,-22.379642,-22.388433,-22.381843,-22.389643,-22.388893,-22.399413,-22.391262,-22.414242,-22.421522,-22.421043,-22.423983,-22.441673,-22.422112,-22.439003,-22.454103,-22.419463,-22.402503,-22.368993,-22.346542,-22.366263,-22.374691,-22.377111,-22.430603,-22.443822,-22.446292,-22.453011,-22.468872,-22.477502,-22.473381,-22.485062,-22.518601,-22.506053,-22.489583,-22.492441,-22.473233,-22.472853,-22.484753,-22.482333,-22.494732,-22.474283,-22.501042,-22.508883,-22.522543,-22.544663,-22.573452,-22.577683,-22.567843,-22.553582,-22.553633,-22.563153,-22.600202,-22.623428,-22.633365,-22.623442,-22.606373,-22.636196,-22.633811,-22.641393,-22.633119,-22.623572,-22.635896,-22.626706,-22.633605,-22.624083,-22.621591,-22.617273,-22.603831,-22.610123,-22.604593,-22.600573,-22.587843,-22.591483,-22.584923,-22.589483,-22.580311,-22.57695,-22.552274,-22.552404,-22.539397,-22.523769,-22.529159,-22.536857,-22.545318,-22.555007,-22.555674,-22.577601,-22.638967,-22.650021,-22.646849,-22.671503,-22.679697,-22.684207,-22.715349,-22.730958,-22.749195,-22.791219,-22.798389,-22.804534,-22.817808,-22.815856,-22.82527,-22.865746,-22.922219,-22.933073,-22.961919,-23.055917,-23.128814,-23.165245,-23.162962,-23.175039,-23.18291,-23.187063,-23.208575,-23.201702,-23.227819,-23.221535,-23.235928,-23.236169,-23.280195,-23.309769,-23.303035,-23.323231,-23.321955,-23.339702,-23.336312,-23.357574,-23.406846,-23.480594,-23.502002,-23.506892,-23.501093,-23.510082,-23.552292,-23.565282,-23.553782,-23.562492,-23.575472,-23.620772,-23.576802,-23.543952,-23.553452,-23.598612,-23.609672,-23.622773,-23.605122,-23.555412,-23.572012,-23.623571,-23.619812,-23.629691,-23.636971,-23.629886,-23.638407,-23.647362,-23.653631,-23.648383,-23.654291,-23.657055,-23.658864,-23.660247,-23.661357,-23.671403,-23.698387,-23.696442,-23.700295,-23.704094,-23.704255,-23.713047,-23.70731,-23.72841,-23.74761,-23.770023,-23.815879,-23.821402,-23.831685,-23.825214,-23.817992,-23.826859,-23.82016,-23.830597,-23.83732,-23.854385,-23.853841,-23.860351,-23.85459,-23.882733,-23.873515,-23.900085,-23.875064,-23.935767,-23.93744,-23.987175,-24.023516,-24.026444,-24.04602,-24.058123,-24.076862,-24.062355,-24.058465,-24.047253,-24.035194,-24.026038,-24.037436,-24.056819,-24.064995,-24.05505,-24.059308,-24.071957,-24.07282,-24.063899,-24.064534,-24.07471,-24.067012,-24.060672,-24.033643,-24.038215,-24.015814,-23.992033,-23.994732,-24.029292,-24.037532,-24.035102,-24.045001,-24.060272,-24.070282,-24.088932,-24.089352,-24.113282,-24.110252,-24.081702,-24.109132,-24.099782,-24.111411,-24.073602,-24.087102,-24.077602,-24.069972,-24.036932,-24.035722,-24.049862,-24.042502,-24.05505,-24.055782,-24.080412,-24.07365,-24.090502,-24.084652,-24.098552,-24.0885,-24.1103,-24.104111,-24.088881,-24.060492,-24.067321,-24.049582,-24.051932,-24.032242,-24.032872,-24.02758,-24.011302,-24.004774,-24.013102,-24.008841,-23.979251,-23.977381,-23.98938,-24.01158,-24.022499,-24.03982,-24.052371,-24.05641,-24.058141,-24.06898,-24.087261,-24.061911,-24.0498,-24.046791,-24.042291,-24.04192,-24.032021,-24.003259,-24.018399,-24.015229,-24.060169,-24.117659,-24.129529,-24.124319,-24.129399,-24.121949,-24.126259,-24.145809,-24.170699,-24.165369,-24.176899,-24.171549,-24.218469,-24.193679,-24.189599,-24.175509,-24.149438,-24.208049,-24.210888,-24.240148,-24.433677,-24.497587,-24.511996,-24.52505,-24.517771,-24.52219,-24.566083,-24.626559,-24.657206,-24.711928,-24.738073,-24.743637,-24.736684,-24.732477,-24.732047,-24.75063,-24.747755,-24.768278,-24.796634,-24.763064,-24.757738,-24.775327,-24.816086,-24.916321,-24.93045,-24.970557,-25.073693,-25.069324,-25.078387,-25.0811,-25.089609,-25.073848,-25.119009,-25.151782,-25.173267,-25.166879,-25.171668,-25.190003,-25.205,-25.188253,-25.182103,-25.183275,-25.227158,-25.233911,-25.229992,-25.244018,-25.26961,-25.264371,-25.247609,-25.243491,-25.247807,-25.276345,-25.283695,-25.280881,-25.293372,-25.314013,-25.363276,-25.378182,-25.430789,-25.418816,-25.418902,-25.426966,-25.429336,-25.443527,-25.484874,-25.494003,-25.498311,-25.461935,-25.447936,-25.431864,-25.433649,-25.451845,-25.451856,-25.461248,-25.469691,-25.498879,-25.504799,-25.500974,-25.529443,-25.533855,-25.541591,-25.556387,-25.553437,-25.561303,-25.56632,-25.562123,-25.568976,-25.575447,-25.572368,-25.609736,-25.617972,-25.646862,-25.658074,-25.674799,-25.673677,-25.683629,-25.70634,-25.728034,-25.733561,-25.73846,-25.744364,-25.759688,-25.757463,-25.7623,-25.771169,-25.79412,-25.801675,-25.795193,-25.815048,-25.819768,-25.81844,-25.810479,-25.809483,-25.824584,-25.803433,-25.829565,-25.852149,-25.8538,-25.865548,-25.881116,-25.877364,-25.885447,-25.866297,-25.877608,-25.888788,-25.896685,-25.891322,-25.899235,-25.903938,-25.907307,-25.903843,-25.917686,-25.930923,-25.934884,-25.934041,-25.953359,-25.961146,-25.956614,-25.969023,-25.968118,-25.981332,-25.982746,-25.990006,-25.99732,-25.986753,-25.987973,-25.976872,-25.978048,-25.959046,-25.955821,-25.969612,-25.95106,-25.946145,-25.935971,-25.944123,-25.931613,-25.931338,-25.922316,-25.908171,-25.905047,-25.911331,-25.912291,-25.898159,-25.908878,-25.914447,-25.906195,-25.887497,-25.885597,-25.871078,-25.861882,-25.849378,-25.827039,-25.822673,-25.808007,-25.811775,-25.888748,-25.933571,-25.949801,-25.945843,-25.928339,-25.932922,-26.006326,-26.10351,-26.224779,-26.313167,-26.346903,-26.379318,-26.386399,-26.376908,-26.379249,-26.51765,-26.546541,-26.642594,-26.670734,-26.683675,-26.679196,-26.773419,-26.802186,-26.806371,-26.833292,-26.841653,-26.869574,-26.881422,-26.878696,-26.883961,-26.895315,-26.894516,-26.908013,-26.892914,-26.928299,-26.946226,-26.965067,-26.976283,-26.969362,-26.985946,-26.988098,-26.988809,-27.017376,-27.016644,-27.028424,-27.032684,-27.051015,-27.057968,-27.053288,-27.062537,-27.06225,-27.063962,-27.062782,-27.075363,-27.085943,-27.090624,-27.110509,-27.149381,-27.148811,-27.127727,-27.124097,-27.131197,-27.153997,-27.156184,-27.158517,-27.165439,-27.18267,-27.196644,-27.206278,-27.19087,-27.19826,-27.233565,-27.261695,-27.255942,-27.262641,-27.247135,-27.227985,-27.230291,-27.264359,-27.283303,-27.313956,-27.325287,-27.333821,-27.343033,-27.362939,-27.377412,-27.387932,-27.394649,-27.415904,-27.438948,-27.445666,-27.440183,-27.460432,-27.442264,-27.450227,-27.443217,-27.421564,-27.401874,-27.400598,-27.39194,-27.362169,-27.367309,-27.383072,-27.393561,-27.397288,-27.407389,-27.415885,-27.413546,-27.440383,-27.450929,-27.459984,-27.451931,-27.456362,-27.475775,-27.478986,-27.47278,-27.481805,-27.481781,-27.46503,-27.480719,-27.484399,-27.516181,-27.510992,-27.540517,-27.549513,-27.565182,-27.565002,-27.57489,-27.581545,-27.594969,-27.621266,-27.63942,-27.656447,-27.674298,-27.679951,-27.700306,-27.70676,-27.69175,-27.710656,-27.711817,-27.697024,-27.695121,-27.711694,-27.708796,-27.703081,-27.693146,-27.674634,-27.670557,-27.648676,-27.644826,-27.634174,-27.641576,-27.657371,-27.696919,-27.708533,-27.707768,-27.740923,-27.73576,-27.778544,-27.784379,-27.785974,-27.782969,-27.790509,-27.818661,-27.814022,-27.794167,-27.792498,-27.793961,-27.801307,-27.800938,-27.801654,-27.807325,-27.800907,-27.800769,-27.817867,-27.829136,-27.835064,-27.845482,-27.839186,-27.840543,-27.834071,-27.831592,-27.83845,-27.839113,-27.86419,-27.857462,-27.863237,-27.872758,-27.872353,-27.868649,-27.870379,-27.88155,-27.873449,-27.886195,-27.907035,-27.954956,-27.974506,-27.982992,-27.971494,-27.940901,-27.934002,-27.938144,-28.002705,-28.083606,-28.125574,-28.125653,-28.161019,-28.164275,-28.17763,-28.15702,-28.18054,-28.187207,-28.210415,-28.234935,-28.249619,-28.248412,-28.237064,-28.233636,-28.246788,-28.245832,-28.26511,-28.247458,-28.274777,-28.279824,-28.294163,-28.295691,-28.311993,-28.318641,-28.330665,-28.357543,-28.339455,-28.341717,-28.331853,-28.338311,-28.309607,-28.320265,-28.353594,-28.346625,-28.363914,-28.344096,-28.330416,-28.311752,-28.310997,-28.298204,-28.269555,-28.283836,-28.307381,-28.338976,-28.323575,-28.323355,-28.316663,-28.321019,-28.30625,-28.262631,-28.249249,-28.259373,-28.290442,-28.298822,-28.298101,-28.315734,-28.333089,-28.368554,-28.361197,-28.36786,-28.363168,-28.393151,-28.390047,-28.449236,-28.433948,-28.438872,-28.433123,-28.462669,-28.468003,-28.48559,-28.494966,-28.525281,-28.525613,-28.503395,-28.518904,-28.563409,-28.581498,-28.6244,-28.664951,-28.664448,-28.68194,-28.680968,-28.697454,-28.708175,-28.731623,-28.740329,-28.756992,-28.778581,-28.79071,-28.819231,-28.838514,-28.850626,-28.858253,-28.851794,-28.864696,-28.907663,-28.90973,-28.895483,-28.916567,-28.929307,-28.914966,-28.90785,-28.916547,-28.942665,-28.959829,-28.959374,-28.944636,-28.959885,-28.955846,-28.938251,-28.918646,-28.871578,-28.871784,-28.907595,-28.916839,-28.929234,-28.923279,-28.945031,-28.941731,-28.952998,-28.980619,-29.019909,-29.056244,-29.070805,-29.088818,-29.098943,-29.126859,-29.147477,-29.152566,-29.177893,-29.177266,-29.165531,-29.147526,-29.134499,-29.100769,-29.077791,-29.050251,-29.037356,-29.030275,-29.005871,-28.986967,-28.980593,-28.973172,-28.95408,-28.938926,-28.924297,-28.904656,-28.90147,-28.884349,-28.860242,-28.844291,-28.836369,-28.83438,-28.849373,-28.844482,-28.827649,-28.799153,-28.793127,-28.772049,-28.770497,-28.761415,-28.740805,-28.730938,-28.705519,-28.687706,-28.693797,-28.673119,-28.666631,-28.657336,-28.655236,-28.633464,-28.63449,-28.651951,-28.661351,-28.65018,-28.676572,-28.668979,-28.670758,-28.655465,-28.661817,-28.653064,-28.658494,-28.668026,-28.671524,-28.668879,-28.660519,-28.654311,-28.661759,-28.657421,-28.668912,-28.665141,-28.651122,-28.650834,-28.633892,-28.627281,-28.633924,-28.625354,-28.62068,-28.60751,-28.598511,-28.587759,-28.575348,-28.571045,-28.557182,-28.537157,-28.55381,-28.559711,-28.555713,-28.567687,-28.567549,-28.574181,-28.566742,-28.572795,-28.565211,-28.563474,-28.556287,-28.56389,-28.550587,-28.557155,-28.55021,-28.565316,-28.559734,-28.570297,-28.564239,-28.578618,-28.575843,-28.584396,-28.576562,-28.589196,-28.582399,-28.580656,-28.613464,-28.60804,-28.617922,-28.610132,-28.608056,-28.621909,-28.602199,-28.610477,-28.603748,-28.615843,-28.605773,-28.614132,-28.609441,-28.618388,-28.609183,-28.616464,-28.620299,-28.633712,-28.631859,-28.624156,-28.609311,-28.615489,-28.61211,-28.599207,-28.593342,-28.60088,-28.572815,-28.571079,-28.580137,-28.57422,-28.581674,-28.574351,-28.580399,-28.582818,-28.593894,-28.594867,-28.612053,-28.620323,-28.629225,-28.635031,-28.650136,-28.651315,-28.655209,-28.675241,-28.677292,-28.695803,-28.68433,-28.696672,-28.698194,-28.714058,-28.709947,-28.743452,-28.734297,-28.742235,-28.738899,-28.764462,-28.775118,-28.7806,-28.802996,-28.810739,-28.807197,-28.822215,-28.835262,-28.829575,-28.838124,-28.83168,-28.841801,-28.858362,-28.884099,-28.888645,-28.910358,-28.916989,-28.955958,-28.956919,-28.972645,-28.976413,-28.999064,-28.999103,-25.996376,-25.996867,-16.544509,-16.57832,-16.648019,-16.686169,-16.719388,-16.750458,-16.736358,-16.740338,-16.777257,-16.773217,-16.783607,-16.775447,-16.783067,-16.781957,-16.767936,-16.778186,-16.784176,-16.778886,-16.800166,-16.852805,-16.867985,-16.877314,-16.884774,-16.876014,-16.888944,-16.887294,-16.912443,-16.927983,-16.950193,-16.977793,-16.998513,-17.029233,-17.078693,-17.163892,-17.270472,-17.319781,-17.364841,-17.37458,-17.3746,-17.39383,-17.42251,-17.39551,-17.400899,-17.441359,-17.460479,-17.468949,-17.482358,-17.505418,-17.538138,-17.553468,-17.548398,-17.563677,-17.577017,-17.578087,-17.570617,-17.589827,-17.605417,-17.604747,-17.596047,-17.630976,-17.673796,-17.714575,-17.722545,-17.702984,-17.709174,-17.677883,-17.641683,-17.648873,-17.644873,-17.601542,-17.597832,-17.509932,-17.512221,-17.477701,-17.465341,-17.455171,-17.382311,-17.349411,-17.348651,-17.342291,-17.316241,-17.302821,-17.277411,-17.233131,-17.198591,-17.184611,-17.098541,-17.092841,-17.040591,-16.998141,-16.969841,-16.940721,-16.870241,-16.803161,-16.803771,-16.779761,-16.69199,-16.6561,-16.58798,-16.55773,-16.55775,-16.49621,-16.45712,-16.425691,-16.408171,-16.342451,-16.218871,-16.122771,-16.074761,-16.023891,-15.951202,-15.916912,-15.909632,-15.871292,-15.657593,-15.498773,-15.479172,-15.351972,-15.350862,-15.332542,-15.296572,-15.235252,-15.205402,-15.212542,-15.201712,-15.198752,-15.161722,-15.126282,-15.103872,-15.075092,-15.054692,-15.023522,-15.003962]},{&#34;lng&#34;:[141.663264,141.659633,141.652643,141.663264],&#34;lat&#34;:[-15.002642,-14.983102,-14.973722,-15.002642]},{&#34;lng&#34;:[153.418782,153.414918,153.418593,153.42641,153.428083,153.421946,153.418782],&#34;lat&#34;:[-27.983775,-27.999034,-27.991038,-27.998556,-27.9887,-27.991747,-27.983775]},{&#34;lng&#34;:[153.384533,153.381187,153.380745,153.384533],&#34;lat&#34;:[-27.873611,-27.861126,-27.873915,-27.873611]},{&#34;lng&#34;:[153.380463,153.38024,153.351138,153.357695,153.352334,153.342355,153.348417,153.343328,153.348841,153.357839,153.358452,153.381965,153.380463],&#34;lat&#34;:[-27.882054,-27.888522,-27.890017,-27.891006,-27.902052,-27.894883,-27.901758,-27.910546,-27.91929,-27.911845,-27.893345,-27.891385,-27.882054]},{&#34;lng&#34;:[153.380611,153.379578,153.365183,153.36759,153.360362,153.380611],&#34;lat&#34;:[-27.858976,-27.855123,-27.849873,-27.848937,-27.84854,-27.858976]},{&#34;lng&#34;:[153.189041,153.18727,153.192737,153.189041],&#34;lat&#34;:[-27.489295,-27.491334,-27.495081,-27.489295]},{&#34;lng&#34;:[153.053206,153.049071,153.036853,153.035625,153.042924,153.053158,153.053206],&#34;lat&#34;:[-27.470205,-27.474133,-27.462407,-27.465476,-27.477473,-27.474863,-27.470205]},{&#34;lng&#34;:[153.034401,153.030055,153.016591,153.003576,152.994671,153.0151,153.020615,153.000384,152.997869,153.008303,153.001187,153.023266,153.015508,152.996449,153.005487,153.016242,153.031672,153.034401],&#34;lat&#34;:[-27.468537,-27.479401,-27.467591,-27.474761,-27.48996,-27.492494,-27.500563,-27.506686,-27.514944,-27.520945,-27.509937,-27.50033,-27.490914,-27.488859,-27.475966,-27.469481,-27.481851,-27.468537]},{&#34;lng&#34;:[153.008332,152.996948,152.970607,152.965751,152.973545,152.938563,152.926836,152.924928,152.903432,152.906095,152.894252,152.900985,152.89318,152.905339,152.89664,152.874073,152.862014,152.855671,152.862395,152.874271,152.895854,152.906082,152.894645,152.902405,152.895476,152.907246,152.904281,152.924542,152.928825,152.940604,152.974146,152.967828,152.972495,152.995168,153.009663,153.008332],&#34;lat&#34;:[-27.520989,-27.521667,-27.504557,-27.51441,-27.542577,-27.525358,-27.529063,-27.540832,-27.544263,-27.554386,-27.560344,-27.566915,-27.577266,-27.600726,-27.601187,-27.57857,-27.596959,-27.595594,-27.598111,-27.579575,-27.601917,-27.601893,-27.579249,-27.566557,-27.560735,-27.555607,-27.544945,-27.542538,-27.529015,-27.528123,-27.544639,-27.515666,-27.505962,-27.524705,-27.523049,-27.520989]},{&#34;lng&#34;:[152.937083,152.936869,152.941918,152.937083],&#34;lat&#34;:[-25.76062,-25.76809,-25.765354,-25.76062]},{&#34;lng&#34;:[152.525074,152.523429,152.507522,152.523325,152.525074],&#34;lat&#34;:[-25.071108,-25.068824,-25.077532,-25.069521,-25.071108]},{&#34;lng&#34;:[150.574294,150.607817,150.587402,150.601857,150.590708,150.593027,150.587052,150.574294],&#34;lat&#34;:[-22.482161,-22.500843,-22.487502,-22.486143,-22.484483,-22.475803,-22.485802,-22.482161]},{&#34;lng&#34;:[142.594143,142.587955,142.583365,142.588755,142.595275,142.594143],&#34;lat&#34;:[-10.889247,-10.888612,-10.901272,-10.889512,-10.891112,-10.889247]},{&#34;lng&#34;:[149.451231,149.435825,149.432715,149.451231],&#34;lat&#34;:[-21.729296,-21.721941,-21.727041,-21.729296]},{&#34;lng&#34;:[151.636498,151.641625,151.638165,151.636498],&#34;lat&#34;:[-24.000305,-24.002631,-23.996941,-24.000305]}],[{&#34;lng&#34;:[143.587838,143.585163,143.591058,143.587838],&#34;lat&#34;:[-13.53238,-13.517198,-13.52464,-13.53238]}],[{&#34;lng&#34;:[147.420305,147.384578,147.414341,147.420305],&#34;lat&#34;:[-19.321215,-19.302496,-19.312627,-19.321215]}],[{&#34;lng&#34;:[153.546708,153.527186,153.480873,153.458708,153.453997,153.438435,153.446265,153.439943,153.432158,153.436187,153.412751,153.392899,153.402075,153.398836,153.421663,153.407077,153.413532,153.412537,153.398385,153.409129,153.423033,153.44045,153.436199,153.432456,153.438495,153.455838,153.483166,153.543327,153.546708],&#34;lat&#34;:[-27.434827,-27.461592,-27.580785,-27.67062,-27.728758,-27.733191,-27.716514,-27.715469,-27.728161,-27.734647,-27.738998,-27.707127,-27.692963,-27.662602,-27.642054,-27.611009,-27.599202,-27.511639,-27.496423,-27.47601,-27.470118,-27.411344,-27.405505,-27.411206,-27.394897,-27.388291,-27.415556,-27.425346,-27.434827]}],[{&#34;lng&#34;:[153.468489,153.434044,153.419661,153.41758,153.437286,153.427959,153.41864,153.421218,153.365502,153.373262,153.361611,153.370134,153.3614,153.402396,153.387805,153.407102,153.38873,153.454481,153.468489],&#34;lat&#34;:[-27.028478,-27.131235,-27.20357,-27.274423,-27.333965,-27.36364,-27.35502,-27.331066,-27.201245,-27.176285,-27.13566,-27.103027,-27.061041,-27.035267,-27.047619,-27.040074,-27.050345,-27.022003,-27.028478]}],[{&#34;lng&#34;:[153.445354,153.427189,153.42553,153.431489,153.426455,153.418943,153.4235,153.409414,153.406535,153.437815,153.437091,153.445354],&#34;lat&#34;:[-27.757379,-27.868386,-27.923964,-27.933127,-27.933921,-27.92114,-27.873558,-27.857256,-27.83397,-27.778226,-27.753164,-27.757379]}],[{&#34;lng&#34;:[153.419051,153.416219,153.411533,153.419051],&#34;lat&#34;:[-27.931575,-27.940147,-27.931464,-27.931575]}],[{&#34;lng&#34;:[153.397645,153.390059,153.382115,153.397645],&#34;lat&#34;:[-27.823099,-27.82992,-27.822919,-27.823099]}],[{&#34;lng&#34;:[153.390463,153.372437,153.383042,153.390463],&#34;lat&#34;:[-27.620217,-27.630754,-27.61585,-27.620217]}],[{&#34;lng&#34;:[153.376281,153.362416,153.346774,153.360837,153.367779,153.360363,153.368145,153.36825,153.376281],&#34;lat&#34;:[-27.618272,-27.632403,-27.622307,-27.580348,-27.591278,-27.61432,-27.616073,-27.605871,-27.618272]}],[{&#34;lng&#34;:[153.374756,153.345019,153.336635,153.35911,153.374756],&#34;lat&#34;:[-27.498101,-27.51423,-27.498094,-27.485742,-27.498101]}],[{&#34;lng&#34;:[153.361765,153.349681,153.353855,153.361765],&#34;lat&#34;:[-27.683956,-27.681842,-27.649222,-27.683956]}],[{&#34;lng&#34;:[152.95018,152.949924,152.95953,152.951004,152.9887,152.993434,152.983831,152.986802,153.007945,153.034132,153.051422,153.039991,153.051353,153.045751,153.051534,153.038673,152.995353,152.992301,153.029533,153.076841,153.160286,153.222258,153.234004,153.226223,153.169105,153.144138,153.118924,153.176828,153.24973,153.264622,153.266901,153.259634,153.270255,153.304181,153.325286,153.350721,153.352266,153.360352,153.18822,153.107901,153.078329,153.089358,153.077662,153.038935,153.015095,152.990494,152.991996,152.982456,152.98717,152.980329,152.983046,152.96983,152.974675,152.961913,152.955499,152.95587,152.959554,152.955282,152.964234,152.956113,152.952425,152.952676,152.942505,152.95018],&#34;lat&#34;:[-25.573919,-25.561256,-25.560827,-25.551935,-25.512107,-25.484536,-25.468563,-25.448296,-25.411261,-25.384775,-25.34532,-25.276699,-25.262671,-25.247605,-25.244659,-25.223162,-25.230323,-25.220705,-25.176303,-25.152851,-25.083602,-24.995656,-24.942465,-24.912011,-24.832034,-24.816753,-24.815058,-24.743396,-24.69762,-24.697089,-24.70436,-24.823713,-24.893474,-24.949901,-24.963937,-24.963441,-24.999593,-25.006351,-25.370615,-25.560023,-25.668662,-25.757713,-25.79234,-25.792544,-25.769062,-25.71778,-25.697164,-25.676569,-25.671992,-25.670686,-25.660247,-25.639832,-25.62468,-25.605494,-25.613069,-25.59886,-25.601948,-25.595525,-25.57668,-25.589134,-25.584519,-25.594422,-25.585859,-25.573919]}],[{&#34;lng&#34;:[153.352586,153.347064,153.335139,153.352586],&#34;lat&#34;:[-27.632497,-27.638539,-27.621186,-27.632497]}],[{&#34;lng&#34;:[153.341562,153.33683,153.33344,153.341562],&#34;lat&#34;:[-27.605001,-27.620871,-27.614301,-27.605001]}],[{&#34;lng&#34;:[153.341439,153.329074,153.322939,153.328599,153.341439],&#34;lat&#34;:[-27.648566,-27.670436,-27.651959,-27.635049,-27.648566]}],[{&#34;lng&#34;:[153.339912,153.327446,153.31959,153.326488,153.339912],&#34;lat&#34;:[-27.690426,-27.694839,-27.680217,-27.677403,-27.690426]}],[{&#34;lng&#34;:[153.33877,153.335164,153.318673,153.330106,153.33877],&#34;lat&#34;:[-27.566762,-27.574963,-27.573471,-27.563115,-27.566762]}],[{&#34;lng&#34;:[153.241558,153.23913,153.225927,153.235054,153.241558],&#34;lat&#34;:[-27.39114,-27.397299,-27.391912,-27.37765,-27.39114]}],[{&#34;lng&#34;:[153.207558,153.197319,153.16572,153.155417,153.135343,153.132554,153.099075,153.093119,153.098616,153.079019,153.090917,153.0752,153.077223,153.129999,153.129951,153.130523,153.141534,153.168082,153.207558],&#34;lat&#34;:[-27.081683,-27.096589,-27.099444,-27.072152,-27.054075,-27.03628,-27.013777,-26.991818,-26.985759,-26.972384,-26.944968,-26.920269,-26.91015,-26.874151,-26.814082,-26.872422,-26.918363,-27.001748,-27.081683]}],[{&#34;lng&#34;:[153.188501,153.178023,153.183789,153.188501],&#34;lat&#34;:[-27.401757,-27.3967,-27.39343,-27.401757]}],[{&#34;lng&#34;:[153.08553,153.077628,153.078823,153.08553],&#34;lat&#34;:[-27.008147,-27.0098,-27.001741,-27.008147]}],[{&#34;lng&#34;:[152.993723,152.977217,152.959055,152.943013,152.988579,152.993723],&#34;lat&#34;:[-25.334914,-25.309973,-25.302812,-25.272831,-25.313966,-25.334914]}],[{&#34;lng&#34;:[152.969339,152.9612,152.960351,152.969339],&#34;lat&#34;:[-25.477287,-25.491444,-25.477359,-25.477287]}],[{&#34;lng&#34;:[152.964241,152.957638,152.952811,152.964241],&#34;lat&#34;:[-25.620138,-25.637489,-25.616189,-25.620138]}],[{&#34;lng&#34;:[152.955833,152.935971,152.915032,152.909266,152.942185,152.952524,152.955833],&#34;lat&#34;:[-25.494834,-25.522798,-25.529163,-25.499854,-25.478995,-25.482803,-25.494834]}],[{&#34;lng&#34;:[152.949727,152.941926,152.937963,152.949727],&#34;lat&#34;:[-25.558276,-25.583345,-25.562785,-25.558276]}],[{&#34;lng&#34;:[152.938475,152.928925,152.931179,152.938475],&#34;lat&#34;:[-25.61055,-25.598976,-25.586306,-25.61055]}],[{&#34;lng&#34;:[152.930181,152.927026,152.921184,152.930181],&#34;lat&#34;:[-25.618306,-25.624367,-25.614228,-25.618306]}],[{&#34;lng&#34;:[152.927744,152.924186,152.92036,152.927744],&#34;lat&#34;:[-25.583076,-25.598071,-25.574699,-25.583076]}],[{&#34;lng&#34;:[152.92185,152.920682,152.91503,152.92185],&#34;lat&#34;:[-25.560239,-25.568012,-25.562742,-25.560239]}],[{&#34;lng&#34;:[152.912179,152.906687,152.902534,152.912179],&#34;lat&#34;:[-25.549367,-25.563753,-25.555341,-25.549367]}],[{&#34;lng&#34;:[152.903871,152.889168,152.898518,152.903871],&#34;lat&#34;:[-25.570965,-25.56988,-25.56008,-25.570965]}],[{&#34;lng&#34;:[152.901002,152.891518,152.888908,152.898973,152.901002],&#34;lat&#34;:[-25.592536,-25.59461,-25.579162,-25.578439,-25.592536]}],[{&#34;lng&#34;:[151.664085,151.660625,151.64886,151.664085],&#34;lat&#34;:[-24.047172,-24.052692,-24.04452,-24.047172]}],[{&#34;lng&#34;:[151.547662,151.536212,151.541652,151.547662],&#34;lat&#34;:[-24.078401,-24.082191,-24.074651,-24.078401]}],[{&#34;lng&#34;:[151.462018,151.459437,151.459686,151.462018],&#34;lat&#34;:[-24.04397,-24.05645,-24.039352,-24.04397]}],[{&#34;lng&#34;:[151.439928,151.436493,151.428035,151.434802,151.43456,151.436791,151.439928],&#34;lat&#34;:[-24.047055,-24.054062,-24.039902,-24.036193,-24.04644,-24.037108,-24.047055]}],[{&#34;lng&#34;:[151.39422,151.38926,151.373897,151.366349,151.362915,151.370687,151.364155,151.360707,151.353963,151.336418,151.339784,151.328042,151.323601,151.332707,151.332516,151.34082,151.373704,151.39422],&#34;lat&#34;:[-23.864592,-23.875615,-23.881055,-23.874802,-23.859744,-23.842698,-23.84746,-23.824056,-23.818983,-23.824672,-23.806141,-23.798079,-23.77751,-23.768365,-23.754008,-23.785146,-23.812615,-23.864592]}],[{&#34;lng&#34;:[151.31528,151.296673,151.290901,151.285269,151.264781,151.276278,151.26262,151.262505,151.274567,151.262054,151.262094,151.252553,151.260182,151.2589,151.245224,151.245684,151.24196,151.245212,151.227272,151.221974,151.214545,151.215777,151.198446,151.172194,151.129744,151.104231,151.103401,151.096724,151.092083,151.047671,151.045781,151.052181,151.053861,151.044911,151.032541,151.012611,150.989632,150.979467,151.013912,151.017102,151.051631,151.047941,151.056971,151.080941,151.071931,151.077851,151.072741,151.08498,151.08677,151.12569,151.12307,151.155149,151.202419,151.199289,151.191449,151.195519,151.182639,151.193459,151.183689,151.193119,151.183389,151.217398,151.218528,151.235158,151.225618,151.248449,151.266969,151.264228,151.27224,151.286574,151.296245,151.31528],&#34;lat&#34;:[-23.759224,-23.75396,-23.759258,-23.79742,-23.77791,-23.764664,-23.774577,-23.7588,-23.75253,-23.757379,-23.749114,-23.75686,-23.75713,-23.776659,-23.779691,-23.76742,-23.775067,-23.79414,-23.79033,-23.799438,-23.79437,-23.783396,-23.779682,-23.745155,-23.669241,-23.658133,-23.649587,-23.657269,-23.644795,-23.622893,-23.616412,-23.621582,-23.615582,-23.614272,-23.570402,-23.553672,-23.497612,-23.488793,-23.473622,-23.452263,-23.456172,-23.452463,-23.447673,-23.466642,-23.473682,-23.482802,-23.488362,-23.487852,-23.479932,-23.498932,-23.490702,-23.511312,-23.512072,-23.520102,-23.518682,-23.523402,-23.520872,-23.527472,-23.531252,-23.530982,-23.541312,-23.518422,-23.503502,-23.483652,-23.609492,-23.656938,-23.665706,-23.671256,-23.662863,-23.684109,-23.738597,-23.759224]}],[{&#34;lng&#34;:[151.288596,151.286117,151.281871,151.288596],&#34;lat&#34;:[-23.805152,-23.818702,-23.801427,-23.805152]}],[{&#34;lng&#34;:[151.162989,151.156079,151.145019,151.162989],&#34;lat&#34;:[-23.396661,-23.405621,-23.398901,-23.396661]}],[{&#34;lng&#34;:[150.994716,150.986712,150.988037,150.977597,150.939011,150.93178,150.934829,150.951112,150.95624,150.975542,150.975532,150.994716],&#34;lat&#34;:[-23.181226,-23.184132,-23.192356,-23.18328,-23.19829,-23.178545,-23.168652,-23.171192,-23.156287,-23.148842,-23.171202,-23.181226]}],[{&#34;lng&#34;:[150.975637,150.964892,150.972552,150.975637],&#34;lat&#34;:[-23.215244,-23.215732,-23.209152,-23.215244]}],[{&#34;lng&#34;:[150.914408,150.913228,150.901108,150.889409,150.884619,150.892078,150.914408],&#34;lat&#34;:[-23.079684,-23.087584,-23.079164,-23.083164,-23.077424,-23.054474,-23.079684]}],[{&#34;lng&#34;:[150.871819,150.864524,150.850544,150.871819],&#34;lat&#34;:[-23.505923,-23.517002,-23.511742,-23.505923]}],[{&#34;lng&#34;:[150.865299,150.846954,150.837854,150.865299],&#34;lat&#34;:[-23.527853,-23.532642,-23.521162,-23.527853]}],[{&#34;lng&#34;:[150.698291,150.691421,150.690421,150.677381,150.686121,150.698291],&#34;lat&#34;:[-21.953413,-21.953504,-21.967213,-21.965404,-21.945934,-21.953413]}],[{&#34;lng&#34;:[150.676942,150.669862,150.669412,150.676942],&#34;lat&#34;:[-22.090083,-22.094403,-22.082893,-22.090083]}],[{&#34;lng&#34;:[150.662604,150.660625,150.656205,150.662604],&#34;lat&#34;:[-22.334683,-22.339523,-22.330923,-22.334683]}],[{&#34;lng&#34;:[150.647652,150.641792,150.644912,150.647652],&#34;lat&#34;:[-22.008794,-22.008334,-22.001774,-22.008794]}],[{&#34;lng&#34;:[150.56079,150.554526,150.544256,150.542506,150.527506,150.529136,150.516517,150.522997,150.510567,150.504797,150.482958,150.475678,150.489957,150.478482,150.500037,150.485957,150.472637,150.463972,150.459157,150.470567,150.482787,150.472187,150.475472,150.500496,150.478307,150.492306,150.486166,150.497726,150.490056,150.474746,150.470236,150.479211,150.518936,150.534876,150.55255,150.56079],&#34;lat&#34;:[-22.294982,-22.305104,-22.299504,-22.321134,-22.316634,-22.324424,-22.325794,-22.333504,-22.340064,-22.334274,-22.349334,-22.335184,-22.325064,-22.320653,-22.303084,-22.311024,-22.294924,-22.301153,-22.296624,-22.281264,-22.278744,-22.276654,-22.261113,-22.269634,-22.255394,-22.255474,-22.243274,-22.240754,-22.227524,-22.232034,-22.221624,-22.206573,-22.224244,-22.275424,-22.279932,-22.294982]}],[{&#34;lng&#34;:[150.528487,150.515397,150.520907,150.528487],&#34;lat&#34;:[-22.373564,-22.372124,-22.366524,-22.373564]}],[{&#34;lng&#34;:[150.50043,150.498065,150.496965,150.50043],&#34;lat&#34;:[-22.546404,-22.554493,-22.540503,-22.546404]}],[{&#34;lng&#34;:[150.465407,150.454737,150.463372,150.443962,150.438068,150.427463,150.429888,150.421668,150.415543,150.442557,150.430468,150.440702,150.464031,150.454132,150.465407],&#34;lat&#34;:[-22.247854,-22.247324,-22.259213,-22.274063,-22.268054,-22.275733,-22.288394,-22.299374,-22.279583,-22.254554,-22.251084,-22.231533,-22.225173,-22.234233,-22.247854]}],[{&#34;lng&#34;:[150.450148,150.449608,150.442518,150.450148],&#34;lat&#34;:[-22.314584,-22.321014,-22.313624,-22.314584]}],[{&#34;lng&#34;:[150.373931,150.369171,150.359471,150.366871,150.373931],&#34;lat&#34;:[-22.020774,-22.024234,-22.013784,-22.011364,-22.020774]}],[{&#34;lng&#34;:[150.364129,150.345734,150.348159,150.338865,150.325355,150.29978,150.31383,150.339779,150.364129],&#34;lat&#34;:[-21.720525,-21.742986,-21.763955,-21.769956,-21.768746,-21.746385,-21.739395,-21.741345,-21.720525]}],[{&#34;lng&#34;:[150.350514,150.339094,150.340044,150.325844,150.338449,150.350514],&#34;lat&#34;:[-21.667046,-21.668406,-21.674376,-21.658617,-21.656015,-21.667046]}],[{&#34;lng&#34;:[150.323344,150.31974,150.30357,150.29757,150.314164,150.323344],&#34;lat&#34;:[-22.235664,-22.244885,-22.249705,-22.243685,-22.233104,-22.235664]}],[{&#34;lng&#34;:[150.301974,150.274145,150.253435,150.24306,150.242585,150.250415,150.24732,150.26389,150.290874,150.301974],&#34;lat&#34;:[-21.664917,-21.680887,-21.667817,-21.675306,-21.654277,-21.650997,-21.619046,-21.641166,-21.643787,-21.664917]}],[{&#34;lng&#34;:[150.282671,150.272352,150.261852,150.259382,150.251002,150.273131,150.282671],&#34;lat&#34;:[-22.351765,-22.352345,-22.371075,-22.363615,-22.364555,-22.347165,-22.351765]}],[{&#34;lng&#34;:[150.280543,150.272984,150.262894,150.266488,150.280543],&#34;lat&#34;:[-21.483377,-21.490567,-21.483637,-21.476826,-21.483377]}],[{&#34;lng&#34;:[150.276454,150.257514,150.245184,150.276454],&#34;lat&#34;:[-21.516627,-21.528507,-21.517197,-21.516627]}],[{&#34;lng&#34;:[150.186054,150.178019,150.180269,150.16875,150.151544,150.159929,150.179144,150.186054],&#34;lat&#34;:[-21.977925,-21.982756,-21.998436,-22.004146,-21.971365,-21.977567,-21.970035,-21.977925]}],[{&#34;lng&#34;:[150.149904,150.14265,150.143035,150.139894,150.149904],&#34;lat&#34;:[-21.961135,-21.960847,-21.980425,-21.958436,-21.961135]}],[{&#34;lng&#34;:[150.139395,150.12547,150.128085,150.139395],&#34;lat&#34;:[-21.998185,-22.001377,-21.987656,-21.998185]}],[{&#34;lng&#34;:[150.120384,150.11828,150.108305,150.108315,150.120384],&#34;lat&#34;:[-21.918196,-21.931267,-21.932066,-21.922226,-21.918196]}],[{&#34;lng&#34;:[150.040373,150.013514,150.020694,150.008694,149.975295,149.945206,149.933226,149.950645,149.970075,149.978464,149.992244,150.001074,150.001074,150.010469,150.040373],&#34;lat&#34;:[-22.111437,-22.109927,-22.126907,-22.128017,-22.158827,-22.172048,-22.152358,-22.134258,-22.134027,-22.117627,-22.113497,-22.122257,-22.105247,-22.100986,-22.111437]}],[{&#34;lng&#34;:[150.019029,150.016019,150.012739,150.019029],&#34;lat&#34;:[-22.620936,-22.628796,-22.618846,-22.620936]}],[{&#34;lng&#34;:[149.931706,149.919657,149.925351,149.931706],&#34;lat&#34;:[-22.187348,-22.200488,-22.175176,-22.187348]}],[{&#34;lng&#34;:[149.92999,149.920646,149.918597,149.909107,149.896082,149.869738,149.865953,149.879147,149.861842,149.871547,149.869726,149.874366,149.883196,149.881596,149.901375,149.910245,149.904275,149.918786,149.92999],&#34;lat&#34;:[-22.133736,-22.154668,-22.205008,-22.223548,-22.234766,-22.226308,-22.219087,-22.206808,-22.169687,-22.146748,-22.118548,-22.100698,-22.099418,-22.067948,-22.052068,-22.058238,-22.076878,-22.122748,-22.133736]}],[{&#34;lng&#34;:[149.917109,149.907149,149.909249,149.917109],&#34;lat&#34;:[-21.506599,-21.50014,-21.49256,-21.506599]}],[{&#34;lng&#34;:[149.915512,149.909877,149.898632,149.904807,149.912887,149.915512],&#34;lat&#34;:[-22.235726,-22.256048,-22.260256,-22.234738,-22.227258,-22.235726]}],[{&#34;lng&#34;:[149.911386,149.897586,149.894196,149.903786,149.911386],&#34;lat&#34;:[-21.018141,-21.020951,-21.004851,-21.002861,-21.018141]}],[{&#34;lng&#34;:[149.90977,149.90517,149.897945,149.90977],&#34;lat&#34;:[-22.474037,-22.476877,-22.462916,-22.474037]}],[{&#34;lng&#34;:[149.900687,149.894552,149.888822,149.900687],&#34;lat&#34;:[-22.235998,-22.244246,-22.237956,-22.235998]}],[{&#34;lng&#34;:[149.89653,149.888105,149.891104,149.89653],&#34;lat&#34;:[-21.49786,-21.499388,-21.485268,-21.49786]}],[{&#34;lng&#34;:[149.894853,149.884703,149.877633,149.894853],&#34;lat&#34;:[-22.256316,-22.263246,-22.255037,-22.256316]}],[{&#34;lng&#34;:[149.892748,149.877008,149.874518,149.884572,149.892748],&#34;lat&#34;:[-22.247988,-22.251448,-22.238138,-22.235717,-22.247988]}],[{&#34;lng&#34;:[149.88061,149.86175,149.844036,149.88061],&#34;lat&#34;:[-21.993587,-22.013057,-22.004219,-21.993587]}],[{&#34;lng&#34;:[149.842112,149.833932,149.831507,149.842112],&#34;lat&#34;:[-21.659429,-21.66221,-21.647438,-21.659429]}],[{&#34;lng&#34;:[149.837414,149.833235,149.821925,149.837414],&#34;lat&#34;:[-21.379099,-21.383199,-21.371669,-21.379099]}],[{&#34;lng&#34;:[149.818927,149.791507,149.788652,149.780737,149.784962,149.805862,149.818927],&#34;lat&#34;:[-21.605799,-21.616409,-21.60922,-21.612649,-21.60056,-21.59091,-21.605799]}],[{&#34;lng&#34;:[149.804274,149.793214,149.793499,149.804274],&#34;lat&#34;:[-21.832029,-21.839349,-21.830308,-21.832029]}],[{&#34;lng&#34;:[149.763432,149.753502,149.755527,149.763432],&#34;lat&#34;:[-22.405678,-22.411808,-22.400847,-22.405678]}],[{&#34;lng&#34;:[149.717587,149.706187,149.709967,149.717587],&#34;lat&#34;:[-21.45598,-21.44806,-21.43899,-21.45598]}],[{&#34;lng&#34;:[149.694666,149.685572,149.663957,149.666177,149.690581,149.694666],&#34;lat&#34;:[-21.3239,-21.332441,-21.31059,-21.30244,-21.312211,-21.3239]}],[{&#34;lng&#34;:[149.664699,149.664029,149.657829,149.654943,149.664699],&#34;lat&#34;:[-21.97497,-21.98186,-21.9784,-21.966109,-21.97497]}],[{&#34;lng&#34;:[149.653888,149.651308,149.642548,149.653888],&#34;lat&#34;:[-21.9289,-21.93648,-21.93192,-21.9289]}],[{&#34;lng&#34;:[149.626443,149.612939,149.622148,149.626443],&#34;lat&#34;:[-20.770392,-20.778103,-20.760803,-20.770392]}],[{&#34;lng&#34;:[149.626129,149.617274,149.606434,149.59673,149.57811,149.584695,149.6057,149.603464,149.623224,149.626129],&#34;lat&#34;:[-20.868733,-20.884202,-20.879402,-20.885163,-20.869193,-20.861222,-20.864983,-20.846492,-20.856302,-20.868733]}],[{&#34;lng&#34;:[149.588542,149.572642,149.577227,149.588542],&#34;lat&#34;:[-22.13827,-22.12498,-22.119209,-22.13827]}],[{&#34;lng&#34;:[149.58253,149.56622,149.558565,149.576795,149.58253],&#34;lat&#34;:[-21.97444,-21.99205,-21.987569,-21.967929,-21.97444]}],[{&#34;lng&#34;:[149.50038,149.4869,149.46902,149.485795,149.50038],&#34;lat&#34;:[-21.829431,-21.836521,-21.821731,-21.81789,-21.829431]}],[{&#34;lng&#34;:[149.498568,149.493318,149.485418,149.498568],&#34;lat&#34;:[-21.597772,-21.605032,-21.597402,-21.597772]}],[{&#34;lng&#34;:[149.483695,149.472275,149.466275,149.483695],&#34;lat&#34;:[-20.741003,-20.747213,-20.726713,-20.741003]}],[{&#34;lng&#34;:[149.469552,149.466927,149.464232,149.469552],&#34;lat&#34;:[-20.928214,-20.937362,-20.925944,-20.928214]}],[{&#34;lng&#34;:[149.460697,149.451302,149.447002,149.441893,149.432608,149.426493,149.422453,149.435058,149.427638,149.425488,149.446757,149.460697],&#34;lat&#34;:[-20.914972,-20.934264,-20.930074,-20.941254,-20.937133,-20.945544,-20.939184,-20.927893,-20.926733,-20.906803,-20.902893,-20.914972]}],[{&#34;lng&#34;:[149.422713,149.418983,149.414143,149.405488,149.385858,149.414178,149.422713],&#34;lat&#34;:[-20.919684,-20.926774,-20.918624,-20.924243,-20.904113,-20.896853,-20.919684]}],[{&#34;lng&#34;:[149.412301,149.397802,149.390066,149.412301],&#34;lat&#34;:[-20.772914,-20.779164,-20.769333,-20.772914]}],[{&#34;lng&#34;:[149.300993,149.276558,149.273648,149.291153,149.300993],&#34;lat&#34;:[-20.796835,-20.793444,-20.778404,-20.774485,-20.796835]}],[{&#34;lng&#34;:[149.289968,149.286084,149.279784,149.264904,149.268254,149.249279,149.274388,149.289968],&#34;lat&#34;:[-20.809974,-20.820335,-20.810395,-20.823325,-20.810095,-20.805914,-20.796364,-20.809974]}],[{&#34;lng&#34;:[149.209084,149.203544,149.197274,149.209084],&#34;lat&#34;:[-20.690576,-20.698776,-20.689826,-20.690576]}],[{&#34;lng&#34;:[149.193939,149.186794,149.189194,149.172544,149.181574,149.193939],&#34;lat&#34;:[-20.671615,-20.675596,-20.689206,-20.672256,-20.666186,-20.671615]}],[{&#34;lng&#34;:[149.178166,149.171886,149.173006,149.178166],&#34;lat&#34;:[-20.247617,-20.250407,-20.241187,-20.247617]}],[{&#34;lng&#34;:[149.166659,149.156454,149.158119,149.14579,149.138505,149.136085,149.148255,149.145509,149.154749,149.163614,149.166659],&#34;lat&#34;:[-20.683335,-20.674447,-20.683265,-20.693805,-20.694717,-20.686447,-20.684937,-20.673485,-20.662175,-20.665237,-20.683335]}],[{&#34;lng&#34;:[149.157156,149.154846,149.150576,149.157156],&#34;lat&#34;:[-20.237227,-20.243217,-20.238927,-20.237227]}],[{&#34;lng&#34;:[149.132848,149.132283,149.120703,149.132848],&#34;lat&#34;:[-20.467096,-20.482017,-20.469427,-20.467096]}],[{&#34;lng&#34;:[149.126855,149.124097,149.117759,149.118181,149.126855],&#34;lat&#34;:[-20.348028,-20.35703,-20.355752,-20.3438,-20.348028]}],[{&#34;lng&#34;:[149.124987,149.119157,149.123377,149.124987],&#34;lat&#34;:[-20.271127,-20.271557,-20.264907,-20.271127]}],[{&#34;lng&#34;:[149.124414,149.118354,149.114959,149.095989,149.112639,149.124414],&#34;lat&#34;:[-20.543977,-20.542247,-20.552936,-20.547206,-20.537796,-20.543977]}],[{&#34;lng&#34;:[149.111722,149.111042,149.104912,149.111722],&#34;lat&#34;:[-20.274368,-20.287828,-20.266228,-20.274368]}],[{&#34;lng&#34;:[149.104678,149.095279,149.098289,149.082009,149.066939,149.065174,149.043585,149.04683,149.03672,149.04995,149.065369,149.068674,149.075639,149.074269,149.082334,149.074279,149.080398,149.089288,149.084249,149.104678],&#34;lat&#34;:[-20.481176,-20.480566,-20.490736,-20.484337,-20.525967,-20.516248,-20.522198,-20.513387,-20.503027,-20.509647,-20.502147,-20.477368,-20.481527,-20.464827,-20.459778,-20.451827,-20.436397,-20.448847,-20.459287,-20.481176]}],[{&#34;lng&#34;:[149.103562,149.101762,149.088262,149.093412,149.084942,149.085482,149.075233,149.077132,149.070243,149.075582,149.089492,149.094352,149.103562],&#34;lat&#34;:[-20.250888,-20.266448,-20.280968,-20.300868,-20.304488,-20.294728,-20.301178,-20.293298,-20.293108,-20.270188,-20.265148,-20.270868,-20.250888]}],[{&#34;lng&#34;:[149.089709,149.080839,149.079169,149.089709],&#34;lat&#34;:[-20.522086,-20.525626,-20.515797,-20.522086]}],[{&#34;lng&#34;:[149.08909,149.066665,149.055225,149.08909],&#34;lat&#34;:[-20.660006,-20.641137,-20.618427,-20.660006]}],[{&#34;lng&#34;:[149.074593,149.070078,149.065883,149.074593],&#34;lat&#34;:[-20.303888,-20.309447,-20.303818,-20.303888]}],[{&#34;lng&#34;:[149.064619,149.052794,149.034049,149.024314,149.036719,149.040079,149.052999,149.064619],&#34;lat&#34;:[-20.453027,-20.450558,-20.460247,-20.441408,-20.430407,-20.438137,-20.436267,-20.453027]}],[{&#34;lng&#34;:[149.062018,149.046818,149.043363,149.034643,149.032913,149.022073,148.990261,148.978533,148.986585,148.963191,148.962392,148.9499,148.974867,148.968451,148.966294,148.959159,148.957395,148.93756,148.932188,148.923039,148.928952,148.912699,148.91294,148.927148,148.936299,148.942787,148.962034,148.954794,148.958474,148.942114,148.937944,148.939884,148.952054,148.960263,148.955973,148.978318,148.973203,148.983768,148.976173,148.996058,148.991628,149.010783,149.004478,149.025938,149.014993,149.025338,149.040648,149.062018],&#34;lat&#34;:[-20.293457,-20.309537,-20.302179,-20.308699,-20.300499,-20.321399,-20.30076,-20.313661,-20.322515,-20.328759,-20.303594,-20.303021,-20.268843,-20.265306,-20.280216,-20.287995,-20.280696,-20.307124,-20.294449,-20.295794,-20.286217,-20.290958,-20.2819,-20.281475,-20.263722,-20.268185,-20.244859,-20.239519,-20.227639,-20.243359,-20.23961,-20.22586,-20.219399,-20.187339,-20.15803,-20.161928,-20.174369,-20.185078,-20.205229,-20.203178,-20.250372,-20.232919,-20.255478,-20.234908,-20.269729,-20.255418,-20.284588,-20.293457]}],[{&#34;lng&#34;:[149.044232,149.036602,149.038652,149.020662,149.036332,149.038132,149.044232],&#34;lat&#34;:[-20.155939,-20.164879,-20.182929,-20.160819,-20.159379,-20.150229,-20.155939]}],[{&#34;lng&#34;:[149.036284,149.034079,149.023064,149.036284],&#34;lat&#34;:[-20.397008,-20.403797,-20.397438,-20.397008]}],[{&#34;lng&#34;:[148.996016,148.989086,148.990664,148.996016],&#34;lat&#34;:[-20.352742,-20.356558,-20.349645,-20.352742]}],[{&#34;lng&#34;:[148.982644,148.977171,148.965653,148.967053,148.956302,148.952834,148.948581,148.955269,148.94488,148.946392,148.958925,148.976357,148.982644],&#34;lat&#34;:[-20.35187,-20.364386,-20.366564,-20.35298,-20.361372,-20.377405,-20.368537,-20.356846,-20.364437,-20.332614,-20.347499,-20.34423,-20.35187]}],[{&#34;lng&#34;:[148.967942,148.948543,148.949993,148.959293,148.957333,148.945423,148.937013,148.951263,148.931544,148.930024,148.915044,148.902224,148.915574,148.887624,148.881699,148.884284,148.889319,148.904124,148.911564,148.911883,148.902224,148.906818,148.922663,148.926433,148.926713,148.942668,148.959347,148.967942],&#34;lat&#34;:[-20.06766,-20.0835,-20.09252,-20.09459,-20.10626,-20.09375,-20.1017,-20.15655,-20.17826,-20.13276,-20.1742,-20.16612,-20.12343,-20.16916,-20.161629,-20.12268,-20.111419,-20.10991,-20.10044,-20.08806,-20.07958,-20.071299,-20.06211,-20.08167,-20.07327,-20.063779,-20.059799,-20.06766]}],[{&#34;lng&#34;:[148.941687,148.928113,148.927809,148.935578,148.941687],&#34;lat&#34;:[-20.376094,-20.369498,-20.337306,-20.339826,-20.376094]}],[{&#34;lng&#34;:[148.929134,148.927129,148.923918,148.929134],&#34;lat&#34;:[-20.318732,-20.325538,-20.311178,-20.318732]}],[{&#34;lng&#34;:[148.927724,148.917864,148.917764,148.927724],&#34;lat&#34;:[-20.852097,-20.854737,-20.847327,-20.852097]}],[{&#34;lng&#34;:[148.924298,148.921284,148.908498,148.909994,148.924298],&#34;lat&#34;:[-20.255996,-20.271186,-20.274167,-20.25755,-20.255996]}],[{&#34;lng&#34;:[148.915139,148.897579,148.891499,148.902424,148.915139],&#34;lat&#34;:[-20.852698,-20.854978,-20.829298,-20.826817,-20.852698]}],[{&#34;lng&#34;:[148.898053,148.894654,148.881,148.880974,148.898053],&#34;lat&#34;:[-20.05045,-20.06259,-20.061911,-20.037,-20.05045]}],[{&#34;lng&#34;:[148.882793,148.876062,148.878675,148.882793],&#34;lat&#34;:[-20.601334,-20.599328,-20.590579,-20.601334]}],[{&#34;lng&#34;:[148.875858,148.866008,148.864236,148.875858],&#34;lat&#34;:[-20.613492,-20.61901,-20.607159,-20.613492]}],[{&#34;lng&#34;:[148.875368,148.875253,148.866487,148.851674,148.844541,148.853481,148.850643,148.875368],&#34;lat&#34;:[-20.38524,-20.394064,-20.396576,-20.381613,-20.335626,-20.316017,-20.347399,-20.38524]}],[{&#34;lng&#34;:[148.85049,148.83977,148.826745,148.830208,148.85049],&#34;lat&#34;:[-20.261236,-20.280417,-20.285208,-20.255839,-20.261236]}],[{&#34;lng&#34;:[148.829856,148.829826,148.822706,148.810081,148.829856],&#34;lat&#34;:[-20.23581,-20.24123,-20.23823,-20.214139,-20.23581]}],[{&#34;lng&#34;:[148.614098,148.600258,148.607568,148.614098],&#34;lat&#34;:[-20.148852,-20.152502,-20.137532,-20.148852]}],[{&#34;lng&#34;:[148.576033,148.569743,148.570723,148.576033],&#34;lat&#34;:[-20.101301,-20.103801,-20.096471,-20.101301]}],[{&#34;lng&#34;:[148.478544,148.474689,148.457315,148.444535,148.438,148.445214,148.457744,148.467394,148.478544],&#34;lat&#34;:[-20.001782,-20.049703,-20.051822,-20.044432,-20.021094,-19.973952,-19.974672,-19.995912,-20.001782]}],[{&#34;lng&#34;:[148.294237,148.286087,148.277657,148.282627,148.284787,148.294237],&#34;lat&#34;:[-20.031863,-20.040683,-20.038033,-20.026973,-20.033643,-20.031863]}],[{&#34;lng&#34;:[146.883736,146.872826,146.850816,146.846112,146.804245,146.779033,146.789986,146.8155,146.832454,146.849446,146.864249,146.862175,146.883736],&#34;lat&#34;:[-19.1136,-19.153078,-19.160137,-19.18176,-19.161279,-19.129171,-19.115137,-19.117516,-19.10483,-19.117944,-19.115523,-19.102522,-19.1136]}],[{&#34;lng&#34;:[146.693728,146.693758,146.687918,146.647918,146.632788,146.616789,146.609879,146.587109,146.579689,146.568499,146.566909,146.576989,146.578326,146.589049,146.572429,146.594969,146.597889,146.619628,146.641868,146.685337,146.693728],&#34;lat&#34;:[-18.755685,-18.761905,-18.757185,-18.776445,-18.762605,-18.764925,-18.757955,-18.758495,-18.770715,-18.762966,-18.750546,-18.749946,-18.725158,-18.712046,-18.677646,-18.682536,-18.698226,-18.707746,-18.749695,-18.738215,-18.755685]}],[{&#34;lng&#34;:[146.643071,146.629061,146.633503,146.643071],&#34;lat&#34;:[-19.031949,-19.033123,-19.02239,-19.031949]}],[{&#34;lng&#34;:[146.621541,146.59803,146.614807,146.621541],&#34;lat&#34;:[-19.031736,-19.035242,-19.02523,-19.031736]}],[{&#34;lng&#34;:[146.567539,146.556349,146.538559,146.547909,146.567539],&#34;lat&#34;:[-18.670886,-18.687876,-18.658106,-18.652196,-18.670886]}],[{&#34;lng&#34;:[146.55102,146.54855,146.53213,146.55102],&#34;lat&#34;:[-18.842345,-18.848685,-18.835185,-18.842345]}],[{&#34;lng&#34;:[146.52688,146.51981,146.50861,146.51851,146.50585,146.520559,146.52688],&#34;lat&#34;:[-18.672386,-18.714776,-18.700016,-18.684276,-18.659806,-18.660766,-18.672386]}],[{&#34;lng&#34;:[146.508094,146.50335,146.489405,146.486975,146.500069,146.483639,146.494729,146.481289,146.484314,146.497164,146.508094],&#34;lat&#34;:[-18.622835,-18.656076,-18.667525,-18.650135,-18.633606,-18.614446,-18.598936,-18.585416,-18.567436,-18.581735,-18.622835]}],[{&#34;lng&#34;:[146.505109,146.500409,146.489009,146.490599,146.502228,146.505109],&#34;lat&#34;:[-18.554046,-18.563326,-18.557826,-18.539177,-18.543096,-18.554046]}],[{&#34;lng&#34;:[146.237398,146.23051,146.232619,146.244209,146.232479,146.227819,146.216459,146.224469,146.223009,146.231169,146.231689,146.250529,146.274539,146.298758,146.305528,146.285969,146.275559,146.290009,146.306059,146.318119,146.331399,146.339609,146.334419,146.327309,146.32416,146.358419,146.33632,146.323921,146.301201,146.289691,146.247902,146.224192,146.200902,146.206982,146.191301,146.151691,146.101022,146.070812,146.103791,146.127081,146.19634,146.247,146.237973,146.23978,146.22564,146.237398],&#34;lat&#34;:[-18.282148,-18.272299,-18.265509,-18.266169,-18.257489,-18.234449,-18.227359,-18.213669,-18.19458,-18.197159,-18.219529,-18.237119,-18.239889,-18.231479,-18.241969,-18.271729,-18.317509,-18.325618,-18.355748,-18.351988,-18.362348,-18.380748,-18.386298,-18.381458,-18.400218,-18.418328,-18.432278,-18.486427,-18.494057,-18.487417,-18.488858,-18.478958,-18.437418,-18.397758,-18.366709,-18.312989,-18.28595,-18.24667,-18.23443,-18.23462,-18.277899,-18.295879,-18.282971,-18.293069,-18.277299,-18.282148]}],[{&#34;lng&#34;:[146.287188,146.277138,146.282088,146.287188],&#34;lat&#34;:[-18.14235,-18.13876,-18.13513,-18.14235]}],[{&#34;lng&#34;:[146.208762,146.206062,146.189963,146.192782,146.208762],&#34;lat&#34;:[-18.460688,-18.471768,-18.470778,-18.459698,-18.460688]}],[{&#34;lng&#34;:[146.179222,146.178302,146.193842,146.195662,146.192602,146.180032,146.17995,146.172582,146.167942,146.179842,146.179589,146.178722,146.167232,146.145022,146.163362,146.171062,146.179222],&#34;lat&#34;:[-18.396718,-18.373169,-18.395858,-18.418338,-18.429418,-18.417458,-18.415342,-18.420298,-18.407988,-18.412587,-18.406121,-18.409668,-18.404718,-18.358089,-18.368999,-18.365619,-18.396718]}],[{&#34;lng&#34;:[146.192099,146.17605,146.1524,146.16052,146.17198,146.192099],&#34;lat&#34;:[-18.16639,-18.18099,-18.17538,-18.1522,-18.15117,-18.16639]}],[{&#34;lng&#34;:[146.187042,146.177702,146.182302,146.187042],&#34;lat&#34;:[-18.430448,-18.434408,-18.426268,-18.430448]}],[{&#34;lng&#34;:[146.180752,146.176392,146.170572,146.180752],&#34;lat&#34;:[-18.419718,-18.432378,-18.423468,-18.419718]}],[{&#34;lng&#34;:[146.178178,146.134149,146.151528,146.173178,146.178178],&#34;lat&#34;:[-17.966971,-17.935401,-17.927661,-17.945931,-17.966971]}],[{&#34;lng&#34;:[146.016754,146.011805,146.004885,146.016754],&#34;lat&#34;:[-17.155424,-17.165024,-17.154394,-17.155424]}],[{&#34;lng&#34;:[146.005128,146.000307,145.985538,145.99079,146.005128],&#34;lat&#34;:[-16.924182,-16.936674,-16.942179,-16.925325,-16.924182]}],[{&#34;lng&#34;:[145.477366,145.467406,145.470666,145.448257,145.444866,145.455786,145.450626,145.467116,145.477366],&#34;lat&#34;:[-14.670246,-14.679976,-14.685506,-14.680236,-14.667366,-14.672086,-14.647026,-14.654336,-14.670246]}],[{&#34;lng&#34;:[144.989702,144.978802,144.950633,144.978692,144.989702],&#34;lat&#34;:[-14.502708,-14.511518,-14.499318,-14.492998,-14.502708]}],[{&#34;lng&#34;:[144.817504,144.810894,144.804174,144.815534,144.817504],&#34;lat&#34;:[-14.431719,-14.437809,-14.432829,-14.425169,-14.431719]}],[{&#34;lng&#34;:[144.532854,144.531924,144.525444,144.525464,144.532854],&#34;lat&#34;:[-14.118902,-14.124552,-14.120252,-14.112122,-14.118902]}],[{&#34;lng&#34;:[144.338099,144.335647,144.326277,144.327687,144.338099],&#34;lat&#34;:[-14.095325,-14.102323,-14.102303,-14.095183,-14.095325]}],[{&#34;lng&#34;:[144.338124,144.328497,144.331877,144.340426,144.338124],&#34;lat&#34;:[-14.095252,-14.093843,-14.085953,-14.088683,-14.095252]}],[{&#34;lng&#34;:[144.283659,144.240279,144.232459,144.251439,144.250329,144.272898,144.283659],&#34;lat&#34;:[-14.194862,-14.191333,-14.175403,-14.175913,-14.160443,-14.158703,-14.194862]}],[{&#34;lng&#34;:[144.278709,144.269759,144.24539,144.266099,144.276419,144.278709],&#34;lat&#34;:[-14.226112,-14.238612,-14.221042,-14.225052,-14.216622,-14.226112]}],[{&#34;lng&#34;:[144.268188,144.245039,144.20952,144.228599,144.231219,144.237239,144.243449,144.268188],&#34;lat&#34;:[-14.148073,-14.151733,-14.184813,-14.154733,-14.132833,-14.129703,-14.142923,-14.148073]}],[{&#34;lng&#34;:[144.23131,144.20254,144.22241,144.23131],&#34;lat&#34;:[-14.209942,-14.230392,-14.206292,-14.209942]}],[{&#34;lng&#34;:[144.063809,144.057899,144.039199,144.051549,144.063809],&#34;lat&#34;:[-9.91276,-9.92374,-9.92315,-9.908429999999999,-9.91276]}],[{&#34;lng&#34;:[143.78451,143.775831,143.760011,143.759251,143.772461,143.777661,143.78451],&#34;lat&#34;:[-9.577152999999999,-9.598423,-9.597023,-9.580522999999999,-9.580473,-9.570963000000001,-9.577152999999999]}],[{&#34;lng&#34;:[143.779395,143.772635,143.775035,143.779395],&#34;lat&#34;:[-14.221694,-14.220164,-14.214054,-14.221694]}],[{&#34;lng&#34;:[143.721987,143.717843,143.715161,143.721987],&#34;lat&#34;:[-13.866067,-13.870137,-13.862125,-13.866067]}],[{&#34;lng&#34;:[143.501861,143.475112,143.454362,143.475222,143.501861],&#34;lat&#34;:[-12.526884,-12.521365,-12.504375,-12.520465,-12.526884]}],[{&#34;lng&#34;:[143.422975,143.398315,143.404565,143.422975],&#34;lat&#34;:[-9.750263,-9.754583,-9.748233000000001,-9.750263]}],[{&#34;lng&#34;:[143.415166,143.403683,143.413206,143.415166],&#34;lat&#34;:[-12.289466,-12.287791,-12.284046,-12.289466]}],[{&#34;lng&#34;:[143.401295,143.392476,143.389006,143.401295],&#34;lat&#34;:[-12.868873,-12.875953,-12.868853,-12.868873]}],[{&#34;lng&#34;:[143.400826,143.393566,143.394896,143.400826],&#34;lat&#34;:[-12.895923,-12.894363,-12.876513,-12.895923]}],[{&#34;lng&#34;:[143.390646,143.383976,143.379126,143.390646],&#34;lat&#34;:[-12.878563,-12.883323,-12.876673,-12.878563]}],[{&#34;lng&#34;:[143.388316,143.376686,143.385076,143.388316],&#34;lat&#34;:[-12.869873,-12.870463,-12.864793,-12.869873]}],[{&#34;lng&#34;:[143.378456,143.374456,143.358766,143.378456],&#34;lat&#34;:[-12.886273,-12.895763,-12.887003,-12.886273]}],[{&#34;lng&#34;:[143.275986,143.267332,143.262231,143.275986],&#34;lat&#34;:[-11.985288,-11.989577,-11.975052,-11.985288]}],[{&#34;lng&#34;:[142.977396,142.971796,142.975476,142.977396],&#34;lat&#34;:[-9.80498,-9.805440000000001,-9.79509,-9.80498]}],[{&#34;lng&#34;:[142.948447,142.912558,142.897758,142.900448,142.917257,142.948447],&#34;lat&#34;:[-9.853910000000001,-9.866849,-9.853439,-9.846079,-9.842999000000001,-9.853910000000001]}],[{&#34;lng&#34;:[142.867649,142.857599,142.82604,142.83288,142.857289,142.867649],&#34;lat&#34;:[-10.039029,-10.053148,-10.024858,-10.018308,-10.019578,-10.039029]}],[{&#34;lng&#34;:[142.800857,142.794837,142.754198,142.743739,142.70725,142.651571,142.609372,142.596612,142.603782,142.646921,142.707499,142.743128,142.800857],&#34;lat&#34;:[-9.375672,-9.389352000000001,-9.400472000000001,-9.419021000000001,-9.428321,-9.427961,-9.414711,-9.403411,-9.383171000000001,-9.364720999999999,-9.381752000000001,-9.366911999999999,-9.375672]}],[{&#34;lng&#34;:[142.783441,142.768611,142.764381,142.781371,142.783441],&#34;lat&#34;:[-9.904118,-9.904698,-9.894078,-9.895868,-9.904118]}],[{&#34;lng&#34;:[142.725479,142.69885,142.6673,142.68893,142.725479],&#34;lat&#34;:[-9.368282000000001,-9.377342000000001,-9.369790999999999,-9.358252,-9.368282000000001]}],[{&#34;lng&#34;:[142.705703,142.692314,142.686954,142.666714,142.651164,142.651864,142.690173,142.705703],&#34;lat&#34;:[-10.953042,-10.958571,-10.936972,-10.936282,-10.923612,-10.914792,-10.920132,-10.953042]}],[{&#34;lng&#34;:[142.666442,142.654073,142.638413,142.650883,142.632273,142.639373,142.666442],&#34;lat&#34;:[-10.629033,-10.651403,-10.653193,-10.638623,-10.627073,-10.618263,-10.629033]}],[{&#34;lng&#34;:[142.649234,142.647984,142.621995,142.628365,142.649234],&#34;lat&#34;:[-9.764488,-9.772568,-9.772588000000001,-9.757778,-9.764488]}],[{&#34;lng&#34;:[142.639044,142.635264,142.620744,142.634024,142.639044],&#34;lat&#34;:[-10.920432,-10.926992,-10.918722,-10.914212,-10.920432]}],[{&#34;lng&#34;:[142.627853,142.615163,142.609233,142.619973,142.627853],&#34;lat&#34;:[-10.598243,-10.600713,-10.592683,-10.589754,-10.598243]}],[{&#34;lng&#34;:[142.622543,142.611903,142.584394,142.595253,142.608843,142.615023,142.615453,142.622543],&#34;lat&#34;:[-10.743163,-10.745413,-10.714403,-10.712833,-10.726303,-10.720883,-10.738183,-10.743163]}],[{&#34;lng&#34;:[142.551753,142.531603,142.528863,142.551753],&#34;lat&#34;:[-9.419591,-9.435991,-9.410781,-9.419591]}],[{&#34;lng&#34;:[142.517682,142.513112,142.504112,142.517682],&#34;lat&#34;:[-10.192006,-10.195276,-10.183846,-10.192006]}],[{&#34;lng&#34;:[142.514652,142.508252,142.502222,142.514652],&#34;lat&#34;:[-10.158086,-10.163276,-10.157276,-10.158086]}],[{&#34;lng&#34;:[142.490332,142.480023,142.474043,142.490332],&#34;lat&#34;:[-10.243286,-10.260396,-10.250256,-10.243286]}],[{&#34;lng&#34;:[142.410957,142.385637,142.393437,142.389727,142.396547,142.410957],&#34;lat&#34;:[-10.711573,-10.750123,-10.730423,-10.717993,-10.709253,-10.711573]}],[{&#34;lng&#34;:[142.344168,142.331609,142.278669,142.241128,142.226388,142.218088,142.183887,142.205827,142.210747,142.206037,142.219837,142.236927,142.253827,142.265887,142.288637,142.300147,142.312078,142.325528,142.330418,142.344168],&#34;lat&#34;:[-10.172237,-10.199197,-10.259777,-10.234258,-10.230358,-10.238878,-10.18948,-10.166549,-10.170829,-10.161699,-10.128859,-10.121329,-10.125449,-10.115789,-10.127798,-10.124018,-10.138558,-10.135108,-10.158157,-10.172237]}],[{&#34;lng&#34;:[142.326393,142.302723,142.267664,142.236094,142.243174,142.240974,142.257124,142.306333,142.326393],&#34;lat&#34;:[-10.611193,-10.634243,-10.642303,-10.607263,-10.606453,-10.597863,-10.579483,-10.570583,-10.611193]}],[{&#34;lng&#34;:[142.321023,142.315813,142.300273,142.284103,142.304293,142.312232,142.321023],&#34;lat&#34;:[-10.531173,-10.541373,-10.542343,-10.527934,-10.520614,-10.505544,-10.531173]}],[{&#34;lng&#34;:[142.319433,142.306693,142.283773,142.258312,142.290603,142.319433],&#34;lat&#34;:[-9.567913000000001,-9.574293000000001,-9.569863,-9.553914000000001,-9.551303000000001,-9.567913000000001]}],[{&#34;lng&#34;:[142.304918,142.290218,142.281688,142.295108,142.304918],&#34;lat&#34;:[-10.721873,-10.733913,-10.716313,-10.701673,-10.721873]}],[{&#34;lng&#34;:[142.294921,142.284021,142.245401,142.160671,142.131871,142.222421,142.242551,142.266541,142.294921],&#34;lat&#34;:[-9.262734999999999,-9.284644999999999,-9.290786000000001,-9.281257,-9.264447000000001,-9.229597,-9.258915999999999,-9.250686,-9.262734999999999]}],[{&#34;lng&#34;:[142.277423,142.264814,142.255044,142.242914,142.245694,142.230224,142.227404,142.206854,142.195723,142.187943,142.186313,142.177863,142.158273,142.150053,142.138633,142.112843,142.119103,142.109633,142.119713,142.110464,142.122544,142.121934,142.139994,142.152494,142.168724,142.186914,142.203704,142.210184,142.245394,142.249704,142.277423],&#34;lat&#34;:[-10.706483,-10.727223,-10.713813,-10.711143,-10.720063,-10.739463,-10.720703,-10.726433,-10.746274,-10.746184,-10.765974,-10.770874,-10.761334,-10.764874,-10.737094,-10.719665,-10.710815,-10.685085,-10.690575,-10.661784,-10.652124,-10.642974,-10.642574,-10.622854,-10.623354,-10.597964,-10.594844,-10.616523,-10.647253,-10.667023,-10.706483]}],[{&#34;lng&#34;:[142.250871,142.242411,142.23354,142.250871],&#34;lat&#34;:[-9.229096,-9.234726,-9.221187,-9.229096]}],[{&#34;lng&#34;:[142.232533,142.210654,142.205594,142.221487,142.232533],&#34;lat&#34;:[-10.573924,-10.589044,-10.581494,-10.569771,-10.573924]}],[{&#34;lng&#34;:[142.229863,142.213993,142.194943,142.184063,142.182853,142.204073,142.213013,142.229863],&#34;lat&#34;:[-10.534034,-10.566314,-10.574864,-10.568354,-10.552644,-10.544074,-10.521654,-10.534034]}],[{&#34;lng&#34;:[142.201174,142.178455,142.164694,142.187014,142.201174],&#34;lat&#34;:[-9.948772,-9.972832,-9.951741999999999,-9.942382,-9.948772]}],[{&#34;lng&#34;:[142.192476,142.187847,142.170987,142.163427,142.153917,142.134317,142.121646,142.108876,142.087466,142.091896,142.085356,142.112755,142.114185,142.127895,142.161975,142.168266,142.181926,142.192476],&#34;lat&#34;:[-10.10589,-10.14842,-10.15786,-10.18096,-10.17262,-10.1788,-10.148091,-10.148811,-10.130111,-10.122861,-10.112592,-10.082542,-10.068512,-10.072881,-10.063601,-10.069001,-10.059341,-10.10589]}],[{&#34;lng&#34;:[142.18843,142.156401,142.16435,142.18843],&#34;lat&#34;:[-9.232797,-9.246727,-9.223927,-9.232797]}],[{&#34;lng&#34;:[142.178983,142.169004,142.146333,142.178983],&#34;lat&#34;:[-10.585664,-10.605944,-10.595054,-10.585664]}],[{&#34;lng&#34;:[142.173227,142.168848,142.163437,142.173227],&#34;lat&#34;:[-10.207719,-10.228199,-10.216909,-10.207719]}],[{&#34;lng&#34;:[142.170973,142.157783,142.145653,142.170973],&#34;lat&#34;:[-10.553585,-10.570035,-10.565665,-10.553585]}],[{&#34;lng&#34;:[142.140715,142.134365,142.125905,142.124654,142.132764,142.140715],&#34;lat&#34;:[-10.373367,-10.386847,-10.384057,-10.353408,-10.354288,-10.373367]}],[{&#34;lng&#34;:[142.115326,142.107635,142.098845,142.099596,142.108716,142.114906,142.099295,142.115326],&#34;lat&#34;:[-10.991465,-10.998365,-10.989496,-10.975245,-10.967305,-10.971235,-10.986556,-10.991465]}],[{&#34;lng&#34;:[142.076853,142.065883,142.073973,142.076853],&#34;lat&#34;:[-10.26538,-10.26248,-10.25918,-10.26538]}],[{&#34;lng&#34;:[142.060474,142.048074,142.048604,142.060474],&#34;lat&#34;:[-10.353859,-10.365769,-10.354689,-10.353859]}],[{&#34;lng&#34;:[139.887477,139.855767,139.848137,139.868217,139.871947,139.887477],&#34;lat&#34;:[-16.653029,-16.677089,-16.663479,-16.658209,-16.645349,-16.653029]}],[{&#34;lng&#34;:[139.813616,139.806556,139.802206,139.813616],&#34;lat&#34;:[-16.49131,-16.49679,-16.48797,-16.49131]}],[{&#34;lng&#34;:[139.734697,139.730877,139.723347,139.709537,139.701237,139.717717,139.726367,139.734697],&#34;lat&#34;:[-16.477391,-16.501301,-16.490971,-16.490181,-16.474411,-16.450141,-16.450781,-16.477391]}],[{&#34;lng&#34;:[139.712128,139.689608,139.683758,139.657218,139.639278,139.626268,139.595979,139.589039,139.579709,139.578299,139.558499,139.566579,139.546629,139.560819,139.540659,139.531339,139.506779,139.47502,139.48556,139.51432,139.5068,139.4837,139.45308,139.4583,139.46743,139.47307,139.45527,139.4712,139.465631,139.439141,139.447111,139.451261,139.438131,139.417381,139.401991,139.393081,139.380071,139.375851,139.383012,139.368602,139.373892,139.365692,139.358742,139.350562,139.321982,139.313053,139.305073,139.274583,139.254353,139.230023,139.221573,139.199764,139.195023,139.166244,139.151014,139.161923,139.212783,139.218522,139.239262,139.241832,139.292081,139.304131,139.338331,139.36362,139.42042,139.465389,139.535249,139.548048,139.604468,139.650178,139.676387,139.680237,139.690287,139.698507,139.700878,139.712128],&#34;lat&#34;:[-16.530531,-16.534981,-16.520471,-16.519401,-16.532321,-16.530421,-16.554211,-16.532241,-16.527081,-16.502671,-16.490752,-16.474502,-16.460532,-16.480272,-16.488212,-16.515482,-16.511992,-16.526232,-16.542112,-16.545152,-16.576682,-16.556022,-16.569502,-16.575382,-16.568582,-16.583162,-16.580312,-16.588132,-16.627932,-16.630692,-16.633152,-16.666262,-16.674752,-16.672402,-16.640432,-16.637272,-16.647112,-16.642032,-16.656382,-16.672102,-16.686342,-16.693352,-16.684572,-16.688952,-16.710182,-16.730232,-16.724132,-16.733523,-16.723583,-16.731153,-16.709793,-16.707653,-16.661933,-16.667973,-16.633843,-16.608643,-16.568533,-16.535753,-16.523663,-16.504333,-16.477193,-16.462833,-16.464503,-16.452393,-16.444882,-16.446072,-16.408552,-16.390702,-16.403041,-16.449501,-16.450611,-16.468881,-16.468001,-16.478801,-16.514421,-16.530531]}],[{&#34;lng&#34;:[139.639482,139.611912,139.614462,139.603772,139.596492,139.595112,139.614042,139.625512,139.639482],&#34;lat&#34;:[-17.07442,-17.12094,-17.13948,-17.13833,-17.1329,-17.11222,-17.10626,-17.06209,-17.07442]}],[{&#34;lng&#34;:[139.472553,139.427284,139.425524,139.439824,139.434554,139.411174,139.394114,139.423344,139.450443,139.456743,139.468593,139.461633,139.469723,139.472983,139.486073,139.490133,139.486953,139.473763,139.477453,139.490573,139.494582,139.500462,139.492632,139.494472,139.543542,139.556342,139.549272,139.554432,139.577982,139.522693,139.514473,139.518683,139.509863,139.478003,139.472553],&#34;lat&#34;:[-17.09595,-17.105591,-17.123461,-17.135691,-17.139451,-17.122191,-17.082971,-17.078611,-17.055281,-17.031281,-17.029171,-17.025261,-17.023851,-17.035581,-17.036241,-17.044571,-17.034701,-17.030381,-17.019511,-17.015811,-17.000981,-17.002301,-16.996501,-16.979621,-17.03135,-17.03431,-17.04797,-17.06973,-17.09355,-17.10276,-17.11186,-17.12316,-17.12315,-17.115791,-17.09595]},{&#34;lng&#34;:[139.479806,139.484533,139.480753,139.479806],&#34;lat&#34;:[-17.093717,-17.092811,-17.084631,-17.093717]}],[{&#34;lng&#34;:[139.560553,139.549473,139.552203,139.560553],&#34;lat&#34;:[-17.11442,-17.12921,-17.11452,-17.11442]}],[{&#34;lng&#34;:[139.477661,139.464551,139.453651,139.441331,139.438391,139.452441,139.467561,139.477661],&#34;lat&#34;:[-16.679452,-16.700382,-16.707512,-16.703682,-16.694532,-16.674392,-16.667032,-16.679452]}],[{&#34;lng&#34;:[139.28366,139.27372,139.2729,139.28366],&#34;lat&#34;:[-16.264043,-16.275354,-16.264384,-16.264043]}],[{&#34;lng&#34;:[139.279795,139.262625,139.260655,139.265475,139.279795],&#34;lat&#34;:[-16.993792,-16.999202,-16.989832,-16.984412,-16.993792]}],[{&#34;lng&#34;:[139.265675,139.250745,139.247865,139.233225,139.222885,139.214685,139.207345,139.243075,139.265675],&#34;lat&#34;:[-17.058282,-17.055642,-17.045382,-17.046142,-17.031722,-17.036402,-17.003332,-17.029472,-17.058282]}],[{&#34;lng&#34;:[139.188754,139.182644,139.188624,139.173964,139.184754,139.169974,139.162344,139.141354,139.145954,139.171284,139.188754],&#34;lat&#34;:[-16.681543,-16.698383,-16.719283,-16.728443,-16.733643,-16.730693,-16.748893,-16.754083,-16.691933,-16.671033,-16.681543]}],[{&#34;lng&#34;:[139.152225,139.128405,139.113855,139.113255,139.094725,139.090625,139.094865,139.132535,139.152225],&#34;lat&#34;:[-16.821893,-16.826063,-16.837583,-16.849443,-16.843103,-16.826713,-16.812703,-16.797813,-16.821893]}],[{&#34;lng&#34;:[139.076836,139.046216,139.073676,139.076836],&#34;lat&#34;:[-16.902193,-16.885333,-16.891113,-16.902193]}],[{&#34;lng&#34;:[139.067596,139.058906,139.063146,139.067596],&#34;lat&#34;:[-16.865003,-16.876863,-16.860593,-16.865003]}]],[[{&#34;lng&#34;:[138.500217,138.510797,138.51616,138.532889,138.530822,138.545732,138.56628,138.547525,138.553914,138.543501,138.541428,138.52975,138.532602,138.491739,138.475866,138.463876,138.454697,138.43615,138.444655,138.430566,138.436243,138.445781,138.426467,138.413243,138.416988,138.408432,138.364309,138.349516,138.344385,138.265632,138.246978,138.225222,138.230858,138.223029,138.192401,138.146203,138.167524,138.165702,138.102306,138.077415,138.04372,138.029348,138.012405,138.001543,138.021736,138.007096,137.917537,137.898839,137.887583,137.875809,137.907676,137.87681,137.880758,137.868851,137.864947,137.857788,137.865023,137.8317,137.800063,137.796073,137.805024,137.79029,137.757304,137.76399,137.733807,137.72473,137.745477,137.743274,137.758661,137.697314,137.677887,137.637498,137.554817,137.525835,137.510698,137.464103,137.42284,137.352267,137.340748,137.342809,137.334579,137.347808,137.334887,137.29811,137.264701,137.237741,137.203511,137.190399,137.190574,137.173992,137.111428,137.076687,137.001389,136.982979,136.9827,136.969755,136.966855,136.945243,136.944022,136.89975,136.883,136.870503,136.848565,136.821927,136.834107,136.829351,136.846425,136.84574,136.865972,136.888337,136.89761,136.913125,136.941123,136.941788,136.961072,136.930287,136.944086,136.943678,136.968239,136.976385,137.012553,137.013614,137.093376,137.146064,137.194414,137.224498,137.276479,137.291011,137.309245,137.346955,137.356422,137.374945,137.41535,137.448758,137.457725,137.459607,137.50944,137.506741,137.473817,137.486637,137.483189,137.463169,137.446005,137.427025,137.415149,137.416933,137.438119,137.446657,137.465117,137.47608,137.483663,137.500299,137.499904,137.449856,137.506757,137.522273,137.526001,137.567535,137.552323,137.527125,137.538706,137.558632,137.563706,137.575722,137.600263,137.63064,137.62546,137.600358,137.643791,137.725471,137.736431,137.755144,137.800547,137.834527,137.857277,137.879023,137.892462,137.919659,137.924238,137.913797,137.903569,137.905083,137.89323,137.917547,137.935597,137.935352,137.946766,137.951782,137.964795,137.977463,137.971121,137.962976,137.939426,137.94143,137.949068,137.932892,137.906643,137.870496,137.8755,137.883258,137.890944,137.882871,137.891216,137.883687,137.881243,137.87414,137.878627,137.8656,137.858829,137.873503,137.85183,137.842526,137.844915,137.817427,137.811132,137.82675,137.821262,137.837982,137.852958,137.853601,137.907816,137.925484,137.939986,137.958306,137.963533,137.954364,137.987635,138.000807,138.007072,138.001337,138.013031,138.011854,138.024228,138.036289,138.014093,138.018263,138.028292,138.020918,138.048044,138.054408,138.036705,138.02463,138.030634,138.039252,138.045942,138.018784,137.952082,137.956632,137.912322,137.90089,137.916527,137.916821,137.936655,137.944458,137.887464,137.837571,137.860025,137.867648,137.852028,137.836291,137.802716,137.82182,137.828519,137.825333,137.829153,137.839055,137.829893,137.838248,137.829686,137.83577,137.823014,137.782259,137.789296,137.78184,137.785277,137.768971,137.772488,137.758759,137.770628,137.757935,137.766047,137.75036,137.752415,137.763815,137.753371,137.764511,137.751739,137.76201,137.749653,137.764897,137.750393,137.757119,137.749747,137.753152,137.781324,137.809507,137.793206,137.798497,137.798826,137.803563,137.810557,137.800485,137.791768,137.798263,137.789289,137.758283,137.749516,137.786511,137.759169,137.760331,137.721268,137.713268,137.691496,137.661043,137.641418,137.611458,137.595198,137.596336,137.60323,137.595789,137.599742,137.585736,137.596979,137.552961,137.557292,137.538685,137.536023,137.499752,137.486076,137.4576,137.451979,137.442264,137.434062,137.397534,137.389738,137.393686,137.383491,137.385368,137.374434,137.384526,137.377221,137.385585,137.360741,137.360521,137.314614,137.305001,137.295283,137.278833,137.263916,137.252397,137.213306,137.182092,137.168508,137.124328,137.069734,137.03728,137.025511,136.991674,136.951489,136.857218,136.799629,136.778484,136.73046,136.668362,136.592684,136.572195,136.57475,136.497478,136.434749,136.363136,136.346688,136.356851,136.331378,136.32439,136.278006,136.260573,136.233584,136.187841,136.138538,136.112245,136.10378,136.130148,136.116359,136.091801,136.116687,136.114089,136.121769,136.109917,136.117536,136.112519,136.096279,136.092173,136.083513,136.091281,136.073225,136.0829,136.056326,136.02502,136.015488,136.021803,136.008306,135.993143,135.974127,135.93231,135.928238,135.934827,135.922751,135.902127,135.913887,135.933423,135.937413,135.912623,135.913136,135.891144,135.861765,135.853962,135.853777,135.884862,135.870055,135.8921,135.891409,135.86472,135.863448,135.846373,135.785731,135.834373,135.860612,135.893494,135.928895,135.949624,135.956396,135.960864,135.980602,135.990068,135.983633,135.99126,135.979243,135.995092,136.006531,136.014332,136.001927,136.015783,136.004306,136.008467,135.993522,135.959953,135.96267,135.993163,135.986455,135.992985,135.987292,135.997972,136.004524,136.00263,135.987209,135.976579,135.960257,135.960935,135.954463,135.943382,135.94134,135.948555,135.931669,135.928877,135.867748,135.856062,135.853755,135.79209,135.751833,135.712711,135.705738,135.679212,135.688404,135.685876,135.668666,135.653561,135.618827,135.622174,135.61472,135.624044,135.604931,135.604502,135.54065,135.495893,135.494109,135.47434,135.379698,135.350491,135.325022,135.320817,135.329374,135.347275,135.341687,135.321377,135.297102,135.283699,135.25243,135.225242,135.206611,135.208808,135.173727,135.149892,135.143498,135.109197,135.125345,135.12329,135.134241,135.129869,135.143601,135.138982,135.159564,135.173227,135.18658,135.194978,135.206319,135.217378,135.211506,135.212554,135.221384,135.3539,135.316249,135.297586,135.309491,135.354688,135.350464,135.361623,135.391139,135.402196,135.392045,135.390367,135.374297,135.376859,135.363762,135.365757,135.438272,135.451066,135.451529,135.474023,135.494016,135.510428,135.51676,135.50804,135.478234,135.45807,135.443137,135.472966,135.431694,135.444031,135.435742,135.445784,135.428658,135.42034,135.410348,135.414586,135.405086,135.395231,135.401244,135.391444,135.42219,135.406384,135.413637,135.396341,135.422243,135.389235,135.398323,135.376918,135.395769,135.388359,135.358934,135.365597,135.349857,135.357365,135.35984,135.346224,135.303512,135.28003,135.267879,135.255685,135.241237,135.244041,135.279477,135.272741,135.281119,135.264772,135.271551,135.252174,135.194027,135.182152,135.170374,135.161747,135.145846,135.082236,135.040271,134.878917,134.886099,134.879138,134.860762,134.830247,134.842694,134.840484,134.863402,134.845066,134.802047,134.760683,134.736774,134.719308,134.696622,134.688007,134.658294,134.691346,134.6985,134.711261,134.708922,134.719097,134.722438,134.709636,134.718293,134.717401,134.702148,134.666654,134.632418,134.595151,134.558351,134.576362,134.598184,134.613473,134.62554,134.640753,134.647444,134.623148,134.631218,134.663776,134.642472,134.630838,134.59576,134.547666,134.506204,134.450885,134.415463,134.391888,134.38855,134.368885,134.358474,134.324366,134.307047,134.292566,134.289983,134.299682,134.293337,134.281484,134.284078,134.275541,134.264013,134.278535,134.271537,134.281739,134.262433,134.261001,134.266137,134.284236,134.278781,134.292343,134.312594,134.321623,134.316547,134.35847,134.344935,134.352804,134.344837,134.351334,134.328367,134.260225,134.266773,134.261749,134.247206,134.230283,134.192038,134.167922,134.165246,134.138526,134.167286,134.193542,134.204837,134.201879,134.189083,134.167393,134.14406,134.141184,134.123646,134.12927,134.119181,134.106442,134.080901,134.081098,134.06053,134.070384,134.078646,134.071527,134.096119,134.099301,134.11686,134.138498,134.118901,134.060323,134.080595,134.107069,134.174283,134.204935,134.215088,134.152814,134.164646,134.200135,134.189241,134.196647,134.221859,134.24095,134.260472,134.290382,134.283746,134.294307,134.279388,134.277802,134.266342,134.214223,134.163101,134.121275,134.092181,134.102837,134.081033,134.082349,134.073909,134.081218,134.062832,134.057125,134.061924,134.086216,134.036977,133.995073,133.991564,133.954956,133.922739,133.907426,133.908794,133.89619,133.893695,133.861052,133.849,133.85712,133.846992,133.862406,133.85062,133.867482,133.866818,133.897186,133.886749,133.893665,133.889012,133.905579,133.887446,133.919317,133.94693,133.951086,133.932709,133.931014,133.901989,133.880096,133.86936,133.842866,133.818172,133.827154,133.821407,133.806014,133.808341,133.769731,133.755353,133.762215,133.756726,133.745056,133.736068,133.733206,133.714932,133.679113,133.692908,133.674713,133.648205,133.642718,133.670702,133.666883,133.643775,133.63055,133.62822,133.613619,133.592256,133.572514,133.584683,133.555852,133.553457,133.522105,133.525112,133.519074,133.525297,133.50477,133.51903,133.511304,133.496786,133.502926,133.483142,133.480031,133.489479,133.47279,133.451048,133.451453,133.438088,133.39511,133.398041,133.392332,133.400865,133.414843,133.411752,133.464309,133.491804,133.487729,133.485628,133.44624,133.425612,133.423492,133.389785,133.371437,133.322792,133.278238,133.275245,133.253192,133.230029,133.164662,133.146617,133.147535,133.125756,133.138132,133.088342,133.006622,132.979569,132.98157,132.963634,132.903772,132.826487,132.746588,132.734266,132.686927,132.660581,132.655504,132.595204,132.531329,132.478447,132.446417,132.437926,132.461607,132.473232,132.415452,132.393408,132.383915,132.38046,132.343188,132.335197,132.285618,132.271202,132.200614,132.176409,132.166219,132.151178,132.112775,132.072997,131.758577,131.442176,131.244776,131.148637,131.128507,131.081798,131.057558,131.026398,130.806132,130.734472,130.567923,130.488804,130.275063,130.152187,130.120404,129.918215,129.843095,129.527784,129.05281,129.00134,129.001854,140.999394,141.002937,141.002956,140.989765,140.980453,140.986747,140.97532,140.980575,140.969273,140.963616,140.963103,140.973872,140.965735,140.873073,140.837839,140.807612,140.782998,140.770478,140.716881,140.662442,140.642658,140.620936,140.608192,140.590339,140.579385,140.567291,140.517006,140.491164,140.454015,140.39645,140.388676,140.375888,140.353977,140.328417,140.318866,140.24789,140.178709,140.112713,140.107588,140.120189,140.131312,140.12084,140.049823,140.020089,140.011347,139.993117,139.996576,139.960106,139.949224,139.946727,139.890441,139.865514,139.840749,139.761627,139.74001,139.743061,139.776534,139.788459,139.795818,139.791482,139.768416,139.743931,139.740535,139.669972,139.675909,139.698355,139.73239,139.787616,139.842891,139.863159,139.861979,139.851109,139.782926,139.655207,139.52302,139.37702,139.211957,139.055313,138.883656,138.762908,138.710269,138.692927,138.684432,138.631522,138.626004,138.59822,138.603774,138.565936,138.52236,138.494522,138.431096,138.410026,138.275956,138.232054,138.191358,138.156886,138.096166,138.093913,138.108686,138.12743,138.165488,138.193862,138.24454,138.294318,138.341253,138.441044,138.447529,138.443202,138.459911,138.46993,138.469061,138.493568,138.517614,138.510356,138.47606,138.490256,138.477997,138.496325,138.515343,138.511546,138.500217],&#34;lat&#34;:[-34.843571,-34.842304,-34.810835,-34.815026,-34.822573,-34.81061,-34.825093,-34.809537,-34.789902,-34.774809,-34.752951,-34.745246,-34.737353,-34.721322,-34.698481,-34.697038,-34.682072,-34.672481,-34.670494,-34.668154,-34.653886,-34.653393,-34.621629,-34.620852,-34.614387,-34.60026,-34.578149,-34.557529,-34.531212,-34.476802,-34.400897,-34.365908,-34.343908,-34.311262,-34.272173,-34.265618,-34.245335,-34.221296,-34.138883,-34.133551,-34.174353,-34.221086,-34.231329,-34.257058,-34.28507,-34.349032,-34.428156,-34.493836,-34.507362,-34.597683,-34.615868,-34.66841,-34.695263,-34.722633,-34.76608,-34.7712,-34.777911,-34.812719,-34.877546,-34.906192,-34.912187,-34.922297,-34.99657,-35.040599,-35.044159,-35.053743,-35.074885,-35.102896,-35.114743,-35.141537,-35.167742,-35.168201,-35.117455,-35.112928,-35.119016,-35.099218,-35.098095,-35.13396,-35.149462,-35.16172,-35.163878,-35.163004,-35.167858,-35.168308,-35.159041,-35.164515,-35.191922,-35.208941,-35.229175,-35.237359,-35.242931,-35.226357,-35.223207,-35.235541,-35.24955,-35.25208,-35.26703,-35.269335,-35.282153,-35.285811,-35.300346,-35.286886,-35.282106,-35.24528,-35.241945,-35.233226,-35.228823,-35.190101,-35.194123,-35.185252,-35.156673,-35.153594,-35.129111,-35.105674,-35.082302,-35.02905,-35.022033,-35.012642,-35.000414,-34.94124,-34.92048,-34.892979,-34.919948,-34.9182,-34.901017,-34.904483,-34.8939,-34.90102,-34.927825,-34.9298,-34.946584,-34.953745,-34.938659,-34.910318,-34.884498,-34.80763,-34.617955,-34.582015,-34.511303,-34.481665,-34.439275,-34.426672,-34.436891,-34.472597,-34.459593,-34.444675,-34.427953,-34.398039,-34.400688,-34.392463,-34.343124,-34.312,-34.226504,-34.135518,-34.137625,-34.129251,-34.10829,-34.043536,-34.014424,-34.004388,-33.992451,-33.988852,-33.971636,-33.967168,-33.936313,-33.921822,-33.895162,-33.876794,-33.830437,-33.769922,-33.737836,-33.714222,-33.683113,-33.642457,-33.631321,-33.596782,-33.587902,-33.58733,-33.597412,-33.612915,-33.614486,-33.596919,-33.625613,-33.624978,-33.580101,-33.552675,-33.554549,-33.573302,-33.574318,-33.558834,-33.539426,-33.550773,-33.547918,-33.518107,-33.512444,-33.499684,-33.434132,-33.39654,-33.362386,-33.359406,-33.366841,-33.357762,-33.353978,-33.3524,-33.323158,-33.316092,-33.329884,-33.317356,-33.320776,-33.330279,-33.32618,-33.316505,-33.30467,-33.286669,-33.266254,-33.248593,-33.244931,-33.207238,-33.209589,-33.196834,-33.171441,-33.176496,-33.15815,-33.167765,-33.160505,-33.154713,-33.143951,-33.131649,-33.133387,-33.144027,-33.153719,-33.178027,-33.181884,-33.169499,-33.178089,-33.159353,-33.15501,-33.149031,-33.135837,-33.115096,-33.102965,-33.10578,-33.09837,-33.101157,-33.0867,-33.035621,-33.00601,-32.981391,-32.853486,-32.777649,-32.768858,-32.759413,-32.766652,-32.757655,-32.715447,-32.69581,-32.6894,-32.663933,-32.640869,-32.637649,-32.608002,-32.58058,-32.591178,-32.603699,-32.594097,-32.603632,-32.594301,-32.587284,-32.584703,-32.574669,-32.560252,-32.550341,-32.545782,-32.543439,-32.52852,-32.523867,-32.505119,-32.491348,-32.480322,-32.456053,-32.43951,-32.415371,-32.43129,-32.442118,-32.457178,-32.476162,-32.503471,-32.510099,-32.53156,-32.596744,-32.673305,-32.694254,-32.708266,-32.721238,-32.713734,-32.74859,-32.779971,-32.784695,-32.779387,-32.796932,-32.845255,-32.868142,-32.870953,-32.89354,-32.915205,-32.907355,-32.921517,-32.999915,-32.988972,-32.995383,-32.990512,-32.974483,-32.95956,-32.950959,-32.955318,-32.974561,-32.998551,-33.006782,-33.001786,-33.012108,-33.021089,-33.022086,-33.03615,-33.058059,-33.065908,-33.082123,-33.094818,-33.109622,-33.124658,-33.135572,-33.130701,-33.152177,-33.230088,-33.2853,-33.285318,-33.28989,-33.290892,-33.298338,-33.292726,-33.298507,-33.344211,-33.372166,-33.414838,-33.439166,-33.471529,-33.500116,-33.507413,-33.565015,-33.577687,-33.608277,-33.661082,-33.673153,-33.690294,-33.700746,-33.698743,-33.70801,-33.719722,-33.724793,-33.755299,-33.798387,-33.80333,-33.831012,-33.834978,-33.878689,-33.899562,-33.923038,-33.943438,-33.992615,-34.011595,-34.069349,-34.099496,-34.122758,-34.148126,-34.181602,-34.220835,-34.267704,-34.296136,-34.33484,-34.341141,-34.359384,-34.382528,-34.407111,-34.408422,-34.429572,-34.425739,-34.459054,-34.467421,-34.478434,-34.489264,-34.515817,-34.524595,-34.542734,-34.532224,-34.520841,-34.506203,-34.495306,-34.47902,-34.484048,-34.499011,-34.516206,-34.507749,-34.51856,-34.504699,-34.528521,-34.538091,-34.543962,-34.549984,-34.592584,-34.611309,-34.609826,-34.64902,-34.631482,-34.620512,-34.615732,-34.633575,-34.665381,-34.715444,-34.724936,-34.74443,-34.744097,-34.751447,-34.769666,-34.754873,-34.752882,-34.80933,-34.819008,-34.807459,-34.805599,-34.768824,-34.765659,-34.757148,-34.783816,-34.784618,-34.769453,-34.757852,-34.750348,-34.730501,-34.725326,-34.735939,-34.756514,-34.787262,-34.794216,-34.79881,-34.805694,-34.82779,-34.848601,-34.87545,-34.929897,-34.933799,-34.944914,-34.958681,-34.959234,-34.980343,-34.985854,-34.981705,-34.994656,-34.991911,-35.004769,-35.006352,-35.002954,-34.985684,-34.980702,-34.970804,-34.948295,-34.919894,-34.927288,-34.886649,-34.860956,-34.85615,-34.865101,-34.905736,-34.913706,-34.92331,-34.944856,-34.946723,-34.936363,-34.944466,-34.924155,-34.924474,-34.906359,-34.891673,-34.878667,-34.814131,-34.782583,-34.765676,-34.744108,-34.687117,-34.680472,-34.686375,-34.680297,-34.669383,-34.666046,-34.629108,-34.607997,-34.603172,-34.576035,-34.55187,-34.543618,-34.549956,-34.558634,-34.555002,-34.568884,-34.591838,-34.588234,-34.576533,-34.557401,-34.544351,-34.527798,-34.519773,-34.503296,-34.488896,-34.464768,-34.459933,-34.43406,-34.429307,-34.433353,-34.440781,-34.481453,-34.49863,-34.522063,-34.520659,-34.552295,-34.56369,-34.580068,-34.60351,-34.620736,-34.623034,-34.633402,-34.637662,-34.630065,-34.628815,-34.640746,-34.637309,-34.642091,-34.633633,-34.626783,-34.614405,-34.622819,-34.613292,-34.620955,-34.612968,-34.594986,-34.59736,-34.58644,-34.600557,-34.61665,-34.603432,-34.570027,-34.541643,-34.537188,-34.527388,-34.539237,-34.538834,-34.520801,-34.507235,-34.524262,-34.533371,-34.534024,-34.548857,-34.555048,-34.587853,-34.593077,-34.601453,-34.595065,-34.55567,-34.515206,-34.496803,-34.441275,-34.418703,-34.384994,-34.368618,-34.366161,-34.344051,-34.267559,-34.184088,-34.170303,-34.177283,-34.155217,-34.150131,-34.140787,-34.119738,-34.094594,-34.070257,-34.032148,-34.019591,-33.981334,-33.919801,-33.877771,-33.872562,-33.877516,-33.852366,-33.804127,-33.755003,-33.653908,-33.643037,-33.636109,-33.643979,-33.626318,-33.621398,-33.5929,-33.546591,-33.43649,-33.328782,-33.309046,-33.273849,-33.263939,-33.26348,-33.250199,-33.233584,-33.229487,-33.221831,-33.227607,-33.233074,-33.229984,-33.218774,-33.214788,-33.207371,-33.195677,-33.17467,-33.161002,-33.162198,-33.13879,-33.161347,-33.189315,-33.196556,-33.189094,-33.195113,-33.182719,-33.19539,-33.197901,-33.213751,-33.223077,-33.224337,-33.245163,-33.203417,-33.18987,-33.161407,-33.144657,-33.148863,-33.166091,-33.177345,-33.175899,-33.125341,-33.090625,-33.088982,-33.07592,-33.060373,-33.049216,-33.039983,-33.03942,-33.028506,-33.024783,-33.032125,-33.036229,-33.042322,-33.050437,-33.060006,-33.073092,-33.08802,-33.100396,-33.107431,-33.118565,-33.11201,-33.118288,-33.125254,-33.148298,-33.161236,-33.157392,-33.162215,-33.190301,-33.199477,-33.152631,-33.138511,-33.098203,-33.08727,-33.043313,-33.035167,-33.055687,-33.041359,-33.018087,-33.009282,-33.013532,-32.995309,-32.963783,-32.942369,-32.926769,-32.928168,-32.944267,-32.932117,-32.926433,-32.914597,-32.91238,-32.926517,-32.918626,-32.907934,-32.909397,-32.89912,-32.883815,-32.878643,-32.867198,-32.868108,-32.839715,-32.783386,-32.722498,-32.709573,-32.721285,-32.717947,-32.725202,-32.730782,-32.723976,-32.736988,-32.746691,-32.769701,-32.795305,-32.789845,-32.748056,-32.734768,-32.692865,-32.68494,-32.661955,-32.648207,-32.608656,-32.573809,-32.511148,-32.469053,-32.454073,-32.457869,-32.450116,-32.455382,-32.465578,-32.460686,-32.45731,-32.455795,-32.440708,-32.456321,-32.470786,-32.459813,-32.484451,-32.505353,-32.494361,-32.49485,-32.508794,-32.517545,-32.523342,-32.541219,-32.531912,-32.541726,-32.519484,-32.503696,-32.483536,-32.461417,-32.420449,-32.399186,-32.399574,-32.402351,-32.408599,-32.41151,-32.413412,-32.423126,-32.428318,-32.411577,-32.388513,-32.379879,-32.361804,-32.318217,-32.306173,-32.280505,-32.256313,-32.247234,-32.242835,-32.23397,-32.231165,-32.243115,-32.263826,-32.235325,-32.224313,-32.205846,-32.201553,-32.207596,-32.198675,-32.194992,-32.202643,-32.15524,-32.142638,-32.152014,-32.144576,-32.134991,-32.103832,-32.095913,-32.100079,-32.090614,-32.086022,-32.087258,-32.117454,-32.140992,-32.158998,-32.169582,-32.155301,-32.137132,-32.135729,-32.127439,-32.141927,-32.143533,-32.153307,-32.150609,-32.131086,-32.126292,-32.115968,-32.10982,-32.100107,-32.112658,-32.136008,-32.12304,-32.141578,-32.156673,-32.159361,-32.169053,-32.169899,-32.177752,-32.172158,-32.195616,-32.206108,-32.196247,-32.17852,-32.184688,-32.197973,-32.200207,-32.188838,-32.179875,-32.18353,-32.194901,-32.21087,-32.190844,-32.170052,-32.174835,-32.194517,-32.208783,-32.174878,-32.127021,-32.083401,-32.106513,-32.081999,-32.065239,-32.036233,-31.981566,-31.949342,-31.956579,-31.950662,-31.957185,-31.948156,-31.934328,-31.934945,-31.946285,-31.970725,-32.000986,-32.010634,-32.030092,-31.998806,-32.001747,-32.015743,-32.009867,-32.014498,-32.029089,-32.022479,-32.033754,-32.02728,-32.018313,-32.004709,-32.003035,-31.946543,-31.91774,-31.72026,-31.571825,-31.492277,-31.463654,-31.464717,-31.490898,-31.521546,-31.537626,-31.60563,-31.606052,-31.585733,-31.593044,-31.573662,-31.576538,-31.586414,-31.590296,-31.607747,-31.622684,-31.67418,-31.687068,-25.998613,-25.996376,-33.99851,-34.021892,-34.031708,-34.016013,-34.010237,-34.009321,-33.999996,-33.997216,-33.980648,-35.748535,-37.462093,-38.055989,-38.051014,-38.041051,-38.049008,-38.04552,-38.059708,-38.051013,-38.061474,-38.041452,-38.040256,-38.027659,-38.023614,-38.029701,-38.008596,-37.98996,-37.96087,-37.935846,-37.919006,-37.901501,-37.897846,-37.849536,-37.81817,-37.789123,-37.686113,-37.617223,-37.578417,-37.565571,-37.569746,-37.556224,-37.530865,-37.478617,-37.476952,-37.493125,-37.48589,-37.476743,-37.443363,-37.44182,-37.42933,-37.375874,-37.335612,-37.32219,-37.199707,-37.182126,-37.155849,-37.165216,-37.157799,-37.137468,-37.112869,-37.081579,-37.07419,-37.021304,-36.957431,-36.942056,-36.94011,-36.916809,-36.894859,-36.839575,-36.753479,-36.692328,-36.647474,-36.458816,-36.221918,-36.043505,-35.892234,-35.754559,-35.649577,-35.55729,-35.520673,-35.513587,-35.522923,-35.538108,-35.543844,-35.557911,-35.579469,-35.594283,-35.608529,-35.642968,-35.63353,-35.629274,-35.640576,-35.639375,-35.659589,-35.66509,-35.658167,-35.625221,-35.603403,-35.592452,-35.555371,-35.519377,-35.52365,-35.500848,-35.468183,-35.392864,-35.349994,-35.320045,-35.272135,-35.261545,-35.239157,-35.109436,-35.084609,-35.03213,-34.969695,-34.856766,-34.810966,-34.78294,-34.764612,-34.770168,-34.818085,-34.843571]}],[{&#34;lng&#34;:[138.546309,138.518591,138.522502,138.514615,138.546309],&#34;lat&#34;:[-34.799042,-34.805594,-34.769668,-34.756904,-34.799042]}],[{&#34;lng&#34;:[138.544072,138.524303,138.537721,138.544072],&#34;lat&#34;:[-34.80597,-34.810078,-34.801407,-34.80597]}],[{&#34;lng&#34;:[138.134901,138.110893,138.040822,137.911134,137.874263,137.856083,137.803232,137.741097,137.726115,137.660289,137.611978,137.598172,137.605102,137.620444,137.602643,137.58664,137.535973,137.504002,137.485394,137.48278,137.460723,137.420237,137.405605,137.406806,137.379444,137.371018,137.278364,137.257945,137.20949,137.180849,137.179962,137.189772,137.161316,137.162682,137.145803,137.130947,137.102588,137.092381,137.05762,137.036082,136.997279,136.942162,136.915453,136.854045,136.831686,136.81674,136.781837,136.774976,136.75799,136.727088,136.705236,136.696256,136.705634,136.708435,136.66562,136.625028,136.59835,136.581743,136.579779,136.550767,136.538853,136.550604,136.53441,136.532942,136.541723,136.563908,136.560478,136.579361,136.573788,136.587436,136.697258,136.720292,136.758786,136.778416,136.783664,136.86171,136.952722,137.069652,137.12178,137.141189,137.16347,137.184955,137.203466,137.239456,137.285143,137.313489,137.446932,137.490998,137.518809,137.545784,137.564368,137.591737,137.605438,137.621661,137.634199,137.626677,137.615658,137.598203,137.569625,137.569756,137.589341,137.641217,137.64369,137.605689,137.603349,137.579197,137.577915,137.596038,137.626884,137.69626,137.780334,137.803452,137.771947,137.772751,137.746078,137.754379,137.762208,137.754157,137.772401,137.796662,137.814758,137.798297,137.770736,137.758373,137.762804,137.778092,137.777351,137.822554,137.852159,137.892535,137.893642,137.900608,137.940728,138.005581,138.045983,138.06779,138.066857,138.07695,138.106517,138.125725,138.119071,138.123264,138.134901],&#34;lat&#34;:[-35.841399,-35.848409,-35.904274,-35.859789,-35.870569,-35.859755,-35.850616,-35.853115,-35.876742,-35.884899,-35.913111,-35.942693,-35.964858,-35.978592,-36.00929,-36.019559,-36.025864,-36.055873,-36.057029,-36.065675,-36.074971,-36.041416,-36.038791,-36.032412,-36.013892,-35.998416,-35.994258,-35.982221,-35.973988,-35.983985,-35.993958,-35.997078,-36.016479,-36.024739,-36.020706,-36.033985,-36.018171,-36.025105,-36.0201,-36.027651,-36.017338,-36.026688,-36.043576,-36.016575,-36.019765,-36.038845,-36.031408,-36.043631,-36.049731,-36.045071,-36.064064,-36.054659,-36.051282,-36.036926,-35.975745,-35.954423,-35.961762,-35.950849,-35.930728,-35.90193,-35.899329,-35.885701,-35.886475,-35.876557,-35.85823,-35.849535,-35.828319,-35.792374,-35.76589,-35.748857,-35.739468,-35.720286,-35.722716,-35.71221,-35.700213,-35.693844,-35.674107,-35.669155,-35.651733,-35.629762,-35.633111,-35.621209,-35.624715,-35.604191,-35.598036,-35.57924,-35.596223,-35.579767,-35.595531,-35.587221,-35.571125,-35.564088,-35.57151,-35.561188,-35.565733,-35.597161,-35.589155,-35.595276,-35.618675,-35.63243,-35.643213,-35.638891,-35.654125,-35.678765,-35.692678,-35.709027,-35.725671,-35.735349,-35.731666,-35.739791,-35.723932,-35.757605,-35.780922,-35.788005,-35.800946,-35.842984,-35.838863,-35.833933,-35.822796,-35.834287,-35.822033,-35.810204,-35.814085,-35.806042,-35.798023,-35.796203,-35.784445,-35.800182,-35.79495,-35.757945,-35.728166,-35.719757,-35.716206,-35.726301,-35.742821,-35.759784,-35.780365,-35.795898,-35.809476,-35.80235,-35.819876,-35.83424,-35.841399]}],[{&#34;lng&#34;:[137.381767,137.371478,137.36523,137.351512,137.340983,137.338346,137.361392,137.374861,137.381767],&#34;lat&#34;:[-34.497301,-34.505908,-34.529483,-34.534103,-34.52633,-34.488509,-34.462878,-34.468847,-34.497301]}],[{&#34;lng&#34;:[136.867216,136.858413,136.85435,136.860653,136.867216],&#34;lat&#34;:[-35.37131,-35.378187,-35.371055,-35.365574,-35.37131]}],[{&#34;lng&#34;:[136.494692,136.489641,136.468701,136.453071,136.441521,136.453826,136.453584,136.494692],&#34;lat&#34;:[-35.166527,-35.176526,-35.163436,-35.166073,-35.148699,-35.144714,-35.134301,-35.166527]}],[{&#34;lng&#34;:[136.359072,136.345884,136.344484,136.329893,136.344605,136.359072],&#34;lat&#34;:[-34.663679,-34.671253,-34.682606,-34.658364,-34.650539,-34.663679]}],[{&#34;lng&#34;:[136.305585,136.284472,136.287571,136.278582,136.286523,136.274889,136.270571,136.279936,136.305585],&#34;lat&#34;:[-34.505339,-34.515536,-34.530193,-34.537655,-34.545408,-34.549303,-34.542143,-34.50389,-34.505339]}],[{&#34;lng&#34;:[136.279752,136.269174,136.26689,136.279752],&#34;lat&#34;:[-34.681504,-34.68333,-34.673204,-34.681504]}],[{&#34;lng&#34;:[136.204543,136.200019,136.1894,136.176914,136.163326,136.146785,136.159193,136.156605,136.111885,136.109902,136.084155,136.089183,136.078739,136.082766,136.107292,136.129531,136.149943,136.176086,136.189708,136.192501,136.204543],&#34;lat&#34;:[-35.052982,-35.06541,-35.052299,-35.061493,-35.05516,-35.026593,-35.020844,-35.006405,-34.977026,-34.96874,-34.966901,-34.956008,-34.952161,-34.94543,-34.93245,-34.952374,-34.987895,-35.005754,-35.004449,-35.044324,-35.052982]}],[{&#34;lng&#34;:[136.185876,136.180123,136.181304,136.185876],&#34;lat&#34;:[-34.646672,-34.647575,-34.640457,-34.646672]}],[{&#34;lng&#34;:[136.073126,136.07102,136.055516,136.063705,136.073126],&#34;lat&#34;:[-35.227388,-35.238131,-35.235491,-35.222945,-35.227388]}],[{&#34;lng&#34;:[136.069945,136.050632,136.059975,136.069945],&#34;lat&#34;:[-34.962707,-34.96822,-34.957347,-34.962707]}],[{&#34;lng&#34;:[136.038216,136.027948,136.032156,136.038216],&#34;lat&#34;:[-34.907363,-34.916969,-34.905921,-34.907363]}],[{&#34;lng&#34;:[136.014585,136.010196,136.000885,136.008219,136.014585],&#34;lat&#34;:[-34.882591,-34.891351,-34.880386,-34.865101,-34.882591]}],[{&#34;lng&#34;:[135.983063,135.97409,135.965616,135.974324,135.9789,135.983063],&#34;lat&#34;:[-35.033605,-35.037425,-35.022049,-35.027879,-35.019936,-35.033605]}],[{&#34;lng&#34;:[135.960402,135.952445,135.94614,135.955741,135.960402],&#34;lat&#34;:[-34.583104,-34.593633,-34.568367,-34.56956,-34.583104]}],[{&#34;lng&#34;:[135.953064,135.937263,135.929026,135.923401,135.911382,135.916855,135.921373,135.938574,135.939865,135.953064],&#34;lat&#34;:[-34.723721,-34.719738,-34.732851,-34.701869,-34.695469,-34.673059,-34.683079,-34.687447,-34.711598,-34.723721]}],[{&#34;lng&#34;:[135.626345,135.617531,135.61736,135.626345],&#34;lat&#34;:[-34.982111,-35.001798,-34.980197,-34.982111]}],[{&#34;lng&#34;:[134.813029,134.806786,134.776026,134.813029],&#34;lat&#34;:[-33.594219,-33.610433,-33.595175,-33.594219]}],[{&#34;lng&#34;:[134.681803,134.676802,134.666412,134.67076,134.681803],&#34;lat&#34;:[-33.2081,-33.216999,-33.214363,-33.202427,-33.2081]}],[{&#34;lng&#34;:[134.547689,134.506727,134.496082,134.446961,134.458137,134.453848,134.467848,134.471997,134.483397,134.527562,134.537786,134.547689],&#34;lat&#34;:[-33.721441,-33.723013,-33.745812,-33.772204,-33.750746,-33.740567,-33.733433,-33.690427,-33.694013,-33.677685,-33.712614,-33.721441]}],[{&#34;lng&#34;:[134.279578,134.259737,134.27497,134.279578],&#34;lat&#34;:[-32.679966,-32.678381,-32.674265,-32.679966]}],[{&#34;lng&#34;:[133.857514,133.788077,133.814528,133.806843,133.840764,133.857514],&#34;lat&#34;:[-32.387369,-32.358797,-32.355451,-32.358759,-32.371959,-32.387369]}],[{&#34;lng&#34;:[133.835456,133.816229,133.829955,133.835456],&#34;lat&#34;:[-32.359889,-32.35472,-32.352285,-32.359889]}],[{&#34;lng&#34;:[133.68352,133.657781,133.669125,133.68352],&#34;lat&#34;:[-32.440256,-32.454898,-32.43642,-32.440256]}],[{&#34;lng&#34;:[133.673997,133.644302,133.614344,133.615093,133.628394,133.611962,133.600296,133.580315,133.572989,133.549729,133.540236,133.551372,133.550914,133.567216,133.593579,133.575415,133.581729,133.623823,133.673997],&#34;lat&#34;:[-32.232494,-32.2376,-32.256815,-32.270341,-32.27136,-32.282841,-32.307921,-32.306581,-32.319107,-32.308098,-32.279,-32.273134,-32.263677,-32.266873,-32.251043,-32.264464,-32.268444,-32.239292,-32.232494]}],[{&#34;lng&#34;:[133.654949,133.639648,133.625508,133.634055,133.654949],&#34;lat&#34;:[-32.451097,-32.463219,-32.457157,-32.449993,-32.451097]}],[{&#34;lng&#34;:[133.530727,133.501381,133.513051,133.530727],&#34;lat&#34;:[-32.304603,-32.318356,-32.302166,-32.304603]}],[{&#34;lng&#34;:[133.487081,133.483864,133.47563,133.477016,133.487081],&#34;lat&#34;:[-32.371099,-32.382613,-32.381062,-32.370624,-32.371099]}],[{&#34;lng&#34;:[133.381916,133.366691,133.367743,133.381916],&#34;lat&#34;:[-32.394907,-32.402932,-32.393433,-32.394907]}],[{&#34;lng&#34;:[133.311036,133.304489,133.287616,133.287642,133.277379,133.283384,133.267768,133.288553,133.292226,133.310109,133.311036],&#34;lat&#34;:[-32.510125,-32.521998,-32.528476,-32.517276,-32.517608,-32.511092,-32.50049,-32.490551,-32.502113,-32.499284,-32.510125]}],[{&#34;lng&#34;:[133.298957,133.291466,133.275341,133.28604,133.283701,133.298957],&#34;lat&#34;:[-32.557689,-32.567595,-32.565373,-32.564128,-32.554077,-32.557689]}],[{&#34;lng&#34;:[133.289921,133.276318,133.284988,133.289921],&#34;lat&#34;:[-32.585392,-32.584805,-32.578711,-32.585392]}]],[[{&#34;lng&#34;:[113.394175,113.382303,113.382563,113.370693,113.354662,113.336382,113.354172,113.357451,113.366341,113.364601,113.375871,113.386501,113.37851,113.38054,113.3873,113.373429,113.377939,113.358699,113.367579,113.356979,113.363739,113.386319,113.385559,113.4003,113.39672,113.42917,113.42442,113.43693,113.44468,113.448311,113.459571,113.462211,113.479871,113.482772,113.498812,113.487802,113.506592,113.502232,113.496452,113.484682,113.502253,113.485333,113.476963,113.486493,113.503293,113.506003,113.528272,113.512462,113.515962,113.507072,113.493912,113.513692,113.518311,113.511541,113.530451,113.537211,113.545491,113.540512,113.559482,113.548712,113.567072,113.561713,113.552323,113.563013,113.575554,113.577194,113.559825,113.558225,113.571785,113.583745,113.596295,113.598086,113.607105,113.588235,113.589205,113.599215,113.593394,113.609824,113.614084,113.618465,113.618064,113.630553,113.638153,113.628695,113.633505,113.625615,113.642026,113.653905,113.663695,113.657086,113.666416,113.657807,113.664009,113.680928,113.704918,113.688937,113.699957,113.697557,113.690737,113.686397,113.696146,113.686806,113.697006,113.714186,113.738446,113.769357,113.787617,113.807717,113.814227,113.812366,113.833105,113.863654,113.882864,113.887384,113.870232,113.885442,113.880661,113.836641,113.79775,113.68805,113.687479,113.663129,113.639458,113.614819,113.620809,113.5803,113.57354,113.585899,113.580019,113.567249,113.575338,113.560576,113.559108,113.517617,113.525307,113.512917,113.461056,113.478696,113.466285,113.479255,113.460525,113.462295,113.473245,113.471405,113.459465,113.472435,113.458624,113.444665,113.456855,113.446485,113.460265,113.459475,113.449625,113.464335,113.454205,113.467135,113.469346,113.414475,113.415234,113.431983,113.449083,113.472752,113.488952,113.499732,113.511082,113.525233,113.537754,113.558634,113.574684,113.581314,113.592765,113.606655,113.626415,113.659025,113.691116,113.721766,113.721717,113.761857,113.758477,113.731638,113.729936,113.738917,113.734327,113.699924,113.706085,113.703642,113.706197,113.704968,113.703554,113.701118,113.728259,113.7249,113.70321,113.72102,113.72818,113.74232,113.7528,113.753519,113.76222,113.77399,113.78998,113.813279,113.836409,113.835199,113.845569,113.836329,113.837649,113.883738,113.879018,113.885248,113.865247,113.877217,113.887457,113.906417,113.914427,113.902487,113.893518,113.908458,113.904588,113.910849,113.924519,113.938879,113.947559,113.93431,113.959511,113.950481,113.967251,113.972862,114.053862,114.082562,114.074362,114.075132,114.072592,114.076792,114.089562,114.094812,114.089562,114.156462,114.166352,114.210282,114.219851,114.215901,114.237651,114.231651,114.23798,114.20403,114.20553,114.19189,114.18829,114.191179,114.210679,114.223509,114.230689,114.219899,114.225349,114.241339,114.254709,114.236019,114.239278,114.209147,114.194667,114.218447,114.225667,114.223607,114.245047,114.265307,114.257567,114.252867,114.247036,114.266835,114.232095,114.227045,114.205395,114.198745,114.167955,114.175545,114.172095,114.134484,114.132524,114.146304,114.119404,114.114114,114.122245,114.113586,114.119555,114.091091,114.035389,114.048427,114.019199,114.01965,114.004183,114.01536,113.990189,113.982191,113.99166,113.99164,113.954523,113.93401,113.93922,113.939731,113.94121,113.948421,113.944179,113.90205,113.9136,113.90813,113.91384,113.891109,113.896689,113.891339,113.856719,113.868629,113.864909,113.871479,113.842578,113.842088,113.848158,113.839617,113.817067,113.802207,113.739897,113.712426,113.665985,113.664234,113.679944,113.691924,113.677804,113.665146,113.652354,113.651491,113.65519,113.644444,113.666133,113.706889,113.676463,113.646983,113.617533,113.615863,113.620883,113.620213,113.632723,113.623242,113.489939,113.427619,113.419178,113.406958,113.399528,113.406196,113.390165,113.409115,113.443343,113.442382,113.419422,113.428122,113.422151,113.429991,113.446941,113.4587,113.470909,113.464999,113.470308,113.513827,113.520177,113.531906,113.567276,113.591695,113.596614,113.614153,113.613213,113.636191,113.650858,113.70047,113.72587,113.75326,113.778119,113.783468,113.776938,113.788108,113.794447,113.770376,113.774436,113.763826,113.770855,113.760475,113.789665,113.812495,113.829426,113.829485,113.819755,113.826185,113.816655,113.801184,113.793804,113.755254,113.709393,113.677123,113.670493,113.686423,113.668262,113.673612,113.654082,113.665302,113.693132,113.713761,113.707921,113.722981,113.737741,113.74938,113.76547,113.78031,113.820809,113.866887,113.933246,113.933596,113.963945,113.995084,114.023922,114.072079,114.078749,114.10802,114.131572,114.165205,114.191014,114.148873,114.138063,114.080266,114.084757,114.133007,114.123738,114.126418,114.117078,114.115818,114.149498,114.178468,114.178218,114.135518,114.140118,114.129918,114.147038,114.140929,114.128189,114.122099,114.128329,114.121799,114.13859,114.135628,114.14391,114.14381,114.15104,114.1618,114.16073,114.1888,114.21861,114.21621,114.23069,114.22563,114.24117,114.28237,114.31744,114.32279,114.32404,114.32718,114.33896,114.34032,114.34503,114.35485,114.35765,114.35874,114.36276,114.36785,114.37708,114.36458,114.38377,114.37261,114.38608,114.37711,114.38356,114.40383,114.39,114.38031,114.39298,114.39173,114.4053,114.38627,114.38604,114.40788,114.39236,114.390439,114.402089,114.394809,114.393369,114.42333,114.396409,114.40129,114.408706,114.407,114.42302,114.44083,114.44569,114.4366,114.45164,114.4309,114.44328,114.42314,114.40872,114.41468,114.42644,114.41651,114.423059,114.439679,114.43362,114.46088,114.449019,114.46139,114.43726,114.42976,114.43983,114.46093,114.45038,114.47257,114.44869,114.44397,114.454045,114.45137,114.463731,114.458602,114.48187,114.45222,114.4532,114.46932,114.46642,114.47842,114.48899,114.500461,114.47176,114.481568,114.4536,114.45566,114.48946,114.49069,114.49952,114.50799,114.50085,114.50582,114.50691,114.5149,114.50134,114.519389,114.526329,114.518059,114.527749,114.531389,114.525809,114.523149,114.535739,114.520239,114.517339,114.542519,114.551599,114.547849,114.558978,114.574359,114.564189,114.575438,114.570598,114.585028,114.589378,114.586568,114.601358,114.605908,114.604868,114.615748,114.612938,114.626148,114.615218,114.637127,114.619328,114.621497,114.639367,114.651637,114.664297,114.647597,114.642507,114.648076,114.675486,114.686136,114.693166,114.685247,114.697647,114.693386,114.683356,114.698796,114.720886,114.778396,114.857156,114.860906,114.858956,114.903446,114.914256,114.936136,114.973136,114.988376,114.972296,114.945196,114.958346,114.962986,114.963037,114.958696,114.966276,114.973816,114.967966,114.974716,114.984046,115.029006,115.016716,115.026126,115.027846,115.029496,115.040396,115.037106,115.043246,115.030336,115.054706,115.055956,115.057116,115.108956,115.131126,115.131686,115.142186,115.132206,115.160617,115.176586,115.161576,115.178526,115.194926,115.193786,115.210136,115.186866,115.211046,115.219856,115.219776,115.234417,115.229977,115.242317,115.252147,115.243107,115.245947,115.244677,115.298207,115.327218,115.328417,115.331168,115.381689,115.399119,115.401449,115.418299,115.414159,115.381169,115.404719,115.416339,115.408099,115.412909,115.433338,115.428139,115.436598,115.435319,115.440673,115.439559,115.438168,115.457316,115.458668,115.443498,115.4474,115.444495,115.446529,115.448352,115.45569,115.456349,115.445068,115.459058,115.46387,115.460388,115.467747,115.476168,115.47558,115.477278,115.491459,115.49243,115.498209,115.493239,115.493444,115.492399,115.480899,115.475037,115.496198,115.495312,115.499928,115.510698,115.510869,115.520308,115.495158,115.491127,115.494612,115.492557,115.492747,115.506617,115.516477,115.528267,115.515287,115.508427,115.526357,115.506267,115.509716,115.516966,115.518147,115.518576,115.549255,115.558646,115.565447,115.561056,115.571627,115.563346,115.572695,115.562156,115.550914,115.583583,115.591003,115.580864,115.585784,115.592693,115.597464,115.593073,115.609033,115.602163,115.595733,115.588783,115.605012,115.617963,115.619193,115.608763,115.621074,115.627954,115.637415,115.627454,115.618084,115.640326,115.652917,115.648726,115.662207,115.649696,115.668266,115.648386,115.652546,115.683226,115.678946,115.703144,115.705095,115.716284,115.719964,115.735854,115.737974,115.744593,115.744104,115.756344,115.752614,115.762314,115.770344,115.761724,115.769244,115.767424,115.783794,115.779274,115.787864,115.794433,115.787544,115.791894,115.804654,115.816655,115.808864,115.831246,115.819345,115.829245,115.830964,115.844875,115.833533,115.850303,115.856418,115.854553,115.869993,115.876543,115.869043,115.877983,115.887543,115.881502,115.893376,115.889342,115.918152,115.925732,115.923423,115.917776,115.923783,115.927662,115.989382,116.069422,116.097092,116.093712,116.105226,116.095522,116.103222,116.130452,116.146142,116.140302,116.164532,116.176822,116.188102,116.189741,116.226741,116.210131,116.214021,116.207011,116.19103,116.20459,116.236371,116.256172,116.241431,116.246722,116.241341,116.252972,116.259561,116.255571,116.272441,116.28929,116.286,116.29734,116.297932,116.30263,116.32903,116.345391,116.366911,116.399031,116.400171,116.439771,116.453791,116.459009,116.453162,116.442401,116.45945,116.464803,116.46686,116.480531,116.488152,116.483151,116.49242,116.502271,116.50065,116.48929,116.51378,116.527729,116.52783,116.535647,116.51339,116.524128,116.531508,116.53525,116.532098,116.525909,116.549777,116.551857,116.553368,116.578324,116.560572,116.579184,116.583064,116.590204,116.594494,116.587394,116.597554,116.605204,116.591744,116.601645,116.574794,116.590744,116.573714,116.579034,116.593494,116.592914,116.607454,116.628384,116.636794,116.647994,116.602277,116.623084,116.616084,116.624034,116.630624,116.636114,116.629904,116.633662,116.633634,116.639594,116.654034,116.652501,116.662944,116.663774,116.663514,116.642074,116.668238,116.682624,116.684744,116.688884,116.666704,116.656594,116.661214,116.650224,116.666794,116.644934,116.642474,116.668054,116.696484,116.692134,116.721668,116.721658,116.740594,116.765153,116.746393,116.770663,116.780043,116.784493,116.798162,116.778143,116.789782,116.810581,116.815071,116.804531,116.811161,116.867491,116.819793,116.822893,116.819273,116.808093,116.814903,116.812813,116.797913,116.802423,116.787262,116.792573,116.787843,116.797442,116.799803,116.828193,116.898773,116.923653,116.927533,116.919903,116.927913,116.931653,116.927073,116.952673,116.926423,116.956812,116.945572,116.956322,116.965442,116.973632,116.979252,116.979152,116.982442,116.976262,116.990212,117.036232,117.029502,117.038022,117.038802,117.066372,117.084502,117.094351,117.105332,117.128192,117.138272,117.171421,117.182811,117.175851,117.180651,117.191201,117.199223,117.192972,117.176194,117.181592,117.156852,117.181362,117.175908,117.190092,117.189132,117.200422,117.171942,117.182642,117.187154,117.195172,117.214452,117.227292,117.217282,117.216423,117.228972,117.211932,117.223092,117.242282,117.245012,117.244762,117.276731,117.284682,117.283923,117.292012,117.287933,117.299922,117.297992,117.302672,117.347532,117.357832,117.346672,117.340148,117.337302,117.340472,117.349652,117.349702,117.357872,117.350712,117.352302,117.366722,117.362752,117.369832,117.382811,117.377051,117.381762,117.390151,117.397962,117.397352,117.386081,117.388341,117.403842,117.387441,117.395171,117.426992,117.436492,117.429782,117.441062,117.441422,117.457401,117.461121,117.434562,117.442572,117.544521,117.551302,117.552551,117.573301,117.594911,117.585011,117.590691,117.598871,117.589961,117.630731,117.64833,117.618871,117.616571,117.625961,117.641691,117.637162,117.645072,117.646552,117.628292,117.643982,117.651362,117.656312,117.654322,117.667362,117.664152,117.675362,117.666782,117.680432,117.689442,117.686822,117.697292,117.688182,117.700652,117.704112,117.713972,117.736281,117.737391,117.739281,117.746241,117.747311,117.769461,117.770181,117.774191,117.793421,117.809731,117.794851,117.774281,117.782781,117.794181,117.814141,117.85412,117.86457,117.859369,117.867469,117.897989,117.884729,117.891418,117.878379,117.871029,117.881738,117.895298,117.890138,117.903338,117.900368,117.915899,117.912169,117.920299,117.930279,117.914649,117.924569,117.912258,117.919848,117.941329,117.943769,117.934539,117.941779,117.949509,117.945399,117.957759,117.960229,117.959329,117.970579,117.975049,117.972849,117.964119,117.970969,117.959679,117.942719,117.959189,117.948409,117.951369,117.961689,117.949409,117.942939,117.931528,117.942168,117.940918,117.965299,117.952538,117.992309,118.017779,118.050079,118.103248,118.109758,118.110288,118.160907,118.181566,118.196726,118.200207,118.184787,118.172967,118.172297,118.182097,118.175987,118.183717,118.184127,118.199827,118.180077,118.198227,118.169527,118.165128,118.205457,118.196158,118.213937,118.224707,118.215487,118.232717,118.240166,118.235996,118.244226,118.257216,118.257336,118.281016,118.283496,118.297766,118.308396,118.314806,118.318336,118.315396,118.288766,118.346126,118.353606,118.344056,118.359136,118.363596,118.368666,118.379196,118.379086,118.400626,118.409436,118.403846,118.411626,118.408896,118.416856,118.439586,118.428016,118.450305,118.448915,118.455845,118.477516,118.493035,118.489266,118.495915,118.479395,118.487515,118.494955,118.486585,118.491045,118.510725,118.506386,118.517905,118.506205,118.536745,118.539555,118.530895,118.541859,118.540485,118.548125,118.557315,118.547335,118.526265,118.561962,118.573745,118.563712,118.570425,118.565445,118.566425,118.558485,118.563285,118.552016,118.556246,118.574425,118.571295,118.576025,118.578566,118.580215,118.595936,118.596675,118.603086,118.612845,118.602866,118.587415,118.605635,118.617285,118.608505,118.629555,118.606775,118.591765,118.573033,118.591016,118.597995,118.59819,118.640369,118.64181,118.667325,118.655135,118.674455,118.665685,118.678345,118.678655,118.687325,118.676765,118.690255,118.768224,118.797844,118.805914,118.805964,118.820704,118.820874,118.822624,118.845254,118.827794,118.832404,118.847263,118.829794,118.842063,118.851303,118.874524,118.869544,118.882655,118.871454,118.878214,118.860273,118.896502,118.959141,118.99383,119.068349,119.093699,119.088349,119.099709,119.14709,119.16063,119.15868,119.16842,119.20707,119.21056,119.17215,119.17159,119.218269,119.238089,119.239959,119.248449,119.241549,119.242619,119.32078,119.373371,119.38125,119.371671,119.415161,119.443042,119.466093,119.471004,119.512931,119.569839,119.572449,119.562789,119.569339,119.655498,119.673188,119.680508,119.700867,119.709368,119.696675,119.704818,119.702678,119.714498,119.724888,119.733008,119.745323,119.741138,119.746508,119.741308,119.752745,119.730067,119.757368,119.755358,119.765198,119.772538,119.764148,119.791508,119.787758,119.861547,119.866227,119.884437,119.972766,120.081236,120.087397,120.080296,120.133206,120.195936,120.631003,120.981888,121.113922,121.210132,121.333221,121.412999,121.511139,121.525358,121.518018,121.540748,121.564597,121.553177,121.578207,121.600087,121.575957,121.600707,121.602727,121.618176,121.628106,121.637696,121.631316,121.642666,121.651446,121.653186,121.654906,121.645466,121.655526,121.634496,121.619796,121.618145,121.628835,121.630775,121.635465,121.639355,121.657264,121.665014,121.681173,121.677753,121.698082,121.717273,121.737335,121.741115,121.751867,121.766926,121.786896,121.788186,121.793046,121.783805,121.790825,121.729385,121.764754,121.790934,121.798384,121.795278,121.817024,121.810174,121.803245,121.788974,121.815214,121.839983,121.851664,121.872013,121.903643,121.946672,121.982593,122.017415,122.063513,122.083382,122.130022,122.166232,122.168122,122.177943,122.172143,122.183033,122.198293,122.201603,122.190603,122.200653,122.199113,122.185043,122.199823,122.212013,122.204913,122.214613,122.315051,122.370266,122.380958,122.372597,122.378069,122.351888,122.335949,122.301692,122.250641,122.210771,122.207141,122.175331,122.189731,122.204931,122.21287,122.1987,122.199649,122.187585,122.184069,122.172549,122.145169,122.150017,122.162007,122.173206,122.187296,122.201656,122.211056,122.214916,122.204706,122.206566,122.226375,122.234365,122.225685,122.229335,122.234025,122.243095,122.239425,122.247055,122.241045,122.251615,122.258775,122.246565,122.257395,122.254905,122.274645,122.279825,122.282035,122.318985,122.317205,122.288145,122.313526,122.317864,122.311984,122.292595,122.293266,122.267215,122.253805,122.253195,122.295524,122.351043,122.369773,122.366353,122.469652,122.460552,122.440732,122.447202,122.443472,122.431033,122.444433,122.467632,122.461432,122.468742,122.472122,122.481052,122.475032,122.485552,122.476882,122.485512,122.476892,122.480221,122.489682,122.503291,122.503082,122.519782,122.507952,122.527572,122.554002,122.572342,122.587612,122.602102,122.612161,122.595622,122.591361,122.597471,122.585581,122.582201,122.570371,122.569461,122.556531,122.551491,122.543501,122.533801,122.54935,122.55104,122.56055,122.55114,122.56429,122.56537,122.56781,122.57123,122.5713,122.55329,122.57411,122.57749,122.56949,122.57943,122.609939,122.62014,122.63741,122.693508,122.706578,122.734458,122.757428,122.764968,122.742698,122.761948,122.766738,122.771638,122.769657,122.777207,122.773527,122.788947,122.786637,122.792097,122.781597,122.803017,122.800607,122.810187,122.809847,122.813617,122.845567,122.827587,122.833417,122.823467,122.833387,122.821407,122.838417,122.810017,122.790807,122.775687,122.773087,122.785297,122.784137,122.773757,122.762787,122.743868,122.741798,122.771107,122.778997,122.771287,122.810106,122.817926,122.794756,122.811576,122.833406,122.816486,122.847726,122.861415,122.884225,122.861255,122.853885,122.863075,122.867225,122.884095,122.904375,122.905705,122.895845,122.898075,122.901774,122.911494,122.901524,122.925294,122.955224,122.987654,122.992024,122.982414,122.993694,122.991634,123.038893,123.020273,123.034123,123.034884,123.014754,123.023984,123.034054,123.031004,123.043074,123.076683,123.047244,123.045014,123.042844,123.023824,123.015404,122.982984,122.979094,122.995694,122.997494,122.971064,123.006694,123.008024,122.989784,122.981074,122.985014,122.968734,122.954425,122.960695,122.984734,122.986564,122.996504,122.988314,122.995744,123.023274,123.027104,123.038664,123.036184,123.050614,123.078734,123.083754,123.084883,123.094023,123.126613,123.138833,123.145053,123.132633,123.118743,123.103453,123.107823,123.102533,123.110683,123.109923,123.119853,123.134833,123.156963,123.161403,123.162123,123.173493,123.163393,123.153544,123.149104,123.168634,123.234835,123.263354,123.278176,123.290602,123.344578,123.383408,123.394348,123.392728,123.405198,123.425168,123.442709,123.459279,123.48328,123.51426,123.51229,123.51479,123.51557,123.52419,123.52315,123.53751,123.533859,123.540999,123.545209,123.543548,123.562707,123.576869,123.57239,123.58035,123.59314,123.58993,123.59705,123.591339,123.600118,123.579648,123.582759,123.564479,123.580988,123.593778,123.602928,123.623806,123.641706,123.646226,123.608086,123.590635,123.583544,123.600693,123.647972,123.659322,123.660033,123.679143,123.680253,123.689193,123.704423,123.740863,123.761123,123.773073,123.786093,123.789214,123.829924,123.836234,123.851974,123.862494,123.888704,123.912493,123.914863,123.887704,123.885523,123.829603,123.834243,123.796449,123.820389,123.802559,123.82687,123.894389,123.902589,123.915838,123.928378,123.951508,123.959268,123.949288,123.951418,123.942228,123.942128,123.920968,123.903628,123.893328,123.883959,123.79612,123.760959,123.758339,123.717589,123.711529,123.681509,123.61776,123.59994,123.58761,123.57138,123.552161,123.523001,123.502801,123.520551,123.506591,123.573871,123.555651,123.572451,123.563031,123.563381,123.581141,123.588392,123.602002,123.589242,123.619432,123.615142,123.588582,123.578622,123.526052,123.520752,123.533852,123.542202,123.517742,123.511602,123.494272,123.498082,123.513442,123.503112,123.491002,123.463692,123.460392,123.468072,123.428532,123.428542,123.442233,123.431082,123.445302,123.496582,123.492952,123.502072,123.495132,123.472503,123.469553,123.461443,123.473462,123.544012,123.534132,123.546352,123.594543,123.584313,123.643023,123.637033,123.607623,123.588483,123.582963,123.602723,123.625213,123.632873,123.662934,123.648273,123.651363,123.619823,123.599233,123.568233,123.542982,123.505342,123.497942,123.502772,123.582213,123.547842,123.563072,123.511242,123.518632,123.509122,123.535882,123.567482,123.556682,123.571732,123.571922,123.597992,123.605162,123.591802,123.607993,123.621393,123.629572,123.665523,123.676563,123.671683,123.681483,123.697213,123.679752,123.688282,123.647942,123.629232,123.658682,123.651362,123.663532,123.673022,123.662962,123.681402,123.716902,123.698871,123.710621,123.700111,123.697421,123.679991,123.662391,123.640321,123.627141,123.61137,123.624441,123.593361,123.598751,123.550201,123.549571,123.566061,123.58213,123.58388,123.59929,123.576061,123.61663,123.60351,123.60966,123.5909,123.5801,123.60192,123.58655,123.58225,123.5637,123.60112,123.58169,123.56387,123.57246,123.55669,123.56926,123.5707,123.58418,123.61334,123.63577,123.62043,123.65526,123.65984,123.67575,123.66535,123.68346,123.67977,123.69342,123.69683,123.68984,123.69604,123.70098,123.70141,123.70214,123.71363,123.70311,123.70897,123.72343,123.71316,123.72846,123.703089,123.726609,123.7379,123.741819,123.747239,123.750909,123.770559,123.79055,123.80316,123.7968,123.80665,123.81461,123.80037,123.79856,123.78861,123.78907,123.77159,123.77569,123.78502,123.78833,123.79503,123.79694,123.79109,123.7833,123.78349,123.77714,123.76947,123.74296,123.740651,123.778031,123.782711,123.783191,123.795821,123.784441,123.796371,123.810051,123.799531,123.825361,123.842971,123.835221,123.843921,123.86594,123.856671,123.858461,123.864591,123.860141,123.867621,123.865471,123.876441,123.878721,123.865791,123.878831,123.876081,123.851431,123.836461,123.850571,123.842031,123.85409,123.8711,123.86703,123.88304,123.88837,123.89997,123.889541,123.899381,123.895031,123.88435,123.90897,123.88572,123.91702,123.89281,123.8838,123.89536,123.9058,123.94131,123.97571,123.98384,123.98759,123.97728,123.95515,123.94933,123.93358,123.960979,124.000079,123.993739,123.961179,123.963819,123.953369,123.950239,123.962469,123.950729,123.945749,123.951989,123.941669,123.925899,123.915949,123.909909,123.939909,123.972119,123.970069,123.979929,123.995519,124.002819,123.999819,124.009939,124.017819,124.014949,124.026209,124.042379,124.041969,124.052429,124.068258,124.056988,124.075478,124.104808,124.101428,124.107838,124.124448,124.124538,124.179728,124.175048,124.194858,124.185658,124.194648,124.193538,124.199308,124.196978,124.199698,124.205838,124.195858,124.204878,124.210088,124.201848,124.211488,124.222718,124.256728,124.264078,124.261098,124.282927,124.294697,124.300137,124.311227,124.324957,124.322697,124.334247,124.331847,124.315098,124.322198,124.308098,124.319158,124.332338,124.344978,124.353438,124.363677,124.361077,124.373397,124.390137,124.390297,124.407297,124.391618,124.400878,124.405888,124.399068,124.415218,124.407528,124.392268,124.406438,124.410298,124.426248,124.427598,124.435528,124.429807,124.441167,124.442637,124.444657,124.449367,124.443527,124.449237,124.448047,124.468217,124.440067,124.441377,124.419097,124.402777,124.401897,124.388797,124.346447,124.336527,124.344267,124.348867,124.365657,124.387487,124.402547,124.407377,124.426237,124.431257,124.449537,124.449227,124.494416,124.494537,124.501276,124.513646,124.599746,124.745415,124.840514,124.917184,124.922285,124.947665,124.953335,124.943945,124.917735,124.901265,124.881884,124.874394,124.830524,124.814465,124.787665,124.725195,124.715185,124.693485,124.673426,124.570956,124.506596,124.480476,124.477586,124.464286,124.457436,124.424167,124.411657,124.405937,124.394547,124.410707,124.402947,124.385157,124.398967,124.407867,124.402667,124.378747,124.379037,124.400167,124.388757,124.400967,124.398577,124.427696,124.434656,124.449676,124.443286,124.448916,124.444346,124.453276,124.462736,124.464066,124.477236,124.479966,124.458426,124.486616,124.514136,124.517026,124.501436,124.501496,124.516776,124.508166,124.518836,124.526396,124.525136,124.532616,124.525406,124.536686,124.526976,124.541436,124.560716,124.599256,124.646945,124.634105,124.622976,124.618106,124.607146,124.592446,124.588116,124.580536,124.595486,124.579456,124.591275,124.588885,124.615185,124.619885,124.616235,124.637135,124.634041,124.642635,124.639015,124.605575,124.615545,124.598445,124.596865,124.605985,124.610495,124.626005,124.616065,124.621185,124.605295,124.607845,124.629415,124.654555,124.668465,124.681575,124.686845,124.677845,124.675825,124.686535,124.682005,124.711935,124.704515,124.741585,124.700815,124.704275,124.719004,124.709155,124.702985,124.704344,124.701695,124.696434,124.700775,124.691195,124.697865,124.693585,124.675385,124.678965,124.704784,124.688694,124.660445,124.633865,124.632785,124.631765,124.625685,124.629485,124.607895,124.572015,124.531746,124.520326,124.513546,124.516376,124.498596,124.490246,124.492126,124.498076,124.491966,124.497006,124.508266,124.512456,124.506116,124.499316,124.498016,124.492426,124.487306,124.476696,124.480476,124.474886,124.478906,124.499406,124.483656,124.489946,124.475166,124.484256,124.475256,124.477616,124.460946,124.459346,124.476646,124.460276,124.461202,124.443376,124.458276,124.451256,124.444636,124.439056,124.429536,124.424846,124.417516,124.409286,124.410286,124.385946,124.395926,124.407656,124.423796,124.419216,124.437256,124.416856,124.411476,124.417826,124.409026,124.397346,124.402536,124.393216,124.386356,124.375976,124.368816,124.379266,124.385716,124.390236,124.402466,124.412666,124.414366,124.421516,124.430726,124.429656,124.443686,124.444656,124.457196,124.436506,124.433775,124.450455,124.452465,124.482955,124.500625,124.488215,124.497125,124.454365,124.459585,124.453875,124.450685,124.433465,124.430595,124.409575,124.416035,124.404585,124.430035,124.424655,124.430075,124.417525,124.425115,124.436315,124.446425,124.458595,124.461995,124.465785,124.461695,124.470145,124.472685,124.473045,124.486525,124.496185,124.510425,124.500265,124.505805,124.498575,124.492535,124.468615,124.455825,124.461595,124.446375,124.476645,124.498065,124.507385,124.508594,124.518254,124.521494,124.529804,124.528974,124.551694,124.554674,124.579944,124.580334,124.595824,124.599064,124.617474,124.620644,124.614444,124.628764,124.632144,124.624364,124.638794,124.621544,124.626384,124.617854,124.628214,124.633404,124.645724,124.653784,124.645674,124.642194,124.667524,124.677064,124.674194,124.679864,124.686104,124.682054,124.690774,124.686664,124.676554,124.671644,124.668904,124.687084,124.678184,124.676174,124.723743,124.727203,124.744773,124.726643,124.723483,124.704723,124.705333,124.688763,124.666774,124.661984,124.662084,124.672353,124.656463,124.661913,124.666473,124.674243,124.691033,124.707193,124.692483,124.696883,124.667313,124.679283,124.672743,124.678893,124.672843,124.674673,124.681763,124.678763,124.701373,124.705033,124.770573,124.761793,124.736123,124.753253,124.759363,124.783853,124.783233,124.810393,124.817193,124.831293,124.836983,124.822163,124.846793,124.836373,124.847703,124.849473,124.840523,124.847663,124.860933,124.862333,124.875693,124.888623,124.907062,124.915252,124.932372,124.937082,124.925322,124.926742,124.945192,124.940572,124.945912,124.971323,124.978842,124.979942,125.003773,125.002983,124.984083,124.952193,124.958033,124.952943,124.960243,124.984463,124.961793,124.973223,124.981343,124.981743,124.982983,124.996233,124.995723,124.986903,124.995973,124.999513,124.997823,125.001393,125.010163,124.999793,125.004033,125.009493,125.011283,125.018333,125.025963,125.017603,125.022903,125.015273,125.002103,125.014113,125.004593,125.011343,125.017103,125.013013,125.017843,125.025553,125.022053,125.026773,125.029373,125.030123,125.033158,125.030933,125.039873,125.044243,125.045003,125.054793,125.041693,125.046883,125.052273,125.049203,125.062622,125.088652,125.123099,125.12124,125.137358,125.140927,125.174716,125.202236,125.225298,125.291007,125.305398,125.421186,125.300717,125.276688,125.287617,125.271448,125.254859,125.225236,125.225865,125.217086,125.188466,125.146096,125.141497,125.101922,125.081702,125.087702,125.070032,125.082532,125.084312,125.095002,125.088822,125.090851,125.111261,125.137341,125.140451,125.143821,125.144531,125.152091,125.138811,125.144261,125.156011,125.159121,125.164091,125.156381,125.162971,125.155061,125.162561,125.160361,125.154771,125.157741,125.152511,125.146541,125.149591,125.143451,125.130531,125.136771,125.128651,125.124781,125.126571,125.120651,125.117001,125.118781,125.088561,125.098371,125.110131,125.110341,125.099171,125.115521,125.101911,125.110011,125.102481,125.101861,125.107671,125.118921,125.105101,125.100321,125.094301,125.088141,125.090001,125.086621,125.077451,125.073421,125.081001,125.095661,125.094991,125.086821,125.087541,125.079761,125.094301,125.081251,125.065431,125.052142,125.039642,125.036012,125.044951,125.034942,125.030672,125.026372,124.984202,124.979122,124.920082,124.897912,124.898232,124.907792,124.902412,124.906782,124.891472,124.883052,124.895232,124.880122,124.876132,124.893842,124.903252,124.904642,124.904602,124.912982,124.914052,124.922812,124.918802,124.931922,124.918652,124.933372,124.927432,124.951502,124.969492,124.979172,124.972102,124.981512,125.005642,125.004551,125.019861,125.021981,125.028521,125.046801,125.041481,125.060211,125.056031,125.048641,125.045811,125.020161,125.022781,125.013821,125.005831,125.014251,124.992821,124.981971,124.994911,124.984821,124.985371,124.976101,124.978281,124.970141,124.971241,124.961052,124.971102,124.939892,124.935172,124.942822,124.935902,124.943782,124.923002,124.917152,124.917542,124.900982,124.909902,124.907942,124.875772,124.891822,124.868842,124.867492,124.881142,124.867672,124.864272,124.896372,124.854812,124.861542,124.847462,124.844662,124.837712,124.845792,124.833912,124.868992,124.870682,124.877902,124.893082,124.906811,124.910381,124.922051,124.926441,124.943241,124.951681,124.949461,124.961471,124.974441,124.981151,124.985051,124.987731,124.997071,124.997581,125.008631,125.011141,125.029861,125.047701,125.029411,125.035511,125.020271,125.026201,125.014181,125.02354,125.01895,125.02517,125.01197,125.028,125.03306,125.04462,125.05565,125.05448,125.07429,125.07472,125.09283,125.05901,125.06732,125.08347,125.07237,125.1008,125.09655,125.10552,125.12567,125.13341,125.12562,125.12205,125.13847,125.14502,125.16324,125.1743,125.22426,125.21249,125.2234,125.22198,125.22701,125.22545,125.24053,125.24445,125.24196,125.266,125.26504,125.27102,125.2811,125.28972,125.2823,125.30586,125.30679,125.32534,125.33493,125.33158,125.345979,125.368199,125.378299,125.411869,125.443089,125.481329,125.480176,125.476659,125.448139,125.479907,125.479299,125.397089,125.375949,125.380459,125.357649,125.377529,125.373079,125.401919,125.402149,125.370129,125.367399,125.375479,125.387009,125.401919,125.411479,125.428438,125.459278,125.462448,125.474788,125.481598,125.475118,125.471498,125.449898,125.448429,125.441378,125.443938,125.420979,125.408979,125.409369,125.385939,125.365369,125.363489,125.352929,125.347199,125.337329,125.339509,125.318749,125.303589,125.301659,125.295459,125.285599,125.278089,125.295989,125.304639,125.288589,125.271199,125.265069,125.254389,125.250369,125.262409,125.257649,125.239579,125.234219,125.231559,125.227699,125.222109,125.222459,125.213719,125.207809,125.213589,125.214899,125.220569,125.218789,125.225759,125.232979,125.230709,125.239259,125.244539,125.255039,125.256299,125.269899,125.287209,125.294689,125.307689,125.294619,125.303349,125.308079,125.307089,125.311399,125.318919,125.316739,125.333978,125.305039,125.305659,125.295889,125.286669,125.273949,125.271689,125.264099,125.254279,125.250949,125.235519,125.249119,125.244139,125.231739,125.224569,125.223559,125.210099,125.208909,125.200539,125.196869,125.186169,125.184119,125.195269,125.189499,125.205169,125.201709,125.192979,125.195479,125.189429,125.190029,125.166789,125.169699,125.154659,125.150789,125.141429,125.146709,125.159799,125.188979,125.187739,125.195288,125.182908,125.179848,125.199248,125.201138,125.211478,125.217468,125.210558,125.212858,125.218438,125.218748,125.234358,125.245648,125.245558,125.262108,125.268238,125.254288,125.261008,125.260828,125.271388,125.273688,125.279288,125.308418,125.288448,125.280348,125.257406,125.267378,125.247968,125.236098,125.228338,125.204228,125.218878,125.217988,125.225558,125.227768,125.234988,125.232118,125.243828,125.256529,125.249018,125.260868,125.255378,125.265497,125.274497,125.282477,125.303577,125.300407,125.325707,125.328237,125.335667,125.347587,125.350097,125.342577,125.342057,125.364136,125.355047,125.368927,125.354587,125.374667,125.374447,125.385837,125.391607,125.394427,125.400087,125.399597,125.410267,125.410657,125.415187,125.415487,125.424977,125.413447,125.427247,125.438227,125.427157,125.429947,125.450027,125.437247,125.463416,125.452366,125.466636,125.471196,125.483426,125.467386,125.466526,125.480456,125.491386,125.495646,125.488606,125.515286,125.520306,125.528766,125.519936,125.529546,125.529056,125.541376,125.560606,125.557786,125.544676,125.547995,125.529916,125.534786,125.550415,125.557345,125.569426,125.599326,125.572466,125.580975,125.596486,125.600125,125.613705,125.602375,125.588215,125.597975,125.591035,125.600655,125.594484,125.599454,125.601264,125.621944,125.616884,125.622704,125.610414,125.608014,125.588564,125.587904,125.603694,125.582784,125.582253,125.598783,125.583923,125.573683,125.592142,125.608253,125.605922,125.596212,125.609042,125.629212,125.633382,125.626292,125.640962,125.641522,125.649142,125.648562,125.655072,125.665032,125.666713,125.695303,125.703273,125.718123,125.717913,125.730063,125.714523,125.721573,125.723753,125.712684,125.710864,125.697204,125.704594,125.725694,125.717564,125.726354,125.705854,125.699584,125.695464,125.693454,125.669514,125.663374,125.672954,125.668294,125.673864,125.678024,125.666304,125.666134,125.657274,125.651544,125.670704,125.660844,125.659294,125.677584,125.674995,125.682415,125.688726,125.676255,125.675275,125.652015,125.646906,125.669335,125.708916,125.731015,125.747165,125.765385,125.774405,125.781145,125.794595,125.797984,125.806095,125.816165,125.802565,125.852075,125.859125,125.828055,125.817205,125.849884,125.828664,125.850194,125.835584,125.830574,125.849264,125.851414,125.876234,125.881294,125.894764,125.910034,125.921304,125.928484,125.920994,125.930556,125.927334,125.933824,125.932689,125.936734,125.930514,125.933034,125.919144,125.902694,125.903864,125.920684,125.920584,125.932514,125.945674,125.949224,125.955594,125.964754,125.972524,125.981893,126.000293,126.013863,126.005733,126.015463,126.041913,126.050933,126.042223,126.053453,126.042893,126.046333,126.031503,126.024763,126.019604,125.985464,125.976674,125.992424,125.996134,126.006154,126.009843,126.021753,126.027903,126.045812,126.069332,126.075451,126.081902,126.088431,126.084231,126.072891,126.073901,126.086411,126.090221,126.080491,126.082891,126.073041,126.053401,126.081261,126.096542,126.093932,126.13322,126.139799,126.136639,126.147759,126.160189,126.141279,126.169718,126.153278,126.152198,126.133328,126.126217,126.104427,126.087797,126.064057,126.032518,126.004138,125.993078,125.992058,125.976228,125.982957,125.972917,125.983847,125.984127,126.014357,126.005357,126.010148,126.029287,126.026707,126.040027,126.034767,126.055987,126.043337,126.021867,126.031706,126.038526,126.038186,126.065356,126.074746,126.083056,126.102616,126.086386,126.095626,126.089946,126.096645,126.086406,126.107235,126.100415,126.083866,126.082265,126.046546,126.051416,126.036036,126.031316,126.021126,126.011206,126.038725,126.050266,126.062745,126.065075,126.094815,126.100705,126.085315,126.107865,126.085635,126.104965,126.132355,126.134225,126.158385,126.152835,126.161615,126.148425,126.136855,126.126205,126.141355,126.158695,126.130935,126.135785,126.128665,126.110075,126.109766,126.126785,126.117255,126.187035,126.215825,126.221025,126.193385,126.157755,126.144305,126.154145,126.173325,126.185025,126.200705,126.202245,126.220415,126.224715,126.217475,126.160256,126.149526,126.150826,126.159126,126.191856,126.170376,126.162547,126.165707,126.178147,126.214206,126.205797,126.221697,126.211997,126.216517,126.179398,126.185678,126.208928,126.185969,126.196429,126.207869,126.204649,126.243279,126.233119,126.248049,126.240099,126.24812,126.233399,126.216,126.23071,126.24097,126.25363,126.2706,126.27253,126.26972,126.28217,126.30085,126.312679,126.318689,126.323849,126.339398,126.360798,126.353697,126.323087,126.320887,126.305488,126.304048,126.297568,126.315217,126.314457,126.345006,126.343836,126.334326,126.371905,126.394325,126.387615,126.396554,126.425344,126.438364,126.446014,126.454354,126.485223,126.495853,126.495263,126.511483,126.536992,126.554362,126.565248,126.565932,126.539223,126.508963,126.491033,126.487414,126.497194,126.483544,126.449465,126.454675,126.478804,126.481304,126.492184,126.511864,126.513734,126.525444,126.525144,126.499484,126.499154,126.517254,126.515445,126.537854,126.555814,126.569774,126.574924,126.562614,126.570464,126.564995,126.575465,126.601665,126.610414,126.606984,126.633614,126.651414,126.647314,126.660983,126.644843,126.663253,126.685593,126.689353,126.686294,126.693834,126.719663,126.717883,126.710223,126.718163,126.729743,126.737163,126.723133,126.762732,126.747153,126.753093,126.745913,126.757773,126.753993,126.738623,126.723313,126.701862,126.695932,126.706052,126.728763,126.751553,126.750702,126.768062,126.772132,126.786802,126.796982,126.789767,126.791802,126.798032,126.807192,126.793432,126.801312,126.810312,126.810002,126.817372,126.838291,126.878691,126.882141,126.905371,126.865071,126.840061,126.839461,126.805571,126.809481,126.799571,126.772811,126.758402,126.760452,126.743302,126.766621,126.757742,126.767112,126.764342,126.778191,126.789172,126.794021,126.81874,126.818201,126.8315,126.826231,126.84232,126.84737,126.87294,126.85159,126.851319,126.86843,126.87049,126.881,126.89779,126.89758,126.92047,126.921769,126.944399,126.91439,126.954289,126.963289,126.969558,126.984018,126.977909,126.985739,126.996269,126.998279,127.002059,127.012349,127.013479,127.030769,127.017699,127.00607,127.03046,127.02598,127.03664,127.047079,127.05582,127.04578,127.04432,127.05751,127.06857,127.08142,127.08112,127.06508,127.07666,127.06058,127.06935,127.10285,127.09864,127.10932,127.10076,127.09386,127.10461,127.11147,127.10769,127.12274,127.11377,127.1175,127.1272,127.14288,127.14503,127.15313,127.14823,127.15764,127.17878,127.16625,127.16981,127.190729,127.195539,127.18623,127.18989,127.19522,127.19875,127.20775,127.2143,127.20702,127.21044,127.226629,127.235169,127.246709,127.249049,127.265579,127.282769,127.275789,127.290699,127.318129,127.334408,127.345758,127.345279,127.329579,127.321859,127.347398,127.359788,127.360578,127.377458,127.374108,127.395568,127.410758,127.430068,127.424978,127.444448,127.439628,127.455478,127.454258,127.467208,127.448538,127.459268,127.452509,127.477548,127.482908,127.493398,127.504618,127.515198,127.514428,127.523668,127.508498,127.514828,127.521018,127.537568,127.523918,127.543498,127.549568,127.556778,127.589128,127.615928,127.624628,127.648428,127.634228,127.669848,127.665328,127.677248,127.671778,127.683728,127.692188,127.691198,127.684628,127.683198,127.710598,127.719348,127.738237,127.737617,127.762677,127.779667,127.780117,127.765877,127.760697,127.782117,127.788277,127.797077,127.806517,127.810467,127.819307,127.828427,127.819757,127.834657,127.850137,127.880247,127.882267,127.902097,127.929266,127.949346,127.952566,127.938877,127.940227,127.927367,127.953527,127.952637,127.962707,127.984806,127.993046,128.000516,128.027856,128.069336,128.069376,128.085937,128.086787,128.101917,128.130907,128.137237,128.131267,128.150207,128.161137,128.184217,128.201207,128.221707,128.214227,128.225111,128.218437,128.200627,128.183877,128.175206,128.193996,128.192446,128.151186,128.118506,128.122946,128.139096,128.107867,128.113357,128.100067,128.101407,128.094407,128.103087,128.092127,128.074948,128.083549,128.098879,128.09167,128.080241,128.087771,128.081921,128.092781,128.065941,128.044771,128.040359,128.066031,128.067131,128.08663,128.08936,128.07736,128.05241,128.01949,127.99553,127.99878,128.01842,128.06812,128.0964,128.11433,128.12471,128.128171,128.11613,128.100201,128.11514,128.11008,128.128299,128.188169,128.258018,128.256028,128.281608,128.281309,128.296279,128.292269,128.321489,128.327369,128.341638,128.329629,128.324288,128.299139,128.307258,128.295269,128.292298,128.300758,128.278108,128.239588,128.220238,128.221067,128.194027,128.228166,128.265466,128.289216,128.307286,128.324676,128.331196,128.314716,128.292496,128.295856,128.313916,128.323066,128.328045,128.361855,128.373975,128.364115,128.358105,128.378605,128.410375,128.387495,128.349105,128.358205,128.368655,128.401045,128.418915,128.429984,128.448614,128.455874,128.438024,128.419215,128.417765,128.402385,128.421665,128.473884,128.501724,128.511423,128.518983,128.507784,128.470344,128.477134,128.466974,128.427475,128.395465,128.380945,128.393426,128.418545,128.436395,128.465935,128.475265,128.485125,128.506635,128.535895,128.528475,128.550455,128.554145,128.588494,128.587074,128.596034,128.623444,128.627874,128.608834,128.613484,128.678874,128.718104,128.718904,128.738404,128.777323,128.767903,128.777203,128.787763,128.789163,128.793573,128.808563,128.818893,128.827503,128.830403,128.832733,128.906063,128.914072,128.912912,128.916392,128.931732,128.953922,128.967402,128.972172,129.001242,129.00134,128.896362,128.706703,128.642335,128.55175,128.494827,128.314269,128.022372,127.705705,127.585376,127.548597,127.518817,127.452078,127.32596,127.213371,127.089312,126.956523,126.772578,126.73424,126.672789,126.422025,126.203139,126.160689,126.081171,126.037052,125.95101,125.801225,125.53206,125.48507,125.439021,125.315272,125.230343,125.102415,125.026186,124.993076,124.928047,124.894578,124.814039,124.741,124.393573,124.305384,124.238655,124.154307,124.101189,124.07911,123.998,123.97602,123.935731,123.930731,123.875072,123.866822,123.877712,123.810233,123.774417,123.756934,123.747493,123.749193,123.764154,123.742364,123.707623,123.693654,123.656293,123.639134,123.573375,123.558005,123.553025,123.534286,123.512086,123.508005,123.474015,123.412296,123.371446,123.330286,123.328676,123.299967,123.303027,123.286897,123.275427,123.251957,123.227257,123.212948,123.163068,123.151988,123.165398,123.172148,123.148458,123.162437,123.161067,123.134157,123.139767,123.133887,123.083117,123.022718,123.004848,123.002258,122.979058,122.975888,122.970008,122.935088,122.829389,122.812679,122.773819,122.754619,122.747759,122.669819,122.65346,122.64927,122.61869,122.59801,122.6014,122.59165,122.58165,122.58558,122.59736,122.58072,122.57653,122.58263,122.57153,122.57504,122.56082,122.55757,122.53605,122.50966,122.50072,122.49111,122.444431,122.364201,122.349301,122.354151,122.326281,122.274502,122.268242,122.280641,122.277312,122.264102,122.249432,122.243791,122.227021,122.211532,122.209432,122.197792,122.200762,122.188992,122.193252,122.171452,122.165303,122.156563,122.136743,122.113573,122.112523,122.093293,122.093193,122.109852,122.118982,122.085382,122.030782,122.001002,121.986272,121.982962,121.956102,121.915102,121.893972,121.901804,121.908096,121.900482,121.874532,121.863402,121.864832,121.829272,121.789874,121.756933,121.763143,121.695084,121.676684,121.674814,121.644684,121.646554,121.627666,121.546584,121.531603,121.504836,121.467732,121.459999,121.435524,121.428551,121.361874,121.350196,121.349451,121.323819,121.298993,121.296339,121.2759,121.268492,121.198696,121.177135,121.172767,121.099835,121.083487,121.079426,121.013914,121.007921,120.939765,120.918118,120.906146,120.868536,120.841095,120.840007,120.811364,120.813474,120.779753,120.712683,120.671874,120.639,120.593472,120.55337,120.562314,120.558378,120.518014,120.494711,120.471276,120.469348,120.447181,120.43657,120.315466,120.231065,120.176725,120.126592,120.042168,120.011342,119.991368,119.984181,119.967498,119.944395,119.920455,119.850753,119.81637,119.788001,119.781732,119.750434,119.73385,119.710912,119.681199,119.650299,119.634353,119.640269,119.597462,119.578523,119.587825,119.534915,119.503722,119.482109,119.45712,119.461742,119.469828,119.486654,119.503207,119.499148,119.507448,119.528815,119.54184,119.569888,119.576278,119.54744,119.502718,119.478108,119.492468,119.482512,119.453434,119.441935,119.415734,119.398674,119.407986,119.390842,119.403232,119.397248,119.402417,119.418618,119.39019,119.382143,119.355734,119.36619,119.346392,119.289851,119.271141,119.279837,119.277469,119.288592,119.284847,119.277191,119.27886,119.266819,119.257808,119.25449,119.222245,119.23936,119.217883,119.180712,119.17354,119.15223,119.117503,119.069109,119.058059,118.960905,118.911791,118.900958,118.912935,118.905782,118.914168,118.856164,118.811598,118.755351,118.739631,118.745441,118.781709,118.751991,118.745957,118.722385,118.701391,118.666082,118.645197,118.620074,118.579204,118.561918,118.519837,118.440144,118.400428,118.397075,118.422406,118.427747,118.402601,118.403425,118.389714,118.390579,118.378616,118.339161,118.331264,118.334039,118.32091,118.298682,118.299691,118.259873,118.254962,118.223654,118.20681,118.210999,118.175323,118.172558,118.182607,118.190393,118.2107,118.212122,118.199929,118.2059,118.194646,118.187455,118.192117,118.17698,118.167453,118.108758,118.07182,118.034801,118.004005,117.998839,117.961875,117.948802,117.97971,117.97342,117.976718,117.94893,117.946188,117.939387,117.948679,117.918679,117.919537,117.859596,117.848248,117.854368,117.86786,117.887888,117.90929,117.927854,117.927755,117.910393,117.920354,117.918972,117.938926,117.934674,117.943593,117.979115,118.00226,118.021209,118.005966,117.976193,117.96721,117.969247,117.948254,117.940863,117.924451,117.904428,117.898808,117.885538,117.865886,117.838897,117.762152,117.70938,117.699847,117.685596,117.644602,117.65139,117.637161,117.628417,117.641724,117.639695,117.629383,117.611236,117.605589,117.548633,117.514358,117.512349,117.48526,117.479131,117.397478,117.362834,117.332467,117.356851,117.395747,117.398633,117.428481,117.465766,117.451558,117.468887,117.479563,117.471867,117.455199,117.429064,117.404886,117.369155,117.354753,117.348802,117.334227,117.337073,117.326428,117.337031,117.326067,117.272123,117.247599,117.195241,117.164713,117.164299,117.153613,117.150469,117.097947,117.073378,117.070851,117.06022,117.033503,117.018925,116.956844,116.934394,116.921228,116.884551,116.865924,116.861987,116.846365,116.844353,116.826937,116.810454,116.768273,116.741921,116.737367,116.745407,116.726477,116.707198,116.658079,116.645501,116.630374,116.629858,116.610312,116.572295,116.574846,116.532847,116.517875,116.498432,116.481664,116.468516,116.383109,116.370284,116.289466,116.261291,116.189752,116.133605,116.096924,116.029668,116.002145,115.996733,116.002664,115.961779,115.962426,115.94719,115.74301,115.669869,115.577862,115.558774,115.540859,115.542264,115.520254,115.478856,115.41791,115.345406,115.262563,115.168887,115.16529,115.201944,115.169115,115.165207,115.176676,115.156042,115.160423,115.143848,115.148446,115.160073,115.164672,115.172977,115.166376,115.157864,115.140164,115.133997,115.137026,115.124006,115.119138,115.050556,115.034056,115.033996,115.02375,115.03289,115.02441,115.039132,115.019226,114.991097,115.00414,114.997143,115.000795,114.979878,114.991902,114.992227,114.97595,114.986936,114.993979,115.000101,114.975079,114.990486,114.994782,115.019396,115.028268,115.003842,115.011321,115.003732,115.054693,115.065085,115.088836,115.102544,115.104741,115.123254,115.20671,115.299974,115.367242,115.42754,115.573649,115.59896,115.635818,115.646148,115.636594,115.647727,115.639797,115.66626,115.657587,115.670186,115.681022,115.687753,115.673712,115.632637,115.608247,115.627811,115.671224,115.700593,115.710538,115.717609,115.671098,115.665989,115.672846,115.645158,115.641006,115.655459,115.671585,115.672598,115.68349,115.696618,115.692719,115.712431,115.713302,115.72587,115.726835,115.710236,115.7139,115.697351,115.686051,115.684698,115.667165,115.666353,115.676878,115.704125,115.724219,115.747016,115.773706,115.767298,115.775445,115.770639,115.7775,115.762888,115.766264,115.755304,115.718518,115.720931,115.712251,115.721732,115.71174,115.723856,115.7379,115.750188,115.743892,115.712858,115.736117,115.74334,115.730675,115.701554,115.701971,115.684747,115.706381,115.736703,115.756059,115.755697,115.774567,115.765778,115.73734,115.755948,115.762755,115.742605,115.749349,115.742713,115.739558,115.740895,115.732237,115.760307,115.76191,115.777515,115.786705,115.813354,115.814353,115.826885,115.82881,115.846419,115.860631,115.86073,115.8718,115.857253,115.845083,115.863766,115.883729,115.891098,115.885924,115.89873,115.914832,115.918992,115.91012,115.936307,115.941252,115.951409,115.964464,115.958636,115.974023,115.958093,115.961648,115.950687,115.941162,115.936201,115.908899,115.914072,115.899614,115.897619,115.884725,115.883369,115.855654,115.842509,115.822208,115.82892,115.804136,115.79178,115.786605,115.773792,115.771548,115.779784,115.755784,115.758386,115.724374,115.750832,115.751671,115.743804,115.732048,115.740716,115.733569,115.727443,115.729627,115.685783,115.635222,115.579799,115.539123,115.441094,115.399236,115.383226,115.326427,115.328329,115.312809,115.219791,115.204504,115.189756,115.183259,115.102005,115.103602,115.087663,115.094402,115.07514,115.057946,115.071196,115.050572,115.042,115.020472,115.046093,115.042629,115.028083,114.994298,114.998978,114.991893,114.998686,115.00622,115.001771,114.984038,114.963037,114.965309,114.954846,114.969522,114.962836,114.977788,114.982742,114.98098,114.96483,114.959298,114.957949,114.977133,114.997224,114.997569,114.95634,114.954247,114.926874,114.914436,114.922057,114.920793,114.872084,114.831984,114.637438,114.62399,114.628663,114.612243,114.576178,114.587491,114.605975,114.614754,114.618976,114.605724,114.612666,114.596573,114.533698,114.454641,114.465639,114.451766,114.432984,114.405422,114.341731,114.323321,114.23874,114.197237,114.174711,114.144551,114.105399,114.124357,114.151587,114.157686,114.165846,114.181666,114.169976,114.173456,114.165566,114.172456,114.163386,114.104253,113.965158,113.783098,113.584357,113.296693,113.308233,113.294223,113.299632,113.277522,113.236421,113.15627,113.16254,113.19725,113.260891,113.269961,113.280371,113.273041,113.28219,113.29113,113.291559,113.284199,113.291609,113.284619,113.299268,113.31989,113.325441,113.317771,113.333482,113.324332,113.331212,113.326702,113.338722,113.356012,113.365273,113.357123,113.369893,113.368383,113.380413,113.383303,113.392573,113.394175],&#34;lat&#34;:[-26.39303,-26.385244,-26.360994,-26.357564,-26.300853,-26.300353,-26.276373,-26.245352,-26.237572,-26.210722,-26.205202,-26.212652,-26.165042,-26.119591,-26.111471,-26.097131,-26.078641,-26.065091,-26.054151,-26.03327,-26.01748,-26.06082,-26.092181,-26.105721,-26.113951,-26.138551,-26.161001,-26.167541,-26.163261,-26.212552,-26.221802,-26.253382,-26.271092,-26.320722,-26.336053,-26.357043,-26.363913,-26.400233,-26.378133,-26.383553,-26.420313,-26.430584,-26.477054,-26.484834,-26.468814,-26.409143,-26.362212,-26.336502,-26.322062,-26.323982,-26.310342,-26.302102,-26.284501,-26.276831,-26.284381,-26.27952,-26.30275,-26.324751,-26.353482,-26.380912,-26.433343,-26.461323,-26.469113,-26.493923,-26.495823,-26.504623,-26.547154,-26.574004,-26.578164,-26.600184,-26.601934,-26.614194,-26.606204,-26.585584,-26.560214,-26.544634,-26.511933,-26.514733,-26.489423,-26.518418,-26.489683,-26.463272,-26.502853,-26.540193,-26.563643,-26.571213,-26.619454,-26.594623,-26.596193,-26.616164,-26.630354,-26.654165,-26.674456,-26.658415,-26.662085,-26.649034,-26.639314,-26.632554,-26.643904,-26.637874,-26.619244,-26.601673,-26.611464,-26.606803,-26.617583,-26.587282,-26.605053,-26.610972,-26.603852,-26.576002,-26.551251,-26.536721,-26.50847,-26.4497,-26.39134,-26.371449,-26.335378,-26.280818,-26.252269,-26.217539,-26.186189,-26.165389,-26.121969,-26.108689,-26.100899,-26.097219,-26.086279,-26.071049,-26.071839,-26.044329,-26.014548,-25.998749,-25.946398,-25.919578,-25.884177,-25.852117,-25.809357,-25.783337,-25.768077,-25.764046,-25.733766,-25.725766,-25.730526,-25.720146,-25.715606,-25.709316,-25.702856,-25.709476,-25.713116,-25.723016,-25.739746,-25.752606,-25.756417,-25.751146,-25.764887,-25.773837,-25.785457,-25.724737,-25.683786,-25.625725,-25.610885,-25.558264,-25.547814,-25.513773,-25.503303,-25.607794,-25.625765,-25.635505,-25.636894,-25.620774,-25.683625,-25.714325,-25.733535,-25.748575,-25.789215,-25.793645,-25.868086,-25.878595,-25.905095,-25.949526,-26.001947,-25.999667,-26.013658,-26.044962,-26.061982,-26.096375,-26.11239,-26.12356,-26.097609,-26.13191,-26.187239,-26.194689,-26.199769,-26.196729,-26.206749,-26.206839,-26.197909,-26.185049,-26.212209,-26.214889,-26.207408,-26.178818,-26.140187,-26.115607,-26.113657,-26.116727,-26.138657,-26.060216,-26.068116,-26.029306,-25.955965,-25.945125,-25.959105,-25.960115,-25.982435,-25.998745,-26.035146,-26.054496,-26.088906,-26.122376,-26.133386,-26.129846,-26.143006,-26.203947,-26.244227,-26.267597,-26.293926,-26.342507,-26.419217,-26.454547,-26.451227,-26.459277,-26.452337,-26.466587,-26.467617,-26.459327,-26.458487,-26.410107,-26.390016,-26.372056,-26.357256,-26.341546,-26.312765,-26.300875,-26.283905,-26.244795,-26.224064,-26.203644,-26.180263,-26.168333,-26.157803,-26.119022,-26.124612,-26.139513,-26.165043,-26.165863,-26.144892,-26.117782,-26.072702,-26.031612,-25.983571,-25.968891,-25.973651,-25.987401,-25.992551,-25.982131,-25.983341,-25.972951,-25.936501,-25.88774,-25.87567,-25.862,-25.85302,-25.83563,-25.81127,-25.81265,-25.80644,-25.778099,-25.772338,-25.780169,-25.755256,-25.743165,-25.735975,-25.725455,-25.728185,-25.696372,-25.662525,-25.667324,-25.624117,-25.632347,-25.618519,-25.620488,-25.58992,-25.560829,-25.57514,-25.56488,-25.493408,-25.475488,-25.470638,-25.480228,-25.473228,-25.477168,-25.458678,-25.410088,-25.413468,-25.406708,-25.400948,-25.372988,-25.357417,-25.337007,-25.292457,-25.299337,-25.287607,-25.290317,-25.264597,-25.255907,-25.256927,-25.216997,-25.173566,-25.157316,-25.127367,-25.103316,-25.022706,-24.958656,-24.932985,-24.928535,-24.924985,-24.895891,-24.905115,-24.897891,-24.882163,-24.878065,-24.861964,-24.850707,-24.848724,-24.864515,-24.858645,-24.844545,-24.831784,-24.849725,-24.797444,-24.746034,-24.575957,-24.515616,-24.491706,-24.484176,-24.411406,-24.303065,-24.223995,-24.223505,-24.181694,-24.136784,-24.090333,-24.080733,-24.042933,-24.032653,-24.032173,-24.013642,-23.966452,-23.925572,-23.898561,-23.84733,-23.797639,-23.774839,-23.752229,-23.698938,-23.663358,-23.646688,-23.630908,-23.618921,-23.599586,-23.575201,-23.545007,-23.528236,-23.478055,-23.416074,-23.378934,-23.365153,-23.296052,-23.217841,-23.194561,-23.177771,-23.13065,-23.1213,-23.10674,-23.082769,-23.030908,-22.994887,-22.977056,-22.956016,-22.906935,-22.886805,-22.842664,-22.756224,-22.715284,-22.723044,-22.717134,-22.664414,-22.628723,-22.596863,-22.578773,-22.550123,-22.540952,-22.517962,-22.496702,-22.496212,-22.471031,-22.408421,-22.38435,-22.37676,-22.305849,-22.151067,-21.998885,-21.973225,-21.938004,-21.875463,-21.851153,-21.827572,-21.815962,-21.803272,-21.805571,-21.785761,-21.814581,-21.866652,-21.957822,-22.154135,-22.191275,-22.261584,-22.279275,-22.313925,-22.314915,-22.331156,-22.301463,-22.305374,-22.353442,-22.393165,-22.398025,-22.399916,-22.396805,-22.409195,-22.407806,-22.415806,-22.441656,-22.472668,-22.497539,-22.500663,-22.506699,-22.538059,-22.517099,-22.534049,-22.523779,-22.520809,-22.497188,-22.486008,-22.473288,-22.457368,-22.459207,-22.433786,-22.440617,-22.503707,-22.479567,-22.489727,-22.492117,-22.516307,-22.490207,-22.500606,-22.494287,-22.503896,-22.492827,-22.500166,-22.498146,-22.490347,-22.490786,-22.483027,-22.484616,-22.476147,-22.464757,-22.469407,-22.461037,-22.441277,-22.446257,-22.439037,-22.438947,-22.434067,-22.426617,-22.429237,-22.421547,-22.402587,-22.403047,-22.401687,-22.390967,-22.395737,-22.382957,-22.359597,-22.36145,-22.350917,-22.351497,-22.367537,-22.363706,-22.357147,-22.362576,-22.351727,-22.342937,-22.345967,-22.331167,-22.316167,-22.319787,-22.310527,-22.300597,-22.303997,-22.294967,-22.329296,-22.300057,-22.292616,-22.289326,-22.275436,-22.264945,-22.271896,-22.259655,-22.264406,-22.253554,-22.242045,-22.244557,-22.238325,-22.244985,-22.245694,-22.251497,-22.235045,-22.207968,-22.217947,-22.204248,-22.204818,-22.219118,-22.220498,-22.190368,-22.18803,-22.166098,-22.159548,-22.157647,-22.171057,-22.162957,-22.183507,-22.150317,-22.158217,-22.152916,-22.156646,-22.129886,-22.123235,-22.141576,-22.105855,-22.101794,-22.095344,-22.100324,-22.093434,-22.078764,-22.082714,-22.066464,-22.060823,-22.066463,-22.052133,-22.020301,-22.043662,-22.026842,-22.015781,-22.001781,-21.99688,-22.019481,-22.003811,-21.98772,-22.00686,-21.98749,-21.97619,-21.96152,-21.97358,-21.947629,-21.944579,-21.944779,-21.935879,-21.917348,-21.922518,-21.910538,-21.919928,-21.909328,-21.844517,-21.827656,-21.832946,-21.839366,-21.867827,-21.843086,-21.830816,-21.828996,-21.813726,-21.798786,-21.790546,-21.734465,-21.738045,-21.732655,-21.705314,-21.688344,-21.690764,-21.669643,-21.673993,-21.670773,-21.690393,-21.686173,-21.692613,-21.68583,-21.683693,-21.677233,-21.681793,-21.675413,-21.671553,-21.679543,-21.684683,-21.692863,-21.688193,-21.694883,-21.686713,-21.692212,-21.684883,-21.682142,-21.685583,-21.677582,-21.686052,-21.675882,-21.631741,-21.644862,-21.659842,-21.659042,-21.644852,-21.626211,-21.636612,-21.625072,-21.611331,-21.628312,-21.620291,-21.627892,-21.612421,-21.597741,-21.616211,-21.602551,-21.596221,-21.592561,-21.576801,-21.585001,-21.587071,-21.595891,-21.588201,-21.594131,-21.5803,-21.58316,-21.57599,-21.54814,-21.556059,-21.547009,-21.539879,-21.534689,-21.543289,-21.528238,-21.532568,-21.527878,-21.524798,-21.529188,-21.545369,-21.530188,-21.542018,-21.53814,-21.538188,-21.529608,-21.508477,-21.527558,-21.532848,-21.53785,-21.537976,-21.543788,-21.539071,-21.548478,-21.539778,-21.532838,-21.531058,-21.547228,-21.531728,-21.514737,-21.527107,-21.547188,-21.530037,-21.537397,-21.545807,-21.536058,-21.534337,-21.52791,-21.534347,-21.530127,-21.505767,-21.510937,-21.516397,-21.508877,-21.509527,-21.524847,-21.509176,-21.501457,-21.495497,-21.492555,-21.492437,-21.485766,-21.477336,-21.483476,-21.464786,-21.481206,-21.475996,-21.459466,-21.474406,-21.457936,-21.454696,-21.461466,-21.446576,-21.434726,-21.437695,-21.457255,-21.438835,-21.448805,-21.438955,-21.427545,-21.435905,-21.413065,-21.384845,-21.397405,-21.401885,-21.406185,-21.397865,-21.410855,-21.391655,-21.382045,-21.379385,-21.389515,-21.379895,-21.361104,-21.377344,-21.366854,-21.356264,-21.351674,-21.363184,-21.345554,-21.354744,-21.345684,-21.327134,-21.346364,-21.337434,-21.342214,-21.336644,-21.333764,-21.331674,-21.315654,-21.319314,-21.309984,-21.279463,-21.299573,-21.276673,-21.288723,-21.283833,-21.274923,-21.278637,-21.277313,-21.253863,-21.284013,-21.271823,-21.284603,-21.268093,-21.267891,-21.254113,-21.256743,-21.288553,-21.265673,-21.262797,-21.251563,-21.246493,-21.245843,-21.265623,-21.248903,-21.251437,-21.247453,-21.239803,-21.225243,-21.227893,-21.205602,-21.191862,-21.194914,-21.176072,-21.157362,-21.164142,-21.151712,-21.135362,-21.138812,-21.121142,-21.117304,-21.112682,-21.078751,-21.077861,-21.093551,-21.093008,-21.095691,-21.077411,-21.040109,-21.017038,-21.000447,-21.024268,-21.037917,-21.024498,-21.001127,-20.997017,-21.012727,-20.991917,-20.968736,-20.977626,-20.967896,-20.901295,-20.883454,-20.888494,-20.879854,-20.889604,-20.888425,-20.833754,-20.860333,-20.857773,-20.865733,-20.865953,-20.876574,-20.866163,-20.867633,-20.880183,-20.868933,-20.877023,-20.881323,-20.877113,-20.880271,-20.876313,-20.868003,-20.838822,-20.841922,-20.822181,-20.830301,-20.826671,-20.844471,-20.842679,-20.840171,-20.824181,-20.822651,-20.825627,-20.814951,-20.808011,-20.815441,-20.804281,-20.799511,-20.807821,-20.798501,-20.797171,-20.778531,-20.782771,-20.791521,-20.785559,-20.77176,-20.758061,-20.768751,-20.76739,-20.767851,-20.752861,-20.748361,-20.755011,-20.746431,-20.74169,-20.74681,-20.74519,-20.75172,-20.74042,-20.74467,-20.75242,-20.74567,-20.75382,-20.73451,-20.728406,-20.7311,-20.717199,-20.708299,-20.692129,-20.684569,-20.705949,-20.686469,-20.683609,-20.674709,-20.682339,-20.728017,-20.715189,-20.729109,-20.734039,-20.710729,-20.726199,-20.732089,-20.734922,-20.734839,-20.725949,-20.732319,-20.735413,-20.733249,-20.741369,-20.732049,-20.721939,-20.726694,-20.714229,-20.723029,-20.705779,-20.722209,-20.717859,-20.713889,-20.715859,-20.711709,-20.714529,-20.704719,-20.684839,-20.683088,-20.677608,-20.646594,-20.637941,-20.641238,-20.633147,-20.621328,-20.588797,-20.583177,-20.589277,-20.575437,-20.576797,-20.560137,-20.549857,-20.539557,-20.541537,-20.529187,-20.526156,-20.581637,-20.597997,-20.606307,-20.606417,-20.607177,-20.614757,-20.630087,-20.640447,-20.665297,-20.675388,-20.686928,-20.667567,-20.680658,-20.708718,-20.724107,-20.712327,-20.725087,-20.740687,-20.725687,-20.730926,-20.720087,-20.724336,-20.713207,-20.701226,-20.698196,-20.683326,-20.683266,-20.671016,-20.687446,-20.671095,-20.670807,-20.668966,-20.658155,-20.648204,-20.658244,-20.659494,-20.667574,-20.639543,-20.636063,-20.623993,-20.654783,-20.654393,-20.626753,-20.593562,-20.592332,-20.606112,-20.616122,-20.613342,-20.631731,-20.638582,-20.632304,-20.639662,-20.657153,-20.645062,-20.664591,-20.673322,-20.665082,-20.666552,-20.700593,-20.691842,-20.695515,-20.680332,-20.705982,-20.706772,-20.713322,-20.724842,-20.705532,-20.697732,-20.695142,-20.702532,-20.714202,-20.704312,-20.723394,-20.720252,-20.735322,-20.723622,-20.734912,-20.726502,-20.738032,-20.726802,-20.735652,-20.743033,-20.759303,-20.75911,-20.774213,-20.764283,-20.763033,-20.778983,-20.775772,-20.771633,-20.757123,-20.745742,-20.734332,-20.734222,-20.750712,-20.758842,-20.784363,-20.760982,-20.771023,-20.758832,-20.760442,-20.752732,-20.760062,-20.744782,-20.730592,-20.731132,-20.746492,-20.758012,-20.753602,-20.745352,-20.757222,-20.751662,-20.740502,-20.730602,-20.707741,-20.710321,-20.704001,-20.694031,-20.703641,-20.694171,-20.688011,-20.694771,-20.679771,-20.663771,-20.66199,-20.678851,-20.687271,-20.677101,-20.677981,-20.693351,-20.689441,-20.702141,-20.709091,-20.711651,-20.703931,-20.715471,-20.688911,-20.672281,-20.684141,-20.699031,-20.679391,-20.666601,-20.66872,-20.677311,-20.687,-20.691541,-20.68677,-20.69455,-20.68222,-20.67889,-20.68657,-20.67764,-20.68229,-20.67412,-20.66608,-20.67633,-20.67009,-20.6793,-20.67417,-20.67534,-20.66354,-20.65437,-20.65558,-20.63214,-20.606039,-20.607469,-20.597439,-20.581939,-20.585259,-20.578269,-20.573049,-20.581109,-20.571759,-20.551958,-20.551798,-20.558178,-20.553688,-20.561948,-20.567298,-20.576598,-20.566728,-20.570878,-20.562688,-20.561048,-20.555528,-20.543578,-20.546668,-20.556818,-20.558548,-20.566988,-20.551828,-20.546198,-20.547847,-20.561958,-20.549418,-20.544407,-20.550487,-20.541687,-20.546917,-20.525207,-20.546817,-20.536837,-20.517007,-20.519987,-20.511617,-20.506646,-20.510437,-20.530507,-20.526597,-20.510907,-20.479916,-20.491116,-20.479196,-20.472155,-20.458715,-20.422104,-20.394765,-20.401053,-20.387724,-20.357893,-20.336413,-20.337923,-20.360063,-20.345573,-20.350943,-20.359123,-20.355983,-20.354883,-20.346713,-20.356003,-20.368943,-20.358133,-20.369453,-20.368983,-20.382943,-20.376413,-20.403754,-20.373203,-20.370553,-20.370943,-20.368144,-20.371944,-20.375234,-20.369774,-20.377723,-20.358853,-20.353423,-20.367413,-20.351633,-20.364343,-20.356053,-20.365403,-20.354693,-20.348633,-20.329892,-20.355253,-20.360053,-20.358723,-20.373963,-20.351432,-20.369622,-20.351372,-20.348642,-20.358522,-20.364302,-20.361082,-20.349152,-20.339562,-20.338452,-20.344722,-20.346742,-20.337152,-20.335072,-20.349491,-20.343631,-20.350991,-20.343641,-20.329151,-20.325971,-20.328141,-20.330461,-20.334271,-20.330641,-20.348781,-20.330811,-20.327661,-20.311651,-20.319231,-20.323911,-20.329756,-20.321721,-20.310611,-20.31361,-20.304851,-20.305361,-20.294396,-20.3016,-20.310819,-20.32014,-20.31805,-20.32576,-20.316671,-20.329571,-20.346311,-20.349761,-20.32796,-20.345211,-20.33779,-20.357681,-20.33726,-20.35449,-20.34494,-20.35154,-20.34755,-20.34905,-20.33539,-20.33124,-20.34243,-20.3316,-20.33437,-20.32459,-20.32967,-20.316187,-20.308092,-20.286556,-20.308261,-20.298496,-20.312455,-20.325349,-20.33112,-20.33228,-20.34286,-20.340319,-20.330279,-20.327159,-20.326659,-20.315799,-20.281728,-20.278908,-20.288098,-20.281098,-20.278028,-20.287848,-20.276008,-20.286293,-20.272658,-20.262298,-20.262328,-20.258898,-20.230647,-20.225507,-20.242347,-20.253377,-20.261126,-20.253727,-20.242516,-20.225447,-20.167756,-20.127025,-20.035794,-20.015393,-19.988453,-19.970373,-19.959323,-19.978573,-20.012123,-20.004063,-20.015163,-20.023673,-20.017253,-20.007733,-19.956573,-19.953213,-19.961353,-19.971703,-19.970593,-19.971063,-19.964513,-19.990369,-19.991488,-19.996448,-20.008108,-19.994507,-20.017226,-20.013336,-20.005676,-20.046507,-20.070986,-20.077196,-20.078977,-20.080347,-20.046535,-20.032005,-20.003815,-19.995104,-20.021334,-20.03502,-20.037234,-20.029904,-20.022464,-20.026204,-20.013354,-20.01106,-20.005914,-20.003214,-19.984394,-19.983716,-19.976184,-19.963594,-19.971724,-19.976433,-19.969753,-19.955563,-19.968123,-19.973303,-19.962162,-19.969592,-19.955312,-19.933001,-19.926479,-19.925279,-19.921249,-19.912429,-19.913908,-19.770045,-19.621038,-19.538571,-19.466302,-19.341653,-19.237982,-19.093872,-19.053121,-19.042821,-19.021291,-18.96926,-18.94346,-18.95089,-18.940679,-18.94738,-18.903179,-18.869179,-18.864369,-18.841579,-18.847709,-18.840009,-18.818009,-18.819059,-18.835929,-18.813189,-18.79588,-18.767209,-18.743309,-18.742019,-18.706309,-18.700249,-18.721939,-18.704219,-18.709989,-18.707108,-18.720258,-18.720618,-18.715638,-18.698637,-18.706368,-18.696819,-18.704738,-18.674829,-18.673049,-18.653888,-18.660788,-18.657178,-18.610838,-18.609258,-18.575678,-18.552828,-18.503848,-18.509858,-18.518299,-18.491818,-18.481068,-18.508058,-18.484188,-18.451138,-18.443727,-18.461707,-18.471687,-18.464057,-18.439267,-18.404847,-18.390527,-18.325816,-18.327636,-18.307426,-18.266645,-18.273425,-18.266075,-18.262915,-18.239416,-18.230706,-18.235346,-18.241216,-18.237606,-18.243136,-18.247885,-18.249696,-18.228566,-18.217376,-18.204036,-18.172326,-18.116445,-18.070664,-17.993713,-17.989814,-17.975223,-17.979884,-17.973614,-17.952334,-17.989225,-18.008875,-17.974005,-17.970715,-17.945275,-17.873734,-17.774314,-17.684823,-17.665576,-17.667663,-17.601233,-17.560353,-17.355372,-17.341572,-17.263592,-17.240411,-17.245921,-17.240371,-17.228171,-17.240381,-17.229191,-17.186451,-17.181021,-17.192331,-17.198201,-17.185761,-17.196031,-17.184171,-17.173311,-17.169251,-17.1576,-17.15566,-17.163931,-17.169,-17.16064,-17.15044,-17.15744,-17.14512,-17.15895,-17.15127,-17.13957,-17.136127,-17.12968,-17.12709,-17.13029,-17.119348,-17.13701,-17.13172,-17.11985,-17.06723,-17.036949,-17.008089,-16.997639,-16.936298,-16.956878,-16.967098,-16.969788,-16.980528,-16.983388,-16.987758,-16.968838,-16.977778,-16.986348,-16.976958,-16.981348,-16.968148,-16.951627,-16.957178,-16.937277,-16.921707,-16.894587,-16.918507,-16.915987,-16.923677,-16.933687,-16.954367,-16.947677,-16.962397,-16.955677,-16.957217,-16.971297,-16.965257,-16.964307,-16.954947,-16.954927,-16.948077,-16.933217,-16.929367,-16.903267,-16.896417,-16.864457,-16.861427,-16.836947,-16.819836,-16.834526,-16.835516,-16.828876,-16.829286,-16.837986,-16.829056,-16.836156,-16.822606,-16.805366,-16.785766,-16.777286,-16.771426,-16.762136,-16.765655,-16.794666,-16.800705,-16.777244,-16.787474,-16.777653,-16.746053,-16.752013,-16.772203,-16.765513,-16.754373,-16.761563,-16.752673,-16.760883,-16.751413,-16.763552,-16.771692,-16.760602,-16.747423,-16.762142,-16.767022,-16.766172,-16.774302,-16.770112,-16.792031,-16.773562,-16.772412,-16.769852,-16.758282,-16.756982,-16.744482,-16.752842,-16.733722,-16.735473,-16.704523,-16.704153,-16.695973,-16.694013,-16.710333,-16.700123,-16.683403,-16.628613,-16.584943,-16.590313,-16.545303,-16.539172,-16.571693,-16.558293,-16.560702,-16.556122,-16.546502,-16.519102,-16.530251,-16.509952,-16.512692,-16.499102,-16.509362,-16.508041,-16.488521,-16.473601,-16.468221,-16.447201,-16.436671,-16.437081,-16.434981,-16.389451,-16.401741,-16.3809,-16.38755,-16.4059,-16.39341,-16.38009,-16.35921,-16.37821,-16.38561,-16.4002,-16.40577,-16.41997,-16.42076,-16.43056,-16.43986,-16.440339,-16.462969,-16.473789,-16.458959,-16.4627,-16.45175,-16.46513,-16.47709,-16.47757,-16.48581,-16.51611,-16.5222,-16.528429,-16.53251,-16.55246,-16.55875,-16.56188,-16.58014,-16.59061,-16.59309,-16.607089,-16.601849,-16.625609,-16.640849,-16.604569,-16.617049,-16.621359,-16.671528,-16.690788,-16.693248,-16.664818,-16.698287,-16.709127,-16.711067,-16.688477,-16.708437,-16.738037,-16.731557,-16.745297,-16.772587,-16.783717,-16.779057,-16.794197,-16.787297,-16.790736,-16.805666,-16.817926,-16.846646,-16.858976,-16.858986,-16.878438,-16.924718,-16.924948,-16.969948,-17.011833,-17.035544,-17.107721,-17.162732,-17.240033,-17.280663,-17.316253,-17.327513,-17.325463,-17.345443,-17.350613,-17.397063,-17.418462,-17.435522,-17.429542,-17.437172,-17.433202,-17.452292,-17.454392,-17.481901,-17.463792,-17.469231,-17.501081,-17.503891,-17.523841,-17.555842,-17.584192,-17.573752,-17.552611,-17.542691,-17.529441,-17.515581,-17.483621,-17.424752,-17.405802,-17.350152,-17.361531,-17.339401,-17.198661,-17.193651,-17.183951,-17.139381,-17.100991,-17.03326,-17.010619,-16.999738,-17.010179,-17.039649,-17.045069,-17.059229,-17.060029,-17.042679,-17.068349,-17.087749,-17.129039,-17.138809,-17.152289,-17.178389,-17.191629,-17.195409,-17.216569,-17.221728,-17.211858,-17.205648,-17.202518,-17.186579,-17.134649,-17.118049,-17.004007,-16.997896,-16.986377,-16.957277,-16.907427,-16.887496,-16.886506,-16.871306,-16.867516,-16.852416,-16.836416,-16.818116,-16.822806,-16.852076,-16.852076,-16.863777,-16.857227,-16.877897,-16.911838,-16.875858,-16.837748,-16.784868,-16.752718,-16.751687,-16.679497,-16.679007,-16.667597,-16.672767,-16.659717,-16.667826,-16.658826,-16.650066,-16.643146,-16.625236,-16.612606,-16.608006,-16.600806,-16.588255,-16.594516,-16.582825,-16.582145,-16.567454,-16.573783,-16.554332,-16.538302,-16.549843,-16.544414,-16.548174,-16.550474,-16.572025,-16.566135,-16.597756,-16.570805,-16.565075,-16.568415,-16.566025,-16.546015,-16.534805,-16.524605,-16.518225,-16.511196,-16.498866,-16.500465,-16.502966,-16.509875,-16.514535,-16.501725,-16.504064,-16.494055,-16.484015,-16.475055,-16.477015,-16.470005,-16.504553,-16.508644,-16.504233,-16.525902,-16.517452,-16.53004,-16.51801,-16.504871,-16.510472,-16.498562,-16.490701,-16.49044,-16.498639,-16.49109,-16.479889,-16.474949,-16.464731,-16.448731,-16.445533,-16.427224,-16.419995,-16.409865,-16.407085,-16.427682,-16.408504,-16.407953,-16.391335,-16.389254,-16.380235,-16.397994,-16.399853,-16.403153,-16.408373,-16.400803,-16.405662,-16.415552,-16.417132,-16.425752,-16.429971,-16.422992,-16.43663,-16.43356,-16.428321,-16.43269,-16.414851,-16.416171,-16.404832,-16.385393,-16.356753,-16.362873,-16.369483,-16.383373,-16.383112,-16.367993,-16.375382,-16.372392,-16.359133,-16.354033,-16.351003,-16.337533,-16.335583,-16.313513,-16.308693,-16.290494,-16.287084,-16.317263,-16.311233,-16.322803,-16.283154,-16.262805,-16.276294,-16.272024,-16.260614,-16.264084,-16.245294,-16.261804,-16.250954,-16.243774,-16.247684,-16.239224,-16.232404,-16.224924,-16.233704,-16.216245,-16.216364,-16.205884,-16.210365,-16.192125,-16.177745,-16.172315,-16.180805,-16.164424,-16.160494,-16.176164,-16.157694,-16.168304,-16.153424,-16.163214,-16.151204,-16.153614,-16.160594,-16.151104,-16.162244,-16.160004,-16.173274,-16.169474,-16.190264,-16.171174,-16.167543,-16.153894,-16.152243,-16.170893,-16.154083,-16.156813,-16.128683,-16.140513,-16.160613,-16.153523,-16.162773,-16.157443,-16.170593,-16.200473,-16.203513,-16.209233,-16.206143,-16.219653,-16.216153,-16.222923,-16.209503,-16.223643,-16.216153,-16.228843,-16.233443,-16.228263,-16.238833,-16.263033,-16.263553,-16.243033,-16.262143,-16.251803,-16.259543,-16.253123,-16.263273,-16.285833,-16.297653,-16.284063,-16.299763,-16.303063,-16.316123,-16.320673,-16.303973,-16.322823,-16.326223,-16.319613,-16.315043,-16.327873,-16.330173,-16.340583,-16.336113,-16.350323,-16.351733,-16.342443,-16.347053,-16.355203,-16.362233,-16.371253,-16.377674,-16.371734,-16.354373,-16.376474,-16.382834,-16.435165,-16.447055,-16.412874,-16.416724,-16.409534,-16.422833,-16.394503,-16.392203,-16.365043,-16.353663,-16.362923,-16.342823,-16.352203,-16.333713,-16.304033,-16.307393,-16.335163,-16.359833,-16.378943,-16.379503,-16.370433,-16.340413,-16.325003,-16.304383,-16.297723,-16.279823,-16.291832,-16.281402,-16.268633,-16.260183,-16.264743,-16.260533,-16.252823,-16.257713,-16.250903,-16.246193,-16.249173,-16.229623,-16.231473,-16.210293,-16.233563,-16.245312,-16.253662,-16.248302,-16.261632,-16.254562,-16.264722,-16.257442,-16.268342,-16.259392,-16.255742,-16.268952,-16.278332,-16.271962,-16.284152,-16.271422,-16.270972,-16.277832,-16.285392,-16.278642,-16.280432,-16.288902,-16.309581,-16.328211,-16.342561,-16.352681,-16.356571,-16.366401,-16.360561,-16.377041,-16.372541,-16.383881,-16.389021,-16.386921,-16.397011,-16.404761,-16.398491,-16.418441,-16.409591,-16.413811,-16.419421,-16.414481,-16.423921,-16.414911,-16.420161,-16.414921,-16.421461,-16.428531,-16.439481,-16.441541,-16.448811,-16.455421,-16.468691,-16.458471,-16.465571,-16.454171,-16.458231,-16.448671,-16.442741,-16.445191,-16.458981,-16.478611,-16.504581,-16.497341,-16.503581,-16.506421,-16.509951,-16.525511,-16.533011,-16.533871,-16.543251,-16.531701,-16.517921,-16.525531,-16.498491,-16.497531,-16.508911,-16.502741,-16.506741,-16.494941,-16.501181,-16.496081,-16.498551,-16.482831,-16.475411,-16.485221,-16.469661,-16.429011,-16.415221,-16.424751,-16.418821,-16.416381,-16.389161,-16.378731,-16.34562,-16.35224,-16.37329,-16.36682,-16.39408,-16.38862,-16.41091,-16.4043,-16.41168,-16.4008,-16.40856,-16.4143,-16.389979,-16.43432,-16.420818,-16.391137,-16.393327,-16.371327,-16.383957,-16.388077,-16.416048,-16.408779,-16.416219,-16.40907,-16.416409,-16.385858,-16.372199,-16.355839,-16.344719,-16.350389,-16.32929,-16.34285,-16.35644,-16.34497,-16.34123,-16.35284,-16.35958,-16.35726,-16.33421,-16.33853,-16.29363,-16.29811,-16.2761,-16.27402,-16.25067,-16.23799,-16.22702,-16.21663,-16.2017,-16.19091,-16.18272,-16.169479,-16.182809,-16.178809,-16.122029,-16.113529,-16.110279,-16.065389,-16.078429,-16.079479,-16.071809,-16.078539,-16.094139,-16.102519,-16.122199,-16.164669,-16.173599,-16.182689,-16.189239,-16.177439,-16.206029,-16.178819,-16.194759,-16.188199,-16.189359,-16.181199,-16.184239,-16.162009,-16.157619,-16.119458,-16.127398,-16.098108,-16.091848,-16.099708,-16.089758,-16.113428,-16.116078,-16.109518,-16.023228,-16.027418,-16.000528,-15.997678,-15.973497,-15.983727,-15.996267,-15.982487,-15.984137,-15.99857,-15.988417,-15.980897,-15.969967,-15.964507,-15.967607,-15.942977,-15.944427,-15.927357,-15.920887,-15.912997,-15.906097,-15.898437,-15.891317,-15.881557,-15.853597,-15.862727,-15.888916,-15.881886,-15.877276,-15.862816,-15.856586,-15.849516,-15.839466,-15.814056,-15.822276,-15.784466,-15.768976,-15.770066,-15.762296,-15.766496,-15.750216,-15.763896,-15.759046,-15.767746,-15.765166,-15.769216,-15.783006,-15.784746,-15.769706,-15.741066,-15.745626,-15.781617,-15.790477,-15.778957,-15.790487,-15.786087,-15.795637,-15.810867,-15.861227,-15.957318,-15.972368,-15.968078,-15.979718,-15.998068,-15.987488,-15.975498,-15.977248,-15.959128,-15.943248,-15.946368,-15.934418,-15.927868,-15.935708,-15.928318,-15.935968,-15.920408,-15.941578,-15.896948,-15.885678,-15.893378,-15.889778,-15.889818,-15.886058,-15.873708,-15.866628,-15.868398,-15.863378,-15.854118,-15.817708,-15.820258,-15.816018,-15.802971,-15.809198,-15.811438,-15.831348,-15.829048,-15.870368,-15.867388,-15.847618,-15.876798,-15.863848,-15.805898,-15.717558,-15.731178,-15.720058,-15.732568,-15.723958,-15.711468,-15.720398,-15.715068,-15.711408,-15.710998,-15.726028,-15.698618,-15.677308,-15.672178,-15.680098,-15.671878,-15.660198,-15.669318,-15.662408,-15.685178,-15.681428,-15.637228,-15.667358,-15.673888,-15.664268,-15.669738,-15.654828,-15.656338,-15.643498,-15.623017,-15.602767,-15.616207,-15.618837,-15.636687,-15.621527,-15.615687,-15.613547,-15.608557,-15.591877,-15.601137,-15.608447,-15.588087,-15.609457,-15.620168,-15.615128,-15.574467,-15.559357,-15.560787,-15.549247,-15.540787,-15.546987,-15.528717,-15.539507,-15.532067,-15.536897,-15.511707,-15.506397,-15.512367,-15.503557,-15.497277,-15.516547,-15.525127,-15.516417,-15.504087,-15.505807,-15.486177,-15.504257,-15.508487,-15.498187,-15.506277,-15.477897,-15.474967,-15.483737,-15.470327,-15.468737,-15.485127,-15.477197,-15.484437,-15.490806,-15.502796,-15.499606,-15.520056,-15.523406,-15.506476,-15.503846,-15.514456,-15.519576,-15.525666,-15.516306,-15.512756,-15.503916,-15.500666,-15.472426,-15.466096,-15.462806,-15.436696,-15.424696,-15.435186,-15.434136,-15.463116,-15.483746,-15.478196,-15.498086,-15.480336,-15.480916,-15.473216,-15.468026,-15.455806,-15.462826,-15.452896,-15.428606,-15.413716,-15.411636,-15.400686,-15.376745,-15.363405,-15.361785,-15.360495,-15.352805,-15.359836,-15.343555,-15.357496,-15.361946,-15.354946,-15.347946,-15.346246,-15.336876,-15.324886,-15.334256,-15.324526,-15.333196,-15.320805,-15.309125,-15.296465,-15.296636,-15.288586,-15.278996,-15.270166,-15.269046,-15.255036,-15.254006,-15.264066,-15.278375,-15.253395,-15.302065,-15.326155,-15.343165,-15.354425,-15.333275,-15.311885,-15.294465,-15.308755,-15.323535,-15.325915,-15.324725,-15.311885,-15.299055,-15.316365,-15.328535,-15.335425,-15.340645,-15.353175,-15.351775,-15.359115,-15.343495,-15.356435,-15.360235,-15.373315,-15.374735,-15.389855,-15.388875,-15.393845,-15.395785,-15.383625,-15.383725,-15.420935,-15.409605,-15.421805,-15.440144,-15.448394,-15.469585,-15.475225,-15.479725,-15.489225,-15.479945,-15.476015,-15.488745,-15.491195,-15.483485,-15.495005,-15.484275,-15.476995,-15.495635,-15.505835,-15.500835,-15.510445,-15.496305,-15.503625,-15.496494,-15.495054,-15.476634,-15.473224,-15.480144,-15.471494,-15.485704,-15.505324,-15.505934,-15.519864,-15.517755,-15.521784,-15.528485,-15.528575,-15.544665,-15.530545,-15.522114,-15.525814,-15.514764,-15.511124,-15.522184,-15.513814,-15.516397,-15.504444,-15.497854,-15.511504,-15.497044,-15.498594,-15.486434,-15.473764,-15.482554,-15.472624,-15.460934,-15.463214,-15.484205,-15.491535,-15.495446,-15.509086,-15.534266,-15.543866,-15.572295,-15.604725,-15.622804,-15.696025,-15.613775,-15.588135,-15.583565,-15.588054,-15.580894,-15.552796,-15.540026,-15.553396,-15.521966,-15.497106,-15.481946,-15.463394,-15.446414,-15.441514,-15.440244,-15.412294,-15.377714,-15.371304,-15.369454,-15.354984,-15.338864,-15.339444,-15.333104,-15.347914,-15.333874,-15.332494,-15.331304,-15.326534,-15.324564,-15.335264,-15.330574,-15.323464,-15.321034,-15.321404,-15.316964,-15.310094,-15.317424,-15.306144,-15.322434,-15.314114,-15.322104,-15.317884,-15.327834,-15.316854,-15.323994,-15.316554,-15.326604,-15.328774,-15.319294,-15.328894,-15.337704,-15.318464,-15.320234,-15.314584,-15.314174,-15.302024,-15.302634,-15.292444,-15.299354,-15.290434,-15.263074,-15.255614,-15.261394,-15.285924,-15.265044,-15.266764,-15.247804,-15.264394,-15.247674,-15.253924,-15.255604,-15.283114,-15.289674,-15.283764,-15.290154,-15.290854,-15.292044,-15.314354,-15.316214,-15.302394,-15.301394,-15.295534,-15.283864,-15.288194,-15.274794,-15.300314,-15.319974,-15.329394,-15.356465,-15.339925,-15.332125,-15.335035,-15.329635,-15.317425,-15.327745,-15.315905,-15.305355,-15.310485,-15.302025,-15.271805,-15.268955,-15.275725,-15.255504,-15.256384,-15.271194,-15.270484,-15.254564,-15.247404,-15.245294,-15.231134,-15.229224,-15.225084,-15.212154,-15.219914,-15.227244,-15.224204,-15.241934,-15.224464,-15.213574,-15.218534,-15.197044,-15.188714,-15.178584,-15.180784,-15.164434,-15.166364,-15.157674,-15.169504,-15.156164,-15.154504,-15.163344,-15.175854,-15.197844,-15.190984,-15.162004,-15.175954,-15.166124,-15.176314,-15.168174,-15.164254,-15.182994,-15.195574,-15.208304,-15.197104,-15.187414,-15.205114,-15.209734,-15.213134,-15.225734,-15.215134,-15.228244,-15.240224,-15.238994,-15.245664,-15.261915,-15.230334,-15.243635,-15.221605,-15.208434,-15.204085,-15.194945,-15.173444,-15.183565,-15.169044,-15.177935,-15.173195,-15.183155,-15.162704,-15.157965,-15.144884,-15.126234,-15.130614,-15.114314,-15.115854,-15.106804,-15.116714,-15.108684,-15.125574,-15.113234,-15.123544,-15.118744,-15.135314,-15.126474,-15.133284,-15.114254,-15.122814,-15.104844,-15.104694,-15.093504,-15.113284,-15.077114,-15.066214,-15.051964,-15.047044,-15.031344,-15.035084,-15.022064,-15.007954,-14.992374,-14.983164,-14.984254,-14.996014,-14.984444,-14.999784,-14.988094,-14.975763,-14.984233,-14.988153,-15.028274,-15.041464,-15.040613,-15.064904,-15.064473,-15.056263,-15.033183,-15.043503,-15.058953,-15.058983,-15.091643,-15.102933,-15.134713,-15.151363,-15.130073,-15.121173,-15.116363,-15.113043,-15.106273,-15.113823,-15.103433,-15.102513,-15.112953,-15.104263,-15.099983,-15.112673,-15.113733,-15.097543,-15.099653,-15.143623,-15.142163,-15.151633,-15.152463,-15.162923,-15.146453,-15.143103,-15.155863,-15.142613,-15.157572,-15.148722,-15.154802,-15.143002,-15.150472,-15.137622,-15.140257,-15.134032,-15.131702,-15.116982,-15.112322,-15.108373,-15.108842,-15.103322,-15.084662,-15.063762,-15.073742,-15.062462,-15.052712,-15.056492,-15.042532,-15.047452,-15.026812,-15.014902,-15.000202,-15.004772,-14.998582,-15.001492,-14.992512,-14.999932,-15.007052,-14.999442,-15.013852,-15.021652,-14.998582,-15.025102,-15.032552,-14.991422,-15.005782,-15.008882,-15.000892,-15.002632,-14.986812,-15.005873,-14.996303,-15.003353,-14.995933,-14.999193,-14.978823,-14.976633,-14.961642,-14.965993,-14.959593,-14.976143,-14.978403,-14.965523,-14.945913,-14.943753,-14.942323,-14.965343,-14.960593,-14.968933,-14.963673,-14.970493,-14.969813,-14.947173,-14.951833,-14.942803,-14.948583,-14.929273,-14.924003,-14.931573,-14.919133,-14.923253,-14.913953,-14.926583,-14.899833,-14.933283,-14.928732,-14.937972,-14.920222,-14.903582,-14.898192,-14.908702,-14.891202,-14.900052,-14.897002,-14.887622,-14.881312,-14.881492,-14.869632,-14.875282,-14.852972,-14.870092,-14.853712,-14.865422,-14.852522,-14.872263,-14.867573,-14.834542,-14.831702,-14.854463,-14.848003,-14.866613,-14.864883,-14.842863,-14.844073,-14.833333,-14.837353,-14.826953,-14.827563,-14.803773,-14.791023,-14.785133,-14.791203,-14.776193,-14.782683,-14.775383,-14.790513,-14.778803,-14.766543,-14.775103,-14.747673,-14.752173,-14.732123,-14.747033,-14.738673,-14.738372,-14.726913,-14.709853,-14.706542,-14.697972,-14.721712,-14.705712,-14.692252,-14.668662,-14.666872,-14.675232,-14.661182,-14.682222,-14.675562,-14.693082,-14.691002,-14.668482,-14.670652,-14.657782,-14.655222,-14.661332,-14.653672,-14.649942,-14.623222,-14.640212,-14.630754,-14.642792,-14.652992,-14.632812,-14.658452,-14.651462,-14.643842,-14.636682,-14.640832,-14.627512,-14.631122,-14.623082,-14.614362,-14.629695,-14.611132,-14.615552,-14.597692,-14.589492,-14.595092,-14.578602,-14.579582,-14.558232,-14.584412,-14.559242,-14.555772,-14.564732,-14.543852,-14.538972,-14.521583,-14.505743,-14.551771,-14.563561,-14.584062,-14.585501,-14.575771,-14.568241,-14.576161,-14.565111,-14.572811,-14.547181,-14.545631,-14.566631,-14.563941,-14.579181,-14.586431,-14.600511,-14.600781,-14.613791,-14.630582,-14.641492,-14.623762,-14.594601,-14.605291,-14.579181,-14.576061,-14.564451,-14.568031,-14.559241,-14.535531,-14.532192,-14.560332,-14.530434,-14.519234,-14.512984,-14.500245,-14.502753,-14.509164,-14.511893,-14.522282,-14.509891,-14.514799,-14.530709,-14.53496,-14.548409,-14.546101,-14.563911,-14.55654,-14.56593,-14.55828,-14.56264,-14.547679,-14.527829,-14.536559,-14.517499,-14.510638,-14.498308,-14.505729,-14.496718,-14.493659,-14.494019,-14.458782,-14.461622,-14.433523,-14.412914,-14.395855,-14.385715,-14.390425,-14.374955,-14.369935,-14.357856,-14.343566,-14.321836,-14.305357,-14.273786,-14.260127,-14.261647,-14.243746,-14.262376,-14.242996,-14.237326,-14.243676,-14.233576,-14.240246,-14.244856,-14.247506,-14.265886,-14.259596,-14.243426,-14.266816,-14.263116,-14.288186,-14.292425,-14.304065,-14.288635,-14.277455,-14.280985,-14.296635,-14.298465,-14.312235,-14.315156,-14.327676,-14.325386,-14.333646,-14.324545,-14.334116,-14.341815,-14.340977,-14.347627,-14.338767,-14.345807,-14.331757,-14.335537,-14.345197,-14.357267,-14.350957,-14.356727,-14.366966,-14.383836,-14.379206,-14.386005,-14.420364,-14.424744,-14.441673,-14.451981,-14.470029,-14.469369,-14.499406,-14.523458,-14.55672,-14.60205,-14.648196,-14.60922,-14.486577,-14.476989,-14.48474,-14.47224,-14.47971,-14.46776,-14.46642,-14.44532,-14.44432,-14.45167,-14.47908,-14.45669,-14.47498,-14.48092,-14.49759,-14.53591,-14.54277,-14.56402,-14.56806,-14.58509,-14.59168,-14.612131,-14.60626,-14.62333,-14.62309,-14.66159,-14.63982,-14.64581,-14.65092,-14.64609,-14.63971,-14.64265,-14.645013,-14.64297,-14.63317,-14.60925,-14.58281,-14.57649,-14.56442,-14.5521,-14.53724,-14.53061,-14.53873,-14.5235,-14.53129,-14.51923,-14.54574,-14.54046,-14.55499,-14.53417,-14.52503,-14.51948,-14.53672,-14.52964,-14.50871,-14.50395,-14.49436,-14.47222,-14.47055,-14.4578,-14.41138,-14.41953,-14.3933,-14.40257,-14.39637,-14.39977,-14.38779,-14.37761,-14.382,-14.35916,-14.362279,-14.352209,-14.358909,-14.351209,-14.342819,-14.343749,-14.325669,-14.330619,-14.323149,-14.320909,-14.303509,-14.297769,-14.254209,-14.234159,-14.239239,-14.243999,-14.231448,-14.219798,-14.204338,-14.209168,-14.176488,-14.157778,-14.146188,-14.140128,-14.125679,-14.118039,-14.09693,-14.07575,-14.08617,-14.07335,-14.0951,-14.069511,-14.068211,-14.050161,-14.039641,-14.016401,-13.998672,-13.989812,-14.006141,-14.025441,-14.040031,-14.065431,-14.034671,-14.016721,-14.02516,-14.0383,-14.0266,-14.003241,-13.996861,-13.988411,-13.991581,-13.981531,-13.988221,-14.04147,-14.03467,-14.04084,-14.01908,-14.01477,-14.00755,-13.99858,-13.98768,-13.97675,-13.97279,-13.98203,-13.96961,-13.954331,-13.948011,-13.943481,-13.932181,-13.939281,-13.925722,-13.921011,-13.941691,-13.942951,-13.927261,-13.89534,-13.90008,-13.92095,-13.91906,-13.94568,-13.9256,-13.94449,-13.91897,-13.91504,-13.92655,-13.9243,-13.94969,-13.94957,-13.96401,-13.95985,-13.97014,-13.98694,-13.98943,-14.00091,-14.01383,-14.02829,-14.02704,-14.01867,-13.968129,-13.967579,-13.987908,-13.980099,-13.9978,-14.01499,-14.01915,-14.00972,-14.015809,-14.000949,-14.012578,-14.017498,-14.026419,-14.042929,-14.05754,-14.06751,-14.08016,-14.06873,-14.066269,-14.08214,-14.09899,-14.114239,-14.091379,-14.076488,-14.091539,-14.110478,-14.115918,-14.120878,-14.130359,-14.140388,-14.136488,-14.166938,-14.182728,-14.177048,-14.185188,-14.175718,-14.186808,-14.185637,-14.198087,-14.210717,-14.203647,-14.236568,-14.237088,-14.223397,-14.239177,-14.221057,-14.207147,-14.236537,-14.216727,-14.233617,-14.201277,-14.197867,-14.207487,-14.192717,-14.189937,-14.177307,-14.158197,-14.140977,-14.154747,-14.138817,-14.138837,-14.119016,-14.097326,-14.098007,-14.058816,-14.050036,-14.045167,-14.051776,-14.037886,-14.014916,-14.012066,-13.982726,-14.002306,-14.005216,-13.995696,-13.977166,-13.957636,-13.964726,-13.934446,-13.951825,-13.944527,-13.954755,-13.964375,-14.008846,-14.008576,-14.028476,-14.045846,-14.047366,-14.083736,-14.103526,-14.109646,-14.097426,-14.098746,-14.086026,-14.075496,-14.081666,-14.092406,-14.100186,-14.130286,-14.147236,-14.157416,-14.147156,-14.151036,-14.139795,-14.154575,-14.169996,-14.194595,-14.216765,-14.228705,-14.235825,-14.198385,-14.180095,-14.191215,-14.173455,-14.137545,-14.114764,-14.077095,-14.078134,-14.103694,-14.091244,-14.131034,-14.134724,-14.120604,-14.104104,-14.100294,-14.090204,-14.092184,-14.070444,-14.065204,-14.050093,-14.031294,-14.016123,-14.014683,-14.016353,-14.011363,-14.013934,-14.029374,-14.021224,-13.999014,-13.973334,-13.996574,-13.991793,-13.972143,-13.975383,-13.983173,-13.970273,-13.972513,-13.975674,-13.983813,-13.976013,-13.986383,-13.989343,-13.992613,-13.984123,-13.997903,-13.982073,-13.971073,-13.982063,-13.998573,-13.985232,-13.945582,-13.937523,-13.927693,-13.930473,-13.916793,-13.883033,-13.860723,-13.826063,-13.808213,-13.791753,-13.776463,-13.786983,-13.787083,-13.791493,-13.781523,-13.791303,-13.776413,-13.769352,-13.784383,-13.786842,-13.808542,-13.816982,-13.797762,-13.799002,-13.774482,-13.758212,-13.761342,-13.751392,-13.748662,-13.758672,-13.766352,-13.768332,-13.776122,-13.767592,-13.741232,-13.747572,-13.741672,-13.752502,-13.754161,-13.761412,-13.787482,-13.790842,-13.768691,-13.793992,-13.795772,-13.785372,-13.803962,-13.803552,-13.823782,-13.816962,-13.827032,-13.832081,-13.805722,-13.828181,-13.833411,-13.848891,-13.847831,-13.835941,-13.839971,-13.854541,-13.864191,-13.869811,-13.907921,-13.896161,-13.884301,-13.903301,-13.913881,-13.914021,-13.927381,-13.925311,-13.934441,-13.944621,-13.948191,-13.962791,-13.970581,-13.965691,-13.982251,-13.96687,-13.96707,-13.95613,-13.93373,-13.92586,-13.91788,-13.91064,-13.90401,-13.9223,-13.93883,-13.95723,-13.95947,-13.94477,-13.97359,-13.96649,-13.95661,-13.94462,-13.94252,-13.90781,-13.90042,-13.90685,-13.90193,-13.91926,-13.93797,-13.93381,-13.96116,-13.963249,-13.954949,-13.939549,-13.933659,-13.9147,-13.906579,-13.908669,-13.918919,-13.928029,-13.939149,-13.939479,-13.961389,-13.942949,-13.966699,-13.972489,-13.980189,-13.980239,-13.990069,-14.000889,-14.024779,-14.035099,-14.058779,-14.062309,-14.085069,-14.060719,-14.074668,-14.073068,-14.066278,-14.069278,-14.087828,-14.094188,-14.085418,-14.086318,-14.119788,-14.099808,-14.110468,-14.104638,-14.144257,-14.143657,-14.160547,-14.169617,-14.179437,-14.190547,-14.209727,-14.211607,-14.221567,-14.212327,-14.231927,-14.242767,-14.236627,-14.243397,-14.252707,-14.276646,-14.281346,-14.287785,-14.303185,-14.333224,-14.344414,-14.352134,-14.367134,-14.350534,-14.388424,-14.390954,-14.382534,-14.402104,-14.395824,-14.402544,-14.440574,-14.451954,-14.484474,-14.470844,-14.484754,-14.505064,-14.502854,-14.524204,-14.529414,-14.530134,-14.543374,-14.557995,-14.570555,-14.586036,-14.590376,-14.579635,-14.556164,-14.570555,-14.579275,-14.620711,-14.650229,-14.64689,-14.63898,-14.656341,-14.66414,-14.67762,-14.687091,-14.685579,-14.708009,-14.714649,-14.706468,-14.721238,-14.733188,-14.740276,-14.754568,-14.737549,-14.744259,-14.791808,-14.828048,-14.838658,-14.841889,-14.86134,-14.87104,-14.870769,-14.946912,-14.993273,-15.011153,-15.037263,-15.044714,-15.064504,-15.070924,-15.103994,-15.152394,-15.167344,-15.214224,-15.233044,-15.237614,-15.258505,-15.281025,-15.301185,-15.288255,-15.292772,-15.312265,-15.335325,-15.366225,-15.390305,-15.433896,-15.479496,-15.494326,-15.514146,-15.518106,-15.501776,-15.492076,-15.467166,-15.427996,-15.375356,-15.291725,-15.260055,-15.250185,-15.234624,-15.209634,-15.183684,-15.228784,-15.306325,-15.316375,-15.345915,-15.390565,-15.431045,-15.459855,-15.487814,-15.505114,-15.501284,-15.501044,-15.483854,-15.460205,-15.413995,-15.401315,-15.363675,-15.319724,-15.278554,-15.247524,-15.203753,-15.130853,-15.093513,-15.003152,-14.982582,-14.974082,-14.994602,-15.036072,-15.035402,-14.995872,-14.966752,-14.937371,-14.925681,-14.933171,-14.974102,-15.066602,-15.061442,-15.040862,-14.991272,-15.000572,-15.032072,-14.997802,-14.967962,-14.885031,-14.889931,-14.938512,-14.950322,-14.980532,-15.002052,-14.995642,-14.974452,-14.927722,-14.904322,-14.878961,-14.881731,-14.956702,-14.978472,-15.013612,-15.014752,-14.973742,-14.931262,-14.911612,-14.889092,-14.841061,-14.821751,-14.8234,-14.80445,-14.795261,-14.812151,-14.799691,-14.786151,-14.791381,-14.781042,-14.786992,-14.779962,-14.767932,-14.780822,-14.797402,-14.807682,-14.800692,-14.803922,-14.798952,-14.789872,-14.787402,-14.795782,-14.816083,-14.826593,-14.839283,-14.840583,-14.853113,-14.847483,-14.860493,-14.851453,-14.860273,-14.856453,-14.866523,-14.855683,-14.864053,-14.858293,-14.855543,-14.858483,-14.867303,-14.862673,-14.872743,-14.872753,-14.884743,-14.876613,-14.879473,-31.687068,-31.717043,-31.808653,-31.850935,-31.878161,-31.911905,-31.979367,-32.073979,-32.136702,-32.175053,-32.190753,-32.214124,-32.222294,-32.256526,-32.276387,-32.280569,-32.297599,-32.292341,-32.305883,-32.308371,-32.284084,-32.232277,-32.237738,-32.27512,-32.268591,-32.290542,-32.366725,-32.549232,-32.559642,-32.582893,-32.607915,-32.643236,-32.715398,-32.728859,-32.7627,-32.794161,-32.832831,-32.872863,-32.900144,-32.949078,-32.98091,-33.017591,-33.096063,-33.176154,-33.249225,-33.426375,-33.558606,-33.576858,-33.586658,-33.599018,-33.618738,-33.633178,-33.664769,-33.698186,-33.723069,-33.76533,-33.78314,-33.79524,-33.809171,-33.81642,-33.831491,-33.84695,-33.877,-33.887731,-33.906052,-33.927792,-33.940132,-33.942523,-33.922102,-33.906182,-33.893833,-33.895893,-33.918783,-33.934673,-33.953684,-33.961144,-33.979874,-33.975864,-33.997484,-33.988924,-34.001854,-34.016635,-34.010635,-34.008405,-33.989535,-33.976295,-33.968564,-33.945934,-33.917684,-33.911514,-33.904374,-33.871534,-33.856644,-33.870814,-33.885514,-33.887415,-33.902315,-33.890045,-33.886105,-33.909975,-33.889385,-33.877735,-33.881275,-33.895826,-33.888616,-33.889316,-33.897436,-33.892836,-33.902436,-33.913366,-33.909656,-33.916316,-33.932886,-33.937277,-33.945177,-33.955217,-33.958037,-33.961417,-33.948337,-33.944847,-33.936617,-33.935267,-33.953417,-33.936507,-33.938987,-33.919227,-33.913517,-33.921837,-33.933118,-33.928908,-33.959478,-33.968148,-33.989818,-34.000749,-33.995879,-34.004599,-33.994139,-33.988009,-34.008729,-34.000759,-34.000309,-34.008499,-34.008159,-34.017189,-34.011419,-34.002439,-34.013559,-34.006599,-34.017199,-34.000369,-34.002839,-33.993929,-33.992519,-33.980029,-33.902798,-33.844979,-33.829299,-33.829229,-33.839139,-33.833489,-33.838259,-33.863519,-33.87258,-33.867508,-33.878999,-33.876839,-33.881959,-33.890649,-33.888879,-33.909049,-33.885968,-33.886908,-33.86121,-33.863118,-33.874485,-33.898179,-33.887368,-33.86931,-33.82799,-33.825729,-33.839601,-33.822859,-33.828358,-33.82008,-33.830231,-33.815443,-33.82025,-33.830252,-33.821575,-33.825045,-33.840199,-33.842241,-33.850711,-33.844581,-33.877608,-33.867086,-33.848509,-33.851131,-33.8623,-33.860947,-33.872749,-33.862264,-33.870538,-33.861448,-33.85626,-33.865697,-33.873364,-33.886397,-33.89265,-33.885942,-33.893222,-33.885044,-33.891729,-33.886246,-33.903171,-33.920466,-33.926413,-33.935412,-33.953202,-33.956781,-33.966734,-33.963548,-33.971882,-33.942267,-33.932406,-33.934825,-33.954487,-33.923368,-33.936773,-33.935898,-33.954596,-33.95607,-33.977887,-33.968332,-33.969836,-33.983476,-34.005408,-34.026733,-34.040828,-34.060742,-34.061702,-34.081399,-34.087697,-34.102267,-34.11263,-34.134587,-34.160146,-34.170846,-34.221382,-34.288015,-34.279528,-34.289075,-34.295256,-34.288846,-34.295244,-34.29035,-34.330005,-34.359128,-34.364261,-34.382834,-34.376625,-34.387181,-34.389647,-34.411473,-34.40216,-34.393046,-34.375228,-34.378806,-34.366471,-34.373289,-34.386873,-34.395823,-34.419446,-34.426487,-34.440185,-34.4525,-34.458921,-34.459595,-34.485365,-34.474705,-34.462483,-34.446224,-34.45198,-34.469061,-34.476825,-34.490228,-34.493436,-34.513085,-34.515537,-34.523533,-34.515404,-34.51887,-34.5346,-34.531332,-34.516177,-34.497961,-34.485889,-34.494425,-34.494511,-34.47012,-34.458813,-34.463512,-34.451277,-34.462878,-34.47644,-34.488036,-34.496859,-34.503178,-34.501178,-34.509473,-34.545573,-34.573564,-34.593669,-34.609001,-34.622448,-34.638323,-34.656893,-34.654836,-34.667801,-34.691221,-34.6866,-34.705715,-34.703689,-34.717451,-34.760757,-34.823854,-34.876645,-34.881459,-34.898744,-34.905161,-34.916704,-34.915,-34.907659,-34.902794,-34.90269,-34.898061,-34.891437,-34.904264,-34.903639,-34.911858,-34.908552,-34.918009,-34.919858,-34.93499,-34.943949,-34.940093,-34.967746,-34.972948,-34.967373,-34.978845,-34.989093,-35.0035,-35.009216,-35.023122,-35.024623,-35.01349,-35.013817,-34.995229,-34.985902,-34.993908,-35.020426,-35.020806,-35.010009,-35.01313,-35.001889,-34.990929,-34.960262,-34.951961,-34.94365,-34.980004,-34.985854,-34.998172,-35.016578,-35.035785,-35.026856,-35.044897,-35.056429,-35.05721,-35.077541,-35.084445,-35.072885,-35.062451,-35.053563,-35.04087,-35.051111,-35.059312,-35.075488,-35.091664,-35.096385,-35.087523,-35.107929,-35.098825,-35.098641,-35.104098,-35.114578,-35.128275,-35.114699,-35.121839,-35.11468,-35.123447,-35.110087,-35.109255,-35.08732,-35.054515,-35.044846,-35.051865,-35.043346,-35.062122,-35.083771,-35.088609,-35.112842,-35.125584,-35.134481,-35.127747,-35.133337,-35.115308,-35.082535,-35.074613,-35.083117,-35.08897,-35.073569,-35.031978,-35.01957,-35.022812,-35.005152,-34.998141,-35.008141,-35.021619,-35.020544,-35.010066,-35.006501,-34.993528,-34.975857,-34.966957,-34.986071,-34.973502,-34.969487,-34.99305,-34.987004,-34.993712,-35.004901,-35.017387,-35.034639,-35.043897,-35.021075,-35.029324,-35.017104,-35.026958,-35.04477,-35.047796,-35.06148,-35.032434,-35.031838,-35.038305,-35.028717,-35.025066,-35.035512,-35.019364,-35.034983,-35.064349,-35.047809,-35.048489,-35.056622,-35.049388,-35.04029,-35.043292,-35.025767,-35.014721,-35.022506,-35.030423,-35.037401,-35.041398,-35.028956,-35.051438,-35.047159,-35.060835,-35.046301,-35.033281,-35.033018,-35.024375,-35.004438,-35.002217,-35.015451,-35.016156,-34.995666,-34.948639,-34.934423,-34.899747,-34.879922,-34.861078,-34.844361,-34.848358,-34.836755,-34.842218,-34.830896,-34.812392,-34.7622,-34.743911,-34.720824,-34.538714,-34.480925,-34.422088,-34.415108,-34.423087,-34.414241,-34.396852,-34.38174,-34.342289,-34.316212,-34.306793,-34.321749,-34.301376,-34.277636,-34.279554,-34.273688,-34.265659,-34.27519,-34.294769,-34.289482,-34.29862,-34.298014,-34.32284,-34.322976,-34.356796,-34.369036,-34.368932,-34.376086,-34.364311,-34.355632,-34.340947,-34.275425,-34.270426,-34.259112,-34.253029,-34.237263,-34.222803,-34.198194,-34.139158,-34.098468,-34.081449,-34.068884,-34.015397,-33.961428,-33.953541,-33.932673,-33.864183,-33.863803,-33.848482,-33.794171,-33.698053,-33.696245,-33.669383,-33.656495,-33.634152,-33.561071,-33.556435,-33.530913,-33.54389,-33.558402,-33.568289,-33.586192,-33.605905,-33.623884,-33.65104,-33.654816,-33.639391,-33.608303,-33.453763,-33.409616,-33.30876,-33.300987,-33.312083,-33.306299,-33.31873,-33.322086,-33.317936,-33.306926,-33.275255,-33.108628,-32.998787,-32.833887,-32.666719,-32.599548,-32.56231,-32.520285,-32.520568,-32.557609,-32.575175,-32.586427,-32.593901,-32.608198,-32.618505,-32.672297,-32.700305,-32.728078,-32.750622,-32.754281,-32.767689,-32.78772,-32.772867,-32.781745,-32.753347,-32.741358,-32.728879,-32.690617,-32.68291,-32.653378,-32.634585,-32.615729,-32.616449,-32.643751,-32.63188,-32.646339,-32.6359,-32.627021,-32.624448,-32.617785,-32.596343,-32.59077,-32.581562,-32.564816,-32.564406,-32.527227,-32.525898,-32.523097,-32.521401,-32.519919,-32.501939,-32.43962,-32.40349,-32.370174,-32.362418,-32.333568,-32.310271,-32.305276,-32.282413,-32.265981,-32.275911,-32.269668,-32.250033,-32.223666,-32.193807,-32.140146,-32.134952,-32.129549,-32.109293,-32.064983,-32.070524,-32.062433,-32.063556,-32.05698,-32.055678,-32.040541,-32.026658,-32.028549,-32.010957,-32.022324,-32.029068,-32.02126,-32.006402,-32.001719,-32.045816,-32.037752,-32.031126,-32.031184,-31.965227,-31.974657,-31.969067,-31.962323,-31.940556,-31.953675,-31.951167,-31.94427,-31.935993,-31.931023,-31.920401,-31.923068,-31.908432,-31.895333,-31.893722,-31.895192,-31.911327,-31.922417,-31.91977,-31.92998,-31.934846,-31.95032,-31.951452,-31.940933,-31.938378,-31.966952,-31.958692,-31.963201,-31.976327,-31.987108,-32.002921,-32.004937,-31.991033,-31.989209,-32.009255,-32.018867,-32.025531,-32.038878,-32.054056,-32.022301,-31.848348,-31.827846,-31.823784,-31.824089,-31.823462,-31.806066,-31.765771,-31.653709,-31.565635,-31.496324,-31.40829,-31.277796,-31.180369,-31.121401,-31.027856,-31.010648,-30.973147,-30.832686,-30.823381,-30.82495,-30.771888,-30.601752,-30.591548,-30.578365,-30.548793,-30.517769,-30.510248,-30.478059,-30.424339,-30.337814,-30.317383,-30.291215,-30.273825,-30.23742,-30.231289,-30.223438,-30.183963,-30.182588,-30.159243,-30.132213,-30.079087,-30.072159,-30.054523,-30.048851,-30.007584,-29.973929,-29.945078,-29.911024,-29.845405,-29.808755,-29.770488,-29.683704,-29.55739,-29.513595,-29.493548,-29.397405,-29.352185,-29.312732,-29.277415,-29.270183,-29.255486,-29.116741,-29.066018,-28.87771,-28.843587,-28.830535,-28.795347,-28.784586,-28.77082,-28.774909,-28.762725,-28.719306,-28.686676,-28.665159,-28.611563,-28.494488,-28.41026,-28.407306,-28.410371,-28.394242,-28.335375,-28.267219,-28.233061,-28.187246,-28.126849,-28.110972,-27.972384,-27.850373,-27.772902,-27.733461,-27.708541,-27.708291,-27.68031,-27.67465,-27.65888,-27.6681,-27.68762,-27.706981,-27.503189,-27.230748,-26.929048,-26.671426,-26.400195,-26.387455,-26.363865,-26.342435,-26.294014,-26.233494,-26.151674,-26.143564,-26.173983,-26.191223,-26.241773,-26.221593,-26.182663,-26.173203,-26.125722,-26.085442,-26.076302,-26.047761,-26.040081,-26.015961,-26.126202,-26.204832,-26.241713,-26.311444,-26.318994,-26.329154,-26.337274,-26.347434,-26.330974,-26.354104,-26.373504,-26.383654,-26.399225,-26.398774,-26.387494,-26.402274,-26.39303]},{&#34;lng&#34;:[113.39456,113.399893,113.397963,113.39456],&#34;lat&#34;:[-26.393282,-26.418244,-26.395514,-26.393282]},{&#34;lng&#34;:[117.976842,117.981459,117.973842,117.976842],&#34;lat&#34;:[-34.951647,-34.940024,-34.938553,-34.951647]},{&#34;lng&#34;:[125.035068,125.039513,125.044273,125.035068],&#34;lat&#34;:[-15.518022,-15.521804,-15.518854,-15.518022]},{&#34;lng&#34;:[121.794599,121.788124,121.798334,121.794599],&#34;lat&#34;:[-18.520144,-18.537738,-18.529968,-18.520144]},{&#34;lng&#34;:[118.850525,118.854834,118.860274,118.850525],&#34;lat&#34;:[-20.288689,-20.290648,-20.282098,-20.288689]},{&#34;lng&#34;:[117.549725,117.542282,117.547552,117.555702,117.548262,117.549725],&#34;lat&#34;:[-20.718291,-20.736201,-20.728181,-20.730841,-20.725691,-20.718291]},{&#34;lng&#34;:[117.175305,117.173282,117.171982,117.167292,117.168002,117.183842,117.175562,117.175305],&#34;lat&#34;:[-20.666749,-20.673993,-20.654672,-20.657382,-20.682233,-20.672712,-20.673882,-20.666749]},{&#34;lng&#34;:[116.986246,116.986892,116.987201,116.986246],&#34;lat&#34;:[-20.67194,-20.678945,-20.672225,-20.67194]},{&#34;lng&#34;:[116.675721,116.684754,116.685855,116.675721],&#34;lat&#34;:[-20.732565,-20.750459,-20.737179,-20.732565]},{&#34;lng&#34;:[116.652363,116.648021,116.657564,116.652363],&#34;lat&#34;:[-20.735693,-20.744457,-20.740319,-20.735693]},{&#34;lng&#34;:[116.64762,116.647024,116.653634,116.64762],&#34;lat&#34;:[-20.745267,-20.746469,-20.749079,-20.745267]},{&#34;lng&#34;:[116.635949,116.629764,116.639924,116.635949],&#34;lat&#34;:[-20.741603,-20.75117,-20.753219,-20.741603]},{&#34;lng&#34;:[116.467914,116.47438,116.48105,116.467914],&#34;lat&#34;:[-20.827356,-20.830951,-20.826031,-20.827356]},{&#34;lng&#34;:[116.475066,116.477603,116.485251,116.494862,116.485241,116.477713,116.475066],&#34;lat&#34;:[-20.849566,-20.851601,-20.843561,-20.850981,-20.842201,-20.850701,-20.849566]},{&#34;lng&#34;:[116.105599,116.098903,116.106463,116.105599],&#34;lat&#34;:[-21.038434,-21.051678,-21.039628,-21.038434]},{&#34;lng&#34;:[115.856421,115.852203,115.860393,115.865343,115.857023,115.856421],&#34;lat&#34;:[-21.194944,-21.202932,-21.204192,-21.193362,-21.201022,-21.194944]},{&#34;lng&#34;:[115.837066,115.844386,115.839835,115.837066],&#34;lat&#34;:[-21.252095,-21.252924,-21.243884,-21.252095]},{&#34;lng&#34;:[115.796082,115.796144,115.799054,115.796082],&#34;lat&#34;:[-21.265486,-21.277203,-21.270333,-21.265486]},{&#34;lng&#34;:[115.745603,115.738704,115.748584,115.745603],&#34;lat&#34;:[-21.281369,-21.285483,-21.289433,-21.281369]},{&#34;lng&#34;:[115.330103,115.333837,115.341628,115.330103],&#34;lat&#34;:[-21.587178,-21.59608,-21.59599,-21.587178]},{&#34;lng&#34;:[113.618798,113.621535,113.626274,113.618798],&#34;lat&#34;:[-26.520622,-26.538733,-26.524293,-26.520622]},{&#34;lng&#34;:[115.916775,115.915002,115.911913,115.916775],&#34;lat&#34;:[-21.092912,-21.092741,-21.101581,-21.092912]},{&#34;lng&#34;:[116.54043,116.542108,116.542417,116.54043],&#34;lat&#34;:[-20.766632,-20.778411,-20.766341,-20.766632]},{&#34;lng&#34;:[117.173242,117.165632,117.165392,117.173242],&#34;lat&#34;:[-20.6312,-20.628352,-20.634562,-20.6312]},{&#34;lng&#34;:[117.339756,117.320242,117.332612,117.331982,117.339756],&#34;lat&#34;:[-20.759099,-20.758523,-20.761223,-20.770573,-20.759099]},{&#34;lng&#34;:[122.293413,122.301624,122.303484,122.293413],&#34;lat&#34;:[-17.119248,-17.1209,-17.11242,-17.119248]},{&#34;lng&#34;:[124.461531,124.462486,124.457736,124.461531],&#34;lat&#34;:[-15.798338,-15.784878,-15.782938,-15.798338]},{&#34;lng&#34;:[115.877589,115.883354,115.893076,115.889384,115.877589],&#34;lat&#34;:[-32.027661,-32.02421,-32.020538,-32.017527,-32.027661]}],[{&#34;lng&#34;:[126.565501,126.571232,126.577382,126.565501],&#34;lat&#34;:[-13.944357,-13.940515,-13.953835,-13.944357]}],[{&#34;lng&#34;:[128.473074,128.466514,128.448335,128.445495,128.473074],&#34;lat&#34;:[-14.909232,-14.928312,-14.904182,-14.879882,-14.909232]}],[{&#34;lng&#34;:[128.442715,128.440015,128.428115,128.442715],&#34;lat&#34;:[-14.878632,-14.885962,-14.863211,-14.878632]}],[{&#34;lng&#34;:[128.334215,128.310046,128.301726,128.308476,128.297097,128.294696,128.319876,128.334215],&#34;lat&#34;:[-14.75838,-14.762809,-14.751819,-14.745969,-14.745699,-14.73552,-14.74137,-14.75838]}],[{&#34;lng&#34;:[128.201837,128.193878,128.197088,128.126268,128.114008,128.125237,128.124787,128.152337,128.160857,128.196757,128.201837],&#34;lat&#34;:[-15.140613,-15.166403,-15.193993,-15.156214,-15.121604,-15.095523,-15.040363,-15.051723,-15.092653,-15.125043,-15.140613]}],[{&#34;lng&#34;:[128.113189,128.09905,128.104589,128.113189],&#34;lat&#34;:[-15.171674,-15.195714,-15.165434,-15.171674]}],[{&#34;lng&#34;:[127.874997,127.850857,127.838567,127.852287,127.853527,127.863297,127.873117,127.874997],&#34;lat&#34;:[-14.454995,-14.479504,-14.457404,-14.451034,-14.435674,-14.430414,-14.438604,-14.454995]}],[{&#34;lng&#34;:[127.823297,127.811177,127.805377,127.810847,127.823297],&#34;lat&#34;:[-14.366694,-14.377584,-14.357554,-14.352944,-14.366694]}],[{&#34;lng&#34;:[127.716148,127.702088,127.709898,127.716148],&#34;lat&#34;:[-14.237427,-14.242037,-14.233497,-14.237427]}],[{&#34;lng&#34;:[127.175689,127.15658,127.164319,127.162769,127.175689],&#34;lat&#34;:[-13.90361,-13.8987,-13.89619,-13.88286,-13.90361]}],[{&#34;lng&#34;:[126.882891,126.880651,126.845671,126.820001,126.832251,126.819291,126.819851,126.854921,126.869491,126.866481,126.883291,126.887941,126.882891],&#34;lat&#34;:[-13.990389,-13.976183,-13.963713,-13.966813,-13.961483,-13.960263,-13.953943,-13.957593,-13.967983,-13.955883,-13.973143,-13.986803,-13.990389]}],[{&#34;lng&#34;:[126.882947,126.893852,126.883232,126.882947],&#34;lat&#34;:[-13.990749,-13.98782,-13.992553,-13.990749]}],[{&#34;lng&#34;:[126.897513,126.892161,126.900801,126.897513],&#34;lat&#34;:[-13.986188,-13.981922,-13.984722,-13.986188]}],[{&#34;lng&#34;:[126.824461,126.818571,126.815661,126.824461],&#34;lat&#34;:[-13.945683,-13.949533,-13.941183,-13.945683]}],[{&#34;lng&#34;:[126.700442,126.676642,126.693602,126.700442],&#34;lat&#34;:[-13.943074,-13.961404,-13.931334,-13.943074]}],[{&#34;lng&#34;:[126.634981,126.620552,126.614971,126.625481,126.634981],&#34;lat&#34;:[-13.871325,-13.882635,-13.862425,-13.853265,-13.871325]}],[{&#34;lng&#34;:[126.619282,126.611322,126.617802,126.608682,126.593742,126.559632,126.568182,126.563892,126.545512,126.536152,126.527362,126.513832,126.502832,126.504902,126.522702,126.527332,126.547102,126.575452,126.588052,126.599402,126.619282],&#34;lat&#34;:[-13.890545,-13.900945,-13.908055,-13.913715,-13.898365,-13.903145,-13.896585,-13.891285,-13.893555,-13.907566,-13.901366,-13.906686,-13.886356,-13.869076,-13.866126,-13.873916,-13.871866,-13.887315,-13.885945,-13.897235,-13.890545]}],[{&#34;lng&#34;:[126.608022,126.604452,126.595412,126.600722,126.608022],&#34;lat&#34;:[-13.945115,-13.952905,-13.941965,-13.935855,-13.945115]}],[{&#34;lng&#34;:[126.593125,126.590605,126.577495,126.575684,126.586004,126.593125],&#34;lat&#34;:[-14.215295,-14.222875,-14.217165,-14.197625,-14.200855,-14.215295]}],[{&#34;lng&#34;:[126.586905,126.574985,126.569845,126.574895,126.574715,126.586905],&#34;lat&#34;:[-14.223455,-14.226215,-14.213465,-14.203735,-14.216505,-14.223455]}],[{&#34;lng&#34;:[126.403784,126.394104,126.384284,126.362484,126.376474,126.403784],&#34;lat&#34;:[-13.989066,-14.009166,-14.011456,-13.982636,-13.974616,-13.989066]}],[{&#34;lng&#34;:[126.321075,126.314825,126.299795,126.309624,126.321075],&#34;lat&#34;:[-13.942087,-13.961857,-13.967608,-13.927187,-13.942087]}],[{&#34;lng&#34;:[126.318984,126.314484,126.301534,126.303843,126.318984],&#34;lat&#34;:[-13.886197,-13.894776,-13.883367,-13.866997,-13.886197]}],[{&#34;lng&#34;:[126.317374,126.312164,126.300144,126.303384,126.312514,126.317374],&#34;lat&#34;:[-13.909457,-13.923117,-13.920747,-13.903917,-13.900646,-13.909457]}],[{&#34;lng&#34;:[126.299029,126.285279,126.291609,126.299029],&#34;lat&#34;:[-14.163357,-14.171187,-14.159537,-14.163357]}],[{&#34;lng&#34;:[126.295165,126.283835,126.272154,126.295165],&#34;lat&#34;:[-13.941298,-13.945698,-13.927738,-13.941298]}],[{&#34;lng&#34;:[126.243438,126.236298,126.230478,126.243438],&#34;lat&#34;:[-14.148258,-14.161728,-14.150328,-14.148258]}],[{&#34;lng&#34;:[126.194915,126.164605,126.155925,126.174215,126.189715,126.194915],&#34;lat&#34;:[-13.935049,-13.96359,-13.96054,-13.932659,-13.927369,-13.935049]}],[{&#34;lng&#34;:[126.152473,126.150383,126.145423,126.152473],&#34;lat&#34;:[-13.75244,-13.75967,-13.7486,-13.75244]}],[{&#34;lng&#34;:[126.046801,126.041031,126.023412,126.017662,125.993282,125.998272,125.985082,125.992391,125.986611,126.008991,126.004271,126.018061,126.023491,126.046801],&#34;lat&#34;:[-14.327979,-14.33793,-14.32847,-14.35322,-14.33633,-14.32516,-14.3133,-14.30203,-14.28927,-14.28094,-14.30275,-14.30702,-14.30046,-14.327979]}],[{&#34;lng&#34;:[126.043171,126.036361,126.006511,125.993481,126.01839,126.043171],&#34;lat&#34;:[-14.233439,-14.242379,-14.24932,-14.24369,-14.22524,-14.233439]}],[{&#34;lng&#34;:[126.004694,125.994703,125.982774,125.988004,126.004694],&#34;lat&#34;:[-14.43818,-14.44816,-14.44646,-14.43569,-14.43818]}],[{&#34;lng&#34;:[125.995333,125.983294,125.984294,125.971004,125.982953,125.994543,125.995333],&#34;lat&#34;:[-14.37651,-14.37751,-14.38883,-14.38822,-14.36431,-14.36229,-14.37651]}],[{&#34;lng&#34;:[125.994222,125.976263,125.976392,125.994222],&#34;lat&#34;:[-14.32166,-14.3379,-14.32819,-14.32166]}],[{&#34;lng&#34;:[125.970583,125.960154,125.956544,125.944484,125.924224,125.943004,125.934784,125.949044,125.943153,125.958893,125.952653,125.959372,125.970583],&#34;lat&#34;:[-14.34692,-14.35097,-14.37421,-14.388761,-14.377221,-14.365851,-14.360871,-14.34565,-14.336061,-14.33506,-14.32659,-14.32219,-14.34692]}],[{&#34;lng&#34;:[125.79419,125.78758,125.778,125.79419],&#34;lat&#34;:[-14.160684,-14.171164,-14.157944,-14.160684]}],[{&#34;lng&#34;:[125.773283,125.761373,125.767393,125.773283],&#34;lat&#34;:[-14.326554,-14.323784,-14.319544,-14.326554]}],[{&#34;lng&#34;:[125.756964,125.736515,125.717745,125.718135,125.727185,125.721525,125.727955,125.754125,125.738805,125.749075,125.753845,125.756964],&#34;lat&#34;:[-14.45101,-14.476589,-14.477008,-14.453759,-14.44982,-14.44101,-14.409532,-14.41647,-14.42919,-14.45201,-14.44536,-14.45101]}],[{&#34;lng&#34;:[125.739871,125.730941,125.722521,125.730171,125.739871],&#34;lat&#34;:[-14.183934,-14.192834,-14.182884,-14.174664,-14.183934]}],[{&#34;lng&#34;:[125.720544,125.711384,125.708274,125.720544],&#34;lat&#34;:[-14.351845,-14.355436,-14.347987,-14.351845]}],[{&#34;lng&#34;:[125.70549,125.70189,125.69426,125.69214,125.70438,125.70549],&#34;lat&#34;:[-14.135555,-14.144005,-14.139815,-14.107645,-14.116245,-14.135555]}],[{&#34;lng&#34;:[125.683201,125.677281,125.669431,125.678251,125.683201],&#34;lat&#34;:[-14.168455,-14.176345,-14.165715,-14.157615,-14.168455]}],[{&#34;lng&#34;:[125.681354,125.680644,125.670674,125.669664,125.681354],&#34;lat&#34;:[-14.370387,-14.377946,-14.379616,-14.367766,-14.370387]}],[{&#34;lng&#34;:[125.644138,125.628488,125.625588,125.633808,125.634118,125.644138],&#34;lat&#34;:[-13.946925,-13.961835,-13.931445,-13.932185,-13.946145,-13.946925]}],[{&#34;lng&#34;:[125.584894,125.580004,125.573424,125.579004,125.584894],&#34;lat&#34;:[-14.357516,-14.364495,-14.357146,-14.348696,-14.357516]}],[{&#34;lng&#34;:[125.562656,125.559276,125.523476,125.523526,125.511285,125.517325,125.511425,125.529795,125.538085,125.530305,125.544305,125.538116,125.562656],&#34;lat&#34;:[-14.48625,-14.49425,-14.485014,-14.467294,-14.454954,-14.449893,-14.444453,-14.422604,-14.444303,-14.447553,-14.455833,-14.474552,-14.48625]}],[{&#34;lng&#34;:[125.560821,125.551441,125.554701,125.560821],&#34;lat&#34;:[-14.105266,-14.107607,-14.099607,-14.105266]}],[{&#34;lng&#34;:[125.520985,125.516085,125.500805,125.520985],&#34;lat&#34;:[-14.425064,-14.434874,-14.430424,-14.425064]}],[{&#34;lng&#34;:[125.505796,125.491656,125.503966,125.499546,125.505796],&#34;lat&#34;:[-14.508106,-14.506826,-14.499867,-14.505837,-14.508106]}],[{&#34;lng&#34;:[125.497126,125.473326,125.451116,125.444556,125.474416,125.484076,125.481156,125.488466,125.485086,125.497126],&#34;lat&#34;:[-14.499057,-14.511963,-14.496881,-14.481282,-14.497404,-14.484795,-14.491555,-14.488976,-14.494386,-14.499057]}],[{&#34;lng&#34;:[125.443567,125.433117,125.439187,125.443567],&#34;lat&#34;:[-14.574971,-14.580811,-14.568081,-14.574971]}],[{&#34;lng&#34;:[125.441706,125.438086,125.426266,125.431996,125.441706],&#34;lat&#34;:[-14.53963,-14.54707,-14.544551,-14.531811,-14.53963]}],[{&#34;lng&#34;:[125.435636,125.419127,125.424866,125.435636],&#34;lat&#34;:[-14.55395,-14.564851,-14.548731,-14.55395]}],[{&#34;lng&#34;:[125.414346,125.404597,125.408906,125.414346],&#34;lat&#34;:[-14.539891,-14.541551,-14.535241,-14.539891]}],[{&#34;lng&#34;:[125.411194,125.407465,125.404024,125.411194],&#34;lat&#34;:[-14.336557,-14.344787,-14.334387,-14.336557]}],[{&#34;lng&#34;:[125.367019,125.347169,125.356989,125.367019],&#34;lat&#34;:[-15.078622,-15.083683,-15.072342,-15.078622]}],[{&#34;lng&#34;:[125.366769,125.358039,125.355519,125.366769],&#34;lat&#34;:[-15.010392,-15.029862,-15.014512,-15.010392]}],[{&#34;lng&#34;:[125.345986,125.340726,125.337846,125.345986],&#34;lat&#34;:[-14.493265,-14.504754,-14.498084,-14.493265]}],[{&#34;lng&#34;:[125.330117,125.320707,125.321547,125.330117],&#34;lat&#34;:[-14.553492,-14.556052,-14.550522,-14.553492]}],[{&#34;lng&#34;:[125.320404,125.315524,125.313024,125.320404],&#34;lat&#34;:[-14.267368,-14.272998,-14.261668,-14.267368]}],[{&#34;lng&#34;:[125.310294,125.302704,125.290444,125.293064,125.310294],&#34;lat&#34;:[-14.276588,-14.293157,-14.288927,-14.269748,-14.276588]}],[{&#34;lng&#34;:[125.306299,125.301669,125.299649,125.306299],&#34;lat&#34;:[-15.069983,-15.072823,-15.063573,-15.069983]}],[{&#34;lng&#34;:[125.278637,125.267707,125.254407,125.265887,125.267917,125.278637],&#34;lat&#34;:[-14.581192,-14.587812,-14.577592,-14.577412,-14.563762,-14.581192]}],[{&#34;lng&#34;:[125.273006,125.270596,125.264806,125.248106,125.248596,125.261716,125.273006],&#34;lat&#34;:[-14.478315,-14.483325,-14.470716,-14.472005,-14.464555,-14.461106,-14.478315]}],[{&#34;lng&#34;:[125.271636,125.259176,125.249796,125.256086,125.245306,125.253916,125.271636],&#34;lat&#34;:[-14.414625,-14.428695,-14.428435,-14.418634,-14.418925,-14.411284,-14.414625]}],[{&#34;lng&#34;:[125.25442,125.24699,125.22786,125.23062,125.24335,125.25442],&#34;lat&#34;:[-15.085573,-15.095033,-15.096083,-15.084993,-15.078283,-15.085573]}],[{&#34;lng&#34;:[125.253459,125.247509,125.251199,125.232469,125.228769,125.242279,125.239519,125.245669,125.249309,125.253459],&#34;lat&#34;:[-14.977953,-14.982893,-14.992503,-14.996953,-14.991073,-14.985243,-14.977223,-14.979393,-14.967773,-14.977953]}],[{&#34;lng&#34;:[125.244016,125.237846,125.237566,125.244016],&#34;lat&#34;:[-14.422425,-14.429735,-14.413595,-14.422425]}],[{&#34;lng&#34;:[125.23087,125.22987,125.21659,125.22886,125.21871,125.21287,125.21662,125.19623,125.17508,125.16486,125.17531,125.16991,125.17488,125.16444,125.1445,125.15661,125.1564,125.1666,125.16385,125.17846,125.17651,125.20222,125.23087],&#34;lat&#34;:[-15.070653,-15.084263,-15.097823,-15.099573,-15.104593,-15.098403,-15.105393,-15.120613,-15.122053,-15.099273,-15.097663,-15.084793,-15.078903,-15.082783,-15.041743,-15.048243,-15.026103,-15.020533,-15.029463,-15.048163,-15.066243,-15.057663,-15.070653]}],[{&#34;lng&#34;:[125.229669,125.223979,125.226209,125.229669],&#34;lat&#34;:[-14.908543,-14.909533,-14.902203,-14.908543]}],[{&#34;lng&#34;:[125.229005,125.211565,125.220835,125.229005],&#34;lat&#34;:[-14.300197,-14.314797,-14.286498,-14.300197]}],[{&#34;lng&#34;:[125.216127,125.207657,125.211747,125.208927,125.201507,125.201067,125.194538,125.184238,125.180488,125.187178,125.199618,125.204308,125.197318,125.208578,125.196098,125.207818,125.210428,125.214278,125.199798,125.197598,125.185268,125.180868,125.167358,125.154988,125.147568,125.152118,125.135078,125.136108,125.130158,125.112678,125.108088,125.092618,125.100998,125.094768,125.094218,125.102508,125.096118,125.107438,125.110858,125.120078,125.132168,125.138838,125.134088,125.142898,125.151588,125.134418,125.141498,125.144128,125.143858,125.149658,125.153148,125.146658,125.149587,125.140768,125.142218,125.132618,125.131648,125.117638,125.118047,125.141107,125.160467,125.151167,125.162737,125.165357,125.184986,125.180127,125.190257,125.207817,125.204747,125.208137,125.216127],&#34;lat&#34;:[-14.495703,-14.496563,-14.517362,-14.526492,-14.525562,-14.547802,-14.556352,-14.551122,-14.559682,-14.569532,-14.562472,-14.576152,-14.583462,-14.583062,-14.590252,-14.597172,-14.591432,-14.607242,-14.612882,-14.601872,-14.609952,-14.634432,-14.619812,-14.636582,-14.635873,-14.655543,-14.651963,-14.628263,-14.637383,-14.627933,-14.642813,-14.625923,-14.619413,-14.612833,-14.567283,-14.568373,-14.546213,-14.556773,-14.545383,-14.557393,-14.551683,-14.564133,-14.576723,-14.564152,-14.565772,-14.545163,-14.538852,-14.546152,-14.530172,-14.533942,-14.526422,-14.525662,-14.519242,-14.522022,-14.515862,-14.529103,-14.512163,-14.507133,-14.493923,-14.472682,-14.471193,-14.452742,-14.456403,-14.439934,-14.459215,-14.483923,-14.473014,-14.487873,-14.499712,-14.492733,-14.495703]}],[{&#34;lng&#34;:[125.208469,125.201039,125.206939,125.200839,125.188339,125.198359,125.197829,125.208469],&#34;lat&#34;:[-14.952713,-14.953033,-14.958813,-14.966503,-14.962123,-14.953013,-14.941163,-14.952713]}],[{&#34;lng&#34;:[125.189519,125.186479,125.179419,125.179029,125.189519],&#34;lat&#34;:[-14.870783,-14.875513,-14.868493,-14.852003,-14.870783]}],[{&#34;lng&#34;:[125.147098,125.135118,125.129448,125.147098],&#34;lat&#34;:[-14.663083,-14.670033,-14.665833,-14.663083]}],[{&#34;lng&#34;:[125.145279,125.144209,125.137499,125.137649,125.145279],&#34;lat&#34;:[-14.761083,-14.767173,-14.761163,-14.748823,-14.761083]}],[{&#34;lng&#34;:[125.134169,125.126939,125.124719,125.134169],&#34;lat&#34;:[-14.752003,-14.760773,-14.755143,-14.752003]}],[{&#34;lng&#34;:[125.053062,125.048582,125.040172,125.053062],&#34;lat&#34;:[-15.309484,-15.323504,-15.315404,-15.309484]}],[{&#34;lng&#34;:[125.036382,125.018162,124.995482,124.992842,125.021452,125.036382],&#34;lat&#34;:[-15.327504,-15.371744,-15.375774,-15.357024,-15.321454,-15.327504]}],[{&#34;lng&#34;:[125.032029,125.02729,125.02047,125.023809,125.017019,125.025799,125.032029],&#34;lat&#34;:[-14.782033,-14.792623,-14.786943,-14.780003,-14.780153,-14.765293,-14.782033]}],[{&#34;lng&#34;:[125.015991,125.011141,125.005661,125.006561,125.015991],&#34;lat&#34;:[-15.206014,-15.213934,-15.209554,-15.203224,-15.206014]}],[{&#34;lng&#34;:[125.014792,125.005743,125.004213,125.014792],&#34;lat&#34;:[-15.430614,-15.439344,-15.433814,-15.430614]}],[{&#34;lng&#34;:[124.999898,124.991718,124.985957,124.984757,124.979556,124.976755,124.990016,124.990436,124.999898],&#34;lat&#34;:[-14.516733,-14.529003,-14.520054,-14.528064,-14.524204,-14.507024,-14.498614,-14.484504,-14.516733]}],[{&#34;lng&#34;:[124.995535,124.975183,124.979514,124.972482,124.984242,124.995535],&#34;lat&#34;:[-14.440154,-14.452354,-14.444024,-14.437215,-14.427335,-14.440154]}],[{&#34;lng&#34;:[124.985909,124.983332,124.97238,124.973269,124.959339,124.973459,124.985909],&#34;lat&#34;:[-14.395155,-14.424285,-14.411575,-14.397575,-14.401686,-14.383465,-14.395155]}],[{&#34;lng&#34;:[124.984961,124.971241,124.952331,124.964711,124.962221,124.955951,124.969101,124.976771,124.984961],&#34;lat&#34;:[-15.055514,-15.086854,-15.098544,-15.082124,-15.066994,-15.070634,-15.042004,-15.040514,-15.055514]}],[{&#34;lng&#34;:[124.984292,124.980372,124.950852,124.953592,124.976482,124.984292],&#34;lat&#34;:[-15.343044,-15.352214,-15.364285,-15.352075,-15.339794,-15.343044]}],[{&#34;lng&#34;:[124.962261,124.944811,124.939781,124.951161,124.943581,124.953181,124.962261],&#34;lat&#34;:[-15.044964,-15.075294,-15.067174,-15.063864,-15.057114,-15.043634,-15.044964]}],[{&#34;lng&#34;:[124.959291,124.939721,124.941421,124.915941,124.911031,124.920521,124.897731,124.905801,124.913811,124.920641,124.901451,124.894051,124.891421,124.878431,124.883361,124.876791,124.885201,124.879171,124.889371,124.890041,124.897721,124.898121,124.921541,124.9301,124.91712,124.91722,124.92661,124.93138,124.93832,124.93503,124.94616,124.930281,124.938981,124.939261,124.948391,124.958631,124.945431,124.948491,124.959291],&#34;lat&#34;:[-15.029154,-15.049214,-15.038134,-15.029174,-15.020374,-15.008934,-15.004474,-14.994274,-14.996124,-14.980224,-14.983184,-14.996354,-14.987874,-15.004645,-14.996865,-14.986335,-14.978474,-14.975615,-14.959404,-14.965394,-14.961824,-14.974814,-14.967274,-14.948324,-14.941364,-14.922394,-14.926624,-14.947994,-14.947924,-14.961104,-14.965454,-15.007664,-15.002554,-15.015534,-15.001394,-15.005434,-15.018914,-15.027414,-15.029154]}],[{&#34;lng&#34;:[124.932023,124.924752,124.931482,124.932023],&#34;lat&#34;:[-14.521355,-14.515106,-14.514016,-14.521355]}],[{&#34;lng&#34;:[124.92724,124.92119,124.92333,124.92724],&#34;lat&#34;:[-14.895464,-14.897014,-14.888554,-14.895464]}],[{&#34;lng&#34;:[124.890821,124.889291,124.876681,124.890821],&#34;lat&#34;:[-14.948914,-14.955814,-14.941944,-14.948914]}],[{&#34;lng&#34;:[124.872741,124.868081,124.865241,124.872741],&#34;lat&#34;:[-14.939674,-14.941905,-14.930375,-14.939674]}],[{&#34;lng&#34;:[124.866401,124.857221,124.854461,124.844441,124.859861,124.866401],&#34;lat&#34;:[-15.023084,-15.021415,-15.031144,-15.024615,-15.011125,-15.023084]}],[{&#34;lng&#34;:[124.863282,124.860803,124.841723,124.854373,124.848993,124.863282],&#34;lat&#34;:[-15.286805,-15.313025,-15.314545,-15.303435,-15.293395,-15.286805]}],[{&#34;lng&#34;:[124.858813,124.848583,124.843673,124.853083,124.858813],&#34;lat&#34;:[-15.342855,-15.349215,-15.342565,-15.337335,-15.342855]}],[{&#34;lng&#34;:[124.857362,124.842192,124.834092,124.838133,124.812313,124.811783,124.790783,124.792683,124.799743,124.809582,124.827892,124.834182,124.830432,124.836362,124.857362],&#34;lat&#34;:[-15.256205,-15.280085,-15.272505,-15.281335,-15.289535,-15.306145,-15.287335,-15.260545,-15.260125,-15.229095,-15.245325,-15.247225,-15.237635,-15.237725,-15.256205]}],[{&#34;lng&#34;:[124.807562,124.801532,124.783483,124.799962,124.805452,124.799412,124.807562],&#34;lat&#34;:[-15.216445,-15.222565,-15.218875,-15.203805,-15.211815,-15.214435,-15.216445]}],[{&#34;lng&#34;:[124.789892,124.774842,124.775712,124.789892],&#34;lat&#34;:[-15.013104,-15.035395,-15.013475,-15.013104]}],[{&#34;lng&#34;:[124.779958,124.773547,124.773406,124.779958],&#34;lat&#34;:[-14.949326,-14.952336,-14.937207,-14.949326]}],[{&#34;lng&#34;:[124.762606,124.745544,124.746664,124.759305,124.762606],&#34;lat&#34;:[-14.954537,-14.951498,-14.939308,-14.942657,-14.954537]}],[{&#34;lng&#34;:[124.748464,124.738864,124.733124,124.748464],&#34;lat&#34;:[-14.910178,-14.941978,-14.911448,-14.910178]}],[{&#34;lng&#34;:[124.732153,124.716284,124.714853,124.732153],&#34;lat&#34;:[-14.860388,-14.872048,-14.859608,-14.860388]}],[{&#34;lng&#34;:[124.720185,124.691966,124.679485,124.696565,124.710845,124.720185],&#34;lat&#34;:[-16.376959,-16.377899,-16.368609,-16.369569,-16.360269,-16.376959]}],[{&#34;lng&#34;:[124.703176,124.691196,124.672976,124.692305,124.703176],&#34;lat&#34;:[-16.356879,-16.364699,-16.356169,-16.349269,-16.356879]}],[{&#34;lng&#34;:[124.694165,124.685694,124.683924,124.694165],&#34;lat&#34;:[-14.953678,-14.950238,-14.937348,-14.953678]}],[{&#34;lng&#34;:[124.671904,124.665364,124.658704,124.671904],&#34;lat&#34;:[-14.945068,-14.949998,-14.937878,-14.945068]}],[{&#34;lng&#34;:[124.655675,124.648465,124.628885,124.655675],&#34;lat&#34;:[-15.788517,-15.799037,-15.804497,-15.788517]}],[{&#34;lng&#34;:[124.654744,124.615564,124.608674,124.566554,124.524634,124.523894,124.517624,124.510744,124.520404,124.513764,124.529464,124.532394,124.536924,124.540424,124.541144,124.547354,124.538894,124.560184,124.557604,124.589804,124.591044,124.572724,124.567464,124.566904,124.554574,124.546884,124.552044,124.545094,124.537314,124.527974,124.528584,124.522184,124.535234,124.515434,124.516154,124.507194,124.504024,124.512384,124.498114,124.503074,124.483514,124.479384,124.486404,124.475814,124.465554,124.484304,124.479164,124.483804,124.466914,124.461124,124.481634,124.492114,124.497304,124.481172,124.49076,124.504931,124.500272,124.517102,124.49995,124.498379,124.513908,124.515209,124.535558,124.520658,124.523437,124.515888,124.516577,124.504378,124.494807,124.511657,124.522357,124.522487,124.527597,124.541867,124.541777,124.551737,124.558047,124.571307,124.558057,124.568317,124.562527,124.569047,124.568717,124.556209,124.56679,124.571429,124.589939,124.589402,124.580033,124.605013,124.626164,124.619514,124.624504,124.654744],&#34;lat&#34;:[-15.397336,-15.427346,-15.420916,-15.444256,-15.448387,-15.435657,-15.441167,-15.434277,-15.431097,-15.426367,-15.413237,-15.425097,-15.416616,-15.420676,-15.433226,-15.425026,-15.412886,-15.400536,-15.391506,-15.381926,-15.369026,-15.378716,-15.371076,-15.382446,-15.388566,-15.383836,-15.364566,-15.359996,-15.375936,-15.357357,-15.375047,-15.378897,-15.383166,-15.380597,-15.392687,-15.397557,-15.380727,-15.365227,-15.369697,-15.377167,-15.385467,-15.398247,-15.403187,-15.405037,-15.403057,-15.380607,-15.376897,-15.361557,-15.372887,-15.355297,-15.345647,-15.358227,-15.348007,-15.335778,-15.321049,-15.326718,-15.336587,-15.333808,-15.319529,-15.307679,-15.306809,-15.313589,-15.303619,-15.305559,-15.29392,-15.30398,-15.29878,-15.30433,-15.29222,-15.27754,-15.27493,-15.28284,-15.27301,-15.2801,-15.26463,-15.26441,-15.2498,-15.245379,-15.25523,-15.26696,-15.28042,-15.28131,-15.29533,-15.314279,-15.320188,-15.313179,-15.312249,-15.336427,-15.342687,-15.341826,-15.374786,-15.381606,-15.393576,-15.397336]}],[{&#34;lng&#34;:[124.649573,124.643892,124.643403,124.649573],&#34;lat&#34;:[-15.167056,-15.174187,-15.162326,-15.167056]}],[{&#34;lng&#34;:[124.649556,124.564936,124.607566,124.649556],&#34;lat&#34;:[-16.349799,-16.34417,-16.341659,-16.349799]}],[{&#34;lng&#34;:[124.640042,124.618059,124.612108,124.620109,124.640042],&#34;lat&#34;:[-15.281537,-15.290728,-15.283619,-15.265298,-15.281537]}],[{&#34;lng&#34;:[124.620814,124.614084,124.605804,124.605944,124.602074,124.594394,124.620814],&#34;lat&#34;:[-15.432536,-15.447686,-15.443066,-15.452226,-15.441376,-15.441616,-15.432536]}],[{&#34;lng&#34;:[124.596685,124.585095,124.577675,124.557336,124.532026,124.545596,124.576155,124.573445,124.580555,124.593165,124.596685],&#34;lat&#34;:[-15.910887,-15.952487,-15.948737,-15.964968,-15.966558,-15.936848,-15.920527,-15.910697,-15.917217,-15.905357,-15.910887]}],[{&#34;lng&#34;:[124.577047,124.570767,124.566897,124.577047],&#34;lat&#34;:[-15.268419,-15.269109,-15.256119,-15.268419]}],[{&#34;lng&#34;:[124.547187,124.532767,124.543927,124.547187],&#34;lat&#34;:[-15.23162,-15.23673,-15.22711,-15.23162]}],[{&#34;lng&#34;:[124.515977,124.509827,124.498257,124.506657,124.515977],&#34;lat&#34;:[-15.21188,-15.22353,-15.21483,-15.20534,-15.21188]}],[{&#34;lng&#34;:[124.500764,124.487065,124.496084,124.500764],&#34;lat&#34;:[-15.456317,-15.464857,-15.451147,-15.456317]}],[{&#34;lng&#34;:[124.495897,124.493707,124.488437,124.495897],&#34;lat&#34;:[-15.20772,-15.21349,-15.20618,-15.20772]}],[{&#34;lng&#34;:[124.485236,124.476876,124.474296,124.485236],&#34;lat&#34;:[-15.967748,-15.981708,-15.975138,-15.967748]}],[{&#34;lng&#34;:[124.4812,124.470119,124.476849,124.4812],&#34;lat&#34;:[-15.318149,-15.313909,-15.310269,-15.318149]}],[{&#34;lng&#34;:[124.476936,124.470426,124.470956,124.476936],&#34;lat&#34;:[-15.987438,-15.993798,-15.983858,-15.987438]}],[{&#34;lng&#34;:[124.470356,124.457266,124.462076,124.470356],&#34;lat&#34;:[-16.004588,-16.029738,-16.000708,-16.004588]}],[{&#34;lng&#34;:[124.470006,124.467356,124.462556,124.455506,124.449006,124.450866,124.460256,124.454396,124.452936,124.460756,124.460936,124.467986,124.464816,124.470006],&#34;lat&#34;:[-15.914168,-15.942188,-15.939618,-15.955468,-15.984638,-15.938658,-15.918608,-15.919778,-15.907808,-15.908108,-15.897038,-15.906048,-15.917468,-15.914168]}],[{&#34;lng&#34;:[124.464676,124.454767,124.435217,124.433257,124.464676],&#34;lat&#34;:[-16.35581,-16.37384,-16.37342,-16.36809,-16.35581]}],[{&#34;lng&#34;:[124.461438,124.434411,124.443309,124.42053,124.427479,124.418749,124.412778,124.40282,124.397559,124.391872,124.383651,124.373792,124.352571,124.342849,124.355578,124.367059,124.369298,124.378138,124.379568,124.382448,124.407118,124.417487,124.441057,124.457167,124.452827,124.442147,124.449857,124.441868,124.461438],&#34;lat&#34;:[-15.30074,-15.321639,-15.30658,-15.315599,-15.30558,-15.30731,-15.292861,-15.31286,-15.30712,-15.332458,-15.320299,-15.329359,-15.322219,-15.30983,-15.292151,-15.30837,-15.288371,-15.286071,-15.294431,-15.287191,-15.285161,-15.26388,-15.24977,-15.26966,-15.27897,-15.27222,-15.2904,-15.29823,-15.30074]}],[{&#34;lng&#34;:[124.455956,124.447816,124.451316,124.455956],&#34;lat&#34;:[-15.860358,-15.844018,-15.834678,-15.860358]}],[{&#34;lng&#34;:[124.455566,124.447916,124.447346,124.442506,124.444796,124.455566],&#34;lat&#34;:[-15.875828,-15.886258,-15.874628,-15.878938,-15.870118,-15.875828]}],[{&#34;lng&#34;:[124.404655,124.400245,124.400175,124.404655],&#34;lat&#34;:[-15.530977,-15.534157,-15.524597,-15.530977]}],[{&#34;lng&#34;:[124.401214,124.389584,124.392113,124.401214],&#34;lat&#34;:[-15.342458,-15.344878,-15.337978,-15.342458]}],[{&#34;lng&#34;:[124.399517,124.392407,124.392567,124.385377,124.384157,124.399517],&#34;lat&#34;:[-15.22758,-15.250541,-15.234161,-15.239281,-15.228321,-15.22758]}],[{&#34;lng&#34;:[124.395807,124.386087,124.389507,124.395807],&#34;lat&#34;:[-16.32091,-16.32233,-16.31647,-16.32091]}],[{&#34;lng&#34;:[124.374885,124.366735,124.372815,124.366655,124.337664,124.352854,124.366854,124.363455,124.374885],&#34;lat&#34;:[-15.390807,-15.391738,-15.397697,-15.398858,-15.376048,-15.360738,-15.366328,-15.386788,-15.390807]}],[{&#34;lng&#34;:[124.367487,124.358647,124.361517,124.367487],&#34;lat&#34;:[-16.365071,-16.375991,-16.364251,-16.365071]}],[{&#34;lng&#34;:[124.358567,124.353247,124.347557,124.355447,124.358567],&#34;lat&#34;:[-16.346941,-16.358101,-16.349601,-16.340941,-16.346941]}],[{&#34;lng&#34;:[124.351247,124.350987,124.341057,124.342037,124.351247],&#34;lat&#34;:[-16.359221,-16.364311,-16.359851,-16.352961,-16.359221]}],[{&#34;lng&#34;:[124.349922,124.339571,124.336132,124.318151,124.303549,124.336511,124.34042,124.349922],&#34;lat&#34;:[-15.330469,-15.332319,-15.344419,-15.35686,-15.351781,-15.32589,-15.3139,-15.330469]}],[{&#34;lng&#34;:[124.286928,124.278358,124.271968,124.263218,124.265798,124.256868,124.241709,124.231809,124.232548,124.266018,124.276368,124.286928],&#34;lat&#34;:[-15.301911,-15.312451,-15.303931,-15.310701,-15.304931,-15.301672,-15.319702,-15.318722,-15.297482,-15.282451,-15.279701,-15.301911]}],[{&#34;lng&#34;:[124.259448,124.251398,124.237928,124.223418,124.216088,124.222048,124.221628,124.245138,124.247428,124.259448],&#34;lat&#34;:[-16.384971,-16.401081,-16.400781,-16.380921,-16.354321,-16.355151,-16.347571,-16.389071,-16.378801,-16.384971]}],[{&#34;lng&#34;:[124.235186,124.201066,124.185326,124.192806,124.190016,124.204916,124.211296,124.233136,124.235186],&#34;lat&#34;:[-15.968719,-15.965,-15.92455,-15.93374,-15.91669,-15.923499,-15.95435,-15.952689,-15.968719]}],[{&#34;lng&#34;:[124.229576,124.219276,124.212446,124.226726,124.229576],&#34;lat&#34;:[-15.938239,-15.943049,-15.918649,-15.927069,-15.938239]}],[{&#34;lng&#34;:[124.229139,124.224849,124.213549,124.227139,124.229139],&#34;lat&#34;:[-15.320422,-15.325302,-15.318032,-15.314222,-15.320422]}],[{&#34;lng&#34;:[124.220096,124.212096,124.211806,124.220096],&#34;lat&#34;:[-15.946089,-15.9496,-15.935249,-15.946089]}],[{&#34;lng&#34;:[124.208339,124.206859,124.188569,124.208339],&#34;lat&#34;:[-15.330552,-15.337762,-15.337282,-15.330552]}],[{&#34;lng&#34;:[124.187286,124.174836,124.176896,124.187286],&#34;lat&#34;:[-15.95343,-15.94838,-15.93798,-15.95343]}],[{&#34;lng&#34;:[124.146301,124.140392,124.130122,124.136721,124.130631,124.146301],&#34;lat&#34;:[-33.843288,-33.862008,-33.862808,-33.852088,-33.841948,-33.843288]}],[{&#34;lng&#34;:[124.144068,124.110018,124.109728,124.097608,124.105018,124.102148,124.114068,124.113078,124.118968,124.124388,124.144068],&#34;lat&#34;:[-16.249811,-16.249942,-16.258302,-16.251112,-16.246072,-16.237122,-16.239792,-16.229162,-16.241292,-16.235562,-16.249811]}],[{&#34;lng&#34;:[124.103397,124.098437,124.097567,124.103397],&#34;lat&#34;:[-16.120371,-16.126902,-16.117621,-16.120371]}],[{&#34;lng&#34;:[124.099247,124.094427,124.089367,124.086357,124.078087,124.072067,124.063217,124.076967,124.058717,124.076517,124.069147,124.099247],&#34;lat&#34;:[-16.094241,-16.114892,-16.099522,-16.116312,-16.110722,-16.119952,-16.114012,-16.103932,-16.105732,-16.093842,-16.081432,-16.094241]}],[{&#34;lng&#34;:[124.098587,124.093747,124.066688,124.066397,124.073767,124.069247,124.074877,124.084397,124.079237,124.088377,124.094597,124.089737,124.098587],&#34;lat&#34;:[-16.158092,-16.164502,-16.153372,-16.144892,-16.144482,-16.138352,-16.135562,-16.146252,-16.131632,-16.145032,-16.142132,-16.151932,-16.158092]}],[{&#34;lng&#34;:[124.094238,124.085888,124.074708,124.094238],&#34;lat&#34;:[-16.230632,-16.237922,-16.230392,-16.230632]}],[{&#34;lng&#34;:[124.084958,124.077888,124.068238,124.080318,124.084958],&#34;lat&#34;:[-16.167502,-16.174802,-16.166382,-16.161482,-16.167502]}],[{&#34;lng&#34;:[124.080308,124.074418,124.060478,124.080308],&#34;lat&#34;:[-16.248622,-16.255032,-16.240252,-16.248622]}],[{&#34;lng&#34;:[123.940059,123.92539,123.90578,123.912019,123.90043,123.897149,123.86151,123.885529,123.876859,123.940059],&#34;lat&#34;:[-16.276973,-16.282063,-16.276383,-16.270663,-16.271833,-16.256993,-16.236163,-16.246063,-16.232433,-16.276973]}],[{&#34;lng&#34;:[123.892899,123.890639,123.883089,123.892899],&#34;lat&#34;:[-16.186323,-16.190943,-16.183423,-16.186323]}],[{&#34;lng&#34;:[123.891156,123.885492,123.885055,123.891156],&#34;lat&#34;:[-34.102025,-34.108128,-34.101146,-34.102025]}],[{&#34;lng&#34;:[123.890659,123.872759,123.877589,123.867479,123.874049,123.881639,123.883989,123.890659],&#34;lat&#34;:[-16.202923,-16.218163,-16.199543,-16.191333,-16.188333,-16.197803,-16.188743,-16.202923]}],[{&#34;lng&#34;:[123.88644,123.87911,123.87905,123.86355,123.8574,123.88644],&#34;lat&#34;:[-16.280093,-16.289763,-16.281963,-16.273593,-16.253203,-16.280093]}],[{&#34;lng&#34;:[123.88518,123.86483,123.87662,123.87283,123.88518],&#34;lat&#34;:[-16.319723,-16.289883,-16.293813,-16.299433,-16.319723]}],[{&#34;lng&#34;:[123.883869,123.881699,123.876259,123.883869],&#34;lat&#34;:[-16.173713,-16.182053,-16.174673,-16.173713]}],[{&#34;lng&#34;:[123.874299,123.862589,123.865439,123.874299],&#34;lat&#34;:[-16.201783,-16.202493,-16.197193,-16.201783]}],[{&#34;lng&#34;:[123.85708,123.84969,123.84766,123.85708],&#34;lat&#34;:[-16.278523,-16.280953,-16.271673,-16.278523]}],[{&#34;lng&#34;:[123.84502,123.84345,123.83762,123.84502],&#34;lat&#34;:[-16.235593,-16.241913,-16.224343,-16.235593]}],[{&#34;lng&#34;:[123.842349,123.838279,123.830889,123.842349],&#34;lat&#34;:[-16.189003,-16.214513,-16.203043,-16.189003]}],[{&#34;lng&#34;:[123.83545,123.83154,123.82596,123.82647,123.81948,123.81795,123.80411,123.81566,123.8105,123.82767,123.82262,123.83133,123.83107,123.83545],&#34;lat&#34;:[-16.246713,-16.252443,-16.248113,-16.257383,-16.253933,-16.269303,-16.245233,-16.249053,-16.236123,-16.239753,-16.227513,-16.235033,-16.223673,-16.246713]}],[{&#34;lng&#34;:[123.81997,123.81871,123.81158,123.81997],&#34;lat&#34;:[-16.208163,-16.218663,-16.204033,-16.208163]}],[{&#34;lng&#34;:[123.813379,123.796979,123.807839,123.813379],&#34;lat&#34;:[-16.199013,-16.187073,-16.188513,-16.199013]}],[{&#34;lng&#34;:[123.808799,123.79137,123.771889,123.777249,123.784209,123.808799],&#34;lat&#34;:[-16.200053,-16.200253,-16.165513,-16.163553,-16.180413,-16.200053]}],[{&#34;lng&#34;:[123.797439,123.782319,123.789029,123.774489,123.778049,123.759169,123.776589,123.766099,123.709179,123.705399,123.682889,123.710649,123.732069,123.776899,123.777599,123.788699,123.790799,123.784449,123.797439],&#34;lat&#34;:[-16.145363,-16.149433,-16.159833,-16.148133,-16.142393,-16.149023,-16.160263,-16.158573,-16.113923,-16.118983,-16.112013,-16.106253,-16.117843,-16.125653,-16.112543,-16.113653,-16.128133,-16.132263,-16.145363]}],[{&#34;lng&#34;:[123.754498,123.765171,123.756501,123.742781,123.754498],&#34;lat&#34;:[-16.263279,-16.269683,-16.271653,-16.261033,-16.263279]}],[{&#34;lng&#34;:[123.702957,123.692467,123.701587,123.691657,123.689218,123.684417,123.690807,123.696647,123.691497,123.702957],&#34;lat&#34;:[-15.940013,-15.952793,-15.959333,-15.957873,-15.967143,-15.958903,-15.935283,-15.936513,-15.926243,-15.940013]}],[{&#34;lng&#34;:[123.698311,123.688241,123.678741,123.698311],&#34;lat&#34;:[-16.355403,-16.356223,-16.344953,-16.355403]}],[{&#34;lng&#34;:[123.683302,123.676103,123.664652,123.677482,123.683302],&#34;lat&#34;:[-17.034349,-17.043359,-17.028399,-17.021669,-17.034349]}],[{&#34;lng&#34;:[123.672201,123.653421,123.668871,123.672201],&#34;lat&#34;:[-16.356203,-16.348023,-16.348833,-16.356203]}],[{&#34;lng&#34;:[123.665822,123.648352,123.622162,123.665822],&#34;lat&#34;:[-16.416291,-16.417952,-16.400552,-16.416291]}],[{&#34;lng&#34;:[123.658141,123.630121,123.648151,123.658141],&#34;lat&#34;:[-16.344673,-16.335963,-16.335663,-16.344673]}],[{&#34;lng&#34;:[123.639979,123.625179,123.585069,123.639979],&#34;lat&#34;:[-16.099334,-16.106674,-16.081454,-16.099334]}],[{&#34;lng&#34;:[123.629252,123.606411,123.600111,123.627811,123.629252],&#34;lat&#34;:[-16.354043,-16.342883,-16.327793,-16.345093,-16.354043]}],[{&#34;lng&#34;:[123.627372,123.620393,123.606902,123.627372],&#34;lat&#34;:[-16.420602,-16.428342,-16.417832,-16.420602]}],[{&#34;lng&#34;:[123.5951,123.58223,123.57604,123.59033,123.5951],&#34;lat&#34;:[-16.160564,-16.160784,-16.146844,-16.144694,-16.160564]}],[{&#34;lng&#34;:[123.58008,123.564521,123.547171,123.58008],&#34;lat&#34;:[-16.241364,-16.241345,-16.219825,-16.241364]}],[{&#34;lng&#34;:[123.576361,123.566721,123.572311,123.576361],&#34;lat&#34;:[-16.263834,-16.268834,-16.258484,-16.263834]}],[{&#34;lng&#34;:[123.572981,123.565961,123.546281,123.564581,123.564251,123.572981],&#34;lat&#34;:[-16.249674,-16.261934,-16.251925,-16.259884,-16.245075,-16.249674]}],[{&#34;lng&#34;:[123.564059,123.550269,123.5571,123.54795,123.55243,123.54388,123.53544,123.53852,123.52563,123.522529,123.537589,123.564059],&#34;lat&#34;:[-16.078104,-16.077084,-16.096584,-16.099894,-16.095974,-16.085394,-16.087574,-16.095744,-16.086694,-16.069034,-16.058314,-16.078104]}],[{&#34;lng&#34;:[123.561677,123.559537,123.533998,123.533847,123.544717,123.543077,123.561677],&#34;lat&#34;:[-34.337796,-34.360006,-34.378066,-34.368826,-34.364646,-34.356416,-34.337796]}],[{&#34;lng&#34;:[123.559471,123.550661,123.552861,123.559471],&#34;lat&#34;:[-16.605066,-16.607476,-16.597216,-16.605066]}],[{&#34;lng&#34;:[123.553747,123.545267,123.538447,123.543667,123.551857,123.553747],&#34;lat&#34;:[-17.264932,-17.290322,-17.242032,-17.232562,-17.241422,-17.264932]}],[{&#34;lng&#34;:[123.551969,123.530189,123.508429,123.517089,123.522089,123.529389,123.521999,123.527059,123.533539,123.540419,123.551969],&#34;lat&#34;:[-16.046464,-16.050444,-16.024304,-16.026814,-16.017254,-16.023654,-16.026864,-16.035044,-16.030014,-16.044094,-16.046464]}],[{&#34;lng&#34;:[123.551777,123.545948,123.542967,123.551777],&#34;lat&#34;:[-17.305272,-17.318472,-17.303652,-17.305272]}],[{&#34;lng&#34;:[123.547791,123.546661,123.525681,123.503391,123.524391,123.539511,123.539231,123.547791],&#34;lat&#34;:[-16.265395,-16.273515,-16.277285,-16.258435,-16.265185,-16.262715,-16.255145,-16.265395]}],[{&#34;lng&#34;:[123.546407,123.540857,123.537257,123.546407],&#34;lat&#34;:[-17.297342,-17.301152,-17.291982,-17.297342]}],[{&#34;lng&#34;:[123.54628,123.54527,123.53928,123.54628],&#34;lat&#34;:[-16.202865,-16.210425,-16.187655,-16.202865]}],[{&#34;lng&#34;:[123.538491,123.522781,123.517852,123.527242,123.529242,123.538491],&#34;lat&#34;:[-16.592456,-16.604856,-16.580845,-16.579575,-16.591466,-16.592456]}],[{&#34;lng&#34;:[123.536827,123.527637,123.523697,123.536827],&#34;lat&#34;:[-34.009693,-34.023343,-34.006883,-34.009693]}],[{&#34;lng&#34;:[123.535228,123.531288,123.528237,123.535228],&#34;lat&#34;:[-17.321252,-17.332192,-17.307092,-17.321252]}],[{&#34;lng&#34;:[123.53494,123.53466,123.52601,123.53494],&#34;lat&#34;:[-16.152795,-16.157885,-16.144695,-16.152795]}],[{&#34;lng&#34;:[123.531241,123.497041,123.491331,123.505771,123.506631,123.489791,123.479781,123.447401,123.447621,123.457311,123.479011,123.473831,123.488041,123.478071,123.490671,123.531241],&#34;lat&#34;:[-16.258465,-16.249675,-16.259115,-16.266375,-16.274295,-16.284765,-16.244095,-16.228875,-16.218245,-16.208955,-16.214355,-16.220145,-16.224835,-16.226895,-16.243285,-16.258465]}],[{&#34;lng&#34;:[123.531181,123.509541,123.480531,123.456542,123.489181,123.508221,123.502321,123.512281,123.531181],&#34;lat&#34;:[-16.609346,-16.640466,-16.633756,-16.617146,-16.615486,-16.631406,-16.623556,-16.611776,-16.609346]}],[{&#34;lng&#34;:[123.526168,123.523859,123.515738,123.526168],&#34;lat&#34;:[-17.344372,-17.358492,-17.335962,-17.344372]}],[{&#34;lng&#34;:[123.52516,123.523141,123.505261,123.511501,123.51938,123.52516],&#34;lat&#34;:[-16.147515,-16.162975,-16.161915,-16.145465,-16.140905,-16.147515]}],[{&#34;lng&#34;:[123.521711,123.515061,123.512521,123.521711],&#34;lat&#34;:[-16.275895,-16.298675,-16.282485,-16.275895]}],[{&#34;lng&#34;:[123.493402,123.478422,123.483812,123.493402],&#34;lat&#34;:[-16.600296,-16.609996,-16.598066,-16.600296]}],[{&#34;lng&#34;:[123.460991,123.428301,123.454281,123.460991],&#34;lat&#34;:[-16.167835,-16.162225,-16.154745,-16.167835]}],[{&#34;lng&#34;:[123.459381,123.442801,123.446951,123.438251,123.434571,123.438761,123.459381],&#34;lat&#34;:[-16.269815,-16.267716,-16.274316,-16.278296,-16.271026,-16.262366,-16.269815]}],[{&#34;lng&#34;:[123.457898,123.456149,123.447099,123.443528,123.457898],&#34;lat&#34;:[-17.335873,-17.342233,-17.338233,-17.324653,-17.335873]}],[{&#34;lng&#34;:[123.455532,123.429332,123.441432,123.455532],&#34;lat&#34;:[-16.530435,-16.524876,-16.521825,-16.530435]}],[{&#34;lng&#34;:[123.446,123.43427,123.44212,123.42449,123.43232,123.43267,123.446],&#34;lat&#34;:[-16.088115,-16.091845,-16.113625,-16.087795,-16.087425,-16.076455,-16.088115]}],[{&#34;lng&#34;:[123.435441,123.422101,123.432481,123.435441],&#34;lat&#34;:[-16.277706,-16.278036,-16.269996,-16.277706]}],[{&#34;lng&#34;:[123.430001,123.421051,123.416521,123.430001],&#34;lat&#34;:[-16.283646,-16.289446,-16.274476,-16.283646]}],[{&#34;lng&#34;:[123.423888,123.403658,123.399528,123.423888],&#34;lat&#34;:[-17.322183,-17.319363,-17.300693,-17.322183]}],[{&#34;lng&#34;:[123.42252,123.41417,123.40807,123.40027,123.38934,123.39536,123.3899,123.40046,123.39351,123.40135,123.40257,123.42252],&#34;lat&#34;:[-16.131755,-16.136875,-16.126415,-16.134485,-16.129065,-16.123915,-16.119465,-16.116735,-16.109665,-16.108835,-16.117825,-16.131755]}],[{&#34;lng&#34;:[123.422142,123.414762,123.418862,123.422142],&#34;lat&#34;:[-16.343036,-16.343536,-16.332376,-16.343036]}],[{&#34;lng&#34;:[123.41937,123.40497,123.40632,123.38924,123.41937],&#34;lat&#34;:[-16.084585,-16.086375,-16.080165,-16.069825,-16.084585]}],[{&#34;lng&#34;:[123.403002,123.399642,123.383322,123.403002],&#34;lat&#34;:[-16.372136,-16.380576,-16.373186,-16.372136]}],[{&#34;lng&#34;:[123.400362,123.387832,123.380082,123.398282,123.400362],&#34;lat&#34;:[-16.527766,-16.527196,-16.517176,-16.513056,-16.527766]}],[{&#34;lng&#34;:[123.391252,123.387972,123.362992,123.348152,123.352412,123.358612,123.364682,123.391252],&#34;lat&#34;:[-16.582626,-16.604636,-16.583596,-16.544906,-16.530136,-16.530986,-16.556026,-16.582626]}],[{&#34;lng&#34;:[123.37639,123.35817,123.36162,123.37639],&#34;lat&#34;:[-16.058285,-16.056755,-16.050045,-16.058285]}],[{&#34;lng&#34;:[123.361102,123.359682,123.344842,123.346332,123.361102],&#34;lat&#34;:[-16.427126,-16.439096,-16.447086,-16.417256,-16.427126]}],[{&#34;lng&#34;:[123.357412,123.335932,123.334682,123.349362,123.357412],&#34;lat&#34;:[-16.361407,-16.358717,-16.332817,-16.339737,-16.361407]}],[{&#34;lng&#34;:[123.350751,123.341751,123.345991,123.335841,123.319851,123.327241,123.322151,123.333871,123.344341,123.350751],&#34;lat&#34;:[-16.162046,-16.161166,-16.169566,-16.166986,-16.152916,-16.150846,-16.145366,-16.154416,-16.149206,-16.162046]}],[{&#34;lng&#34;:[123.327591,123.309431,123.307981,123.327591],&#34;lat&#34;:[-16.139886,-16.142756,-16.136636,-16.139886]}],[{&#34;lng&#34;:[123.318522,123.309302,123.308972,123.318522],&#34;lat&#34;:[-16.322257,-16.320357,-16.307007,-16.322257]}],[{&#34;lng&#34;:[123.316771,123.301891,123.289971,123.316771],&#34;lat&#34;:[-16.134916,-16.137596,-16.125946,-16.134916]}],[{&#34;lng&#34;:[123.31376,123.29492,123.27753,123.31376],&#34;lat&#34;:[-16.033365,-16.045956,-16.043406,-16.033365]}],[{&#34;lng&#34;:[123.305812,123.302082,123.299972,123.305812],&#34;lat&#34;:[-16.306977,-16.316207,-16.306237,-16.306977]}],[{&#34;lng&#34;:[123.297452,123.295872,123.290882,123.297452],&#34;lat&#34;:[-16.300787,-16.306087,-16.301627,-16.300787]}],[{&#34;lng&#34;:[123.225803,123.213343,123.199383,123.213083,123.225803],&#34;lat&#34;:[-16.407458,-16.422588,-16.424708,-16.393198,-16.407458]}],[{&#34;lng&#34;:[123.216378,123.207209,123.205889,123.192979,123.193819,123.180809,123.173159,123.170619,123.161119,123.157479,123.170288,123.201728,123.214638,123.216378],&#34;lat&#34;:[-34.088235,-34.119455,-34.107725,-34.117396,-34.108595,-34.107556,-34.124456,-34.113736,-34.116876,-34.110326,-34.090396,-34.092945,-34.080895,-34.088235]}],[{&#34;lng&#34;:[123.211453,123.192493,123.185353,123.183843,123.176563,123.166583,123.178863,123.168163,123.187163,123.191143,123.205893,123.211453],&#34;lat&#34;:[-16.392728,-16.432768,-16.432468,-16.421258,-16.433508,-16.425149,-16.406059,-16.389109,-16.386368,-16.397038,-16.387128,-16.392728]}],[{&#34;lng&#34;:[123.188488,123.183178,123.178728,123.188488],&#34;lat&#34;:[-34.078365,-34.087155,-34.079815,-34.078365]}],[{&#34;lng&#34;:[123.167983,123.152423,123.159363,123.167983],&#34;lat&#34;:[-16.405039,-16.423529,-16.400659,-16.405039]}],[{&#34;lng&#34;:[123.166635,123.152765,123.153605,123.166635],&#34;lat&#34;:[-15.528529,-15.532459,-15.511449,-15.528529]}],[{&#34;lng&#34;:[123.158473,123.143453,123.152723,123.158473],&#34;lat&#34;:[-16.397139,-16.389409,-16.387129,-16.397139]}],[{&#34;lng&#34;:[123.135823,123.124963,123.124903,123.118043,123.126113,123.135823],&#34;lat&#34;:[-16.400859,-16.408539,-16.423799,-16.409369,-16.398379,-16.400859]}],[{&#34;lng&#34;:[123.129223,123.104123,123.090913,123.107323,123.129223],&#34;lat&#34;:[-16.434929,-16.437479,-16.425919,-16.424289,-16.434929]}],[{&#34;lng&#34;:[122.862299,122.813979,122.843339,122.862299],&#34;lat&#34;:[-33.982616,-34.003036,-33.983116,-33.982616]}],[{&#34;lng&#34;:[122.813069,122.799569,122.798419,122.807739,122.813069],&#34;lat&#34;:[-34.008576,-34.014226,-34.004466,-34.000696,-34.008576]}],[{&#34;lng&#34;:[122.65492,122.65194,122.64734,122.65492],&#34;lat&#34;:[-33.996987,-34.002627,-33.998237,-33.996987]}],[{&#34;lng&#34;:[122.261105,122.252565,122.256164,122.249174,122.246334,122.235684,122.239143,122.231214,122.238464,122.231354,122.261105],&#34;lat&#34;:[-34.12415,-34.127881,-34.142961,-34.145101,-34.161311,-34.158881,-34.126411,-34.126531,-34.11992,-34.10862,-34.12415]}],[{&#34;lng&#34;:[122.151673,122.128523,122.147073,122.151673],&#34;lat&#34;:[-34.033439,-34.029409,-34.027169,-34.033439]}],[{&#34;lng&#34;:[122.126503,122.101863,122.112663,122.092593,122.126503],&#34;lat&#34;:[-16.85257,-16.85507,-16.85845,-16.854631,-16.85257]}],[{&#34;lng&#34;:[122.109584,122.097724,122.103624,122.109584],&#34;lat&#34;:[-34.06435,-34.06462,-34.05904,-34.06435]}],[{&#34;lng&#34;:[122.059017,122.038627,122.050357,122.059017],&#34;lat&#34;:[-34.145891,-34.141572,-34.137912,-34.145891]}],[{&#34;lng&#34;:[122.026873,122.004353,122.002263,122.026873],&#34;lat&#34;:[-33.96346,-33.97092,-33.95806,-33.96346]}],[{&#34;lng&#34;:[122.011284,121.993355,121.982475,122.011284],&#34;lat&#34;:[-34.024181,-34.042161,-34.036721,-34.024181]}],[{&#34;lng&#34;:[122.004794,121.987044,121.995353,122.004794],&#34;lat&#34;:[-33.98727,-33.988881,-33.98046,-33.98727]}],[{&#34;lng&#34;:[121.992693,121.981824,121.976315,121.992693],&#34;lat&#34;:[-33.97312,-33.979161,-33.972832,-33.97312]}],[{&#34;lng&#34;:[121.984127,121.973548,121.975807,121.984127],&#34;lat&#34;:[-34.117533,-34.120163,-34.113843,-34.117533]}],[{&#34;lng&#34;:[121.979725,121.953565,121.957795,121.979725],&#34;lat&#34;:[-34.049472,-34.055912,-34.045022,-34.049472]}],[{&#34;lng&#34;:[121.910222,121.903813,121.896672,121.910222],&#34;lat&#34;:[-33.917719,-33.924559,-33.920019,-33.917719]}],[{&#34;lng&#34;:[121.883822,121.874292,121.868372,121.883822],&#34;lat&#34;:[-33.920179,-33.926889,-33.922459,-33.920179]}],[{&#34;lng&#34;:[121.803543,121.795934,121.788424,121.803543],&#34;lat&#34;:[-33.924811,-33.928591,-33.920549,-33.924811]}],[{&#34;lng&#34;:[121.689596,121.669176,121.669706,121.679996,121.689596],&#34;lat&#34;:[-34.005122,-34.002433,-33.994753,-33.994373,-34.005122]}],[{&#34;lng&#34;:[121.616807,121.605967,121.593107,121.605567,121.607917,121.616807],&#34;lat&#34;:[-34.018844,-34.039344,-34.028943,-34.028834,-34.013664,-34.018844]}],[{&#34;lng&#34;:[119.613867,119.605835,119.598657,119.613867],&#34;lat&#34;:[-34.375885,-34.378036,-34.368456,-34.375885]}],[{&#34;lng&#34;:[118.527655,118.510665,118.499545,118.511755,118.527655],&#34;lat&#34;:[-20.312141,-20.323751,-20.318621,-20.309091,-20.312141]}],[{&#34;lng&#34;:[118.486712,118.477923,118.466729,118.43686,118.441545,118.456806,118.486712],&#34;lat&#34;:[-34.921999,-34.936849,-34.935495,-34.910698,-34.90405,-34.904944,-34.921999]}],[{&#34;lng&#34;:[118.069948,118.044119,118.039712,118.069948],&#34;lat&#34;:[-35.064917,-35.066411,-35.059841,-35.064917]}],[{&#34;lng&#34;:[117.874168,117.862358,117.845238,117.874168],&#34;lat&#34;:[-20.516177,-20.532148,-20.539198,-20.516177]}],[{&#34;lng&#34;:[117.744051,117.734171,117.711371,117.717111,117.733961,117.744051],&#34;lat&#34;:[-20.62725,-20.65371,-20.64298,-20.60756,-20.6266,-20.62725]}],[{&#34;lng&#34;:[117.089441,117.058322,117.037842,117.072522,117.089441],&#34;lat&#34;:[-20.616303,-20.638793,-20.635984,-20.616283,-20.616303]}],[{&#34;lng&#34;:[117.084729,117.075959,117.074439,117.068689,117.081849,117.084729],&#34;lat&#34;:[-20.446752,-20.465602,-20.433752,-20.430922,-20.431522,-20.446752]}],[{&#34;lng&#34;:[116.975219,116.973819,116.960049,116.966129,116.975219],&#34;lat&#34;:[-20.439783,-20.445323,-20.430173,-20.425953,-20.439783]}],[{&#34;lng&#34;:[116.952899,116.929889,116.849338,116.831809,116.838499,116.952899],&#34;lat&#34;:[-20.420053,-20.418394,-20.378805,-20.354075,-20.352006,-20.420053]}],[{&#34;lng&#34;:[116.886349,116.878981,116.86612,116.856071,116.837001,116.816122,116.854348,116.885701,116.873118,116.862718,116.862549,116.870429,116.869809,116.860889,116.867641,116.886349],&#34;lat&#34;:[-20.480536,-20.505426,-20.518596,-20.511616,-20.520006,-20.517866,-20.445166,-20.423638,-20.456576,-20.459796,-20.469736,-20.465736,-20.480076,-20.489386,-20.495326,-20.480536]}],[{&#34;lng&#34;:[116.844128,116.837418,116.843008,116.844128],&#34;lat&#34;:[-20.457306,-20.458476,-20.452006,-20.457306]}],[{&#34;lng&#34;:[116.838758,116.825078,116.798329,116.799148,116.815558,116.823238,116.838758],&#34;lat&#34;:[-20.426296,-20.458326,-20.472587,-20.451467,-20.450246,-20.434626,-20.426296]}],[{&#34;lng&#34;:[116.820204,116.811248,116.823788,116.82118,116.834138,116.812378,116.818088,116.820204],&#34;lat&#34;:[-20.416699,-20.414596,-20.409215,-20.416644,-20.415925,-20.440776,-20.416816,-20.416699]}],[{&#34;lng&#34;:[116.827288,116.799342,116.786862,116.80534,116.802588,116.827288],&#34;lat&#34;:[-20.465986,-20.518307,-20.515777,-20.481466,-20.474646,-20.465986]}],[{&#34;lng&#34;:[116.697464,116.683404,116.675484,116.674544,116.697464],&#34;lat&#34;:[-20.644838,-20.662178,-20.661878,-20.651818,-20.644838]}],[{&#34;lng&#34;:[116.692212,116.690013,116.677213,116.678052,116.692212],&#34;lat&#34;:[-20.505437,-20.518997,-20.523237,-20.503697,-20.505437]}],[{&#34;lng&#34;:[116.680673,116.670073,116.677403,116.667374,116.649934,116.635363,116.649333,116.668153,116.680673],&#34;lat&#34;:[-20.584068,-20.596538,-20.599438,-20.628388,-20.621248,-20.632378,-20.599118,-20.596998,-20.584068]}],[{&#34;lng&#34;:[116.676393,116.635343,116.600103,116.605703,116.597172,116.613433,116.624243,116.643363,116.649633,116.671023,116.676393],&#34;lat&#34;:[-20.548978,-20.607768,-20.612219,-20.604778,-20.602749,-20.593078,-20.572368,-20.560428,-20.567058,-20.545658,-20.548978]}],[{&#34;lng&#34;:[116.671183,116.661653,116.656143,116.671183],&#34;lat&#34;:[-20.518177,-20.526998,-20.517418,-20.518177]}],[{&#34;lng&#34;:[116.662114,116.656864,116.650934,116.662114],&#34;lat&#34;:[-20.675499,-20.680709,-20.672049,-20.675499]}],[{&#34;lng&#34;:[116.650012,116.645513,116.635382,116.650012],&#34;lat&#34;:[-20.548878,-20.558268,-20.555068,-20.548878]}],[{&#34;lng&#34;:[116.635012,116.627712,116.626842,116.635012],&#34;lat&#34;:[-20.458967,-20.460247,-20.453697,-20.458967]}],[{&#34;lng&#34;:[116.619152,116.588972,116.566062,116.609222,116.606662,116.619152],&#34;lat&#34;:[-20.473828,-20.500838,-20.485748,-20.453887,-20.467338,-20.473828]}],[{&#34;lng&#34;:[116.586122,116.585083,116.574182,116.575902,116.562552,116.555012,116.549921,116.560741,116.560861,116.552761,116.530061,116.501421,116.463222,116.485902,116.512871,116.512692,116.523752,116.533102,116.542451,116.552262,116.555462,116.566212,116.573562,116.586122],&#34;lat&#34;:[-20.575539,-20.583829,-20.58625,-20.594709,-20.58653,-20.59006,-20.60476,-20.602939,-20.609339,-20.62089,-20.61545,-20.62154,-20.609611,-20.58514,-20.58266,-20.59463,-20.60114,-20.59816,-20.57295,-20.568389,-20.58543,-20.57601,-20.58309,-20.575539]}],[{&#34;lng&#34;:[116.505132,116.49889,116.49081,116.505132],&#34;lat&#34;:[-35.027943,-35.036317,-35.03327,-35.027943]}],[{&#34;lng&#34;:[116.451572,116.434102,116.448522,116.451572],&#34;lat&#34;:[-20.664521,-20.655321,-20.651661,-20.664521]}],[{&#34;lng&#34;:[116.248732,116.247312,116.242102,116.248732],&#34;lat&#34;:[-20.813223,-20.818873,-20.803763,-20.813223]}],[{&#34;lng&#34;:[116.179151,116.175971,116.174191,116.179151],&#34;lat&#34;:[-20.945226,-20.956346,-20.934856,-20.945226]}],[{&#34;lng&#34;:[116.157821,116.152371,116.147511,116.157821],&#34;lat&#34;:[-20.937576,-20.948326,-20.934226,-20.937576]}],[{&#34;lng&#34;:[115.902311,115.88163,115.88511,115.900861,115.902311],&#34;lat&#34;:[-20.955348,-20.949709,-20.938648,-20.937628,-20.955348]}],[{&#34;lng&#34;:[115.700388,115.686935,115.700088,115.680808,115.660534,115.674637,115.683319,115.700388],&#34;lat&#34;:[-32.22636,-32.232409,-32.244553,-32.244161,-32.156225,-32.165189,-32.205863,-32.22636]}],[{&#34;lng&#34;:[115.694669,115.689953,115.689832,115.694669],&#34;lat&#34;:[-32.305286,-32.309051,-32.301809,-32.305286]}],[{&#34;lng&#34;:[115.585513,115.579164,115.582974,115.577234,115.570543,115.546023,115.559922,115.566963,115.585513],&#34;lat&#34;:[-20.403446,-20.409306,-20.420365,-20.419685,-20.401956,-20.381486,-20.378006,-20.393486,-20.403446]}],[{&#34;lng&#34;:[115.583248,115.565858,115.581458,115.583248],&#34;lat&#34;:[-20.661117,-20.640997,-20.651297,-20.661117]}],[{&#34;lng&#34;:[115.558403,115.551173,115.531653,115.527643,115.507593,115.449783,115.456893,115.477243,115.511343,115.539653,115.545093,115.558403],&#34;lat&#34;:[-32.003453,-32.012473,-32.014954,-32.027634,-32.012964,-32.026185,-32.015734,-32.013764,-31.987614,-31.988183,-32.000753,-32.003453]}],[{&#34;lng&#34;:[115.551205,115.548445,115.543165,115.547655,115.551205],&#34;lat&#34;:[-20.442445,-20.446994,-20.440365,-20.435316,-20.442445]}],[{&#34;lng&#34;:[115.549115,115.543065,115.543944,115.549115],&#34;lat&#34;:[-20.432686,-20.436895,-20.415346,-20.432686]}],[{&#34;lng&#34;:[115.547284,115.542674,115.542614,115.547284],&#34;lat&#34;:[-21.387085,-21.394745,-21.381985,-21.387085]}],[{&#34;lng&#34;:[115.531971,115.534555,115.539175,115.533972,115.541565,115.532206,115.536506,115.530276,115.535906,115.532176,115.525006,115.521147,115.517185,115.530605,115.524495,115.533224,115.531565,115.537824,115.539475,115.533945,115.543775,115.545795,115.540635,115.534689,115.538135,115.525805,115.533224,115.531655,115.524355,115.529116,115.521426,115.531971],&#34;lat&#34;:[-20.478538,-20.466331,-20.470976,-20.477622,-20.474146,-20.486096,-20.491406,-20.490716,-20.492756,-20.504946,-20.493306,-20.506046,-20.441486,-20.440945,-20.437775,-20.413636,-20.430646,-20.422106,-20.433506,-20.445575,-20.443445,-20.454625,-20.467636,-20.465696,-20.449415,-20.447145,-20.451215,-20.457535,-20.454245,-20.470516,-20.483366,-20.478538]}],[{&#34;lng&#34;:[115.526096,115.540844,115.526464,115.526096],&#34;lat&#34;:[-20.410539,-20.402356,-20.411026,-20.410539]}],[{&#34;lng&#34;:[115.539503,115.512763,115.517503,115.532533,115.539503],&#34;lat&#34;:[-20.371706,-20.364835,-20.358425,-20.361036,-20.371706]}],[{&#34;lng&#34;:[115.529804,115.523554,115.526214,115.529804],&#34;lat&#34;:[-20.423036,-20.427775,-20.415766,-20.423036]}],[{&#34;lng&#34;:[115.525987,115.517734,115.520154,115.525987],&#34;lat&#34;:[-20.399742,-20.401076,-20.389006,-20.399742]}],[{&#34;lng&#34;:[115.476919,115.47093,115.47591,115.46919,115.47065,115.45353,115.44758,115.44745,115.42452,115.420731,115.374991,115.365461,115.332781,115.320411,115.333751,115.321031,115.306821,115.32154,115.433089,115.468679,115.458339,115.476919],&#34;lat&#34;:[-20.733548,-20.741349,-20.766069,-20.766989,-20.777599,-20.80562,-20.8022,-20.82889,-20.83807,-20.8637,-20.894811,-20.871111,-20.867751,-20.875101,-20.876111,-20.891581,-20.860441,-20.808271,-20.666898,-20.680238,-20.692378,-20.733548]}],[{&#34;lng&#34;:[115.465286,115.437428,115.420108,115.435077,115.465286],&#34;lat&#34;:[-21.493407,-21.528148,-21.520118,-21.503197,-21.493407]}],[{&#34;lng&#34;:[115.361458,115.351067,115.356037,115.361458],&#34;lat&#34;:[-21.485118,-21.483258,-21.468328,-21.485118]}],[{&#34;lng&#34;:[115.337102,115.324002,115.316621,115.337102],&#34;lat&#34;:[-20.966192,-20.973882,-20.948202,-20.966192]}],[{&#34;lng&#34;:[115.335951,115.316531,115.324671,115.320791,115.335951],&#34;lat&#34;:[-20.905681,-20.938272,-20.919921,-20.895991,-20.905681]}],[{&#34;lng&#34;:[115.248307,115.212386,115.229236,115.248307],&#34;lat&#34;:[-21.568981,-21.599761,-21.569531,-21.568981]}],[{&#34;lng&#34;:[115.024964,115.016784,114.971534,114.995974,115.024964],&#34;lat&#34;:[-21.45828,-21.4652,-21.45938,-21.45083,-21.45828]}],[{&#34;lng&#34;:[114.766554,114.766454,114.757644,114.766554],&#34;lat&#34;:[-21.522192,-21.528852,-21.528192,-21.522192]}],[{&#34;lng&#34;:[114.697414,114.682334,114.687744,114.663904,114.685544,114.697414],&#34;lat&#34;:[-21.625864,-21.630744,-21.620234,-21.592164,-21.604994,-21.625864]}],[{&#34;lng&#34;:[114.582488,114.570718,114.566138,114.579208,114.582488],&#34;lat&#34;:[-21.9909,-22.000991,-21.986731,-21.9839,-21.9909]}],[{&#34;lng&#34;:[114.539751,114.533689,114.500758,114.510348,114.540818,114.532308,114.542278,114.545549,114.539967,114.545549,114.548459,114.540339,114.539751],&#34;lat&#34;:[-22.052841,-22.061613,-22.012392,-21.993762,-22.007431,-22.022862,-22.028422,-22.044452,-22.052529,-22.048512,-22.057203,-22.060033,-22.052841]}],[{&#34;lng&#34;:[114.491409,114.4902,114.484259,114.491409],&#34;lat&#34;:[-22.118596,-22.135416,-22.135296,-22.118596]}],[{&#34;lng&#34;:[114.48995,114.4891,114.48268,114.48995],&#34;lat&#34;:[-22.147037,-22.153137,-22.150307,-22.147037]}],[{&#34;lng&#34;:[114.392474,114.369784,114.358194,114.375333,114.392474],&#34;lat&#34;:[-21.628267,-21.651857,-21.651177,-21.628037,-21.628267]}],[{&#34;lng&#34;:[114.351554,114.334524,114.306014,114.317614,114.345634,114.351554],&#34;lat&#34;:[-21.665957,-21.675208,-21.711648,-21.685588,-21.660427,-21.665957]}],[{&#34;lng&#34;:[114.188829,114.181899,114.181579,114.188829],&#34;lat&#34;:[-22.422416,-22.423746,-22.410655,-22.422416]}],[{&#34;lng&#34;:[114.172859,114.166589,114.1476,114.172859],&#34;lat&#34;:[-22.447197,-22.473808,-22.489439,-22.447197]}],[{&#34;lng&#34;:[114.005403,113.967223,113.957454,113.962024,113.954074,113.966653,114.005403],&#34;lat&#34;:[-28.90065,-28.938511,-28.967091,-28.985081,-28.977151,-28.932831,-28.90065]}],[{&#34;lng&#34;:[113.921806,113.920576,113.907856,113.858346,113.873556,113.853716,113.855826,113.880736,113.909406,113.921806],&#34;lat&#34;:[-25.883864,-25.896384,-25.898194,-25.868224,-25.871034,-25.846234,-25.810704,-25.800773,-25.817443,-25.883864]}],[{&#34;lng&#34;:[113.878802,113.837327,113.857318,113.852708,113.878802],&#34;lat&#34;:[-26.029192,-26.002146,-26.006946,-26.009096,-26.029192]}],[{&#34;lng&#34;:[113.880375,113.882768,113.879468,113.880375],&#34;lat&#34;:[-26.030403,-26.032246,-26.043006,-26.030403]}],[{&#34;lng&#34;:[113.87216,113.871888,113.877828,113.87216],&#34;lat&#34;:[-26.064486,-26.064306,-26.048446,-26.064486]}],[{&#34;lng&#34;:[113.868412,113.858452,113.865251,113.868412],&#34;lat&#34;:[-26.38413,-26.356419,-26.348729,-26.38413]}],[{&#34;lng&#34;:[113.787881,113.784091,113.779911,113.787881],&#34;lat&#34;:[-28.71395,-28.72291,-28.70928,-28.71395]}],[{&#34;lng&#34;:[113.775116,113.769866,113.759405,113.772445,113.775116],&#34;lat&#34;:[-26.543621,-26.549051,-26.535202,-26.531451,-26.543621]}],[{&#34;lng&#34;:[113.74466,113.73015,113.71939,113.71808,113.74466],&#34;lat&#34;:[-28.426357,-28.443847,-28.445377,-28.430017,-28.426357]}],[{&#34;lng&#34;:[113.720956,113.705277,113.716946,113.720956],&#34;lat&#34;:[-26.06162,-26.094241,-26.057681,-26.06162]}],[{&#34;lng&#34;:[113.70848,113.69629,113.6961,113.68579,113.68207,113.70062,113.70848],&#34;lat&#34;:[-28.462717,-28.469778,-28.483998,-28.485128,-28.454007,-28.440297,-28.462717]}],[{&#34;lng&#34;:[113.641118,113.638364,113.634714,113.619694,113.628374,113.628463,113.643794,113.641268,113.653384,113.644383,113.641118],&#34;lat&#34;:[-24.886206,-24.901785,-24.886565,-24.872405,-24.877555,-24.870905,-24.871075,-24.88536,-24.886265,-24.891154,-24.886206]}],[{&#34;lng&#34;:[113.603089,113.598259,113.588319,113.594939,113.603089],&#34;lat&#34;:[-28.297866,-28.307996,-28.300346,-28.289316,-28.297866]}],[{&#34;lng&#34;:[113.340322,113.331982,113.336912,113.340322],&#34;lat&#34;:[-26.322034,-26.316854,-26.309703,-26.322034]}],[{&#34;lng&#34;:[113.2369,113.22765,113.23662,113.22311,113.22908,113.21628,113.20858,113.18085,113.157499,113.135968,113.048587,113.022966,112.967386,112.976935,112.979595,112.942504,112.929794,112.921124,112.928673,112.970672,112.986462,113.022632,113.005593,113.009403,113.038883,113.054074,113.071105,113.063705,113.076785,113.097226,113.114756,113.109726,113.121127,113.156007,113.126497,113.136678,113.151278,113.157568,113.150727,113.168057,113.166998,113.203978,113.202548,113.210899,113.219779,113.219739,113.2369],&#34;lat&#34;:[-26.104322,-26.105323,-26.118873,-26.125513,-26.143573,-26.162503,-26.134853,-26.122613,-26.055893,-26.022343,-25.931073,-25.860412,-25.783252,-25.773151,-25.749471,-25.65795,-25.6432,-25.58819,-25.526509,-25.480388,-25.497298,-25.498978,-25.535998,-25.561188,-25.618339,-25.69549,-25.72041,-25.72827,-25.76862,-25.78915,-25.838651,-25.867971,-25.880431,-25.887821,-25.922432,-25.977432,-25.976932,-25.968952,-25.941282,-25.943272,-25.979822,-26.003292,-26.027322,-26.038172,-26.036722,-26.058382,-26.104322]}],[{&#34;lng&#34;:[113.166282,113.161353,113.137763,113.140994,113.149784,113.133574,113.118985,113.130594,113.124404,113.127983,113.157122,113.166282],&#34;lat&#34;:[-24.78089,-24.821071,-24.871071,-24.921172,-24.935052,-24.952212,-24.986862,-24.916552,-24.887552,-24.844101,-24.7546,-24.78089]}],[{&#34;lng&#34;:[113.128236,113.110716,113.104217,113.091118,113.088818,113.076049,113.069298,113.087368,113.094766,113.087656,113.101645,113.116485,113.118365,113.124565,113.117265,113.128236],&#34;lat&#34;:[-25.060023,-25.106763,-25.174774,-25.187904,-25.237545,-25.273245,-25.231425,-25.192054,-25.121114,-25.069843,-25.032683,-25.016173,-24.992162,-25.012383,-25.031073,-25.060023]}]],[[{&#34;lng&#34;:[148.481887,148.472864,148.437309,148.430872,148.413814,148.40089,148.397954,148.377985,148.350555,148.336511,148.336025,148.309927,148.293766,148.273419,148.274015,148.226774,148.195969,148.164299,148.14249,148.151251,148.140784,148.142035,148.127716,148.085808,148.046262,148.039924,148.045407,148.024284,148.034193,148.017714,147.98867,147.989826,147.983558,147.9921,147.987266,148.001542,148.047993,148.060493,148.081524,148.08971,148.143798,148.145049,148.166134,148.183895,148.191856,148.207251,148.210703,148.225822,148.229441,148.243538,148.266865,148.282245,148.300134,148.31724,148.331004,148.32979,148.363014,148.370948,148.398253,148.410536,148.407079,148.424169,148.45149,148.44851,148.458517,148.464819,148.481887],&#34;lat&#34;:[-40.43493,-40.442869,-40.439959,-40.465255,-40.462027,-40.473003,-40.489456,-40.47656,-40.492835,-40.482745,-40.464909,-40.426733,-40.434247,-40.428985,-40.436305,-40.466084,-40.435512,-40.450325,-40.448104,-40.453808,-40.460478,-40.450014,-40.43969,-40.457369,-40.448934,-40.441365,-40.434479,-40.429927,-40.424505,-40.414137,-40.421157,-40.406039,-40.402756,-40.394906,-40.387096,-40.375999,-40.355496,-40.358765,-40.339214,-40.345745,-40.336171,-40.342982,-40.34791,-40.344876,-40.356219,-40.342389,-40.317825,-40.32188,-40.330725,-40.325385,-40.340703,-40.319638,-40.321763,-40.311564,-40.299877,-40.290762,-40.322235,-40.341445,-40.357759,-40.371926,-40.377997,-40.371445,-40.376693,-40.405524,-40.409354,-40.42709,-40.43493]}],[{&#34;lng&#34;:[148.363358,148.361477,148.351889,148.363358],&#34;lat&#34;:[-39.947817,-39.953567,-39.950722,-39.947817]}],[{&#34;lng&#34;:[144.754462,144.745688,144.695616,144.683698,144.680014,144.661089,144.638921,144.60734,144.625825,144.63284,144.630894,144.612249,144.611738,144.655803,144.649198,144.683765,144.704305,144.706464,144.698764,144.711558,144.713028,144.697187,144.706188,144.69744,144.707424,144.7102,144.703203,144.691266,144.678363,144.697721,144.68633,144.686043,144.725587,144.748798,144.738129,144.736348,144.771754,144.76588,144.779798,144.778436,144.785517,144.804672,144.810597,144.836544,144.840595,144.848902,144.907807,144.924173,144.92797,144.979247,145.001751,145.000608,145.010179,145.016244,145.007589,145.024186,145.015635,145.023561,145.01876,145.037635,145.038842,145.052654,145.070136,145.065285,145.077273,145.090359,145.0857,145.100233,145.096327,145.108542,145.11152,145.118606,145.12138,145.131606,145.164147,145.167158,145.13384,145.112783,145.110431,145.187798,145.25692,145.216107,145.241386,145.258989,145.269441,145.268471,145.250876,145.252619,145.26034,145.275913,145.295972,145.294779,145.308672,145.288926,145.271209,145.266141,145.269072,145.284774,145.280752,145.293602,145.28008,145.312878,145.309232,145.311445,145.321458,145.315594,145.343865,145.391893,145.395375,145.403784,145.446049,145.446687,145.43537,145.448017,145.446352,145.452602,145.44725,145.481613,145.502628,145.511598,145.522323,145.537742,145.546148,145.560472,145.583882,145.595208,145.619738,145.6218,145.653703,145.72934,145.733111,145.724572,145.741271,145.696461,145.768533,145.800869,145.838866,145.829824,145.836074,145.830052,145.841021,145.877089,145.878743,145.921368,145.910543,145.909331,145.924255,145.923258,145.9249,145.958099,145.984517,145.973762,145.985844,146.046556,146.064334,146.077354,146.119656,146.128806,146.167434,146.167658,146.154381,146.15236,146.168523,146.169309,146.185035,146.248447,146.2436,146.249708,146.247845,146.250711,146.250678,146.255419,146.28731,146.33269,146.316034,146.33651,146.35686,146.366804,146.36683,146.348483,146.35619,146.347735,146.364183,146.367967,146.359806,146.371122,146.368173,146.384725,146.388562,146.38635,146.388846,146.39555,146.391798,146.400488,146.400335,146.362334,146.369695,146.369814,146.395613,146.465277,146.519351,146.531894,146.545716,146.541777,146.561994,146.547982,146.540374,146.553638,146.568919,146.572984,146.562407,146.575723,146.561097,146.572988,146.565167,146.57793,146.568773,146.583418,146.585031,146.586218,146.596177,146.593914,146.606795,146.595039,146.599562,146.608866,146.599365,146.600374,146.609228,146.587867,146.59548,146.578055,146.583255,146.578354,146.584768,146.607877,146.595022,146.609586,146.601657,146.566707,146.564451,146.594907,146.633371,146.648005,146.642073,146.647095,146.679081,146.713516,146.707594,146.744522,146.768439,146.798656,146.788144,146.813642,146.806548,146.810304,146.820089,146.800853,146.778275,146.763244,146.770639,146.790177,146.806961,146.817942,146.825045,146.821114,146.837927,146.829891,146.839009,146.844989,146.857579,146.834072,146.860116,146.877814,146.92315,146.928784,146.908609,146.916475,146.915606,146.907239,146.897505,146.933817,146.945779,146.97473,146.967584,146.978294,146.977252,146.962052,146.970107,146.97063,146.987032,147.004923,147.033772,147.036248,147.058436,147.076859,147.068964,147.073927,147.082486,147.111975,147.11575,147.123053,147.11222,147.127813,147.121852,147.143215,147.145933,147.156018,147.154668,147.144418,147.1421,147.12702,147.118043,147.127757,147.079002,147.07528,147.088938,147.075168,147.082595,147.073644,147.046204,147.040017,146.978166,146.978762,147.013751,147.015391,146.976761,146.976587,146.969149,146.945667,146.944659,146.921478,146.911996,146.932453,146.92211,146.937295,146.96542,146.900329,146.87729,146.850922,146.827795,146.833886,146.82732,146.817572,146.832008,146.816849,146.803965,146.786601,146.81235,146.833608,146.874802,146.893736,146.959263,146.947676,146.996952,147.020898,147.031969,147.058662,147.072775,147.116036,147.158998,147.134424,147.154308,147.157889,147.161713,147.176454,147.194406,147.199892,147.22475,147.249447,147.279843,147.284804,147.302561,147.345618,147.360544,147.35543,147.367462,147.384266,147.401375,147.434541,147.397054,147.441482,147.490728,147.525579,147.568087,147.582835,147.575525,147.590706,147.583618,147.598926,147.594815,147.62682,147.669685,147.70646,147.757456,147.751958,147.756472,147.780002,147.822023,147.882618,147.873879,147.904155,147.912854,147.885044,147.887073,147.9329,147.947832,147.943548,147.952995,147.958845,147.958797,147.942752,147.93876,147.958594,147.974703,148.006658,148.019026,148.032537,148.038015,148.032761,148.043411,148.048767,148.037523,148.057849,148.079273,148.140873,148.175264,148.148166,148.121389,148.115275,148.117239,148.108118,148.111816,148.12618,148.130598,148.158045,148.173803,148.17837,148.197595,148.222758,148.219803,148.226812,148.261912,148.257882,148.267382,148.274334,148.301975,148.302958,148.298476,148.323833,148.349459,148.330583,148.301579,148.296827,148.286325,148.293865,148.249497,148.28219,148.298152,148.269515,148.268043,148.275981,148.2849,148.25287,148.271941,148.275504,148.285286,148.279291,148.2935,148.303167,148.312111,148.317434,148.329319,148.338352,148.33049,148.309885,148.307776,148.290613,148.295442,148.281601,148.271225,148.276134,148.268627,148.276992,148.270611,148.263206,148.268695,148.258976,148.255553,148.247498,148.235763,148.27158,148.309474,148.332008,148.339386,148.356003,148.359084,148.327304,148.30134,148.29577,148.288801,148.29374,148.279124,148.279404,148.289102,148.295704,148.26723,148.266176,148.262956,148.260123,148.266477,148.271,148.263539,148.262266,148.253898,148.249273,148.262503,148.26713,148.275621,148.288018,148.299263,148.316653,148.320296,148.293183,148.289053,148.29523,148.284073,148.30477,148.284295,148.264411,148.272561,148.287446,148.310938,148.304019,148.319268,148.32359,148.302524,148.3098,148.297936,148.289377,148.284634,148.297974,148.30961,148.325642,148.333105,148.340522,148.345388,148.334397,148.33809,148.319607,148.324203,148.297735,148.306679,148.315592,148.345442,148.357126,148.342897,148.346237,148.327871,148.320421,148.308013,148.314562,148.293006,148.288021,148.26135,148.251453,148.251433,148.269671,148.291896,148.277914,148.259352,148.272561,148.297604,148.298424,148.283392,148.268426,148.247575,148.236793,148.241674,148.208443,148.213229,148.224647,148.221071,148.197645,148.18697,148.157191,148.159399,148.1746,148.172684,148.21431,148.242997,148.24331,148.214088,148.217545,148.197438,148.173422,148.170989,148.163207,148.144293,148.146047,148.133264,148.142924,148.150709,148.146761,148.154976,148.16285,148.157816,148.165017,148.152399,148.1295,148.114646,148.126791,148.093656,148.093054,148.095293,148.150762,148.167508,148.211365,148.235198,148.123932,148.046666,148.070034,148.085092,148.07129,148.083882,148.013583,148.013167,148.028151,148.014807,148.015615,148.000346,147.977559,147.970437,147.95366,147.958992,147.944744,147.949717,147.944064,147.938966,147.943687,147.93579,147.93113,147.943869,147.954982,147.962057,147.960252,147.985851,147.97578,147.977951,147.988072,147.996058,148.018485,148.015516,148.026889,148.007557,148.008659,147.987756,147.980497,147.998904,147.976956,148.010295,148.010253,148.000487,147.988523,147.994435,147.997042,148.010483,147.99585,147.994823,147.983241,147.968728,147.94897,147.932352,147.925191,147.930358,147.914208,147.923733,147.913896,147.905278,147.909414,147.897307,147.913282,147.91337,147.888446,147.875079,147.878981,147.881807,147.902503,147.91726,147.945502,147.931612,147.957712,147.92975,147.939925,147.957056,147.953484,147.962992,147.962163,147.938763,147.936205,147.947273,147.941925,147.946552,147.900001,147.879125,147.869535,147.884098,147.870476,147.864558,147.855542,147.844038,147.843156,147.835115,147.844716,147.832438,147.827178,147.791443,147.790526,147.772468,147.766796,147.742442,147.728321,147.721994,147.669116,147.668377,147.655799,147.647453,147.640092,147.656291,147.684198,147.70095,147.684131,147.653331,147.605973,147.607277,147.621625,147.59673,147.603343,147.594183,147.585385,147.595193,147.592203,147.56514,147.565486,147.559597,147.550349,147.537323,147.539103,147.529172,147.539722,147.53521,147.52769,147.52085,147.513046,147.487252,147.452924,147.468533,147.454175,147.459073,147.448442,147.445127,147.434631,147.437091,147.459999,147.485406,147.489816,147.477549,147.471699,147.481114,147.491197,147.513154,147.522242,147.578578,147.613374,147.564561,147.529161,147.503627,147.511077,147.494968,147.530507,147.538225,147.541801,147.554079,147.523747,147.5288,147.520732,147.441208,147.418833,147.408385,147.40419,147.415475,147.397036,147.40407,147.391983,147.408787,147.403757,147.417869,147.417537,147.430092,147.452226,147.468801,147.474064,147.468829,147.478482,147.465332,147.445379,147.44606,147.464751,147.476991,147.491424,147.485493,147.479007,147.435127,147.421401,147.40893,147.409231,147.417327,147.404688,147.366546,147.365664,147.352402,147.350539,147.358626,147.350217,147.337784,147.347047,147.333777,147.335053,147.317373,147.319935,147.281622,147.292742,147.284152,147.264677,147.260522,147.266683,147.256084,147.265584,147.262597,147.264674,147.252229,147.256732,147.198991,147.18397,147.179101,147.18598,147.149948,147.139875,147.114552,147.138788,147.154535,147.198323,147.232614,147.253504,147.252635,147.283207,147.258954,147.265856,147.253629,147.262415,147.255703,147.277379,147.298018,147.306722,147.295007,147.30189,147.305266,147.322112,147.313057,147.327849,147.319663,147.336789,147.341196,147.331528,147.339448,147.332239,147.360963,147.35585,147.344532,147.338563,147.328311,147.329554,147.32415,147.344282,147.314057,147.284934,147.270527,147.265438,147.269284,147.27992,147.255547,147.279037,147.301233,147.28529,147.257671,147.271491,147.269388,147.246385,147.26277,147.252761,147.256247,147.241628,147.247989,147.238584,147.248407,147.240921,147.255438,147.260974,147.240448,147.242512,147.219485,147.188996,147.167749,147.142145,147.142102,147.151165,147.143969,147.124126,147.097077,147.100029,147.088927,147.099297,147.091474,147.117825,147.101984,147.105621,147.094445,147.109018,147.093042,147.09641,147.08251,147.086478,147.071807,147.083322,147.063161,147.061925,147.027771,147.010348,146.984409,146.983458,146.994548,146.997206,147.018802,147.021804,147.04093,147.044775,147.029687,146.991347,146.993008,146.97245,146.98069,146.959536,146.949969,146.962154,146.974454,146.964153,146.971896,146.99539,146.990318,147.0017,147.037075,147.064544,147.068004,147.097614,147.100133,147.080573,147.06533,147.045042,147.011916,147.002616,147.00416,146.982438,146.978811,146.985438,147.007713,147.019319,147.032711,147.059306,147.046012,147.016661,147.025445,147.012442,147.026432,147.017624,147.003066,146.986909,146.973022,146.950553,146.947603,146.923638,146.923631,146.920564,146.915635,146.941796,146.946158,146.937105,146.948668,146.959684,146.983224,146.996446,147.001794,146.980777,146.982585,146.972545,146.942028,146.928992,146.943785,146.943704,146.976749,146.977883,146.954158,146.952825,146.921402,146.9241,146.917257,146.903669,146.911372,146.903086,146.910848,146.900596,146.889195,146.87737,146.891543,146.903731,146.887025,146.89194,146.91679,146.923853,146.920965,146.873612,146.870924,146.844807,146.826624,146.83871,146.831278,146.785144,146.780704,146.762359,146.746118,146.723444,146.711246,146.705475,146.686091,146.670225,146.660118,146.652777,146.658246,146.640129,146.644963,146.62366,146.608514,146.610038,146.599361,146.607548,146.575188,146.578282,146.559389,146.548678,146.548896,146.556142,146.551411,146.596074,146.542175,146.531671,146.50874,146.486456,146.474034,146.469323,146.452673,146.405565,146.391538,146.37264,146.369404,146.368715,146.367572,146.344725,146.325709,146.317811,146.290137,146.276438,146.266651,146.272905,146.216007,146.209073,146.224483,146.209782,146.209618,146.193091,146.177565,146.161542,146.159132,146.148004,146.142256,146.147154,146.136493,146.129045,146.110436,146.109879,146.094856,146.09073,146.079451,146.069952,146.046171,146.031119,146.04282,146.027455,146.029154,146.005742,146.018031,146.000932,145.997379,145.971237,145.976372,145.964525,145.948061,145.934257,145.921467,145.930329,145.932098,145.94634,145.953241,145.970756,145.97579,145.968754,145.977466,145.993483,145.983727,145.993652,146.001901,145.993134,145.989245,145.975078,145.986817,146.00672,146.003097,146.068006,146.07783,146.071152,146.083506,146.091597,146.058308,146.089613,146.086187,146.09507,146.101272,146.130541,146.137172,146.126699,146.140057,146.14448,146.143864,146.134626,146.147363,146.156942,146.164367,146.176766,146.155376,146.210264,146.20907,146.223327,146.225431,146.212893,146.226678,146.222831,146.231605,146.217837,146.219224,146.208616,146.189056,146.176365,146.176098,146.168445,146.153352,146.15762,146.141136,146.136408,146.111866,146.091112,146.087437,146.084282,146.071827,146.069806,146.057121,146.065661,146.064467,146.064396,146.053259,146.061233,146.049175,146.058972,146.039043,146.028734,146.00377,145.997197,146.00601,145.983475,145.983105,145.968445,145.957873,145.963553,145.953416,145.97315,145.966548,145.968161,145.979953,145.968897,145.946408,145.93247,145.917305,145.913922,145.924841,145.928463,145.90749,145.897146,145.871797,145.87567,145.862489,145.880696,145.897572,145.901083,145.923948,145.920125,145.926633,145.899177,145.89518,145.878681,145.870537,145.850545,145.84123,145.843549,145.853364,145.850504,145.839212,145.815667,145.820562,145.806481,145.804119,145.811115,145.796684,145.807892,145.789868,145.795265,145.787729,145.768731,145.761563,145.757941,145.733547,145.721643,145.724969,145.736226,145.715424,145.716158,145.708473,145.694264,145.683356,145.673376,145.664951,145.676833,145.669752,145.674848,145.691198,145.68453,145.682228,145.660026,145.647633,145.637775,145.643957,145.609928,145.602935,145.607522,145.599921,145.590637,145.561365,145.494879,145.503499,145.493596,145.498664,145.492197,145.504398,145.492952,145.490462,145.481562,145.487621,145.476049,145.451969,145.436027,145.443736,145.436868,145.420851,145.425995,145.419727,145.426322,145.407195,145.414582,145.382637,145.38059,145.391332,145.388789,145.396699,145.394176,145.383267,145.374018,145.365816,145.36621,145.338303,145.333637,145.327771,145.33578,145.31181,145.290029,145.285383,145.262948,145.262981,145.28083,145.301714,145.295363,145.304261,145.299221,145.304412,145.277783,145.280694,145.267469,145.252826,145.261198,145.235847,145.254044,145.234628,145.24496,145.235868,145.237556,145.23552,145.224319,145.226423,145.215295,145.223181,145.196129,145.194008,145.213811,145.213726,145.20588,145.189167,145.19011,145.173943,145.165516,145.196371,145.199959,145.208754,145.207299,145.224859,145.221007,145.235782,145.237054,145.256062,145.253472,145.289586,145.292655,145.299572,145.317507,145.310036,145.330972,145.337962,145.340304,145.35349,145.393513,145.415589,145.453279,145.44664,145.459181,145.461906,145.473909,145.481796,145.472315,145.480201,145.473209,145.464043,145.473877,145.452654,145.458028,145.491948,145.531057,145.55474,145.60815,145.618204,145.614933,145.616414,145.608294,145.557118,145.534238,145.524527,145.513056,145.534827,145.536235,145.549886,145.54256,145.557614,145.543745,145.530178,145.512366,145.502588,145.519607,145.526736,145.517507,145.49946,145.494117,145.496399,145.490711,145.497868,145.48054,145.489854,145.484933,145.492642,145.480852,145.478337,145.46756,145.463377,145.432466,145.42299,145.399698,145.377435,145.364827,145.360909,145.371811,145.363995,145.372257,145.346049,145.356292,145.372907,145.356296,145.359658,145.3469,145.329134,145.325976,145.333926,145.32306,145.307823,145.30357,145.315747,145.318164,145.293762,145.268149,145.285037,145.283538,145.290158,145.289682,145.268076,145.249216,145.223136,145.249852,145.25957,145.263729,145.249201,145.251857,145.190559,145.202413,145.196877,145.204115,145.19481,145.173969,145.124435,145.109202,145.07146,145.068595,145.056788,145.028205,145.032888,145.010635,145.004506,145.010145,144.994948,144.999131,144.980118,144.985053,144.978577,144.954941,144.938055,144.927021,144.91122,144.926369,144.924912,145.005252,145.050122,145.034811,145.051069,145.050574,145.050935,145.034052,145.004696,144.974744,144.920865,144.908044,144.906663,144.897118,144.905872,144.888303,144.832007,144.839571,144.821311,144.813581,144.792487,144.78528,144.745887,144.789891,144.781861,144.782976,144.77782,144.759486,144.770554,144.738072,144.734202,144.741994,144.719749,144.722619,144.711372,144.716059,144.705924,144.683526,144.690707,144.685899,144.694852,144.672611,144.683137,144.671378,144.664579,144.67654,144.678073,144.65934,144.68122,144.68396,144.695268,144.746155,144.754462],&#34;lat&#34;:[-41.061823,-41.055616,-41.047835,-41.037541,-41.049585,-41.053436,-41.045355,-41.008782,-41.004986,-40.993842,-40.952478,-40.944652,-40.935732,-40.913869,-40.900148,-40.907252,-40.87633,-40.867127,-40.862325,-40.858335,-40.835548,-40.809128,-40.7942,-40.783046,-40.776209,-40.761442,-40.750765,-40.755082,-40.716896,-40.689591,-40.682024,-40.672218,-40.64169,-40.689576,-40.682246,-40.690121,-40.705922,-40.743571,-40.729181,-40.713336,-40.708478,-40.713687,-40.72731,-40.718704,-40.743286,-40.738766,-40.750791,-40.763765,-40.758715,-40.743338,-40.762191,-40.77509,-40.766719,-40.76657,-40.778464,-40.770578,-40.779288,-40.778019,-40.789466,-40.787331,-40.780598,-40.786872,-40.809455,-40.819235,-40.808352,-40.813041,-40.824405,-40.827444,-40.815085,-40.814422,-40.831661,-40.828989,-40.837964,-40.819294,-40.825593,-40.818999,-40.802853,-40.801398,-40.794288,-40.804082,-40.78985,-40.810913,-40.8137,-40.80576,-40.758245,-40.746962,-40.729975,-40.715537,-40.712323,-40.735562,-40.73866,-40.754827,-40.764172,-40.766309,-40.801069,-40.79791,-40.811055,-40.820553,-40.829918,-40.826904,-40.793723,-40.835213,-40.843426,-40.842656,-40.849701,-40.837688,-40.851039,-40.849714,-40.863249,-40.854994,-40.87123,-40.886104,-40.894268,-40.887259,-40.877989,-40.879127,-40.874037,-40.868816,-40.851704,-40.853572,-40.887648,-40.891482,-40.909124,-40.916817,-40.913801,-40.923991,-40.9253,-40.932104,-40.940308,-40.944952,-40.95628,-40.968982,-40.985375,-40.974734,-40.996881,-41.026184,-41.038859,-41.050013,-41.056969,-41.05006,-41.038702,-41.036858,-41.04289,-41.051361,-41.049456,-41.057579,-41.06655,-41.078016,-41.066182,-41.063036,-41.074802,-41.08775,-41.074108,-41.101926,-41.102699,-41.115568,-41.118948,-41.135313,-41.146616,-41.156277,-41.154331,-41.161853,-41.15747,-41.145346,-41.153937,-41.157119,-41.177217,-41.176144,-41.181915,-41.174882,-41.196567,-41.15182,-41.160682,-41.156626,-41.182843,-41.16028,-41.158478,-41.165248,-41.192633,-41.203811,-41.203896,-41.217352,-41.208433,-41.216687,-41.222149,-41.217406,-41.227409,-41.228853,-41.238242,-41.22836,-41.235943,-41.233506,-41.227809,-41.233444,-41.228252,-41.200687,-41.193808,-41.167473,-41.172722,-41.159568,-41.136185,-41.118429,-41.129549,-41.155056,-41.167384,-41.168461,-41.179138,-41.171486,-41.177839,-41.189146,-41.197311,-41.220171,-41.238444,-41.239339,-41.25103,-41.240574,-41.233048,-41.222754,-41.20509,-41.216474,-41.219731,-41.251432,-41.259365,-41.250654,-41.233032,-41.233748,-41.225783,-41.21564,-41.21204,-41.214271,-41.209322,-41.197681,-41.190846,-41.184684,-41.167896,-41.168591,-41.164375,-41.15845,-41.151886,-41.163766,-41.146471,-41.144835,-41.125721,-41.110049,-41.097728,-41.093819,-41.100766,-41.075036,-41.063722,-41.084775,-41.078863,-41.10684,-41.112045,-41.112687,-41.112835,-41.130746,-41.137656,-41.134292,-41.151478,-41.149663,-41.165274,-41.146078,-41.140575,-41.145442,-41.152269,-41.170147,-41.17652,-41.186615,-41.200033,-41.186343,-41.19303,-41.163131,-41.172137,-41.149989,-41.169772,-41.178903,-41.188807,-41.190252,-41.197787,-41.206215,-41.202552,-41.231375,-41.260201,-41.251689,-41.263312,-41.273239,-41.288199,-41.294391,-41.297668,-41.30922,-41.321197,-41.321225,-41.3558,-41.347026,-41.335689,-41.340994,-41.354366,-41.383968,-41.395963,-41.401055,-41.413719,-41.409566,-41.421941,-41.437589,-41.443637,-41.429298,-41.417212,-41.417372,-41.416017,-41.417371,-41.429361,-41.432141,-41.420156,-41.410785,-41.365619,-41.354539,-41.353673,-41.354129,-41.34465,-41.330184,-41.336631,-41.318655,-41.30878,-41.29875,-41.28358,-41.276387,-41.243418,-41.233247,-41.239463,-41.228867,-41.20656,-41.220309,-41.211971,-41.199955,-41.194557,-41.181782,-41.19006,-41.136987,-41.130625,-41.139972,-41.136306,-41.125238,-41.131375,-41.121689,-41.10302,-41.109696,-41.069733,-41.054124,-41.061188,-41.039533,-41.018839,-41.029678,-41.027492,-41.025577,-40.984845,-40.980265,-40.990365,-40.988018,-40.999683,-40.994577,-41.01369,-41.034902,-41.022045,-41.0314,-41.007969,-41.009312,-40.999118,-40.999626,-40.989143,-40.953479,-40.941692,-40.95193,-40.957694,-40.939475,-40.975327,-40.98228,-40.976086,-40.980446,-41.011332,-41.011899,-41.002901,-41.002915,-40.979349,-40.95069,-40.898606,-40.893163,-40.890794,-40.871601,-40.863407,-40.856219,-40.849136,-40.84502,-40.821027,-40.860312,-40.857606,-40.875958,-40.865117,-40.879821,-40.886929,-40.868134,-40.882913,-40.877669,-40.869078,-40.877794,-40.863556,-40.815249,-40.791051,-40.775918,-40.77635,-40.76477,-40.754978,-40.752717,-40.739958,-40.746525,-40.737601,-40.743739,-40.753568,-40.750995,-40.761407,-40.764985,-40.774421,-40.774525,-40.762116,-40.771625,-40.769059,-40.830521,-40.82965,-40.834712,-40.8258,-40.813961,-40.820586,-40.820586,-40.828161,-40.836042,-40.828903,-40.840496,-40.838722,-40.820913,-40.839431,-40.84604,-40.862333,-40.876383,-40.892453,-40.904223,-40.900505,-40.920672,-40.941664,-40.957324,-40.954737,-40.987847,-40.992895,-41.000004,-41.029206,-41.061945,-41.048437,-41.028949,-41.051097,-41.052229,-41.063829,-41.126026,-41.151794,-41.15141,-41.168601,-41.190939,-41.180612,-41.206764,-41.209251,-41.230436,-41.235988,-41.250461,-41.246739,-41.254969,-41.248609,-41.259955,-41.275557,-41.288513,-41.302225,-41.304037,-41.282706,-41.276556,-41.307471,-41.312281,-41.314087,-41.315201,-41.320652,-41.315376,-41.321956,-41.325101,-41.321714,-41.327717,-41.322759,-41.339573,-41.316973,-41.276489,-41.282044,-41.273877,-41.279556,-41.306454,-41.366183,-41.370327,-41.363257,-41.369317,-41.371733,-41.378774,-41.380463,-41.371693,-41.461698,-41.451924,-41.460234,-41.460119,-41.462171,-41.502425,-41.476971,-41.4893,-41.477769,-41.486025,-41.491472,-41.506367,-41.503499,-41.558195,-41.558037,-41.575378,-41.621392,-41.658961,-41.684514,-41.693173,-41.719999,-41.748176,-41.757798,-41.807216,-41.848887,-41.865809,-41.873282,-41.8913,-41.903099,-41.917201,-41.9369,-41.961411,-41.965853,-41.982665,-42.038985,-42.05708,-42.057028,-42.09622,-42.10552,-42.102683,-42.118468,-42.127459,-42.133001,-42.132453,-42.149314,-42.166374,-42.175619,-42.169199,-42.183595,-42.180358,-42.211152,-42.223782,-42.229921,-42.264362,-42.266702,-42.275988,-42.28185,-42.259614,-42.254341,-42.242275,-42.230326,-42.227026,-42.191683,-42.173142,-42.165458,-42.148554,-42.140164,-42.12564,-42.128068,-42.109987,-42.116841,-42.101073,-42.091033,-42.077391,-42.071434,-42.076886,-42.068837,-42.067186,-42.077836,-42.074206,-42.060094,-42.054347,-42.043377,-42.035654,-42.002619,-41.988302,-41.985999,-42.002982,-42.020801,-42.008975,-41.997075,-41.997963,-42.017103,-42.041537,-42.043949,-42.05158,-42.044665,-42.034651,-42.035182,-42.039652,-42.049836,-42.051771,-42.062255,-42.061124,-42.073634,-42.074003,-42.081067,-42.080769,-42.082548,-42.074493,-42.084963,-42.084914,-42.097901,-42.092425,-42.118418,-42.112076,-42.125511,-42.15419,-42.167915,-42.23935,-42.249462,-42.26061,-42.268237,-42.285468,-42.309933,-42.307399,-42.332961,-42.332503,-42.334999,-42.336101,-42.337844,-42.342377,-42.332802,-42.343173,-42.336659,-42.343481,-42.349591,-42.343902,-42.35733,-42.341271,-42.337244,-42.334204,-42.32568,-42.324824,-42.311551,-42.315007,-42.32777,-42.349507,-42.364513,-42.373624,-42.389042,-42.405386,-42.43318,-42.441039,-42.441393,-42.462346,-42.467763,-42.498345,-42.489971,-42.501569,-42.510352,-42.517787,-42.526537,-42.515998,-42.520332,-42.55323,-42.550122,-42.53816,-42.530803,-42.516288,-42.496786,-42.510941,-42.506046,-42.514562,-42.524029,-42.530651,-42.548512,-42.54526,-42.554772,-42.554155,-42.566941,-42.565956,-42.590013,-42.606319,-42.631559,-42.652588,-42.644901,-42.654511,-42.653182,-42.66107,-42.669542,-42.679592,-42.700692,-42.711749,-42.709103,-42.71371,-42.72801,-42.743854,-42.769865,-42.818752,-42.84552,-42.83687,-42.814657,-42.84913,-42.845775,-42.859893,-42.86094,-42.874234,-42.865739,-42.880452,-42.89262,-42.903081,-42.89876,-42.906849,-42.895011,-42.898855,-42.886558,-42.901907,-42.891581,-42.886089,-42.892773,-42.879568,-42.881943,-42.864377,-42.871601,-42.862707,-42.87877,-42.869225,-42.855797,-42.844509,-42.813354,-42.798117,-42.781572,-42.778262,-42.784521,-42.801039,-42.794264,-42.788376,-42.797335,-42.785344,-42.783209,-42.771505,-42.783821,-42.80117,-42.805304,-42.805102,-42.785432,-42.78289,-42.803107,-42.781526,-42.771074,-42.768118,-42.776787,-42.775934,-42.783309,-42.774071,-42.78577,-42.809509,-42.80794,-42.815033,-42.812896,-42.820715,-42.826743,-42.827953,-42.811323,-42.827978,-42.825114,-42.845948,-42.837869,-42.847302,-42.86429,-42.87607,-42.911283,-42.931312,-42.959998,-42.959318,-42.985644,-42.992724,-43.006036,-43.021104,-43.036948,-43.050494,-43.046474,-43.036572,-43.020382,-43.006683,-42.984539,-42.9757,-42.962914,-42.977578,-42.984372,-43.002823,-43.027571,-43.032634,-43.026716,-43.018685,-42.999289,-42.982108,-42.970171,-42.978391,-42.964527,-42.92345,-42.91859,-42.927146,-42.912981,-42.90631,-42.908656,-42.939748,-42.938809,-42.918964,-42.908852,-42.884267,-42.882554,-42.870159,-42.875777,-42.860591,-42.84868,-42.853124,-42.845709,-42.8352,-42.841081,-42.833706,-42.824903,-42.816675,-42.801062,-42.789744,-42.777749,-42.778498,-42.765294,-42.755655,-42.748636,-42.738953,-42.730198,-42.73899,-42.751215,-42.757012,-42.725319,-42.732291,-42.739844,-42.740918,-42.751834,-42.767072,-42.773108,-42.770094,-42.752804,-42.74044,-42.751868,-42.765787,-42.786616,-42.789994,-42.791834,-42.796527,-42.806203,-42.81166,-42.814863,-42.825828,-42.818736,-42.823546,-42.82923,-42.833834,-42.826403,-42.832089,-42.849206,-42.84461,-42.855131,-42.864589,-42.877063,-42.884938,-42.886795,-42.90022,-42.914127,-42.951108,-42.954768,-42.974427,-42.977505,-42.977814,-43.006165,-43.051679,-43.059471,-43.008305,-43.024591,-43.021382,-43.024685,-43.026748,-43.073251,-43.074919,-43.087908,-43.110991,-43.106513,-43.1148,-43.121944,-43.122312,-43.130832,-43.132332,-43.138576,-43.148676,-43.151727,-43.154448,-43.166291,-43.181955,-43.188368,-43.223517,-43.256604,-43.268099,-43.281036,-43.276249,-43.283386,-43.271216,-43.253558,-43.241125,-43.249994,-43.242804,-43.250251,-43.245309,-43.243168,-43.23792,-43.219886,-43.2106,-43.20679,-43.198464,-43.188042,-43.185291,-43.181487,-43.17169,-43.16295,-43.192828,-43.202332,-43.206701,-43.217345,-43.2251,-43.209647,-43.190295,-43.189432,-43.177597,-43.173192,-43.146956,-43.11225,-43.091959,-43.069763,-43.047391,-43.058653,-43.118735,-43.128655,-43.138584,-43.158917,-43.156129,-43.16384,-43.157924,-43.169317,-43.190302,-43.204,-43.206465,-43.217152,-43.214512,-43.243826,-43.249102,-43.263638,-43.280188,-43.290217,-43.292427,-43.332813,-43.312302,-43.315833,-43.322737,-43.335497,-43.330102,-43.339465,-43.333194,-43.343484,-43.333896,-43.34795,-43.353063,-43.380001,-43.403277,-43.411434,-43.42207,-43.435817,-43.443455,-43.433992,-43.440799,-43.431905,-43.44738,-43.43434,-43.415583,-43.439837,-43.438301,-43.447067,-43.43996,-43.446016,-43.447455,-43.453098,-43.447703,-43.454706,-43.461872,-43.479652,-43.487256,-43.475028,-43.468638,-43.478121,-43.49667,-43.498142,-43.512025,-43.487591,-43.494017,-43.51181,-43.532988,-43.539295,-43.530301,-43.546296,-43.538941,-43.531859,-43.516884,-43.514149,-43.51622,-43.553185,-43.558031,-43.553458,-43.562043,-43.566028,-43.580554,-43.568788,-43.580994,-43.600042,-43.623367,-43.638637,-43.633052,-43.643092,-43.630761,-43.615117,-43.60029,-43.609456,-43.615342,-43.60999,-43.631932,-43.626075,-43.633411,-43.596701,-43.594409,-43.60772,-43.596177,-43.578529,-43.587436,-43.580366,-43.562383,-43.569083,-43.559801,-43.561932,-43.550207,-43.524626,-43.485135,-43.464884,-43.475434,-43.492071,-43.496624,-43.510393,-43.543486,-43.523268,-43.531364,-43.524066,-43.543857,-43.53458,-43.542581,-43.534433,-43.539816,-43.530271,-43.535039,-43.518967,-43.530489,-43.520236,-43.512831,-43.520608,-43.536247,-43.54466,-43.528807,-43.528637,-43.49845,-43.485565,-43.490101,-43.491138,-43.506969,-43.534836,-43.539985,-43.511374,-43.516419,-43.499961,-43.501487,-43.504229,-43.52828,-43.518296,-43.525878,-43.523627,-43.557075,-43.556623,-43.542489,-43.540973,-43.556499,-43.552375,-43.570953,-43.508548,-43.488205,-43.464307,-43.463896,-43.455094,-43.437706,-43.406945,-43.403446,-43.395226,-43.382612,-43.38129,-43.390884,-43.381296,-43.379369,-43.369962,-43.371779,-43.359387,-43.369699,-43.363094,-43.35985,-43.355573,-43.373943,-43.388246,-43.394252,-43.365475,-43.365324,-43.347892,-43.349155,-43.329322,-43.339682,-43.344958,-43.353142,-43.358501,-43.366087,-43.371526,-43.36448,-43.344498,-43.350323,-43.342035,-43.351757,-43.345942,-43.355464,-43.37308,-43.373707,-43.406634,-43.408668,-43.408139,-43.376545,-43.377846,-43.392091,-43.38198,-43.382146,-43.362813,-43.363576,-43.375634,-43.389074,-43.375946,-43.364055,-43.361102,-43.332528,-43.322462,-43.326101,-43.321101,-43.330501,-43.315211,-43.326664,-43.298348,-43.291051,-43.298753,-43.311349,-43.322429,-43.345624,-43.348394,-43.339321,-43.325456,-43.340223,-43.327454,-43.30955,-43.300805,-43.297668,-43.289388,-43.297422,-43.300716,-43.307124,-43.321093,-43.333562,-43.332707,-43.342392,-43.335344,-43.330642,-43.320746,-43.322635,-43.304793,-43.302955,-43.290461,-43.285668,-43.281066,-43.272992,-43.265709,-43.24758,-43.234805,-43.228063,-43.230004,-43.21255,-43.211356,-43.217833,-43.224941,-43.24519,-43.248351,-43.264139,-43.258673,-43.273186,-43.273027,-43.289684,-43.281734,-43.26546,-43.267433,-43.291979,-43.300487,-43.3003,-43.314535,-43.3108,-43.322614,-43.306778,-43.315266,-43.304268,-43.300159,-43.292605,-43.294696,-43.278516,-43.250098,-43.248873,-43.235503,-43.23482,-43.219055,-43.209456,-43.200831,-43.192405,-43.188264,-43.185621,-43.193252,-43.164892,-43.137475,-43.136352,-43.122477,-43.116731,-43.111763,-43.106017,-43.118483,-43.118494,-43.100387,-43.106727,-43.096247,-43.091171,-43.081184,-43.070464,-43.0675,-43.068549,-43.050468,-43.043816,-43.048506,-43.032387,-43.024771,-43.009179,-42.99717,-42.99068,-42.990497,-42.972519,-42.9711,-42.991523,-42.976446,-42.973962,-42.96318,-42.955964,-42.948712,-42.946921,-42.929234,-42.931079,-42.913388,-42.914216,-42.897817,-42.873448,-42.869094,-42.854475,-42.837089,-42.82893,-42.814809,-42.814915,-42.784572,-42.780799,-42.768704,-42.748167,-42.743028,-42.735584,-42.736405,-42.721288,-42.728225,-42.694586,-42.689161,-42.656512,-42.651025,-42.657772,-42.646095,-42.632571,-42.620658,-42.622514,-42.632372,-42.621623,-42.61275,-42.614927,-42.599051,-42.595223,-42.586043,-42.577243,-42.571212,-42.563253,-42.55291,-42.528593,-42.522088,-42.503988,-42.471242,-42.448059,-42.417479,-42.406157,-42.404423,-42.390086,-42.394714,-42.386391,-42.366887,-42.365895,-42.355295,-42.327835,-42.312137,-42.298368,-42.277729,-42.254422,-42.242615,-42.208012,-42.209927,-42.196975,-42.197058,-42.207932,-42.207399,-42.200093,-42.22842,-42.242017,-42.244082,-42.263355,-42.267325,-42.288472,-42.282895,-42.295823,-42.296653,-42.285349,-42.320457,-42.330395,-42.34441,-42.337055,-42.343875,-42.374271,-42.371743,-42.404432,-42.437442,-42.458265,-42.500602,-42.525843,-42.525698,-42.500994,-42.475379,-42.473547,-42.442595,-42.440561,-42.442002,-42.434789,-42.422257,-42.449533,-42.44041,-42.453045,-42.445481,-42.440769,-42.445469,-42.450703,-42.436072,-42.447447,-42.443517,-42.434502,-42.40548,-42.387129,-42.38796,-42.369195,-42.357028,-42.352124,-42.372616,-42.374196,-42.364012,-42.368087,-42.360539,-42.339768,-42.332343,-42.321867,-42.334343,-42.335429,-42.342384,-42.347241,-42.352491,-42.356658,-42.355928,-42.36448,-42.348707,-42.346129,-42.32346,-42.314304,-42.289975,-42.277471,-42.251744,-42.251677,-42.233798,-42.224361,-42.209866,-42.202138,-42.20679,-42.1941,-42.195406,-42.19124,-42.177352,-42.168585,-42.173299,-42.160731,-42.15176,-42.156568,-42.148906,-42.15281,-42.15776,-42.176185,-42.179167,-42.202388,-42.210097,-42.198016,-42.196647,-42.227293,-42.232105,-42.220926,-42.218705,-42.190408,-42.168154,-42.112306,-42.046231,-42.060057,-41.946133,-41.958922,-41.948587,-41.936815,-41.9489,-41.928457,-41.900499,-41.877107,-41.854712,-41.83618,-41.824076,-41.812958,-41.806018,-41.790175,-41.768898,-41.767371,-41.762164,-41.755101,-41.739562,-41.735538,-41.738103,-41.716772,-41.724409,-41.720933,-41.691228,-41.672804,-41.665608,-41.617822,-41.62588,-41.616962,-41.608013,-41.601303,-41.607848,-41.616718,-41.616497,-41.628734,-41.667596,-41.656246,-41.642018,-41.639508,-41.62882,-41.583194,-41.50862,-41.505567,-41.500773,-41.477462,-41.463133,-41.445714,-41.421491,-41.39513,-41.397029,-41.367423,-41.369763,-41.341194,-41.341519,-41.325578,-41.318282,-41.311675,-41.301484,-41.285111,-41.282133,-41.277659,-41.254754,-41.234829,-41.231651,-41.223231,-41.199994,-41.159357,-41.132455,-41.138701,-41.12058,-41.117011,-41.079778,-41.057356,-41.050207,-41.038485,-41.048486,-41.056409,-41.061823]},{&#34;lng&#34;:[144.779333,144.77521,144.781261,144.779333],&#34;lat&#34;:[-41.0795,-41.084293,-41.079853,-41.0795]},{&#34;lng&#34;:[144.777341,144.791585,144.795223,144.793855,144.791172,144.782362,144.777341],&#34;lat&#34;:[-41.070091,-41.068865,-41.054998,-41.053985,-41.06869,-41.065525,-41.070091]},{&#34;lng&#34;:[144.796219,144.798652,144.79924,144.796219],&#34;lat&#34;:[-41.055736,-41.060035,-41.057974,-41.055736]},{&#34;lng&#34;:[144.79154,144.790728,144.799122,144.791165,144.79154],&#34;lat&#34;:[-41.084969,-41.086832,-41.089529,-41.086281,-41.084969]},{&#34;lng&#34;:[145.064125,145.065983,145.062093,145.081232,145.103775,145.090875,145.082199,145.065615,145.068161,145.064125],&#34;lat&#34;:[-41.634036,-41.636421,-41.647983,-41.657116,-41.655895,-41.651241,-41.656176,-41.649032,-41.636387,-41.634036]},{&#34;lng&#34;:[145.388656,145.411219,145.414992,145.388656],&#34;lat&#34;:[-42.196644,-42.198418,-42.196811,-42.196644]},{&#34;lng&#34;:[145.430958,145.434023,145.449001,145.463897,145.469823,145.471508,145.487023,145.499953,145.486997,145.471562,145.469668,145.464064,145.449066,145.433831,145.430958],&#34;lat&#34;:[-42.190011,-42.188706,-42.199769,-42.192569,-42.197144,-42.185374,-42.186916,-42.176319,-42.186539,-42.184938,-42.19667,-42.192256,-42.199429,-42.188288,-42.190011]},{&#34;lng&#34;:[146.156535,146.166411,146.168631,146.156535],&#34;lat&#34;:[-43.414211,-43.418752,-43.411074,-43.414211]},{&#34;lng&#34;:[147.535871,147.516449,147.518198,147.509146,147.528667,147.539201,147.527659,147.535871],&#34;lat&#34;:[-42.960446,-42.952131,-42.963502,-42.967315,-42.985174,-42.97491,-42.962009,-42.960446]},{&#34;lng&#34;:[148.301216,148.287988,148.293148,148.287613,148.301216],&#34;lat&#34;:[-41.251273,-41.250247,-41.253737,-41.256935,-41.251273]},{&#34;lng&#34;:[147.201143,147.203245,147.202672,147.20575,147.201143],&#34;lat&#34;:[-40.999743,-40.999937,-41.009008,-40.999837,-40.999743]},{&#34;lng&#34;:[146.151654,146.128983,146.131761,146.120766,146.125367,146.129428,146.144626,146.142192,146.151908,146.14417,146.151654],&#34;lat&#34;:[-41.162045,-41.152298,-41.157267,-41.155706,-41.164903,-41.158995,-41.161491,-41.168473,-41.176943,-41.164075,-41.162045]},{&#34;lng&#34;:[145.120845,145.091374,145.119694,145.120845],&#34;lat&#34;:[-40.838941,-40.847701,-40.841042,-40.838941]},{&#34;lng&#34;:[148.248756,148.236244,148.244398,148.232911,148.231605,148.231106,148.246233,148.248756],&#34;lat&#34;:[-41.459656,-41.459146,-41.46657,-41.460398,-41.453279,-41.459837,-41.469993,-41.459656]},{&#34;lng&#34;:[148.229653,148.22763,148.228745,148.229653],&#34;lat&#34;:[-41.44264,-41.431612,-41.442547,-41.44264]},{&#34;lng&#34;:[148.21989,148.21592,148.219108,148.21989],&#34;lat&#34;:[-41.44558,-41.446137,-41.446805,-41.44558]},{&#34;lng&#34;:[148.204248,148.205429,148.197882,148.204248],&#34;lat&#34;:[-41.443691,-41.440982,-41.442357,-41.443691]},{&#34;lng&#34;:[148.075841,148.075899,148.06396,148.073524,148.075841],&#34;lat&#34;:[-42.067087,-42.062644,-42.068366,-42.065245,-42.067087]},{&#34;lng&#34;:[147.05231,147.056261,147.036506,147.041366,147.034777,147.034041,147.002317,147.033019,147.035676,147.054684,147.05231],&#34;lat&#34;:[-43.041767,-43.039689,-43.024661,-43.017748,-43.019129,-43.010891,-43.01687,-43.011415,-43.025036,-43.039995,-43.041767]},{&#34;lng&#34;:[146.917754,146.908291,146.905874,146.907601,146.917754],&#34;lat&#34;:[-43.436894,-43.432156,-43.420799,-43.432393,-43.436894]},{&#34;lng&#34;:[145.917851,145.928127,145.916285,145.937342,145.927708,145.921338,145.940454,145.920472,145.927102,145.908648,145.9158,145.910036,145.920675,145.917851],&#34;lat&#34;:[-43.21031,-43.204659,-43.192174,-43.191481,-43.185034,-43.163191,-43.150439,-43.161382,-43.189413,-43.187014,-43.18828,-43.194087,-43.204904,-43.21031]},{&#34;lng&#34;:[145.613883,145.626303,145.648221,145.671991,145.677123,145.665285,145.672542,145.666151,145.670983,145.698605,145.718173,145.729697,145.741359,145.72929,145.718659,145.701175,145.671843,145.667354,145.674067,145.667096,145.67875,145.673267,145.645783,145.625766,145.612914,145.613883],&#34;lat&#34;:[-42.437439,-42.445889,-42.435776,-42.444866,-42.504088,-42.527497,-42.534346,-42.538227,-42.562363,-42.570882,-42.590035,-42.582795,-42.591139,-42.582031,-42.589459,-42.571647,-42.560717,-42.538005,-42.534117,-42.527739,-42.502002,-42.44273,-42.434272,-42.44448,-42.434366,-42.437439]},{&#34;lng&#34;:[145.246202,145.253247,145.267714,145.253297,145.245641,145.246202],&#34;lat&#34;:[-42.030615,-42.019488,-42.022905,-42.018618,-42.027693,-42.030615]}],[{&#34;lng&#34;:[148.349737,148.347005,148.340391,148.327874,148.331176,148.344715,148.349737],&#34;lat&#34;:[-40.517405,-40.522516,-40.517047,-40.501534,-40.496379,-40.499249,-40.517405]}],[{&#34;lng&#34;:[148.347729,148.342542,148.322896,148.315224,148.324036,148.328564,148.347729],&#34;lat&#34;:[-39.950922,-39.958786,-39.959535,-39.946672,-39.944668,-39.931983,-39.950922]}],[{&#34;lng&#34;:[148.345979,148.304643,148.277068,148.251987,148.236565,148.236136,148.253975,148.27924,148.298482,148.31933,148.317633,148.331715,148.326302,148.345979],&#34;lat&#34;:[-42.341687,-42.343784,-42.324644,-42.328576,-42.317678,-42.306489,-42.293475,-42.302213,-42.292461,-42.305872,-42.323332,-42.322622,-42.333737,-42.341687]}],[{&#34;lng&#34;:[148.334277,148.283291,148.27175,148.272247,148.258928,148.210283,148.193204,148.185396,148.122105,148.098371,148.088599,148.059975,148.04611,148.040339,148.025212,148.024496,148.04036,148.041872,148.017627,148.019666,148.007019,147.970208,147.963908,147.955338,147.964487,147.95365,147.951703,147.93385,147.917223,147.895139,147.874749,147.859016,147.869309,147.880468,147.885864,147.897245,147.906751,147.899184,147.880012,147.847806,147.804546,147.794088,147.757223,147.748199,147.76951,147.777372,147.792747,147.803657,147.84384,147.850835,147.840889,147.869716,147.86822,147.847978,147.862703,147.884186,147.919578,147.941776,147.963439,147.955788,147.955958,147.966735,147.967512,147.990705,147.962316,147.967557,147.960671,148.122472,148.107973,148.124084,148.18609,148.170978,148.177245,148.204976,148.260195,148.291135,148.279268,148.286257,148.269247,148.238306,148.223281,148.234069,148.279159,148.281833,148.287652,148.314828,148.334277],&#34;lat&#34;:[-40.208333,-40.231378,-40.230812,-40.217157,-40.209863,-40.210695,-40.218909,-40.249854,-40.274035,-40.26077,-40.268918,-40.247765,-40.249506,-40.230105,-40.225816,-40.211832,-40.215628,-40.204129,-40.17056,-40.136914,-40.105369,-40.086641,-40.075137,-40.082301,-40.088787,-40.099005,-40.061202,-40.034647,-40.029825,-40.037046,-40.021282,-40.023392,-40.009472,-40.012098,-40.000581,-39.999015,-39.976154,-39.942768,-39.907311,-39.898031,-39.916577,-39.901962,-39.890618,-39.873759,-39.866385,-39.849564,-39.852429,-39.835362,-39.837056,-39.822647,-39.808845,-39.786727,-39.77429,-39.75067,-39.747156,-39.761323,-39.744345,-39.719554,-39.72707,-39.732023,-39.74494,-39.772864,-39.759154,-39.779275,-39.743289,-39.74183,-39.730132,-39.897448,-39.894909,-39.898526,-39.946608,-39.942589,-39.952059,-39.945233,-39.96687,-39.965118,-40.008597,-40.067923,-40.090782,-40.101529,-40.121045,-40.12771,-40.116428,-40.080679,-40.080784,-40.174085,-40.208333]}],[{&#34;lng&#34;:[148.325802,148.306275,148.278335,148.288077,148.295423,148.312361,148.325802],&#34;lat&#34;:[-40.287476,-40.292821,-40.284192,-40.278676,-40.257441,-40.266259,-40.287476]}],[{&#34;lng&#34;:[148.318491,148.314921,148.304317,148.30324,148.312425,148.318491],&#34;lat&#34;:[-40.501004,-40.520474,-40.521119,-40.504399,-40.49664,-40.501004]}],[{&#34;lng&#34;:[148.266784,148.256823,148.238893,148.233843,148.227773,148.256437,148.266784],&#34;lat&#34;:[-40.252596,-40.257542,-40.248627,-40.25469,-40.240908,-40.241762,-40.252596]}],[{&#34;lng&#34;:[148.261927,148.244487,148.256977,148.261927],&#34;lat&#34;:[-40.228468,-40.225414,-40.221973,-40.228468]}],[{&#34;lng&#34;:[148.248432,148.23197,148.228405,148.23503,148.194755,148.198465,148.178286,148.149204,148.125657,148.113324,148.121528,148.095831,148.13113,148.192762,148.210229,148.238953,148.246148,148.248432],&#34;lat&#34;:[-40.487771,-40.507856,-40.525651,-40.532883,-40.569098,-40.590122,-40.594185,-40.565369,-40.572343,-40.564875,-40.537112,-40.531738,-40.502107,-40.489367,-40.503504,-40.479896,-40.478409,-40.487771]}],[{&#34;lng&#34;:[148.215104,148.205679,148.201749,148.215104],&#34;lat&#34;:[-40.254906,-40.258491,-40.249739,-40.254906]}],[{&#34;lng&#34;:[148.169014,148.152987,148.14452,148.133278,148.119586,148.112098,148.081273,148.068213,148.087118,148.096308,148.093028,148.079401,148.065282,148.067886,148.047965,148.013573,148.012714,148.02554,148.038744,148.057269,148.06632,148.063155,148.049712,148.025478,148.009322,148.037887,148.034277,148.024605,148.047748,148.052767,148.067397,148.089799,148.120142,148.138549,148.140673,148.169014],&#34;lat&#34;:[-42.64868,-42.65356,-42.667372,-42.660114,-42.668692,-42.659731,-42.661757,-42.681236,-42.689474,-42.711196,-42.720886,-42.724377,-42.717338,-42.726383,-42.722658,-42.741864,-42.720336,-42.712943,-42.684106,-42.68559,-42.676954,-42.664646,-42.655681,-42.668188,-42.661187,-42.649197,-42.634912,-42.629566,-42.607854,-42.5851,-42.570657,-42.585044,-42.585011,-42.608441,-42.631168,-42.64868]}],[{&#34;lng&#34;:[148.166054,148.131932,148.143219,148.166054],&#34;lat&#34;:[-40.291935,-40.297874,-40.290113,-40.291935]}],[{&#34;lng&#34;:[148.127743,148.108142,148.089824,148.119373,148.127743],&#34;lat&#34;:[-40.734296,-40.742853,-40.740085,-40.72693,-40.734296]}],[{&#34;lng&#34;:[148.116053,148.107638,148.097565,148.108589,148.116053],&#34;lat&#34;:[-40.302946,-40.31247,-40.30909,-40.295667,-40.302946]}],[{&#34;lng&#34;:[148.082002,148.047732,148.061758,148.082002],&#34;lat&#34;:[-40.48878,-40.474074,-40.468454,-40.48878]}],[{&#34;lng&#34;:[148.025111,147.994764,147.980622,148.006358,148.02473,148.025111],&#34;lat&#34;:[-40.354577,-40.369337,-40.367635,-40.351234,-40.34917,-40.354577]}],[{&#34;lng&#34;:[148.011504,148.001351,147.949626,147.94516,147.93176,147.916506,147.89663,147.895553,147.888164,147.894681,147.888765,147.886423,147.86729,147.863332,147.853766,147.857979,147.850384,147.866095,147.855675,147.860058,147.845553,147.86135,147.87033,147.87069,147.852999,147.876253,147.866474,147.874616,147.860838,147.844472,147.797429,147.799729,147.785615,147.776399,147.750715,147.746035,147.711578,147.715518,147.701292,147.694551,147.701488,147.698166,147.685138,147.703396,147.731142,147.734104,147.716379,147.730179,147.747515,147.742079,147.684186,147.673726,147.65074,147.641437,147.627123,147.622388,147.628333,147.619071,147.640734,147.66752,147.679341,147.685157,147.668944,147.675717,147.664409,147.678878,147.699473,147.705359,147.725528,147.731363,147.726291,147.736022,147.708038,147.726912,147.718453,147.740428,147.749379,147.759037,147.766735,147.773829,147.806686,147.813794,147.826603,147.840701,147.844355,147.835922,147.845436,147.86034,147.872443,147.924995,147.84686,147.850974,147.839301,147.837899,147.856779,147.836543,147.832381,147.822602,147.811311,147.830846,147.854803,147.847999,147.853799,147.865873,147.857744,147.837048,147.829492,147.833264,147.814891,147.811529,147.821481,147.821825,147.802901,147.840835,147.873839,147.876415,147.895002,147.907805,147.900413,147.903957,147.861124,147.885242,147.87963,147.891706,147.920112,147.920356,147.939856,147.970888,147.97134,147.957801,147.98406,147.998862,147.983432,147.99951,147.98442,147.961326,147.95316,147.930506,147.926429,147.935524,147.950217,147.954041,147.945066,147.955695,147.970726,147.981089,147.980612,147.954581,147.959847,147.954355,147.963387,147.972237,148.005817,147.983168,147.96369,148.011504],&#34;lat&#34;:[-43.221681,-43.227703,-43.21579,-43.19468,-43.198854,-43.189563,-43.190994,-43.155064,-43.142676,-43.138209,-43.138199,-43.123264,-43.129281,-43.107856,-43.117945,-43.124421,-43.124099,-43.137281,-43.134782,-43.142472,-43.154347,-43.164949,-43.15184,-43.164288,-43.179577,-43.19171,-43.197929,-43.206364,-43.20822,-43.187533,-43.217457,-43.24234,-43.237973,-43.213157,-43.209033,-43.197569,-43.194282,-43.178358,-43.176982,-43.167179,-43.160114,-43.14569,-43.13873,-43.122145,-43.124916,-43.110809,-43.105208,-43.100332,-43.112124,-43.094904,-43.102438,-43.088687,-43.089445,-43.075647,-43.073515,-43.051575,-43.040258,-43.006636,-42.99356,-42.999909,-42.991801,-42.974694,-42.963543,-42.956967,-42.943582,-42.934545,-42.944257,-42.95662,-42.949394,-42.957165,-42.964228,-42.970022,-43.003555,-43.018714,-43.027975,-43.014116,-43.043379,-43.044137,-43.032672,-43.054938,-43.046425,-43.06061,-43.055237,-43.0604,-43.049932,-43.041115,-43.030682,-43.057314,-43.023363,-43.015889,-43.013058,-43.007916,-43.003979,-42.991561,-42.982517,-42.980556,-42.970556,-42.976101,-42.962254,-42.965246,-42.958205,-42.951638,-42.945877,-42.947044,-42.935458,-42.947847,-42.946674,-42.934657,-42.937869,-42.926103,-42.922421,-42.907884,-42.893233,-42.88865,-42.894629,-42.888672,-42.894433,-42.908754,-42.899846,-42.882359,-42.874994,-42.861884,-42.853645,-42.842525,-42.843015,-42.861292,-42.877176,-42.864223,-42.874248,-42.881936,-42.890432,-42.914565,-42.94126,-42.964206,-42.979207,-42.984066,-43.001298,-43.009893,-43.021228,-43.034973,-43.034764,-43.05207,-43.059229,-43.064419,-43.102556,-43.107373,-43.123308,-43.12572,-43.130501,-43.136598,-43.142729,-43.13483,-43.139058,-43.156111,-43.191683,-43.221681]}],[{&#34;lng&#34;:[148.011137,147.991378,147.964916,147.985178,147.977117,147.982519,148.011137],&#34;lat&#34;:[-39.648628,-39.663382,-39.660639,-39.652269,-39.643462,-39.636983,-39.648628]}],[{&#34;lng&#34;:[148.009528,147.998704,147.998884,148.009528],&#34;lat&#34;:[-43.23655,-43.246389,-43.2329,-43.23655]}],[{&#34;lng&#34;:[147.98663,147.973717,147.971787,147.983745,147.98663],&#34;lat&#34;:[-40.186005,-40.194177,-40.175701,-40.17753,-40.186005]}],[{&#34;lng&#34;:[147.946602,147.902897,147.890644,147.887686,147.898666,147.907193,147.926712,147.946602],&#34;lat&#34;:[-39.69718,-39.705225,-39.700362,-39.687877,-39.681513,-39.689293,-39.685286,-39.69718]}],[{&#34;lng&#34;:[147.937714,147.927698,147.91109,147.931415,147.937714],&#34;lat&#34;:[-40.270009,-40.28189,-40.278657,-40.257936,-40.270009]}],[{&#34;lng&#34;:[147.917208,147.890374,147.906282,147.917208],&#34;lat&#34;:[-40.186277,-40.190523,-40.177344,-40.186277]}],[{&#34;lng&#34;:[147.908873,147.904735,147.881166,147.864323,147.846615,147.856143,147.836332,147.839791,147.868103,147.875552,147.903275,147.908873],&#34;lat&#34;:[-40.301612,-40.31709,-40.325954,-40.319525,-40.323907,-40.308088,-40.303464,-40.292112,-40.297292,-40.305661,-40.291471,-40.301612]}],[{&#34;lng&#34;:[147.893182,147.886775,147.886514,147.893182],&#34;lat&#34;:[-40.09728,-40.106159,-40.094623,-40.09728]}],[{&#34;lng&#34;:[147.803156,147.787186,147.790695,147.799564,147.803156],&#34;lat&#34;:[-40.31395,-40.299919,-40.294971,-40.294439,-40.31395]}],[{&#34;lng&#34;:[147.7875,147.75963,147.756551,147.726294,147.725647,147.751011,147.747312,147.756423,147.764212,147.775768,147.7875],&#34;lat&#34;:[-40.042051,-40.068324,-40.094755,-40.103138,-40.0912,-40.076174,-40.066625,-40.058756,-40.028643,-40.023031,-40.042051]}],[{&#34;lng&#34;:[147.778852,147.769124,147.774023,147.778852],&#34;lat&#34;:[-39.908975,-39.909354,-39.903602,-39.908975]}],[{&#34;lng&#34;:[147.675423,147.670393,147.672294,147.675423],&#34;lat&#34;:[-43.135705,-43.140366,-43.129312,-43.135705]}],[{&#34;lng&#34;:[147.648942,147.6446,147.635678,147.643785,147.648942],&#34;lat&#34;:[-42.954184,-42.958921,-42.947163,-42.943718,-42.954184]}],[{&#34;lng&#34;:[147.644205,147.634164,147.617007,147.640959,147.644205],&#34;lat&#34;:[-40.787921,-40.80714,-40.813388,-40.779814,-40.787921]}],[{&#34;lng&#34;:[147.490874,147.472132,147.484844,147.490874],&#34;lat&#34;:[-43.062006,-43.045822,-43.044846,-43.062006]}],[{&#34;lng&#34;:[147.2028,147.203519,147.179557,147.187056,147.182837,147.159387,147.146534,147.137447,147.13565,147.093898,147.097146,147.122344,147.160375,147.179878,147.171415,147.180376,147.174268,147.192417,147.184873,147.174277,147.174112,147.167887,147.185854,147.179097,147.188574,147.185046,147.195609,147.198643,147.212788,147.221585,147.218025,147.234483,147.222336,147.240417,147.24678,147.27108,147.271597,147.286104,147.290857,147.302201,147.297969,147.305815,147.317638,147.357883,147.348364,147.355732,147.341157,147.364267,147.375729,147.383276,147.386307,147.378961,147.361713,147.354661,147.331789,147.342299,147.299489,147.300954,147.276007,147.296076,147.282118,147.310204,147.329223,147.337218,147.352864,147.355908,147.361158,147.353227,147.338377,147.328409,147.32263,147.330082,147.306633,147.317133,147.326723,147.32252,147.338105,147.351249,147.367631,147.362585,147.387983,147.389599,147.400714,147.39247,147.409119,147.410771,147.426676,147.43327,147.430187,147.421222,147.415942,147.380261,147.345626,147.322286,147.320304,147.340009,147.334431,147.349725,147.367013,147.381959,147.378941,147.364497,147.337912,147.346277,147.344451,147.331283,147.320875,147.323921,147.294719,147.291016,147.271773,147.263146,147.246569,147.240378,147.255796,147.245864,147.2028],&#34;lat&#34;:[-43.436981,-43.453198,-43.471256,-43.481337,-43.488863,-43.483351,-43.496781,-43.493344,-43.458103,-43.428398,-43.412367,-43.416462,-43.464404,-43.458298,-43.451725,-43.443265,-43.437809,-43.428757,-43.418094,-43.423514,-43.409116,-43.408738,-43.387657,-43.352555,-43.349104,-43.357367,-43.361267,-43.379384,-43.382357,-43.370746,-43.362334,-43.364057,-43.339846,-43.329166,-43.304327,-43.295519,-43.276041,-43.265938,-43.241789,-43.26428,-43.273143,-43.297016,-43.294773,-43.255799,-43.237134,-43.229079,-43.219082,-43.208611,-43.214859,-43.206911,-43.187863,-43.176046,-43.176301,-43.186652,-43.185297,-43.169994,-43.180866,-43.168462,-43.166545,-43.157039,-43.144332,-43.1343,-43.152275,-43.136556,-43.131178,-43.140758,-43.113575,-43.128061,-43.119425,-43.130998,-43.126485,-43.114881,-43.113562,-43.109427,-43.089238,-43.084433,-43.082123,-43.063933,-43.071824,-43.086779,-43.102662,-43.121063,-43.127095,-43.162431,-43.168892,-43.200547,-43.206252,-43.231539,-43.252137,-43.252656,-43.240573,-43.250602,-43.273404,-43.304035,-43.343992,-43.366941,-43.367735,-43.368222,-43.350292,-43.37178,-43.390294,-43.392121,-43.423253,-43.42916,-43.437623,-43.441625,-43.469109,-43.502643,-43.516165,-43.505045,-43.500564,-43.487887,-43.492733,-43.465903,-43.457721,-43.440396,-43.436981]},{&#34;lng&#34;:[147.202672,147.204578,147.225905,147.241973,147.241714,147.23592,147.227259,147.202009,147.202672],&#34;lat&#34;:[-43.434106,-43.429835,-43.433909,-43.425713,-43.413905,-43.419558,-43.41257,-43.419163,-43.434106]}],[{&#34;lng&#34;:[147.361331,147.345767,147.35789,147.349277,147.351315,147.330255,147.324481,147.313777,147.305587,147.303987,147.31262,147.309128,147.3218,147.327147,147.340877,147.343207,147.361331],&#34;lat&#34;:[-39.465221,-39.471754,-39.481089,-39.485543,-39.497497,-39.490423,-39.504975,-39.480175,-39.483653,-39.475222,-39.473357,-39.468232,-39.452009,-39.458278,-39.449671,-39.460544,-39.465221]}],[{&#34;lng&#34;:[147.304836,147.295941,147.299636,147.289884,147.26039,147.270343,147.293386,147.27475,147.285433,147.286866,147.301714,147.304836],&#34;lat&#34;:[-39.451472,-39.456243,-39.461677,-39.477292,-39.479499,-39.466821,-39.462158,-39.443508,-39.446484,-39.439026,-39.438134,-39.451472]}],[{&#34;lng&#34;:[147.148378,147.144375,147.137975,147.148378],&#34;lat&#34;:[-43.286161,-43.294334,-43.290256,-43.286161]}],[{&#34;lng&#34;:[147.134308,147.127599,147.129748,147.134308],&#34;lat&#34;:[-43.257362,-43.264154,-43.252992,-43.257362]}],[{&#34;lng&#34;:[147.105801,147.100439,147.094049,147.099381,147.105801],&#34;lat&#34;:[-43.396061,-43.409456,-43.398601,-43.389214,-43.396061]}],[{&#34;lng&#34;:[147.087857,147.082433,147.079222,147.087857],&#34;lat&#34;:[-41.380311,-41.384656,-41.372835,-41.380311]}],[{&#34;lng&#34;:[147.041416,147.023477,147.030713,147.041416],&#34;lat&#34;:[-43.05334,-43.07742,-43.058525,-43.05334]}],[{&#34;lng&#34;:[147.020219,147.013611,147.00783,147.013419,146.999908,147.004912,147.020219],&#34;lat&#34;:[-43.090946,-43.111723,-43.114991,-43.102483,-43.12072,-43.104127,-43.090946]}],[{&#34;lng&#34;:[146.996233,146.987585,146.977272,146.985648,146.996233],&#34;lat&#34;:[-39.221031,-39.231245,-39.229041,-39.206708,-39.221031]}],[{&#34;lng&#34;:[146.657957,146.640237,146.637765,146.657957],&#34;lat&#34;:[-39.463161,-39.480157,-39.473738,-39.463161]}],[{&#34;lng&#34;:[146.39519,146.380633,146.388608,146.39519],&#34;lat&#34;:[-39.230963,-39.231644,-39.224415,-39.230963]}],[{&#34;lng&#34;:[146.377578,146.351368,146.336781,146.37484,146.377578],&#34;lat&#34;:[-43.596385,-43.607305,-43.59187,-43.586771,-43.596385]}],[{&#34;lng&#34;:[146.297123,146.285371,146.292232,146.297123],&#34;lat&#34;:[-43.61968,-43.620976,-43.61296,-43.61968]}],[{&#34;lng&#34;:[146.286411,146.267079,146.274786,146.286411],&#34;lat&#34;:[-43.651435,-43.657607,-43.636469,-43.651435]}],[{&#34;lng&#34;:[145.971353,145.963439,145.968562,145.971353],&#34;lat&#34;:[-43.418402,-43.423217,-43.412262,-43.418402]}],[{&#34;lng&#34;:[145.104473,145.077657,145.045964,145.04007,145.044247,145.104473],&#34;lat&#34;:[-40.793663,-40.794962,-40.782596,-40.774177,-40.751168,-40.793663]}],[{&#34;lng&#34;:[144.929092,144.919959,144.927522,144.949955,144.935869,144.929548,144.93738,144.967983,144.954757,144.991571,145.026648,145.049312,145.044316,145.06788,145.041145,145.051107,145.039127,145.038789,145.004435,144.976938,144.943067,144.919415,144.893737,144.867154,144.876441,144.87183,144.903128,144.919365,144.929092],&#34;lat&#34;:[-40.622398,-40.613082,-40.577381,-40.62121,-40.62931,-40.622863,-40.649773,-40.658739,-40.629474,-40.670004,-40.684931,-40.680348,-40.689174,-40.714365,-40.717437,-40.712278,-40.713134,-40.705607,-40.714161,-40.707686,-40.731348,-40.728478,-40.74048,-40.722024,-40.710768,-40.678599,-40.657129,-40.624943,-40.622398]}],[{&#34;lng&#34;:[144.969885,144.947913,144.951601,144.896639,144.858052,144.850925,144.834773,144.841026,144.85422,144.877013,144.8857,144.874494,144.88441,144.87902,144.887152,144.913897,144.954617,144.962033,144.956215,144.969885],&#34;lat&#34;:[-40.426237,-40.438604,-40.460038,-40.483856,-40.468834,-40.45246,-40.44306,-40.429911,-40.43453,-40.422894,-40.408489,-40.401325,-40.399455,-40.39278,-40.388676,-40.397452,-40.391235,-40.401478,-40.412446,-40.426237]}],[{&#34;lng&#34;:[144.841326,144.823774,144.832674,144.841326],&#34;lat&#34;:[-40.695521,-40.699205,-40.690735,-40.695521]}],[{&#34;lng&#34;:[144.792726,144.791023,144.784988,144.792562,144.791029,144.771284,144.775962,144.757535,144.735489,144.725805,144.733166,144.722219,144.709542,144.718277,144.710652,144.724777,144.730751,144.755862,144.772548,144.766331,144.784387,144.784648,144.792726],&#34;lat&#34;:[-40.417558,-40.464458,-40.47021,-40.479053,-40.507352,-40.533477,-40.581231,-40.605984,-40.592882,-40.5746,-40.550062,-40.517046,-40.510031,-40.500491,-40.484483,-40.479136,-40.489194,-40.485733,-40.464634,-40.444897,-40.420541,-40.399482,-40.417558]}],[{&#34;lng&#34;:[144.723282,144.716306,144.717605,144.723282],&#34;lat&#34;:[-40.606018,-40.606493,-40.599452,-40.606018]}],[{&#34;lng&#34;:[144.698287,144.687308,144.6791,144.698287],&#34;lat&#34;:[-40.633742,-40.638708,-40.627154,-40.633742]}],[{&#34;lng&#34;:[144.138222,144.128013,144.113551,144.116243,144.100807,144.105457,144.093888,144.070387,144.062736,144.062986,144.049329,144.050871,144.026951,143.989663,143.971088,143.962635,143.949699,143.921046,143.929769,143.925725,143.915953,143.90083,143.908402,143.904426,143.875275,143.872038,143.858082,143.879926,143.890037,143.884037,143.892987,143.885039,143.891671,143.879028,143.838594,143.845164,143.833303,143.839495,143.835297,143.847086,143.841937,143.846829,143.860358,143.854139,143.867172,143.859078,143.863026,143.850197,143.854673,143.84424,143.891328,143.922707,143.934618,143.924209,143.935747,143.94575,143.98439,144.00538,144.01259,144.051478,144.109657,144.100526,144.113522,144.093287,144.106877,144.121486,144.110947,144.127809,144.106584,144.105013,144.111387,144.135646,144.138222],&#34;lat&#34;:[-39.933819,-39.993243,-40.008047,-40.018145,-40.028812,-40.044375,-40.052257,-40.05144,-40.069223,-40.063035,-40.067693,-40.074095,-40.094863,-40.09824,-40.116734,-40.109148,-40.112923,-40.134081,-40.146124,-40.157964,-40.143472,-40.139383,-40.128058,-40.121394,-40.116764,-40.083458,-40.062372,-40.062694,-40.053929,-40.028189,-40.010933,-39.998922,-39.993511,-39.967228,-39.9362,-39.925474,-39.915546,-39.911192,-39.902223,-39.894641,-39.885024,-39.870427,-39.856619,-39.851258,-39.833486,-39.81616,-39.789616,-39.770257,-39.737523,-39.715568,-39.698318,-39.668873,-39.638209,-39.595287,-39.594632,-39.580467,-39.600984,-39.596637,-39.608841,-39.625462,-39.669979,-39.752424,-39.819308,-39.792317,-39.819945,-39.819127,-39.798983,-39.821289,-39.866197,-39.891295,-39.913816,-39.924383,-39.933819]}],[{&#34;lng&#34;:[143.837861,143.819218,143.826748,143.837861],&#34;lat&#34;:[-39.669329,-39.674996,-39.665015,-39.669329]}],[{&#34;lng&#34;:[143.835897,143.829885,143.826046,143.835897],&#34;lat&#34;:[-39.687897,-39.693141,-39.682948,-39.687897]}]],[[{&#34;lng&#34;:[130.517887,130.517526,130.529386,130.524326,130.531006,130.525246,130.531106,130.515446,130.511416,130.520625,130.535765,130.557274,130.558615,130.567234,130.583254,130.569915,130.584645,130.591145,130.585105,130.596024,130.607654,130.599834,130.605024,130.610304,130.629534,130.62497,130.643554,130.636324,130.616973,130.621453,130.630093,130.660603,130.687143,130.690663,130.679753,130.689143,130.693933,130.684583,130.707332,130.738762,130.706062,130.690192,130.679132,130.701951,130.674062,130.664722,130.673922,130.633402,130.637722,130.616462,130.617392,130.597243,130.585863,130.573402,130.545662,130.549902,130.559572,130.582821,130.586502,130.596242,130.588832,130.588232,130.609031,130.618861,130.630331,130.642891,130.641181,130.644121,130.63148,130.618481,130.61202,130.589231,130.60394,130.58899,130.573591,130.566791,130.58284,130.5887,130.60576,130.6041,130.58096,130.58843,130.623239,130.61221,130.58725,130.57816,130.6116,130.6193,130.62413,130.654259,130.683829,130.705669,130.711659,130.749838,130.765148,130.757389,130.727069,130.736749,130.761649,130.778888,130.771439,130.778479,130.769419,130.774399,130.748909,130.729289,130.73203,130.730049,130.749029,130.778559,130.781689,130.767359,130.77471,130.777129,130.77992,130.79185,130.78038,130.790129,130.783669,130.794459,130.788199,130.810159,130.805109,130.814199,130.82533,130.816059,130.841469,130.868019,130.857349,130.847219,130.858969,130.869299,130.876589,130.86976,130.879809,130.8871,130.9,130.898737,130.90818,130.89042,130.882289,130.932929,130.945289,130.952293,130.947089,130.953669,130.952497,130.966849,130.957249,130.948099,130.953319,130.945449,130.923079,130.884649,130.877819,130.893359,130.901419,130.879529,130.873858,130.862118,130.859208,130.869788,130.879588,130.903608,130.895598,130.907068,130.908039,130.916648,130.910408,130.922618,130.930538,130.927358,130.934839,130.934248,130.947029,130.938969,130.949449,130.953849,130.955148,130.941928,130.947278,130.940858,130.930578,130.946728,130.897348,130.891918,130.916948,130.890748,130.885998,130.878308,130.885918,130.878678,130.856348,130.867018,130.850049,130.850938,130.844252,130.83261,130.82111,130.815427,130.831387,130.835559,130.828218,130.819608,130.816378,130.843158,130.848725,130.842149,130.861147,130.896007,130.923387,130.946027,130.946057,130.950097,130.982797,131.004777,131.012507,131.013245,131.013197,131.008917,131.034867,131.055047,131.029817,131.029767,131.060957,131.028017,131.028447,131.017697,131.012977,131.030457,131.021577,131.004677,130.994627,130.995967,131.030606,131.045866,131.051766,131.065336,131.087576,131.113196,131.114346,131.125436,131.144276,131.157555,131.169055,131.175956,131.222045,131.20783,131.209786,131.205976,131.232045,131.221966,131.225006,131.222886,131.229075,131.228525,131.233995,131.206986,131.212316,131.250875,131.231075,131.228875,131.253885,131.250816,131.273556,131.266356,131.297126,131.303356,131.299506,131.320925,131.313885,131.321835,131.312905,131.322835,131.314055,131.322765,131.380875,131.426776,131.472295,131.548072,131.68282,131.7753,131.879259,131.904229,131.917488,131.939408,132.069714,132.073894,132.147633,132.170803,132.224352,132.238192,132.261723,132.264283,132.278463,132.353164,132.389393,132.417113,132.417583,132.442013,132.513032,132.554812,132.556212,132.578382,132.629281,132.618962,132.638692,132.640803,132.655323,132.645613,132.647873,132.636523,132.618483,132.594944,132.580704,132.596714,132.620604,132.648944,132.654704,132.643004,132.630954,132.594684,132.540155,132.518965,132.499845,132.507376,132.557685,132.574235,132.564595,132.576175,132.616644,132.607075,132.594465,132.547825,132.536256,132.549116,132.553086,132.524826,132.531916,132.515756,132.499766,132.494157,132.480517,132.457147,132.399207,132.353457,132.301928,132.238798,132.210069,132.193809,132.167279,132.138099,132.119809,132.119751,132.114889,132.122609,132.113829,132.104509,132.06788,132.05541,132.03388,132.03024,132.05095,132.05936,132.04122,131.9966,131.98598,131.99014,131.96243,131.94243,131.93981,131.95987,131.98057,131.98901,131.96802,131.96483,131.97364,131.97561,131.96591,131.95126,131.9517,131.93759,131.92823,131.93038,131.916901,131.94354,131.93325,131.9306,131.914691,131.859751,131.842081,131.821121,131.773282,131.762662,131.759282,131.772892,131.776291,131.779901,131.800508,131.806471,131.794391,131.815781,131.840211,131.855191,131.848311,131.836891,131.814801,131.821801,131.840041,131.860441,131.856411,131.867961,131.879361,131.886181,131.875591,131.882481,131.912031,131.904111,131.92751,131.92996,131.94554,131.94476,131.96121,131.96126,131.97417,131.98645,131.96242,131.96998,131.98243,131.99353,131.98645,131.98593,131.970311,131.992971,132.01069,132.02906,132.03699,132.04718,132.04611,132.05673,132.05473,132.06831,132.0755,132.0664,132.08262,132.07545,132.084489,132.098559,132.113539,132.113879,132.095759,132.100499,132.114149,132.116409,132.098289,132.107269,132.099979,132.108799,132.122649,132.125019,132.136779,132.140919,132.155869,132.145389,132.153609,132.154109,132.144679,132.157959,132.152029,132.169279,132.164259,132.170359,132.180799,132.175969,132.199109,132.208129,132.206189,132.197839,132.199969,132.188419,132.182889,132.190289,132.222128,132.231338,132.236468,132.226728,132.197519,132.172569,132.197079,132.190229,132.179889,132.188669,132.199039,132.199399,132.202469,132.194549,132.160809,132.161959,132.14125,132.14345,132.13561,132.18681,132.196019,132.211489,132.227519,132.230869,132.243459,132.239809,132.249859,132.265338,132.283548,132.281568,132.264658,132.273989,132.265069,132.287879,132.305688,132.322198,132.319498,132.338898,132.333289,132.343678,132.341328,132.356938,132.364908,132.382308,132.373688,132.384368,132.385698,132.397367,132.406098,132.414087,132.422247,132.413648,132.419998,132.433927,132.451037,132.476747,132.506787,132.505137,132.497247,132.486817,132.510137,132.505267,132.517147,132.503517,132.501877,132.512507,132.519897,132.514157,132.528497,132.547046,132.559196,132.585446,132.622016,132.635436,132.637815,132.669005,132.694625,132.714525,132.732875,132.747845,132.778174,132.783854,132.811374,132.825514,132.823154,132.842194,132.850333,132.864003,132.873063,132.885853,132.896403,132.909183,132.880463,132.865023,132.872033,132.897893,132.917953,132.933332,132.945232,132.968132,133.007852,133.045962,133.076861,133.069591,133.094141,133.105631,133.149872,133.190651,133.28159,133.252581,133.28392,133.29552,133.343359,133.354458,133.340569,133.320389,133.308089,133.309839,133.320889,133.353138,133.356908,133.369628,133.376418,133.369208,133.385618,133.402837,133.415567,133.410057,133.414627,133.398797,133.398677,133.410367,133.448107,133.448097,133.459107,133.480117,133.501157,133.533786,133.539506,133.528917,133.530127,133.549167,133.565596,133.602136,133.606986,133.595156,133.611086,133.663126,133.655866,133.678026,133.692006,133.664616,133.670126,133.690646,133.738465,133.773585,133.785865,133.793785,133.808654,133.793905,133.812364,133.837014,133.848154,133.867534,133.899394,133.915564,133.927604,133.940344,133.916254,133.901684,133.889865,133.867615,133.846505,133.823085,133.829615,133.831915,133.842115,133.858295,133.877905,133.867695,133.876015,133.895355,133.912395,133.907715,133.919905,133.933185,133.984055,134.004474,134.030774,134.063564,134.063914,134.078374,134.068515,134.071625,134.065995,134.074835,134.080915,134.101685,134.104514,134.127154,134.134164,134.175395,134.168545,134.149905,134.151995,134.172945,134.181735,134.181065,134.194245,134.162236,134.168416,134.188036,134.193755,134.228395,134.253515,134.245784,134.286654,134.306484,134.348035,134.416195,134.470304,134.462605,134.479574,134.492834,134.490904,134.605064,134.655863,134.687823,134.703333,134.739702,134.747592,134.770812,134.760703,134.779523,134.798173,134.830173,134.837003,134.831653,134.844233,134.841944,134.856814,134.885214,134.904804,134.935374,134.971594,135.004564,135.056034,135.124104,135.137764,135.144674,135.160154,135.164264,135.213054,135.218924,135.209874,135.183244,135.181434,135.159844,135.161584,135.193284,135.207484,135.267043,135.283324,135.313074,135.342493,135.352043,135.312173,135.280263,135.276043,135.256723,135.223323,135.269053,135.284473,135.302962,135.319172,135.304252,135.305992,135.352982,135.366211,135.386521,135.396871,135.422581,135.405231,135.415332,135.454371,135.507861,135.519041,135.538441,135.544871,135.570011,135.603771,135.615631,135.605381,135.64306,135.64971,135.64364,135.65355,135.68425,135.727399,135.754489,135.808389,135.886568,135.909888,135.911248,135.877479,135.869689,135.831679,135.826499,135.832759,135.77276,135.75854,135.73123,135.700451,135.659231,135.650052,135.652002,135.676822,135.710262,135.720723,135.710377,135.730263,135.746222,135.762072,135.776322,135.778252,135.798352,135.803621,135.815911,135.825201,135.828541,135.838681,135.850471,135.855281,135.864361,135.86584,135.88122,135.88628,135.881591,135.894921,135.91223,135.92187,135.92843,135.93565,135.94817,135.948619,135.95001,135.95908,135.959979,135.972329,136.002099,135.996339,136.004829,135.996789,136.003659,136.031549,136.034629,136.045759,136.011979,135.98308,135.97348,135.95786,135.95535,135.94226,135.928041,135.933111,135.956221,135.962222,135.950052,136.001161,136.010551,136.019273,136.013521,136.028121,136.049241,136.061201,136.054131,136.033911,136.029922,136.009012,136.007422,136.015922,136.023642,136.008152,135.995323,135.975683,135.970893,135.975603,135.996073,136.015493,135.993254,136.003624,135.988914,136.015354,136.014474,136.021374,136.033654,136.051594,136.046274,136.063703,136.075783,136.073623,136.085823,136.104903,136.107983,136.121113,136.151423,136.159603,136.158394,136.158954,136.169074,136.231734,136.249394,136.259704,136.252834,136.263294,136.314173,136.303813,136.304013,136.333092,136.325462,136.341992,136.353871,136.368461,136.342921,136.362771,136.35914,136.35311,136.34207,136.34582,136.33437,136.337,136.31544,136.28821,136.22827,136.21891,136.23211,136.20823,136.19056,136.17218,136.16894,136.176039,136.167409,136.176819,136.195199,136.217229,136.212589,136.230389,136.231739,136.246869,136.267088,136.326148,136.331808,136.339388,136.348758,136.344027,136.355147,136.357417,136.369947,136.367497,136.378757,136.389697,136.382387,136.414836,136.426086,136.430797,136.445696,136.443966,136.492406,136.513896,136.523296,136.531175,136.548246,136.561355,136.573785,136.557645,136.562955,136.568755,136.581815,136.580405,136.534186,136.472096,136.472827,136.456057,136.448947,136.451973,136.457087,136.455837,136.469817,136.477457,136.488837,136.485942,136.490457,136.488997,136.492057,136.498257,136.496017,136.505977,136.503047,136.512256,136.531076,136.564986,136.580688,136.587238,136.590308,136.581198,136.587008,136.577748,136.59931,136.64644,136.647501,136.674801,136.669421,136.691251,136.705701,136.72091,136.72629,136.74227,136.76612,136.7512,136.752159,136.72318,136.729079,136.698689,136.67708,136.681359,136.714319,136.725469,136.727099,136.782358,136.790729,136.818199,136.846679,136.873198,136.884471,136.905089,136.902389,136.911689,136.914919,136.928109,136.939239,136.933899,136.921119,136.944319,136.964208,136.965258,136.978918,136.961778,136.962688,136.945459,136.89969,136.88989,136.863311,136.805132,136.779003,136.772733,136.760713,136.775953,136.795842,136.794432,136.775932,136.759103,136.735403,136.720943,136.719243,136.729533,136.721763,136.742223,136.726903,136.733443,136.748393,136.730974,136.728924,136.720064,136.714294,136.693814,136.691584,136.675844,136.669265,136.680395,136.676855,136.681675,136.682954,136.696074,136.697144,136.715774,136.723724,136.734864,136.747443,136.761883,136.735424,136.690575,136.678645,136.681015,136.699046,136.693856,136.675346,136.652776,136.617426,136.631276,136.611336,136.601037,136.619757,136.624777,136.608447,136.621747,136.587287,136.580617,136.583787,136.605517,136.581977,136.567477,136.549817,136.532077,136.525477,136.531238,136.542848,136.517748,136.483378,136.467878,136.463708,136.468038,136.487978,136.478618,136.505878,136.518258,136.538848,136.552458,136.542838,136.546248,136.555218,136.559148,136.598158,136.625398,136.638077,136.644898,136.667967,136.654497,136.629238,136.635168,136.627498,136.627538,136.617648,136.600858,136.598128,136.580068,136.584458,136.562499,136.569089,136.551139,136.564399,136.558679,136.539539,136.542399,136.531909,136.531769,136.519939,136.491889,136.474329,136.455209,136.452719,136.477959,136.480639,136.484069,136.507099,136.510659,136.535289,136.532889,136.566709,136.538979,136.53117,136.51436,136.498552,136.50087,136.47931,136.48391,136.47395,136.47559,136.46778,136.454891,136.446831,136.454161,136.439651,136.436961,136.399901,136.358172,136.343012,136.331362,136.331632,136.318982,136.338092,136.328142,136.350642,136.367581,136.388071,136.380461,136.366131,136.369801,136.356031,136.371551,136.354071,136.368711,136.36265,136.37143,136.36392,136.33547,136.33342,136.331261,136.308781,136.306511,136.291481,136.311651,136.321181,136.306681,136.315631,136.283082,136.281411,136.288701,136.273782,136.256262,136.259222,136.252562,136.243382,136.218042,136.223082,136.214062,136.231242,136.235802,136.247202,136.235272,136.245162,136.238812,136.218492,136.213422,136.201372,136.186422,136.174902,136.161943,136.159373,136.183853,136.181633,136.155503,136.147752,136.134172,136.150192,136.153092,136.145152,136.099082,136.107902,136.077753,136.084353,136.064193,136.053193,136.050593,136.062073,136.047214,136.036874,136.041884,136.030433,136.012103,135.998023,135.979143,135.963624,135.948314,135.918654,135.908604,135.913314,135.886634,135.879975,135.905755,135.920635,135.925635,135.919085,135.926455,135.965165,135.972985,135.961075,135.951826,135.945305,135.929455,135.935726,135.931246,135.919546,135.894325,135.872605,135.859726,135.863696,135.855046,135.865047,135.869277,135.839737,135.835287,135.843037,135.865167,135.871228,135.880628,135.907398,135.921638,135.889108,135.877828,135.879388,135.914498,135.956238,135.978168,135.988287,136.009047,136.012417,136.033597,136.025907,136.040067,136.051416,136.083056,136.075586,136.069126,136.054867,136.055387,136.034257,136.035167,136.013488,136.006418,136.015738,135.991678,135.989078,135.969909,135.955749,135.941039,135.909739,135.91317,135.90524,135.89114,135.89487,135.87877,135.90359,135.89827,135.89303,135.88145,135.815821,135.791151,135.794031,135.766152,135.736252,135.702532,135.730142,135.667743,135.670323,135.656283,135.630993,135.628103,135.619613,135.586564,135.589514,135.568404,135.566784,135.555184,135.536614,135.518414,135.527444,135.539544,135.541054,135.519114,135.499494,135.484865,135.465005,135.440485,135.416335,135.405295,135.393335,135.382075,135.393785,135.393775,135.412355,135.410935,135.415485,135.428035,135.431135,135.455815,135.478818,135.579954,135.612313,135.639733,135.657323,135.669832,135.701872,135.724142,135.748971,135.86279,135.925168,135.981527,136.049786,136.071565,136.129694,136.164673,136.209752,136.207122,136.239712,136.241542,136.263172,136.270412,136.290291,136.317261,136.317491,136.326441,136.341321,136.41207,136.468909,136.533888,136.547587,136.540908,136.558397,136.555458,136.568427,136.559367,136.584917,136.621007,136.644067,136.664927,136.671607,136.679297,136.681827,136.696867,136.704537,136.724127,136.682667,136.642787,136.645412,136.658387,136.644717,136.670497,136.678637,136.674567,136.713767,136.714657,136.690797,136.706377,136.729497,136.771487,136.773207,136.760737,136.786047,136.795777,136.795857,136.822947,136.835187,136.856317,136.84937,136.866467,136.871707,136.887817,136.888767,136.892947,136.908127,136.904617,136.944306,136.953246,136.918756,136.912706,136.939456,136.970386,136.966306,136.977986,136.987306,136.998736,136.999325,137.005855,136.997926,137.003525,137.048095,137.083575,137.157935,137.204085,137.254414,137.308954,137.294925,137.354344,137.372604,137.373554,137.381344,137.383804,137.356924,137.388394,137.409194,137.425724,137.498494,137.556942,137.534312,137.573772,137.680621,137.729671,137.740891,137.768851,137.789851,137.862021,138.00118,137.999054,129.000584,129.001242,129.031662,129.044122,129.056582,129.054062,129.065942,129.101291,129.11272,129.10842,129.12264,129.13069,129.15677,129.15334,129.15817,129.188919,129.169509,129.180419,129.177609,129.195399,129.200549,129.17467,129.17492,129.15752,129.15819,129.17114,129.18047,129.18774,129.18662,129.1996,129.19563,129.2312,129.215479,129.238089,129.235149,129.249409,129.236489,129.251469,129.256039,129.261929,129.256339,129.261649,129.278198,129.292969,129.301618,129.293099,129.281248,129.265129,129.233489,129.241369,129.233929,129.241818,129.221738,129.228428,129.243178,129.240808,129.243858,129.262907,129.257278,129.317387,129.334857,129.350127,129.367257,129.392217,129.408627,129.409517,129.435317,129.482478,129.522298,129.524778,129.556113,129.603903,129.602213,129.560193,129.557244,129.563584,129.578933,129.611663,129.626233,129.656723,129.670853,129.684983,129.685663,129.652392,129.639822,129.640532,129.663332,129.654302,129.635252,129.621082,129.623012,129.608492,129.596407,129.599517,129.593247,129.547907,129.536477,129.530377,129.500257,129.499707,129.533837,129.570007,129.592117,129.618391,129.586151,129.574046,129.577546,129.632051,129.648571,129.684911,129.744561,129.768161,129.771701,129.802541,129.850091,129.851381,129.881371,129.885561,129.87627,129.86441,129.86395,129.88255,129.90283,129.86835,129.835941,129.812691,129.800841,129.768981,129.756541,129.749481,129.77681,129.7938,129.80403,129.81005,129.80066,129.79405,129.77603,129.77473,129.75847,129.734401,129.672401,129.662211,129.664664,129.644951,129.619276,129.597761,129.589191,129.580675,129.583625,129.69238,129.71891,129.756299,129.773869,129.771549,129.66934,129.566761,129.55692,129.526271,129.488235,129.523065,129.508855,129.490435,129.506885,129.482675,129.471875,129.481665,129.470015,129.464745,129.462615,129.453995,129.468615,129.474455,129.453185,129.447395,129.451155,129.422655,129.420725,129.397845,129.397945,129.379285,129.356765,129.360725,129.373895,129.367015,129.393515,129.410524,129.419444,129.418404,129.411594,129.409294,129.431104,129.453223,129.463853,129.496383,129.507143,129.512033,129.498263,129.507913,129.499522,129.486323,129.478982,129.491382,129.515832,129.525072,129.535592,129.535072,129.542232,129.527663,129.541991,129.556712,129.554812,129.567152,129.594868,129.609288,129.611678,129.590638,129.598097,129.609277,129.640877,129.721306,129.746045,129.752395,129.745905,129.747265,129.735105,129.716925,129.715525,129.722565,129.740024,129.781754,129.794833,129.785094,129.790163,129.834832,129.827732,129.817322,129.831192,129.873241,129.885301,129.871151,129.869401,129.897431,129.900511,129.909891,129.95684,130.008369,130.058688,130.064148,130.106367,130.125227,130.141607,130.182226,130.198365,130.214435,130.235484,130.277914,130.284054,130.239714,130.225204,130.164195,130.130515,130.116176,130.118885,130.134055,130.120155,130.141194,130.128194,130.141114,130.159093,130.175793,130.193763,130.192613,130.213243,130.247122,130.33824,130.33316,130.358339,130.352799,130.356219,130.346309,130.352029,130.372478,130.378858,130.404108,130.405538,130.396468,130.393578,130.412797,130.414147,130.424537,130.420267,130.438556,130.444666,130.460885,130.492105,130.513574,130.518305,130.501186,130.506126,130.517887],&#34;lat&#34;:[-12.731048,-12.725616,-12.725046,-12.734086,-12.742166,-12.734316,-12.724936,-12.722686,-12.710256,-12.703496,-12.719026,-12.701995,-12.718586,-12.706375,-12.719245,-12.743776,-12.735286,-12.739196,-12.731896,-12.717995,-12.719905,-12.729065,-12.732715,-12.722275,-12.727795,-12.769403,-12.743695,-12.727105,-12.711755,-12.705205,-12.715245,-12.714655,-12.727954,-12.732695,-12.745255,-12.751495,-12.746675,-12.744455,-12.716514,-12.710544,-12.710984,-12.719814,-12.713504,-12.690484,-12.707854,-12.700524,-12.691474,-12.686324,-12.683674,-12.668714,-12.676394,-12.670764,-12.684445,-12.652244,-12.634304,-12.616104,-12.626494,-12.622974,-12.660454,-12.653994,-12.654384,-12.629414,-12.604423,-12.615643,-12.610623,-12.625183,-12.644164,-12.623803,-12.609033,-12.612893,-12.601483,-12.592123,-12.578393,-12.580483,-12.596763,-12.581523,-12.512803,-12.501273,-12.501452,-12.487932,-12.462642,-12.452802,-12.447762,-12.431772,-12.425232,-12.406593,-12.393123,-12.381373,-12.388932,-12.393992,-12.416111,-12.414051,-12.423421,-12.427111,-12.437371,-12.482231,-12.526232,-12.524632,-12.482451,-12.474751,-12.493851,-12.509551,-12.527071,-12.545592,-12.579972,-12.581592,-12.596932,-12.583052,-12.584042,-12.559142,-12.573712,-12.601692,-12.616002,-12.599592,-12.619472,-12.621902,-12.616882,-12.602632,-12.589422,-12.578442,-12.548282,-12.539891,-12.563512,-12.582022,-12.5799,-12.558182,-12.555322,-12.601482,-12.615172,-12.613492,-12.620582,-12.611642,-12.628802,-12.658733,-12.631282,-12.648222,-12.655312,-12.662486,-12.656432,-12.641772,-12.606202,-12.611102,-12.637862,-12.635237,-12.617702,-12.627632,-12.635161,-12.629782,-12.630902,-12.608442,-12.596862,-12.606522,-12.579912,-12.574792,-12.552431,-12.560531,-12.556261,-12.547911,-12.528031,-12.526251,-12.506591,-12.505781,-12.521131,-12.513291,-12.529801,-12.516451,-12.540741,-12.530891,-12.517461,-12.509251,-12.520241,-12.536631,-12.540631,-12.532211,-12.541681,-12.554081,-12.539641,-12.555131,-12.529401,-12.521801,-12.496491,-12.504291,-12.486691,-12.47105,-12.487661,-12.472761,-12.45768,-12.46519,-12.44305,-12.45052,-12.46203,-12.46363,-12.45101,-12.4406,-12.438844,-12.467663,-12.471788,-12.459755,-12.461886,-12.453013,-12.449953,-12.426717,-12.41163,-12.41458,-12.40713,-12.40776,-12.390553,-12.378908,-12.37578,-12.33006,-12.34481,-12.34205,-12.35719,-12.34604,-12.34187,-12.35221,-12.367,-12.366287,-12.36632,-12.35638,-12.360879,-12.347789,-12.346399,-12.325609,-12.332129,-12.317819,-12.305499,-12.326879,-12.323279,-12.231509,-12.216269,-12.209079,-12.186059,-12.168649,-12.146439,-12.142789,-12.158259,-12.166809,-12.153769,-12.155059,-12.175049,-12.182589,-12.182429,-12.168839,-12.173219,-12.192099,-12.227179,-12.239412,-12.239639,-12.270389,-12.266789,-12.278009,-12.285039,-12.277889,-12.273239,-12.281379,-12.266339,-12.263139,-12.240189,-12.220029,-12.214389,-12.207279,-12.162809,-12.135939,-12.100129,-12.076929,-12.042609,-12.052989,-12.070169,-12.089869,-12.112699,-12.122619,-12.132449,-12.147239,-12.165679,-12.193429,-12.25649,-12.275411,-12.283712,-12.278212,-12.284741,-12.268231,-12.214551,-12.224351,-12.255891,-12.272931,-12.30354,-12.28898,-12.24585,-12.21328,-12.194571,-12.169761,-12.173431,-12.203021,-12.224211,-12.198823,-12.236413,-12.222413,-12.195333,-12.146473,-12.124144,-12.098304,-12.085774,-12.105474,-12.085415,-12.016715,-11.942775,-11.901335,-11.889815,-11.875145,-11.858235,-11.822025,-11.805005,-11.805325,-11.786005,-11.767885,-11.758145,-11.722446,-11.685646,-11.681586,-11.720466,-11.730045,-11.718195,-11.687615,-11.682115,-11.635725,-11.636375,-11.654965,-11.667415,-11.655195,-11.654786,-11.639956,-11.639686,-11.608665,-11.580276,-11.574226,-11.554926,-11.544996,-11.520516,-11.520786,-11.509546,-11.482506,-11.484055,-11.457755,-11.454915,-11.441274,-11.465094,-11.455203,-11.469233,-11.490203,-11.491592,-11.521082,-11.515232,-11.514471,-11.516612,-11.526422,-11.539922,-11.528132,-11.525002,-11.496502,-11.482132,-11.458862,-11.460212,-11.432142,-11.420422,-11.430041,-11.422791,-11.401471,-11.411111,-11.399891,-11.392321,-11.380631,-11.383502,-11.373342,-11.369472,-11.360772,-11.361922,-11.351772,-11.342492,-11.341212,-11.351492,-11.350812,-11.357862,-11.365662,-11.357502,-11.319862,-11.316342,-11.324462,-11.324762,-11.292782,-11.312602,-11.318292,-11.325042,-11.315752,-11.299712,-11.302232,-11.311282,-11.291302,-11.295386,-11.283142,-11.268323,-11.268153,-11.286402,-11.276743,-11.253013,-11.247673,-11.211703,-11.206423,-11.226563,-11.209123,-11.219613,-11.219313,-11.234923,-11.207283,-11.193144,-11.181534,-11.206893,-11.216363,-11.235043,-11.259883,-11.251573,-11.244463,-11.253053,-11.228923,-11.235163,-11.218593,-11.176664,-11.170814,-11.180094,-11.175744,-11.170854,-11.150984,-11.134234,-11.124244,-11.129874,-11.178744,-11.192783,-11.191263,-11.199493,-11.201923,-11.191073,-11.175794,-11.179554,-11.191703,-11.194723,-11.209363,-11.231533,-11.231943,-11.211133,-11.234173,-11.262083,-11.274753,-11.268493,-11.273703,-11.302853,-11.315323,-11.329053,-11.328533,-11.349273,-11.313043,-11.296163,-11.315043,-11.322683,-11.356383,-11.360153,-11.374493,-11.382353,-11.382533,-11.391973,-11.406983,-11.412643,-11.420423,-11.416293,-11.396853,-11.417433,-11.413403,-11.398133,-11.397523,-11.382513,-11.380093,-11.365383,-11.350963,-11.369643,-11.363003,-11.339893,-11.321453,-11.301203,-11.323443,-11.280013,-11.248553,-11.240723,-11.241543,-11.225784,-11.237304,-11.226814,-11.207694,-11.183704,-11.160794,-11.153674,-11.133824,-11.122384,-11.130314,-11.164904,-11.183164,-11.180304,-11.196804,-11.197424,-11.218524,-11.221624,-11.263814,-11.276724,-11.233084,-11.213554,-11.199374,-11.175394,-11.164874,-11.173205,-11.165595,-11.155875,-11.140365,-11.115725,-11.119945,-11.133945,-11.148915,-11.193765,-11.207975,-11.295455,-11.287375,-11.296865,-11.299155,-11.264535,-11.269995,-11.262235,-11.237915,-11.225635,-11.211325,-11.218075,-11.258415,-11.272276,-11.284126,-11.282176,-11.299486,-11.292736,-11.310106,-11.317046,-11.318456,-11.329936,-11.330916,-11.345406,-11.349896,-11.340466,-11.342006,-11.367916,-11.394547,-11.410267,-11.436637,-11.477527,-11.515587,-11.514207,-11.523307,-11.519077,-11.495287,-11.470077,-11.446377,-11.438097,-11.420737,-11.404687,-11.395137,-11.392566,-11.419036,-11.416906,-11.429826,-11.425896,-11.384706,-11.347456,-11.340066,-11.329806,-11.339925,-11.331725,-11.363625,-11.367605,-11.416805,-11.432825,-11.502846,-11.520985,-11.548306,-11.591176,-11.633116,-11.702237,-11.728637,-11.740646,-11.730766,-11.717706,-11.702806,-11.693715,-11.717905,-11.727155,-11.719556,-11.738986,-11.758176,-11.769845,-11.764685,-11.775545,-11.776115,-11.767425,-11.757705,-11.752065,-11.732084,-11.739444,-11.748135,-11.757525,-11.757505,-11.767785,-11.779555,-11.778345,-11.790435,-11.801975,-11.781304,-11.781224,-11.760334,-11.770284,-11.791094,-11.812984,-11.826994,-11.806804,-11.809164,-11.816344,-11.833724,-11.842784,-11.818904,-11.809054,-11.788633,-11.794073,-11.779583,-11.773943,-11.782773,-11.782583,-11.761143,-11.732123,-11.727492,-11.733792,-11.724672,-11.730212,-11.723222,-11.744432,-11.753922,-11.754191,-11.742441,-11.764141,-11.770351,-11.772381,-11.805711,-11.812372,-11.805132,-11.813482,-11.838102,-11.864992,-11.858782,-11.879912,-11.877992,-11.902512,-11.901382,-11.910522,-11.913812,-11.906891,-11.927621,-11.916761,-11.920261,-11.894961,-11.86378,-11.85497,-11.86952,-11.89223,-11.8982,-11.91595,-11.93346,-11.93432,-11.94182,-11.92962,-11.924519,-11.912889,-11.897279,-11.920599,-11.956789,-11.972499,-11.963459,-11.987989,-12.002259,-11.994179,-12.014979,-12.028678,-12.100449,-12.114769,-12.105348,-12.074468,-12.036468,-12.034148,-11.984748,-11.983797,-12.008447,-12.039126,-12.064506,-12.067475,-12.069875,-12.075875,-12.071605,-12.077235,-12.048994,-12.015103,-11.962833,-11.967083,-11.959872,-11.949342,-11.959782,-11.995172,-12.003402,-12.047782,-12.056091,-12.074901,-12.055511,-12.061611,-12.112171,-12.131031,-12.134271,-12.153201,-12.14251,-12.15839,-12.21296,-12.263609,-12.237389,-12.242839,-12.236739,-12.249769,-12.264819,-12.295298,-12.288638,-12.274268,-12.253538,-12.239058,-12.231789,-12.225009,-12.225848,-12.234528,-12.224928,-12.252878,-12.260258,-12.246377,-12.232247,-12.241598,-12.220988,-12.200398,-12.207958,-12.188688,-12.179708,-12.164008,-12.162898,-12.145388,-12.135758,-12.124338,-12.105957,-12.084717,-12.092757,-12.082027,-12.083057,-12.101817,-12.113917,-12.114057,-12.085906,-12.059806,-12.064456,-12.087636,-12.100746,-12.078476,-12.078336,-12.076896,-12.054625,-12.059055,-12.053385,-12.039505,-12.034595,-12.009145,-12.007775,-11.981314,-11.965704,-11.952393,-11.959963,-11.986144,-11.975744,-11.984284,-11.995354,-12.000714,-12.043944,-12.079455,-12.090315,-12.126055,-12.149925,-12.168475,-12.201705,-12.241725,-12.262515,-12.281165,-12.312562,-12.293485,-12.262495,-12.253784,-12.259084,-12.224944,-12.212044,-12.198924,-12.201174,-12.184434,-12.191324,-12.182074,-12.184074,-12.169144,-12.174224,-12.158624,-12.150694,-12.150684,-12.177374,-12.184934,-12.149754,-12.149293,-12.161943,-12.143393,-12.150273,-12.138513,-12.151293,-12.151953,-12.137033,-12.137413,-12.116853,-12.105443,-12.100453,-12.093113,-12.083953,-12.076222,-12.066262,-12.063082,-12.123393,-12.151923,-12.185283,-12.182033,-12.196843,-12.199343,-12.222093,-12.237233,-12.249633,-12.269643,-12.279043,-12.268113,-12.242323,-12.245398,-12.233273,-12.240032,-12.231752,-12.240882,-12.269042,-12.271002,-12.294752,-12.290823,-12.303833,-12.304382,-12.319292,-12.331183,-12.359803,-12.369223,-12.386763,-12.395113,-12.400053,-12.397082,-12.440983,-12.453512,-12.462353,-12.457342,-12.484922,-12.486152,-12.473472,-12.479342,-12.457062,-12.430012,-12.434962,-12.448082,-12.457442,-12.453112,-12.439082,-12.452402,-12.435491,-12.444401,-12.470521,-12.463281,-12.461571,-12.46572,-12.44544,-12.45644,-12.4434,-12.44145,-12.381859,-12.37635,-12.36753,-12.326649,-12.306889,-12.301299,-12.277189,-12.278509,-12.265239,-12.257499,-12.230379,-12.211409,-12.206009,-12.200169,-12.202979,-12.195659,-12.21072,-12.20536,-12.213191,-12.187331,-12.182661,-12.184751,-12.195531,-12.192061,-12.178161,-12.168771,-12.163021,-12.158031,-12.163071,-12.152401,-12.130821,-12.131681,-12.118451,-12.11051,-12.06501,-12.045539,-12.059089,-12.059179,-12.043889,-12.032829,-12.030989,-12.021149,-12.027669,-12.011399,-12.019619,-12.011339,-11.997449,-11.958678,-11.958438,-11.971088,-11.954128,-11.941478,-11.952617,-11.936017,-11.939207,-11.914597,-11.923347,-11.917507,-11.902057,-11.886307,-11.876607,-11.894017,-11.902866,-11.915526,-11.947257,-11.960318,-11.996588,-11.978868,-11.987458,-11.999452,-11.999948,-12.005718,-11.999688,-12.018198,-12.024038,-12.034463,-12.030818,-12.040088,-12.027307,-12.028987,-12.009547,-12.003407,-11.997897,-11.987997,-11.991437,-12.081298,-12.091146,-12.084486,-12.095106,-12.107786,-12.125586,-12.146067,-12.202296,-12.235496,-12.269716,-12.288175,-12.277665,-12.276015,-12.288465,-12.266925,-12.276085,-12.271824,-12.235054,-12.232994,-12.214144,-12.229785,-12.211385,-12.190325,-12.205625,-12.186335,-12.186965,-12.182475,-12.172425,-12.159094,-12.185103,-12.211553,-12.210243,-12.219653,-12.243666,-12.245954,-12.280773,-12.283273,-12.275713,-12.282722,-12.324072,-12.333872,-12.344243,-12.357942,-12.350282,-12.340802,-12.345442,-12.363822,-12.374552,-12.369792,-12.392433,-12.413653,-12.431343,-12.506344,-12.525274,-12.555524,-12.525694,-12.496134,-12.492214,-12.449754,-12.447324,-12.467424,-12.478564,-12.458235,-12.468605,-12.478324,-12.493955,-12.517864,-12.529024,-12.536144,-12.533914,-12.562904,-12.553864,-12.553845,-12.566265,-12.567355,-12.587555,-12.581205,-12.590565,-12.603575,-12.593625,-12.598605,-12.590815,-12.586665,-12.569165,-12.571905,-12.562775,-12.570924,-12.551644,-12.577404,-12.579174,-12.632275,-12.669065,-12.687585,-12.704105,-12.711095,-12.704395,-12.711355,-12.689846,-12.700245,-12.714886,-12.740266,-12.756676,-12.773965,-12.814925,-12.839455,-12.821586,-12.804026,-12.778956,-12.790076,-12.767096,-12.763796,-12.740376,-12.745416,-12.758276,-12.801876,-12.806756,-12.807146,-12.768027,-12.780167,-12.772047,-12.793507,-12.801577,-12.841577,-12.851836,-12.875466,-12.881616,-12.874196,-12.896306,-12.916306,-12.920126,-12.914186,-12.930075,-12.952945,-12.950715,-12.990475,-13.004314,-13.015825,-13.017395,-13.001605,-12.994725,-12.974625,-12.967605,-12.975115,-12.989925,-13.001335,-13.018435,-13.018115,-12.997825,-12.986776,-12.981386,-12.964996,-12.970376,-12.979186,-12.982216,-12.991926,-12.976766,-12.992466,-12.977386,-12.978237,-12.991357,-12.995906,-13.006456,-12.998026,-12.996606,-13.016026,-13.018976,-13.051946,-13.058835,-13.110765,-13.154425,-13.139905,-13.14035,-13.141846,-13.169676,-13.184865,-13.201665,-13.234315,-13.247545,-13.254706,-13.248476,-13.224436,-13.217386,-13.230596,-13.243256,-13.309886,-13.325876,-13.324706,-13.311716,-13.298577,-13.276606,-13.250027,-13.246036,-13.252696,-13.227066,-13.203026,-13.196836,-13.166577,-13.147107,-13.139527,-13.116497,-13.108847,-13.092567,-13.070447,-13.056307,-13.044857,-13.034147,-13.047407,-13.071487,-13.093507,-13.107577,-13.108887,-13.120107,-13.144797,-13.159627,-13.168097,-13.151827,-13.145187,-13.158577,-13.154668,-13.132768,-13.121288,-13.145588,-13.138268,-13.146308,-13.154288,-13.155148,-13.169738,-13.173508,-13.187578,-13.212467,-13.204558,-13.203788,-13.233248,-13.246988,-13.244938,-13.232988,-13.242088,-13.251688,-13.274708,-13.280798,-13.266578,-13.218888,-13.207299,-13.183528,-13.145699,-13.120549,-13.158579,-13.172399,-13.209549,-13.232629,-13.226329,-13.234409,-13.249309,-13.263149,-13.309849,-13.299189,-13.289159,-13.243239,-13.21491,-13.21295,-13.22264,-13.29479,-13.25344,-13.26843,-13.28678,-13.29507,-13.32368,-13.36307,-13.37902,-13.37755,-13.39628,-13.40444,-13.417749,-13.410479,-13.402329,-13.445589,-13.448149,-13.435009,-13.442399,-13.458239,-13.466819,-13.462459,-13.42517,-13.4289,-13.44024,-13.47687,-13.51998,-13.53144,-13.561739,-13.56636,-13.59083,-13.612979,-13.622269,-13.656649,-13.669089,-13.658179,-13.675979,-13.688029,-13.700399,-13.712039,-13.747239,-13.743358,-13.731618,-13.709958,-13.707448,-13.688488,-13.682478,-13.652058,-13.656068,-13.644778,-13.655457,-13.672767,-13.669857,-13.680647,-13.694657,-13.716478,-13.746757,-13.762818,-13.791598,-13.828347,-13.857847,-13.896127,-13.913667,-13.949297,-13.953747,-13.990438,-14.042497,-14.074617,-14.094317,-14.107427,-14.166827,-14.190517,-14.193797,-14.181367,-14.181277,-14.228967,-14.231517,-14.226067,-14.260687,-14.281947,-14.271368,-14.296677,-14.399167,-14.424377,-14.418397,-14.419537,-14.427567,-14.423108,-14.484718,-14.505147,-14.514998,-14.537497,-14.536258,-14.561138,-14.625477,-14.640947,-14.642547,-14.652717,-14.653287,-14.675787,-14.667087,-14.675787,-14.694137,-14.735027,-14.736597,-14.719188,-14.725738,-14.771877,-14.808627,-14.848547,-14.873137,-14.870597,-14.891747,-14.910706,-14.948966,-14.97606,-15.045305,-15.051995,-15.044445,-15.052535,-15.071585,-15.087524,-15.116294,-15.116514,-15.182743,-15.249212,-15.286991,-15.31679,-15.33917,-15.36429,-15.392339,-15.392878,-15.401138,-15.416088,-15.448618,-15.496728,-15.535779,-15.572359,-15.589609,-15.625989,-15.601979,-15.613408,-15.626158,-15.666438,-15.731948,-15.728898,-15.739158,-15.742148,-15.750398,-15.741838,-15.727578,-15.725048,-15.706167,-15.672446,-15.678486,-15.663926,-15.667786,-15.684616,-15.683526,-15.696756,-15.696345,-15.777916,-15.769127,-15.778971,-15.781587,-15.791607,-15.794147,-15.805237,-15.814487,-15.856807,-15.877257,-15.903408,-15.931228,-15.932397,-15.889446,-15.906387,-15.916267,-15.902796,-15.911796,-15.904506,-15.899236,-15.908286,-15.907525,-15.916257,-15.913635,-15.923575,-15.922355,-15.932285,-15.924845,-15.928475,-15.936495,-15.932914,-15.938334,-15.917084,-15.899684,-15.880174,-15.874893,-15.861563,-15.850953,-15.875133,-15.880673,-15.875133,-15.879323,-15.869493,-15.873103,-15.922252,-15.944162,-15.969461,-15.999341,-16.01235,-16.085119,-16.08112,-16.114999,-16.133349,-16.126419,-16.137018,-16.131898,-16.115629,-16.126618,-16.144318,-16.139258,-16.168017,-16.174293,-16.164233,-16.174823,-16.222322,-16.232252,-16.261771,-16.285721,-16.326001,-16.42271,-16.544509,-25.996867,-25.998613,-14.879473,-14.886404,-14.907474,-14.907864,-14.895314,-14.891074,-14.915063,-14.934444,-14.989234,-14.953124,-14.948973,-14.969083,-14.983424,-14.969313,-14.987173,-15.051533,-15.076401,-15.08892,-15.102657,-15.12261,-15.147453,-15.168373,-15.184362,-15.197602,-15.195692,-15.183122,-15.189412,-15.173913,-15.146683,-15.159303,-15.175933,-15.153844,-15.128741,-15.108587,-15.091536,-15.06779,-15.055972,-15.033953,-15.038413,-15.061991,-15.043503,-15.029293,-15.041763,-15.036533,-15.040513,-15.026843,-15.032903,-15.008293,-14.986463,-14.924383,-14.910693,-14.855403,-14.839373,-14.841342,-14.852582,-14.845302,-14.850112,-14.865012,-14.859452,-14.872992,-14.873682,-14.903172,-14.909062,-14.924932,-14.917592,-14.921391,-14.94106,-15.005689,-15.028089,-15.048727,-15.108006,-15.128906,-15.155136,-15.170536,-15.179916,-15.155626,-15.153736,-15.138026,-15.139507,-15.148547,-15.142667,-15.131027,-15.099347,-15.071217,-15.042167,-15.028097,-15.023397,-15.032857,-14.998587,-14.953257,-14.947687,-14.956909,-14.970359,-14.967069,-14.878519,-14.869029,-14.843859,-14.803219,-14.790109,-14.806799,-14.847559,-14.891009,-14.875607,-14.839377,-14.806769,-14.798299,-14.843867,-14.834407,-14.848817,-14.852327,-14.841357,-14.848977,-14.858017,-14.843308,-14.826188,-14.820108,-14.813898,-14.806888,-14.810608,-14.801678,-14.799428,-14.773218,-14.776208,-14.813298,-14.822878,-14.818908,-14.828028,-14.823598,-14.809698,-14.795378,-14.769058,-14.769418,-14.760318,-14.766808,-14.756408,-14.771298,-14.783058,-14.782018,-14.793968,-14.763468,-14.746158,-14.72606,-14.715278,-14.679653,-14.674389,-14.661259,-14.637929,-14.616239,-14.612789,-14.582829,-14.569719,-14.547569,-14.538709,-14.580489,-14.562549,-14.550809,-14.55229,-14.50334,-14.465559,-14.471969,-14.460169,-14.471739,-14.50095,-14.45945,-14.44965,-14.4582,-14.44181,-14.45106,-14.44639,-14.46057,-14.49099,-14.50506,-14.49962,-14.48358,-14.46734,-14.44993,-14.41613,-14.42647,-14.41941,-14.42363,-14.3825,-14.35473,-14.3381,-14.31682,-14.28827,-14.29112,-14.27713,-14.27946,-14.23594,-14.22639,-14.19119,-14.19368,-14.127889,-14.133229,-14.127049,-14.116479,-14.103619,-14.078959,-14.07847,-14.04793,-14.047399,-14.075369,-14.052339,-14.058359,-14.081419,-14.091149,-14.129999,-14.144528,-14.142159,-14.111869,-14.083859,-14.091231,-14.069591,-14.053581,-14.032861,-14.011061,-14.035611,-14.0472,-14.01343,-13.975139,-13.952199,-13.946999,-13.919199,-13.8972,-13.89629,-13.87888,-13.84791,-13.82687,-13.789429,-13.789519,-13.768179,-13.66691,-13.56119,-13.51814,-13.50176,-13.51147,-13.49909,-13.50323,-13.49345,-13.47977,-13.44041,-13.4986,-13.51434,-13.535809,-13.533339,-13.499448,-13.503698,-13.456308,-13.466197,-13.457117,-13.408637,-13.374207,-13.368216,-13.339676,-13.334866,-13.305756,-13.282487,-13.249197,-13.178029,-13.176539,-13.164139,-13.133399,-13.107479,-13.079379,-13.000669,-12.973699,-12.933458,-12.929228,-12.910277,-12.910507,-12.927808,-12.947028,-12.948377,-12.890117,-12.881077,-12.807237,-12.795377,-12.734777,-12.715227,-12.670337,-12.682037,-12.677677,-12.701477,-12.685337,-12.680147,-12.662287,-12.655607,-12.664525,-12.656957,-12.645427,-12.633656,-12.645516,-12.639176,-12.667286,-12.667765,-12.691376,-12.717966,-12.715006,-12.731048]},{&#34;lng&#34;:[136.493656,136.49489,136.49038,136.493656],&#34;lat&#34;:[-13.13719,-13.130756,-13.135076,-13.13719]},{&#34;lng&#34;:[136.920057,136.89847,136.87916,136.87282,136.88238,136.910529,136.920057],&#34;lat&#34;:[-12.345105,-12.362623,-12.366323,-12.380653,-12.367913,-12.367723,-12.345105]},{&#34;lng&#34;:[136.484882,136.481587,136.464817,136.489277,136.484882],&#34;lat&#34;:[-12.038282,-12.050148,-12.050908,-12.056258,-12.038282]},{&#34;lng&#34;:[134.46031,134.447525,134.455485,134.46031],&#34;lat&#34;:[-12.07059,-12.074575,-12.077815,-12.07059]},{&#34;lng&#34;:[130.624928,130.624345,130.635194,130.624928],&#34;lat&#34;:[-12.769794,-12.775105,-12.774195,-12.769794]},{&#34;lng&#34;:[131.018004,131.018767,131.019277,131.018004],&#34;lat&#34;:[-12.362999,-12.37165,-12.36212,-12.362999]}],[{&#34;lng&#34;:[137.106124,137.097714,137.072865,137.074255,137.039845,137.044045,137.034495,137.016285,136.992615,136.989375,136.978755,136.982385,136.969665,136.980755,136.974575,136.982825,136.978375,136.963855,136.959095,136.947655,136.953935,136.947285,136.941105,136.941585,136.929805,136.940075,136.934035,136.939285,136.918305,136.938245,136.947925,136.941165,136.946895,136.936285,136.949345,136.961025,136.970115,136.969395,136.984195,136.983955,136.994454,136.994464,136.980475,136.976764,136.999964,136.991374,137.019914,137.033644,137.054504,137.058364,137.067104,137.059874,137.063104,137.081664,137.076064,137.085494,137.077784,137.083034,137.073434,137.080354,137.078484,137.106124],&#34;lat&#34;:[-15.772531,-15.812051,-15.834402,-15.846262,-15.835522,-15.817232,-15.797122,-15.805582,-15.792132,-15.760622,-15.761972,-15.749552,-15.749093,-15.740512,-15.737572,-15.723572,-15.712422,-15.730562,-15.709892,-15.717673,-15.740043,-15.733143,-15.739463,-15.725573,-15.726463,-15.719923,-15.697333,-15.690113,-15.683763,-15.685033,-15.676002,-15.672272,-15.661552,-15.660412,-15.658282,-15.640102,-15.642822,-15.661122,-15.667002,-15.674462,-15.664532,-15.657862,-15.655032,-15.634472,-15.622862,-15.584462,-15.594871,-15.635191,-15.640401,-15.628321,-15.628771,-15.641311,-15.652701,-15.655771,-15.661641,-15.712911,-15.743281,-15.747911,-15.745851,-15.749721,-15.760671,-15.772531]}],[{&#34;lng&#34;:[137.074485,137.068885,137.067715,137.074485],&#34;lat&#34;:[-15.854732,-15.866252,-15.857212,-15.854732]}],[{&#34;lng&#34;:[136.964126,136.954096,136.940156,136.934276,136.936096,136.951916,136.945716,136.959806,136.940727,136.947946,136.964576,136.935837,136.935927,136.952186,136.949957,136.909567,136.899007,136.904367,136.896407,136.890897,136.883518,136.876948,136.859568,136.845478,136.842458,136.830018,136.825548,136.819129,136.812379,136.824369,136.814759,136.802779,136.812999,136.809449,136.75546,136.694211,136.679741,136.682461,136.670382,136.649892,136.645632,136.633902,136.628193,136.540515,136.524595,136.490816,136.455507,136.450787,136.437348,136.395549,136.35658,136.3247,136.324461,136.411409,136.422119,136.421029,136.442608,136.429629,136.433159,136.41802,136.41817,136.408151,136.436141,136.429021,136.408042,136.409232,136.422572,136.434711,136.446721,136.440451,136.457131,136.46276,136.49563,136.524569,136.523819,136.531889,136.542578,136.539218,136.552228,136.560248,136.566188,136.574167,136.583937,136.599757,136.594097,136.624416,136.638016,136.629276,136.630546,136.607676,136.618156,136.607306,136.588637,136.592367,136.574237,136.577777,136.612126,136.618906,136.636356,136.617066,136.632126,136.647455,136.661865,136.664035,136.676275,136.678505,136.693774,136.695304,136.710484,136.715263,136.728553,136.730973,136.719883,136.707274,136.694464,136.686044,136.681074,136.685394,136.690624,136.689524,136.697054,136.735352,136.712493,136.716843,136.729142,136.718303,136.725352,136.754461,136.807348,136.837318,136.845488,136.837278,136.813719,136.796999,136.814739,136.839308,136.840528,136.864368,136.888657,136.905216,136.924406,136.912026,136.883996,136.858486,136.857806,136.812587,136.793188,136.778908,136.762279,136.778979,136.807518,136.807558,136.784099,136.777319,136.775249,136.760199,136.74788,136.75222,136.73779,136.73662,136.72059,136.72413,136.713261,136.72065,136.711351,136.699661,136.705451,136.715591,136.707081,136.72625,136.785429,136.788169,136.77089,136.782419,136.776809,136.788569,136.800339,136.810919,136.842938,136.853918,136.865778,136.893617,136.914747,136.911297,136.930696,136.920357,136.928337,136.945176,136.964126],&#34;lat&#34;:[-14.165254,-14.193134,-14.189194,-14.203714,-14.212164,-14.219584,-14.225514,-14.244924,-14.260354,-14.276214,-14.282604,-14.281744,-14.290894,-14.294924,-14.304204,-14.284924,-14.297104,-14.310504,-14.301764,-14.307914,-14.299064,-14.302844,-14.278155,-14.282795,-14.295135,-14.277855,-14.283315,-14.277495,-14.287385,-14.293495,-14.294365,-14.288595,-14.279355,-14.270695,-14.258056,-14.275856,-14.290886,-14.297756,-14.287047,-14.296217,-14.286077,-14.283577,-14.265037,-14.254148,-14.233819,-14.237009,-14.21805,-14.20394,-14.1963,-14.202331,-14.220111,-14.246111,-14.213321,-14.169491,-14.154981,-14.142321,-14.123471,-14.094241,-14.079761,-14.058002,-13.996012,-13.976332,-13.890793,-13.869313,-13.845313,-13.830973,-13.815643,-13.815113,-13.822143,-13.831393,-13.819233,-13.834503,-13.840832,-13.821482,-13.791532,-13.785022,-13.789102,-13.814042,-13.819822,-13.815262,-13.829942,-13.798552,-13.808611,-13.807041,-13.787031,-13.790771,-13.783551,-13.777251,-13.766191,-13.763611,-13.744171,-13.730052,-13.724342,-13.696582,-13.694262,-13.687402,-13.678642,-13.688692,-13.688511,-13.706002,-13.720561,-13.700131,-13.704111,-13.694411,-13.702191,-13.680081,-13.652191,-13.662041,-13.657541,-13.665941,-13.65216,-13.68702,-13.71774,-13.71567,-13.728801,-13.727151,-13.739421,-13.748151,-13.744591,-13.7639,-13.77492,-13.77096,-13.79381,-13.8108,-13.81972,-13.8358,-13.842279,-13.832359,-13.856016,-13.842907,-13.815048,-13.802438,-13.812068,-13.834188,-13.801918,-13.780308,-13.745188,-13.755438,-13.753938,-13.764127,-13.806527,-13.807557,-13.842807,-13.893216,-13.912836,-13.904137,-13.914027,-13.934017,-14.000987,-14.023927,-14.018116,-14.035856,-14.039787,-14.058027,-14.046187,-14.046427,-14.066527,-14.086937,-14.078357,-14.065527,-14.069917,-14.078137,-14.093137,-14.104257,-14.099817,-14.114597,-14.140767,-14.142247,-14.168987,-14.189167,-14.193116,-14.184906,-14.169466,-14.163386,-14.144566,-14.151586,-14.146966,-14.164156,-14.183075,-14.206475,-14.210775,-14.203515,-14.171475,-14.137615,-14.143875,-14.152555,-14.164345,-14.157075,-14.165254]}],[{&#34;lng&#34;:[136.962484,136.951214,136.950334,136.925485,136.933315,136.962484],&#34;lat&#34;:[-13.626417,-13.648927,-13.643497,-13.644537,-13.634437,-13.626417]}],[{&#34;lng&#34;:[136.949935,136.946665,136.940145,136.947145,136.949935],&#34;lat&#34;:[-15.772453,-15.777193,-15.768603,-15.759343,-15.772453]}],[{&#34;lng&#34;:[136.937355,136.929005,136.925815,136.937355],&#34;lat&#34;:[-13.662817,-13.667157,-13.661827,-13.662817]}],[{&#34;lng&#34;:[136.913436,136.900606,136.886987,136.908506,136.913436],&#34;lat&#34;:[-13.662858,-13.678008,-13.676088,-13.658408,-13.662858]}],[{&#34;lng&#34;:[136.904895,136.895675,136.886825,136.884005,136.861975,136.875365,136.881905,136.880825,136.845486,136.837356,136.851696,136.829906,136.843096,136.831096,136.855255,136.852595,136.841995,136.841565,136.860455,136.867255,136.870615,136.883325,136.873745,136.890685,136.904895],&#34;lat&#34;:[-15.588552,-15.598593,-15.594063,-15.607273,-15.607353,-15.617193,-15.613483,-15.636743,-15.647193,-15.628553,-15.624733,-15.618373,-15.610263,-15.601663,-15.583513,-15.569843,-15.562943,-15.542383,-15.532703,-15.507522,-15.517352,-15.509132,-15.532042,-15.579613,-15.588552]}],[{&#34;lng&#34;:[136.840575,136.827626,136.801646,136.796886,136.781596,136.773566,136.793056,136.833155,136.835705,136.827886,136.836515,136.840575],&#34;lat&#34;:[-15.577173,-15.585053,-15.582414,-15.573144,-15.582384,-15.578634,-15.560034,-15.555473,-15.563613,-15.570603,-15.566203,-15.577173]}],[{&#34;lng&#34;:[136.837568,136.824818,136.809578,136.823708,136.833908,136.837568],&#34;lat&#34;:[-11.664256,-11.676206,-11.673236,-11.658686,-11.656566,-11.664256]}],[{&#34;lng&#34;:[136.836326,136.813806,136.802496,136.804276,136.791066,136.779516,136.798166,136.804436,136.776517,136.764277,136.746187,136.739747,136.732167,136.728487,136.738907,136.749007,136.751267,136.729717,136.736837,136.734546,136.740996,136.735426,136.765636,136.780196,136.794656,136.829136,136.828066,136.836326],&#34;lat&#34;:[-15.686594,-15.700344,-15.697834,-15.685254,-15.684344,-15.701305,-15.703364,-15.723814,-15.746355,-15.742725,-15.749915,-15.762665,-15.758026,-15.734745,-15.712065,-15.718635,-15.712775,-15.700195,-15.697155,-15.677615,-15.672875,-15.646665,-15.640404,-15.648224,-15.644974,-15.662984,-15.676874,-15.686594]}],[{&#34;lng&#34;:[136.829616,136.817716,136.815596,136.812226,136.807077,136.800787,136.803376,136.829616],&#34;lat&#34;:[-15.730744,-15.730614,-15.746874,-15.737264,-15.746075,-15.742225,-15.726074,-15.730744]}],[{&#34;lng&#34;:[136.827308,136.814998,136.801938,136.800208,136.796247,136.797077,136.823977,136.827308],&#34;lat&#34;:[-12.129923,-12.141084,-12.127404,-12.132934,-12.106054,-12.088774,-12.072784,-12.129923]}],[{&#34;lng&#34;:[136.819096,136.791326,136.790056,136.777236,136.791256,136.819096],&#34;lat&#34;:[-15.603223,-15.615374,-15.608824,-15.608004,-15.590644,-15.603223]}],[{&#34;lng&#34;:[136.766169,136.73484,136.73698,136.721711,136.714661,136.720001,136.711641,136.706451,136.694982,136.684682,136.666802,136.684022,136.670292,136.662123,136.648383,136.644893,136.633343,136.625083,136.634214,136.623764,136.627134,136.616145,136.599605,136.588726,136.562327,136.555067,136.537658,136.537578,136.521988,136.525388,136.518358,136.499968,136.502218,136.483889,136.474369,136.494748,136.501938,136.497797,136.520457,136.517467,136.530177,136.533446,136.547776,136.554446,136.551036,136.563166,136.565955,136.582935,136.576895,136.583174,136.620283,136.622882,136.627012,136.631112,136.643602,136.657292,136.672412,136.687261,136.706671,136.703041,136.696181,136.704771,136.70666,136.69374,136.71582,136.72215,136.70068,136.7271,136.737569,136.734059,136.71279,136.725759,136.736029,136.745189,136.736759,136.750929,136.759109,136.766169],&#34;lat&#34;:[-11.02851,-11.11465,-11.12776,-11.15089,-11.17652,-11.19382,-11.19471,-11.21119,-11.21885,-11.21334,-11.22487,-11.24876,-11.24669,-11.26418,-11.26347,-11.28233,-11.27766,-11.28433,-11.29484,-11.30363,-11.32872,-11.32847,-11.34758,-11.383529,-11.398509,-11.416769,-11.426099,-11.440329,-11.444579,-11.435079,-11.43078,-11.44179,-11.45556,-11.45655,-11.4491,-11.43779,-11.42477,-11.39225,-11.3956,-11.38422,-11.37752,-11.36562,-11.36499,-11.35608,-11.34567,-11.34743,-11.33532,-11.32464,-11.31626,-11.2817,-11.23807,-11.21006,-11.20498,-11.21381,-11.20989,-11.18495,-11.19701,-11.19272,-11.16791,-11.15287,-11.15184,-11.14791,-11.12509,-11.11974,-11.12466,-11.10987,-11.0923,-11.09723,-11.07601,-11.06064,-11.054701,-11.039601,-11.05058,-11.04823,-11.033861,-11.030261,-11.017651,-11.02851]}],[{&#34;lng&#34;:[136.762108,136.747889,136.736599,136.762108],&#34;lat&#34;:[-11.004551,-11.020101,-11.007311,-11.004551]}],[{&#34;lng&#34;:[136.753982,136.733483,136.738182,136.753982],&#34;lat&#34;:[-13.69057,-13.6957,-13.68636,-13.69057]}],[{&#34;lng&#34;:[136.71275,136.700228,136.696791,136.705807,136.696638,136.709109,136.71275],&#34;lat&#34;:[-12.217115,-12.228824,-12.222728,-12.212869,-12.207066,-12.203675,-12.217115]}],[{&#34;lng&#34;:[136.702274,136.695284,136.701794,136.686344,136.702274],&#34;lat&#34;:[-13.620411,-13.625881,-13.634981,-13.631341,-13.620411]}],[{&#34;lng&#34;:[136.688384,136.680644,136.680894,136.688384],&#34;lat&#34;:[-13.634971,-13.647671,-13.633101,-13.634971]}],[{&#34;lng&#34;:[136.688153,136.669764,136.643024,136.688153],&#34;lat&#34;:[-11.821446,-11.836656,-11.839746,-11.821446]}],[{&#34;lng&#34;:[136.682624,136.676245,136.665975,136.659665,136.668715,136.662425,136.682624],&#34;lat&#34;:[-13.658801,-13.678881,-13.684711,-13.679681,-13.663831,-13.656321,-13.658801]}],[{&#34;lng&#34;:[136.681306,136.673946,136.646446,136.654756,136.669456,136.681306],&#34;lat&#34;:[-15.605335,-15.612206,-15.606156,-15.593636,-15.590506,-15.605335]}],[{&#34;lng&#34;:[136.656735,136.647775,136.643706,136.656735],&#34;lat&#34;:[-13.655251,-13.665681,-13.656942,-13.655251]}],[{&#34;lng&#34;:[136.641666,136.631296,136.632236,136.641136,136.641666],&#34;lat&#34;:[-13.664142,-13.673322,-13.659552,-13.656852,-13.664142]}],[{&#34;lng&#34;:[136.630207,136.621447,136.618247,136.626427,136.630207],&#34;lat&#34;:[-12.863185,-12.868815,-12.858525,-12.854485,-12.863185]}],[{&#34;lng&#34;:[136.627212,136.591703,136.584563,136.589243,136.579823,136.511514,136.515704,136.534313,136.533783,136.546833,136.545153,136.559083,136.557623,136.572103,136.565103,136.587683,136.587253,136.578653,136.587512,136.609632,136.614942,136.627212],&#34;lat&#34;:[-11.740267,-11.764247,-11.774847,-11.782657,-11.788737,-11.804927,-11.786858,-11.776627,-11.760238,-11.771687,-11.780907,-11.780987,-11.767427,-11.778677,-11.760777,-11.764577,-11.756327,-11.755057,-11.744117,-11.751297,-11.737757,-11.740267]}],[{&#34;lng&#34;:[136.617327,136.604837,136.596507,136.604807,136.598967,136.605017,136.594287,136.589687,136.570317,136.550887,136.539177,136.522848,136.494748,136.513388,136.504508,136.520058,136.522078,136.511068,136.525658,136.525328,136.566817,136.578647,136.610417,136.617327],&#34;lat&#34;:[-15.555366,-15.560876,-15.581297,-15.615197,-15.620047,-15.623787,-15.626017,-15.645317,-15.649338,-15.639868,-15.653768,-15.654398,-15.643548,-15.622628,-15.592098,-15.576227,-15.563017,-15.544567,-15.538397,-15.530947,-15.530606,-15.510876,-15.523836,-15.555366]}],[{&#34;lng&#34;:[136.602557,136.591257,136.575547,136.586297,136.602557],&#34;lat&#34;:[-13.657002,-13.667532,-13.667042,-13.653812,-13.657002]}],[{&#34;lng&#34;:[136.584137,136.574597,136.569678,136.584137],&#34;lat&#34;:[-13.723062,-13.729862,-13.724392,-13.723062]}],[{&#34;lng&#34;:[136.579127,136.573927,136.572087,136.579127],&#34;lat&#34;:[-13.775322,-13.787252,-13.773762,-13.775322]}],[{&#34;lng&#34;:[136.541648,136.520229,136.4993,136.4904,136.469211,136.47113,136.49518,136.50116,136.514589,136.518029,136.509829,136.530929,136.538558,136.531719,136.541648],&#34;lat&#34;:[-13.771392,-13.792622,-13.782973,-13.759243,-13.746533,-13.720553,-13.713383,-13.720553,-13.718563,-13.710003,-13.698513,-13.703463,-13.738902,-13.752282,-13.771392]}],[{&#34;lng&#34;:[136.499804,136.491224,136.499824,136.477945,136.486245,136.479145,136.464126,136.468366,136.457885,136.469715,136.460535,136.473945,136.470835,136.464525,136.479874,136.477444,136.499804],&#34;lat&#34;:[-11.797268,-11.816828,-11.818508,-11.846658,-11.884157,-11.898748,-11.904068,-11.896948,-11.889858,-11.876498,-11.866558,-11.858868,-11.841468,-11.841708,-11.819098,-11.801248,-11.797268]}],[{&#34;lng&#34;:[136.473819,136.4617,136.46606,136.44901,136.425871,136.427131,136.409031,136.404221,136.374201,136.366511,136.381191,136.386101,136.400881,136.402371,136.42184,136.43019,136.44657,136.456289,136.473819],&#34;lat&#34;:[-11.46797,-11.49859,-11.50526,-11.53193,-11.53669,-11.54652,-11.54393,-11.55467,-11.56564,-11.53469,-11.55039,-11.52542,-11.52179,-11.52733,-11.51297,-11.49093,-11.49431,-11.47374,-11.46797]}],[{&#34;lng&#34;:[136.459196,136.453816,136.434886,136.457006,136.459196],&#34;lat&#34;:[-11.904748,-11.917408,-11.919348,-11.897068,-11.904748]}],[{&#34;lng&#34;:[136.431975,136.430276,136.408816,136.404576,136.385996,136.366946,136.398486,136.396416,136.409726,136.408095,136.418555,136.426115,136.431975],&#34;lat&#34;:[-11.879018,-11.894948,-11.893608,-11.902198,-11.906609,-11.902899,-11.889768,-11.878018,-11.878468,-11.855188,-11.874048,-11.865578,-11.879018]}],[{&#34;lng&#34;:[136.419932,136.396723,136.400772,136.417072,136.419932],&#34;lat&#34;:[-13.631644,-13.627855,-13.620805,-13.621805,-13.631644]}],[{&#34;lng&#34;:[136.400763,136.384133,136.380243,136.400763],&#34;lat&#34;:[-13.714154,-13.711174,-13.694565,-13.714154]}],[{&#34;lng&#34;:[136.383432,136.374872,136.369122,136.383432],&#34;lat&#34;:[-13.313576,-13.319426,-13.313306,-13.313576]}],[{&#34;lng&#34;:[136.377082,136.365052,136.355422,136.337662,136.332172,136.316692,136.296873,136.289763,136.264663,136.256643,136.270163,136.272233,136.261463,136.230733,136.231193,136.223743,136.213543,136.214343,136.203913,136.172494,136.159534,136.163784,136.180864,136.168143,136.169523,136.207583,136.209983,136.230733,136.232913,136.223513,136.242543,136.239793,136.265112,136.270962,136.280012,136.281282,136.315092,136.314172,136.296752,136.295482,136.308892,136.321042,136.340642,136.338342,136.348432,136.345671,136.358161,136.360791,136.371681,136.369062,136.377082],&#34;lat&#34;:[-11.58349,-11.59796,-11.59435,-11.60588,-11.62351,-11.61752,-11.64159,-11.62228,-11.621041,-11.632671,-11.627251,-11.639,-11.66216,-11.668041,-11.655611,-11.652901,-11.659111,-11.674141,-11.665891,-11.694251,-11.693002,-11.678542,-11.675151,-11.656512,-11.641032,-11.656521,-11.641831,-11.645671,-11.628271,-11.618331,-11.620251,-11.600361,-11.572561,-11.585331,-11.582961,-11.603181,-11.60385,-11.59278,-11.591881,-11.580131,-11.570861,-11.58577,-11.58871,-11.57955,-11.57729,-11.5634,-11.56011,-11.54949,-11.56553,-11.58067,-11.58349]}],[{&#34;lng&#34;:[136.373053,136.368853,136.335423,136.354713,136.367083,136.373053],&#34;lat&#34;:[-13.825564,-13.841814,-13.843754,-13.810264,-13.811544,-13.825564]}],[{&#34;lng&#34;:[136.335427,136.323147,136.332897,136.335427],&#34;lat&#34;:[-11.958279,-11.961219,-11.945279,-11.958279]}],[{&#34;lng&#34;:[136.147129,136.140308,136.131358,136.132938,136.145798,136.146278,136.155458,136.172658,136.171478,136.185398,136.192508,136.189238,136.198548,136.202307,136.207848,136.199848,136.217628,136.256157,136.271527,136.281837,136.313057,136.304337,136.312377,136.317197,136.310567,136.277578,136.197738,136.194678,136.178028,136.161018,136.128318,136.118308,136.119438,136.138168,136.147129],&#34;lat&#34;:[-12.053861,-12.038161,-12.039642,-12.025741,-12.027181,-12.037691,-12.041071,-12.029951,-12.013221,-12.029141,-12.027091,-12.000751,-12.006161,-11.996161,-12.008171,-12.021981,-12.035931,-12.00603,-12.00238,-11.97524,-11.974099,-11.99343,-11.985739,-11.992519,-12.01076,-12.03481,-12.060081,-12.076601,-12.076861,-12.065591,-12.073682,-12.061262,-12.050862,-12.060541,-12.053861]}],[{&#34;lng&#34;:[136.301774,136.266165,136.253875,136.254875,136.276385,136.275505,136.283685,136.273495,136.259995,136.254635,136.244675,136.247865,136.199396,136.211186,136.189086,136.192176,136.185656,136.150076,136.144727,136.157616,136.155246,136.169226,136.168246,136.127887,136.105647,136.119807,136.109777,136.112917,136.122546,136.127966,136.139486,136.145216,136.173646,136.181666,136.173616,136.180896,136.173686,136.187466,136.192506,136.181396,136.199615,136.221805,136.254355,136.252325,136.266655,136.274005,136.292494,136.301774],&#34;lat&#34;:[-13.734425,-13.737465,-13.747706,-13.759685,-13.756365,-13.777935,-13.787005,-13.793175,-13.784215,-13.832085,-13.838445,-13.850025,-13.853816,-13.824146,-13.794806,-13.773396,-13.768176,-13.776706,-13.785386,-13.799886,-13.816826,-13.820606,-13.834606,-13.835816,-13.815847,-13.787807,-13.764347,-13.731267,-13.722267,-13.736357,-13.735657,-13.747427,-13.748326,-13.736266,-13.727426,-13.718276,-13.707096,-13.699696,-13.679606,-13.677657,-13.665286,-13.662426,-13.673716,-13.693026,-13.691946,-13.705526,-13.707505,-13.734425]}],[{&#34;lng&#34;:[136.272863,136.267344,136.251414,136.244334,136.238744,136.248234,136.272863],&#34;lat&#34;:[-13.460176,-13.466816,-13.453667,-13.461887,-13.442667,-13.435917,-13.460176]}],[{&#34;lng&#34;:[136.248265,136.235535,136.225165,136.219295,136.236365,136.231555,136.237355,136.248265],&#34;lat&#34;:[-13.594626,-13.603056,-13.600656,-13.588427,-13.594816,-13.585536,-13.577536,-13.594626]}],[{&#34;lng&#34;:[136.209983,136.207923,136.195433,136.193373,136.205063,136.209983],&#34;lat&#34;:[-11.634031,-11.641261,-11.629851,-11.613802,-11.615271,-11.634031]}],[{&#34;lng&#34;:[136.205914,136.194194,136.181294,136.170764,136.165504,136.151024,136.142125,136.143565,136.149145,136.156245,136.167725,136.165015,136.155105,136.149185,136.149985,136.140525,136.126615,136.150055,136.139135,136.126935,136.132125,136.121755,136.135964,136.130404,136.141754,136.127034,136.089224,136.092594,136.115214,136.140784,136.150504,136.161844,136.180394,136.177114,136.205914],&#34;lat&#34;:[-13.454747,-13.472547,-13.463577,-13.468507,-13.485317,-13.468317,-13.470317,-13.487157,-13.495327,-13.491267,-13.509837,-13.523947,-13.518717,-13.525017,-13.557897,-13.564187,-13.543807,-13.511017,-13.498097,-13.503537,-13.488017,-13.482207,-13.452557,-13.428477,-13.419147,-13.374578,-13.364708,-13.358278,-13.357588,-13.386437,-13.384667,-13.417417,-13.426297,-13.437577,-13.454747]}],[{&#34;lng&#34;:[136.15581,136.11385,136.10442,136.1216,136.12989,136.14779,136.15581],&#34;lat&#34;:[-12.189161,-12.199192,-12.189712,-12.167972,-12.177682,-12.171311,-12.189161]}],[{&#34;lng&#34;:[136.155414,136.130864,136.125254,136.140624,136.138214,136.155414],&#34;lat&#34;:[-11.696282,-11.725312,-11.711182,-11.697632,-11.682832,-11.696282]}],[{&#34;lng&#34;:[136.122792,136.108792,136.110642,136.122792],&#34;lat&#34;:[-11.544183,-11.567003,-11.547903,-11.544183]}],[{&#34;lng&#34;:[136.108895,136.106445,136.082655,136.074755,136.082195,136.108895],&#34;lat&#34;:[-13.464088,-13.471648,-13.471998,-13.482588,-13.443638,-13.464088]}],[{&#34;lng&#34;:[136.104595,136.074655,136.077645,136.099785,136.104595],&#34;lat&#34;:[-11.746202,-11.771272,-11.752752,-11.741122,-11.746202]}],[{&#34;lng&#34;:[136.095613,136.091934,136.077964,136.095613],&#34;lat&#34;:[-13.298418,-13.321738,-13.298008,-13.298418]}],[{&#34;lng&#34;:[136.090453,136.079783,136.077273,136.090453],&#34;lat&#34;:[-11.582703,-11.604843,-11.586763,-11.582703]}],[{&#34;lng&#34;:[136.071371,136.048332,136.048061,136.071371],&#34;lat&#34;:[-12.276932,-12.310882,-12.284882,-12.276932]}],[{&#34;lng&#34;:[136.067733,136.062794,136.054544,136.062573,136.067733],&#34;lat&#34;:[-11.635683,-11.646863,-11.641323,-11.627993,-11.635683]}],[{&#34;lng&#34;:[136.056024,135.993385,135.990645,135.981455,135.950175,135.960175,136.004444,136.012004,136.009834,136.024164,136.034934,136.048924,136.056024],&#34;lat&#34;:[-11.653073,-11.719243,-11.703993,-11.714943,-11.696043,-11.670513,-11.650553,-11.654403,-11.648413,-11.639043,-11.647303,-11.644253,-11.653073]}],[{&#34;lng&#34;:[136.050906,136.028756,136.041156,136.050906],&#34;lat&#34;:[-11.786292,-11.812382,-11.783802,-11.786292]}],[{&#34;lng&#34;:[136.047429,136.036989,136.041269,136.032549,136.028,136.026079,136.035589,136.047429],&#34;lat&#34;:[-12.101182,-12.106052,-12.128212,-12.135683,-12.159433,-12.103583,-12.092602,-12.101182]}],[{&#34;lng&#34;:[135.992587,135.980657,135.961817,135.956867,135.945968,135.942087,135.982267,135.992587],&#34;lat&#34;:[-11.851112,-11.856643,-11.879783,-11.898993,-11.904633,-11.879653,-11.848053,-11.851112]}],[{&#34;lng&#34;:[135.978115,135.960546,135.940016,135.937276,135.941186,135.952426,135.952666,135.975595,135.978115],&#34;lat&#34;:[-11.737083,-11.760233,-11.763943,-11.749253,-11.741003,-11.742153,-11.732653,-11.731323,-11.737083]}],[{&#34;lng&#34;:[135.975744,135.961334,135.971894,135.975744],&#34;lat&#34;:[-13.343869,-13.32138,-13.327589,-13.343869]}],[{&#34;lng&#34;:[135.735321,135.760508,135.781288,135.830238,135.832978,135.835087,135.853777,135.871577,135.883537,135.900167,135.903737,135.888937,135.885507,135.866017,135.864886,135.876486,135.889326,135.907106,135.909846,135.928196,135.937917,135.907837,135.900697,135.857988,135.797619,135.776019,135.741819,135.734859,135.63707,135.60538,135.59206,135.564621,135.56439,135.55418,135.564727,135.56314,135.58524,135.588819,135.581489,135.594139,135.605259,135.618799,135.615569,135.632079,135.656779,135.669789,135.666829,135.735321],&#34;lat&#34;:[-11.936628,-11.912655,-11.909634,-11.860994,-11.870264,-11.837614,-11.848264,-11.832464,-11.804114,-11.808203,-11.793853,-11.803214,-11.792134,-11.782734,-11.767594,-11.755624,-11.762194,-11.757243,-11.768203,-11.775003,-11.802593,-11.823573,-11.851473,-11.878434,-11.964684,-11.976524,-11.975565,-12.001675,-12.017875,-12.032916,-12.055526,-12.069766,-12.056996,-12.048396,-12.031247,-12.008376,-11.980006,-11.968496,-11.961246,-11.950766,-11.960846,-11.959746,-11.970466,-11.975025,-11.964905,-11.945945,-11.935655,-11.936628]}],[{&#34;lng&#34;:[135.768161,135.764091,135.732112,135.707962,135.686912,135.716892,135.721002,135.709522,135.725882,135.747502,135.759322,135.768161],&#34;lat&#34;:[-14.875195,-14.901775,-14.892195,-14.912915,-14.903775,-14.882165,-14.860435,-14.851966,-14.834766,-14.836555,-14.847655,-14.875195]}],[{&#34;lng&#34;:[135.735122,135.732922,135.728052,135.735122],&#34;lat&#34;:[-14.287987,-14.295087,-14.291247,-14.287987]}],[{&#34;lng&#34;:[135.630353,135.607973,135.603083,135.624893,135.630353],&#34;lat&#34;:[-14.496197,-14.516337,-14.490337,-14.488407,-14.496197]}],[{&#34;lng&#34;:[135.169809,135.167609,135.156499,135.150139,135.157139,135.169809],&#34;lat&#34;:[-11.702139,-11.709249,-11.705709,-11.687599,-11.686159,-11.702139]}],[{&#34;lng&#34;:[135.122481,135.107501,135.088911,135.056951,135.047021,135.057091,135.082701,135.122481],&#34;lat&#34;:[-11.927419,-11.942279,-11.941189,-11.95451,-11.94068,-11.91925,-11.916079,-11.927419]}],[{&#34;lng&#34;:[135.002893,134.989573,134.976433,134.997853,135.002893],&#34;lat&#34;:[-12.09141,-12.09383,-12.06569,-12.07227,-12.09141]}],[{&#34;lng&#34;:[134.990602,134.958853,134.960463,134.944023,134.932823,134.910913,134.908513,134.954352,134.990602],&#34;lat&#34;:[-12.03525,-12.05308,-12.0646,-12.06261,-12.044281,-12.033971,-12.023371,-12.01423,-12.03525]}],[{&#34;lng&#34;:[134.959263,134.956623,134.951433,134.942153,134.952263,134.959263],&#34;lat&#34;:[-12.08315,-12.09494,-12.09306,-12.07099,-12.07123,-12.08315]}],[{&#34;lng&#34;:[134.931963,134.925893,134.917413,134.924743,134.931963],&#34;lat&#34;:[-12.06193,-12.064361,-12.054151,-12.051931,-12.06193]}],[{&#34;lng&#34;:[134.929253,134.904654,134.869064,134.874954,134.863734,134.866133,134.847613,134.880283,134.906383,134.929253],&#34;lat&#34;:[-12.09067,-12.137371,-12.125941,-12.117751,-12.109031,-12.070681,-12.042931,-12.061391,-12.065451,-12.09067]}],[{&#34;lng&#34;:[134.865363,134.851123,134.826853,134.839813,134.859983,134.865363],&#34;lat&#34;:[-12.025011,-12.037691,-12.020282,-12.006591,-12.014661,-12.025011]}],[{&#34;lng&#34;:[134.831323,134.798153,134.798003,134.809833,134.831323],&#34;lat&#34;:[-12.044541,-12.033082,-12.016802,-12.016702,-12.044541]}],[{&#34;lng&#34;:[134.222104,134.217524,134.207884,134.222104],&#34;lat&#34;:[-11.953928,-11.963648,-11.962188,-11.953928]}],[{&#34;lng&#34;:[134.185286,134.172076,134.166766,134.172666,134.182816,134.185286],&#34;lat&#34;:[-12.096108,-12.112479,-12.107199,-12.089399,-12.086969,-12.096108]}],[{&#34;lng&#34;:[133.493357,133.491077,133.434468,133.416458,133.383088,133.401578,133.390018,133.423588,133.466588,133.493357],&#34;lat&#34;:[-11.511193,-11.519253,-11.505993,-11.526773,-11.543123,-11.506193,-11.488443,-11.490613,-11.464312,-11.511193]}],[{&#34;lng&#34;:[133.481727,133.480007,133.446647,133.426567,133.421377,133.415157,133.388328,133.402337,133.396017,133.370208,133.358758,133.364858,133.349518,133.392998,133.409407,133.438987,133.441267,133.444827,133.467187,133.481727],&#34;lat&#34;:[-11.615863,-11.623213,-11.617084,-11.629274,-11.645304,-11.625234,-11.633404,-11.659764,-11.673544,-11.681545,-11.664915,-11.642774,-11.623434,-11.603254,-11.584394,-11.587923,-11.599003,-11.592563,-11.591333,-11.615863]}],[{&#34;lng&#34;:[133.016762,133.005392,132.994182,132.977682,133.016762],&#34;lat&#34;:[-11.067574,-11.086534,-11.087524,-11.043774,-11.067574]}],[{&#34;lng&#34;:[132.919843,132.905323,132.904223,132.903833,132.876693,132.871923,132.857293,132.863263,132.876753,132.917283,132.919843],&#34;lat&#34;:[-11.168825,-11.161225,-11.150115,-11.160995,-11.170075,-11.156055,-11.146075,-11.139545,-11.146695,-11.139894,-11.168825]}],[{&#34;lng&#34;:[132.876663,132.870213,132.852374,132.858583,132.876663],&#34;lat&#34;:[-11.046594,-11.060475,-11.058625,-11.044854,-11.046594]}],[{&#34;lng&#34;:[132.832344,132.825534,132.819094,132.830764,132.832344],&#34;lat&#34;:[-10.973844,-10.998114,-10.967934,-10.967294,-10.973844]}],[{&#34;lng&#34;:[132.803154,132.798554,132.780134,132.775364,132.803154],&#34;lat&#34;:[-11.388587,-11.395017,-11.389427,-11.375857,-11.388587]}],[{&#34;lng&#34;:[132.733055,132.730725,132.719755,132.733055],&#34;lat&#34;:[-11.285586,-11.295746,-11.289386,-11.285586]}],[{&#34;lng&#34;:[132.681965,132.660375,132.643096,132.659535,132.681965],&#34;lat&#34;:[-11.188286,-11.211146,-11.210186,-11.187756,-11.188286]}],[{&#34;lng&#34;:[132.587027,132.579156,132.602336,132.614416,132.602366,132.587846,132.579996,132.587826,132.596976,132.600436,132.624806,132.631276,132.615146,132.602716,132.604276,132.619216,132.619376,132.599746,132.587976,132.584506,132.566096,132.555176,132.543256,132.469817,132.476377,132.491797,132.509937,132.504607,132.513306,132.509346,132.485687,132.462417,132.498237,132.520776,132.527226,132.545246,132.533626,132.545526,132.559976,132.556756,132.564476,132.595266,132.589966,132.587027],&#34;lat&#34;:[-10.987207,-11.007336,-11.117766,-11.129726,-11.142846,-11.139406,-11.160046,-11.176906,-11.178746,-11.170286,-11.172846,-11.186196,-11.186146,-11.204746,-11.218756,-11.232136,-11.284766,-11.300066,-11.355817,-11.336486,-11.328746,-11.310746,-11.252306,-11.156935,-11.148946,-11.155216,-11.138226,-11.124426,-11.092496,-11.082536,-11.078386,-11.032556,-11.056976,-11.053556,-11.042626,-11.052496,-11.042986,-11.042456,-11.029186,-10.994316,-10.979186,-10.970106,-10.988976,-10.987207]}],[{&#34;lng&#34;:[132.462976,132.457206,132.447386,132.462976],&#34;lat&#34;:[-11.621425,-11.628745,-11.621024,-11.621425]}],[{&#34;lng&#34;:[132.421983,132.411263,132.387504,132.350944,132.336074,132.377534,132.401394,132.413084,132.421983],&#34;lat&#34;:[-12.116853,-12.138293,-12.138923,-12.108923,-12.085743,-12.072953,-12.076163,-12.088153,-12.116853]}],[{&#34;lng&#34;:[132.360224,132.352034,132.344494,132.354064,132.360224],&#34;lat&#34;:[-12.170493,-12.188993,-12.172152,-12.155233,-12.170493]}],[{&#34;lng&#34;:[132.339558,132.333298,132.334678,132.339558],&#34;lat&#34;:[-11.524334,-11.540794,-11.514484,-11.524334]}],[{&#34;lng&#34;:[132.324278,132.314678,132.295728,132.303518,132.324278],&#34;lat&#34;:[-11.581283,-11.600213,-11.586683,-11.563803,-11.581283]}],[{&#34;lng&#34;:[132.174529,132.167879,132.170329,132.174529],&#34;lat&#34;:[-11.584052,-11.585152,-11.576692,-11.584052]}],[{&#34;lng&#34;:[132.149329,132.13397,132.1111,132.12089,132.11364,132.121939,132.134979,132.149329],&#34;lat&#34;:[-11.606282,-11.627202,-11.620522,-11.590092,-11.575942,-11.564812,-11.568942,-11.606282]}],[{&#34;lng&#34;:[131.96489,131.95367,131.94843,131.96489],&#34;lat&#34;:[-11.483821,-11.486501,-11.473731,-11.483821]}],[{&#34;lng&#34;:[130.402355,130.401478,130.391048,130.384008,130.398258,130.409028,130.407079,130.404518,130.392218,130.394438,130.388528,130.370058,130.363498,130.372588,130.401657,130.418417,130.412557,130.489406,130.513736,130.499926,130.496286,130.538775,130.553795,130.594844,130.603774,130.594174,130.586145,130.579515,130.586674,130.566875,130.554585,130.556485,130.568295,130.581324,130.601364,130.619224,130.640283,130.641083,130.656573,130.663063,130.657353,130.680812,130.680792,130.701322,130.694182,130.709841,130.703491,130.705871,130.710511,130.721501,130.714151,130.722781,130.75537,130.76125,130.795,130.809839,130.810789,130.823969,130.79127,130.76622,130.76943,130.755611,130.754431,130.740141,130.733711,130.723451,130.704998,130.705112,130.696882,130.704562,130.733381,130.735631,130.763031,130.772271,130.80771,130.848272,130.897309,130.921559,130.963688,130.951248,130.987798,130.990237,131.031607,131.051097,131.040937,131.071577,131.082577,131.084017,131.091947,131.089277,131.092667,131.098827,131.095377,131.103807,131.103037,131.110817,131.087617,131.111537,131.112677,131.147747,131.165636,131.163736,131.172166,131.168366,131.187596,131.199736,131.208096,131.209336,131.227736,131.222046,131.215336,131.190736,131.202966,131.197776,131.204016,131.247476,131.250796,131.258026,131.269426,131.260306,131.277136,131.279456,131.288206,131.315275,131.297275,131.296205,131.305105,131.324455,131.320425,131.328085,131.328875,131.353275,131.374955,131.370865,131.380814,131.400244,131.395544,131.401304,131.435824,131.442604,131.429524,131.429714,131.462684,131.455154,131.470984,131.465084,131.481333,131.467654,131.473474,131.456734,131.464174,131.456474,131.481613,131.487973,131.500233,131.510783,131.524003,131.537093,131.532403,131.543133,131.527003,131.508076,131.486173,131.484023,131.464973,131.454473,131.464443,131.455253,131.470333,131.469803,131.431094,131.426024,131.402844,131.369105,131.379134,131.367504,131.359844,131.362904,131.370134,131.370584,131.349674,131.336994,131.333964,131.280395,131.254055,131.181905,131.081916,131.048296,131.018256,130.989977,130.998026,130.976437,130.949287,130.916467,130.919377,130.862288,130.801888,130.72496,130.686341,130.675321,130.679811,130.641142,130.622693,130.597543,130.590543,130.571624,130.556354,130.529015,130.492625,130.476466,130.478335,130.486235,130.493805,130.487255,130.460966,130.452086,130.431867,130.433517,130.418217,130.425817,130.411467,130.409498,130.402355],&#34;lat&#34;:[-11.363409,-11.367384,-11.366734,-11.346304,-11.318124,-11.318104,-11.301731,-11.301844,-11.284014,-11.266885,-11.274645,-11.264865,-11.251205,-11.170955,-11.166135,-11.186005,-11.174695,-11.262063,-11.279143,-11.271953,-11.278583,-11.284413,-11.266443,-11.289212,-11.321361,-11.322271,-11.336491,-11.326841,-11.342941,-11.340652,-11.361012,-11.383171,-11.397611,-11.402441,-11.38654,-11.38757,-11.37246,-11.35631,-11.33596,-11.34143,-11.400649,-11.427146,-11.444928,-11.441447,-11.464337,-11.486466,-11.494226,-11.513636,-11.489066,-11.507446,-11.493166,-11.470286,-11.479866,-11.498335,-11.511095,-11.525854,-11.538514,-11.538364,-11.491835,-11.484566,-11.465726,-11.459876,-11.446987,-11.442487,-11.427647,-11.420468,-11.421863,-11.423058,-11.426658,-11.385318,-11.386348,-11.380098,-11.375528,-11.364398,-11.364677,-11.354036,-11.308917,-11.312216,-11.332685,-11.334815,-11.339594,-11.354544,-11.367293,-11.343004,-11.317754,-11.303354,-11.302164,-11.310534,-11.303684,-11.331794,-11.320064,-11.323824,-11.305854,-11.312444,-11.306114,-11.308194,-11.300384,-11.280295,-11.259065,-11.249875,-11.265555,-11.278084,-11.286364,-11.313453,-11.334903,-11.311803,-11.310943,-11.344062,-11.305483,-11.313953,-11.304763,-11.303063,-11.284264,-11.269554,-11.236045,-11.217845,-11.193915,-11.190445,-11.197515,-11.210955,-11.189525,-11.204275,-11.193865,-11.228214,-11.258964,-11.268113,-11.274583,-11.272983,-11.276693,-11.279213,-11.255953,-11.249963,-11.264283,-11.283693,-11.298202,-11.291162,-11.267083,-11.258303,-11.265902,-11.286712,-11.295462,-11.304052,-11.328011,-11.351361,-11.370391,-11.385731,-11.39883,-11.40188,-11.4053,-11.41212,-11.41249,-11.41957,-11.40205,-11.38717,-11.38361,-11.39606,-11.39409,-11.41322,-11.42471,-11.4522,-11.4763,-11.465768,-11.47461,-11.48766,-11.49786,-11.546599,-11.572499,-11.580939,-11.586739,-11.608099,-11.605349,-11.613679,-11.588839,-11.580943,-11.592039,-11.605539,-11.603359,-11.609469,-11.603519,-11.609729,-11.649959,-11.658149,-11.679259,-11.739789,-11.734479,-11.791749,-11.836209,-11.881559,-11.885999,-11.906809,-11.908069,-11.93315,-11.9401,-11.89544,-11.90045,-11.854651,-11.845062,-11.802673,-11.796444,-11.780444,-11.761714,-11.747565,-11.723376,-11.717226,-11.702036,-11.701457,-11.672427,-11.679468,-11.654929,-11.620629,-11.592939,-11.589519,-11.564078,-11.547599,-11.53559,-11.51674,-11.502561,-11.474982,-11.454912,-11.425513,-11.408758,-11.367254,-11.363409]},{&#34;lng&#34;:[131.368928,131.355714,131.366011,131.368928],&#34;lat&#34;:[-11.580902,-11.577809,-11.585757,-11.580902]},{&#34;lng&#34;:[130.40278,130.408338,130.404198,130.40278],&#34;lat&#34;:[-11.361488,-11.360024,-11.355064,-11.361488]}],[{&#34;lng&#34;:[131.355625,131.355314,131.345445,131.349525,131.355625],&#34;lat&#34;:[-12.101729,-12.111099,-12.111019,-12.096889,-12.101729]}],[{&#34;lng&#34;:[131.135234,131.111884,131.072878,131.127138,131.135234],&#34;lat&#34;:[-12.012368,-12.023833,-12.01497,-12.000961,-12.012368]}],[{&#34;lng&#34;:[131.126716,131.122846,131.105986,131.061766,131.098346,131.126716],&#34;lat&#34;:[-12.059459,-12.070199,-12.075329,-12.069439,-12.052749,-12.059459]}],[{&#34;lng&#34;:[131.064796,131.062866,131.032466,131.001917,131.039416,131.064796],&#34;lat&#34;:[-12.037579,-12.046839,-12.058319,-12.052389,-12.031979,-12.037579]}],[{&#34;lng&#34;:[131.048206,131.036536,131.012397,131.030606,131.048206],&#34;lat&#34;:[-12.112169,-12.127899,-12.118239,-12.098989,-12.112169]}],[{&#34;lng&#34;:[130.872399,130.863219,130.864119,130.872399],&#34;lat&#34;:[-12.548151,-12.560362,-12.546131,-12.548151]}],[{&#34;lng&#34;:[130.660881,130.646951,130.645651,130.660881],&#34;lat&#34;:[-11.814464,-11.821274,-11.809625,-11.814464]}],[{&#34;lng&#34;:[130.212679,130.206591,130.210481,130.222311,130.220021,130.224381,130.237231,130.235501,130.217131,130.225961,130.229841,130.206531,130.223001,130.229682,130.232881,130.26093,130.28352,130.2951,130.305919,130.29315,130.261371,130.246301,130.258451,130.26554,130.253521,130.236971,130.217751,130.209861,130.191281,130.200821,130.195271,130.185751,130.174831,130.192021,130.195611,130.22499,130.23061,130.24221,130.23895,130.25531,130.26149,130.272031,130.26313,130.26735,130.2833,130.26332,130.2609,130.2353,130.23949,130.23342,130.23087,130.23159,130.208801,130.198361,130.185121,130.156601,130.147981,130.169141,130.1801,130.23014,130.245189,130.2387,130.24789,130.254829,130.251679,130.280309,130.286429,130.286619,130.302879,130.337428,130.340843,130.322339,130.341763,130.343177,130.361298,130.384278,130.385228,130.394388,130.400138,130.403868,130.392818,130.375188,130.380838,130.376168,130.402397,130.429936,130.452126,130.452576,130.463716,130.460416,130.448726,130.464676,130.468346,130.516895,130.556094,130.564254,130.584873,130.592293,130.617383,130.641115,130.612542,130.603662,130.581643,130.570633,130.563243,130.567773,130.545793,130.503384,130.393117,130.367818,130.312259,130.130813,130.064924,130.048854,130.023794,130.020444,130.033154,130.080754,130.061484,130.076503,130.090043,130.122543,130.157252,130.202311,130.214271,130.203541,130.221691,130.213221,130.212679],&#34;lat&#34;:[-11.712187,-11.724844,-11.719374,-11.725224,-11.730354,-11.726234,-11.746623,-11.723953,-11.717324,-11.717194,-11.703964,-11.693834,-11.670414,-11.686103,-11.680904,-11.706833,-11.698643,-11.725763,-11.733012,-11.692153,-11.698013,-11.678614,-11.675194,-11.661733,-11.673284,-11.661794,-11.631104,-11.642644,-11.642675,-11.585565,-11.571935,-11.572065,-11.557845,-11.536685,-11.516175,-11.507215,-11.528555,-11.534224,-11.539284,-11.537304,-11.571044,-11.570092,-11.559364,-11.546474,-11.539854,-11.542754,-11.527144,-11.520995,-11.495115,-11.497955,-11.484735,-11.497845,-11.511555,-11.507395,-11.484475,-11.491206,-11.482066,-11.462726,-11.429236,-11.406985,-11.366615,-11.388435,-11.398135,-11.376545,-11.346485,-11.342925,-11.361215,-11.343365,-11.341405,-11.318615,-11.324449,-11.333345,-11.326022,-11.328438,-11.379804,-11.405284,-11.418393,-11.416103,-11.425023,-11.447603,-11.472833,-11.484063,-11.494443,-11.507003,-11.539932,-11.549801,-11.57324,-11.56702,-11.575009,-11.6218,-11.62715,-11.629359,-11.666179,-11.691238,-11.692757,-11.707047,-11.708887,-11.730516,-11.733966,-11.756842,-11.821155,-11.827085,-11.826936,-11.810706,-11.816416,-11.821046,-11.819007,-11.830348,-11.80142,-11.780131,-11.770892,-11.825185,-11.818515,-11.824076,-11.797326,-11.778906,-11.756296,-11.768806,-11.750936,-11.669096,-11.670996,-11.707245,-11.705065,-11.649434,-11.664444,-11.694074,-11.703864,-11.714954,-11.712187]},{&#34;lng&#34;:[130.212108,130.211251,130.204951,130.212108],&#34;lat&#34;:[-11.709274,-11.704904,-11.706724,-11.709274]}],[{&#34;lng&#34;:[130.342921,130.341914,130.342258,130.342921],&#34;lat&#34;:[-11.327712,-11.325964,-11.325835,-11.327712]}],[{&#34;lng&#34;:[130.544335,130.535585,130.525565,130.524044,130.499214,130.486644,130.494903,130.484753,130.508112,130.517302,130.521352,130.510072,130.502953,130.511013,130.517824,130.541664,130.544335],&#34;lat&#34;:[-12.704475,-12.709786,-12.702116,-12.661775,-12.645465,-12.623655,-12.596405,-12.580365,-12.574204,-12.557594,-12.589344,-12.590704,-12.610255,-12.617035,-12.650585,-12.679845,-12.704475]}],[{&#34;lng&#34;:[130.434365,130.416766,130.405366,130.420655,130.434365],&#34;lat&#34;:[-12.579846,-12.592066,-12.573876,-12.563576,-12.579846]}],[{&#34;lng&#34;:[130.416196,130.400667,130.391797,130.404336,130.416196],&#34;lat&#34;:[-12.595006,-12.601807,-12.587107,-12.581336,-12.595006]}],[{&#34;lng&#34;:[130.408387,130.401827,130.385017,130.408387],&#34;lat&#34;:[-12.608127,-12.615137,-12.602487,-12.608127]}],[{&#34;lng&#34;:[130.396427,130.386428,130.368478,130.364898,130.370648,130.385607,130.396427],&#34;lat&#34;:[-12.626567,-12.643077,-12.642067,-12.624997,-12.619457,-12.617417,-12.626567]}],[{&#34;lng&#34;:[130.109606,130.097606,130.085006,130.090966,130.101936,130.109606],&#34;lat&#34;:[-13.220099,-13.221249,-13.209869,-13.192789,-13.194009,-13.220099]}],[{&#34;lng&#34;:[130.075006,130.068106,130.047187,130.041097,130.020437,130.018477,130.027657,130.057656,130.075006],&#34;lat&#34;:[-13.17124,-13.18244,-13.17593,-13.18317,-13.17982,-13.11122,-13.15087,-13.15206,-13.17124]}],[{&#34;lng&#34;:[129.732061,129.719851,129.698121,129.670741,129.732061],&#34;lat&#34;:[-14.804138,-14.813268,-14.809508,-14.784378,-14.804138]}]],[[{&#34;lng&#34;:[149.399284,149.352134,149.336502,149.254815,149.207546,149.146586,149.139052,149.155134,149.13555,149.151279,149.131376,149.14251,149.084514,149.078043,149.087612,149.097495,149.095379,149.109483,149.090716,149.101481,149.093517,149.095682,149.064408,149.048811,149.012198,148.959133,148.909367,148.907065,148.886623,148.897776,148.894887,148.903348,148.894087,148.886633,148.877693,148.872491,148.855652,148.856132,148.835715,148.822423,148.791182,148.798434,148.767495,148.783462,148.768473,148.788758,148.773039,148.778231,148.769231,148.772364,148.762675,148.774354,148.767058,148.788868,148.785764,148.796119,148.795719,148.808702,148.793247,148.807854,149.120902,149.138819,149.1386,149.149637,149.146775,149.164312,149.167696,149.189097,149.183629,149.197037,149.189701,149.208568,149.204883,149.214063,149.238597,149.24679,149.234884,149.273132,149.272048,149.315286,149.322394,149.341384,149.361948,149.39479,149.399284],&#34;lat&#34;:[-35.319175,-35.351317,-35.339914,-35.330079,-35.345305,-35.414836,-35.432543,-35.436628,-35.454422,-35.506926,-35.554173,-35.59257,-35.580594,-35.586127,-35.639697,-35.647313,-35.679285,-35.69664,-35.7656,-35.803698,-35.824221,-35.845716,-35.874932,-35.92041,-35.899697,-35.895456,-35.853065,-35.829563,-35.810063,-35.79465,-35.771654,-35.757798,-35.751288,-35.719136,-35.714936,-35.721422,-35.760874,-35.753518,-35.741884,-35.7209,-35.703449,-35.666492,-35.647323,-35.628342,-35.603186,-35.588179,-35.568157,-35.558852,-35.544096,-35.529329,-35.495505,-35.486003,-35.465405,-35.426382,-35.408748,-35.406549,-35.39292,-35.382373,-35.339156,-35.309647,-35.124517,-35.128466,-35.135257,-35.138669,-35.144856,-35.142046,-35.159881,-35.165677,-35.175618,-35.185499,-35.203308,-35.211501,-35.229549,-35.219507,-35.222127,-35.229217,-35.242822,-35.259287,-35.273644,-35.276286,-35.286708,-35.286648,-35.308998,-35.303157,-35.319175]},{&#34;lng&#34;:[149.153176,149.13651,149.122879,149.118459,149.110274,149.114443,149.103116,149.101406,149.099252,149.08803,149.083012,149.071123,149.084355,149.095399,149.101389,149.12611,149.144619,149.153176],&#34;lat&#34;:[-35.304976,-35.289256,-35.28656,-35.293608,-35.284577,-35.280492,-35.28513,-35.294277,-35.2856,-35.28515,-35.296961,-35.298567,-35.303898,-35.287391,-35.301479,-35.294247,-35.310156,-35.304976]}]]],null,null,{&#34;interactive&#34;:true,&#34;className&#34;:&#34;&#34;,&#34;stroke&#34;:true,&#34;color&#34;:&#34;white&#34;,&#34;weight&#34;:0.5,&#34;opacity&#34;:0.5,&#34;fill&#34;:true,&#34;fillColor&#34;:[&#34;transparent&#34;,&#34;black&#34;,&#34;black&#34;,&#34;black&#34;,&#34;black&#34;,&#34;black&#34;,&#34;black&#34;,&#34;transparent&#34;],&#34;fillOpacity&#34;:[0,0.5,0.5,0.5,0.5,0.5,0.5,0],&#34;smoothFactor&#34;:1,&#34;noClip&#34;:false},null,null,null,{&#34;interactive&#34;:false,&#34;permanent&#34;:false,&#34;direction&#34;:&#34;auto&#34;,&#34;opacity&#34;:1,&#34;offset&#34;:[0,0],&#34;textsize&#34;:&#34;10px&#34;,&#34;textOnly&#34;:false,&#34;className&#34;:&#34;&#34;,&#34;sticky&#34;:true},null]},{&#34;method&#34;:&#34;addCircleMarkers&#34;,&#34;args&#34;:[[-33.801554,-33.917179,-33.879692,-33.919592,-33.889251,-33.837288,-34.062702,-33.860117,-33.919966,-34.077651,-33.933088,-34.485043,-33.867929,-33.918492,-33.966969,-34.037288,-34.336667,-35.317313,-34.868767,-34.424938,-34.558987,-33.859867,-33.775552,-33.765929,-33.804362,-33.705329,-33.759865,-33.610712,-33.498751,-33.701448,-33.685353,-33.821312,-33.795482,-33.419451,-33.261113,-30.512726,-30.382482,-29.864055,-30.711502,-29.733293,-30.983146,-30.213889,-29.770728,-30.745717,-29.470678,-30.325869,-29.045083,-31.500345,-31.074079,-29.950779,-29.450547,-30.987818,-29.538835,-30.225439,-31.346691,-32.403949,-32.014787,-31.910418,-32.827754,-32.401948,-32.825017,-32.726723,-32.142714,-32.264545,-32.389483,-32.899371,-33.024631,-32.051525,-32.567087,-31.770408,-32.720053,-32.922177,-28.863525,-28.859839,-28.733777,-29.674807,-28.627124,-28.809191,-28.597371,-29.454219,-28.323417,-28.177216,-28.471511,-30.457256,-30.317579,-30.340625,-31.067841,-30.713725,-31.452336,-35.714055,-36.68905,-36.917513,-35.443216,-36.241389,-34.464222,-37.04496,-34.747527,-35.904137,-36.926316,-35.347685,-34.844072,-33.292027,-33.916373,-35.623823,-35.662312,-35.667399,-35.993528,-35.524044,-35.641725,-35.515801,-35.723991,-35.356628,-35.325419,-35.815407,-35.778706,-34.442822,-34.555254,-34.320383,-35.521951,-34.282121,-35.051394,-34.500349,-33.478793,-34.866914,-34.819885,-34.545222,-35.222378,-34.743181,-34.443942,-35.307265,-35.118083,-34.634386,-30.092823,-29.961627,-31.509026,-29.544889,-31.821473,-31.274791,-30.945316,-30.964803,-31.329812,-32.239339,-32.017204,-31.704565,-32.366871,-32.603229,-32.24261,-31.560024,-32.030813,-30.030646,-31.693958,-32.549741,-29.429973,-33.406512,-33.537728,-33.557204,-33.082332,-33.832137,-33.424421,-33.396281,-33.894286,-33.087622,-33.705249,-33.317316,-33.151507,-32.735907,-32.921078,-32.804085,-32.242711,-32.635114,-34.644549,-31.947609,-31.557638,-36.078401,-35.345777,-35.253321,-28.637365,-33.750646,-32.898193,-32.390335,-29.433211,-35.253321],[150.991759,151.238334,151.221125,151.098275,151.182926,151.092664,150.693297,150.904339,150.930776,150.806321,151.020823,150.423796,151.212575,151.23938,151.133776,151.115151,150.907344,150.438918,150.595736,150.883451,150.840947,151.033204,150.917537,150.829646,150.987811,150.32111,150.712627,150.820804,150.127701,151.112941,151.306618,151.189735,151.089756,151.340328,151.480761,151.655629,150.605778,150.579235,150.040014,151.731673,150.251339,151.679112,151.130139,150.732249,149.839648,149.777108,152.013552,150.676621,150.924199,151.206732,151.599204,151.591415,150.579567,149.448287,150.652513,152.210029,151.958556,152.454485,151.348396,151.746157,151.463018,151.545887,150.361316,150.900263,150.684453,151.720858,151.648181,150.876864,151.185736,150.834764,152.158858,151.692438,153.564013,153.035827,152.622789,152.941274,153.001742,153.291045,153.223185,153.201094,153.400811,153.545458,152.543029,152.893209,153.093667,152.713882,152.820038,152.919838,152.878304,150.182375,149.858549,149.235372,149.805302,149.130499,149.467427,148.945958,149.712806,150.070774,149.879232,149.232294,148.906427,146.374304,147.196483,144.133479,145.813035,147.042104,146.383541,144.963301,145.568139,147.031847,147.320276,145.720596,146.267316,145.568996,148.006203,148.727073,148.360186,148.288457,148.147891,146.043774,148.101764,144.851433,145.539032,147.581314,147.199329,146.408831,146.719064,146.547661,147.542616,148.219552,147.356915,148.012796,145.947983,146.863796,145.825266,148.581901,149.710049,149.284779,149.066189,148.387527,148.469216,148.620772,149.397366,148.664889,149.521893,149.588179,148.239201,147.208772,147.976355,148.115959,147.835679,148.951977,147.981869,149.572699,149.248988,148.676576,147.154161,148.692376,148.366799,148.013831,148.167843,148.859724,149.853596,149.093953,148.169757,148.199615,147.704315,149.975652,147.358031,147.568997,143.568413,141.454703,143.385336,146.939146,149.100898,149.089654,153.555898,151.23377,144.298904,142.414869,142.012817,149.089654],[13.33654697739081,10.72039530957428,12.1815075547238,11.57672904021923,15.44104678854144,11.08924129751923,6.189992075870149,10.48982005500213,15.98221352309547,14.99517966232526,12.80248447516895,7.828239842476663,10.1300892618003,13.28940412916479,15.37164636175466,13.12655724945318,4.199173607379294,6.779528987720801,10.96257554948027,14.28911386086537,9.890497324297566,9.36061336778112,12.40539699662508,10.39514871510345,14.8852208774274,7.418263056850086,14.63327427643529,8.849632868053638,6.211452829154619,11.1633281568071,9.68897091580976,15.68765642479985,9.205898951138639,14.56241275157378,14.3225958588781,7.219213706056443,2.794054874206298,2.085995450149325,1.590869007030706,3.981438414926426,5.219698426338281,2.463792889755293,5.493305085259156,3.14647181781196,5.370331073635576,4.209664185491033,2.752146705933054,3.555188282313197,11.47697848467539,0.9028024322734728,0.9701137086894889,2.09400401182029,2.057229625538611,2.430467031354946,0.6429174363862724,3.478937949900696,2.887655884142564,9.813007144182453,7.298723691260515,2.645885910373357,3.71104329739976,12.30426041302325,1.750389998599878,5.540299565750268,1.392814963757518,10.68922338975865,9.039614199803637,3.967340554215684,6.373429829163765,2.240628896928536,6.395054624217344,15.66144515035349,7.25925744229293,6.493038130147101,1.548595540529595,8.814593355929096,4.110667461729338,10.39003147425874,3.118362760731926,6.301614981654945,7.333883688232082,12.42892423521941,1.602379683768483,3.885351926912103,11.12097852451977,2.603362670502106,8.955718328990933,6.471057033018572,10.90909297749556,6.76131179076988,7.18468218640589,2.300148826493181,2.252570548079255,5.719303953317896,3.795561232934036,0.8121896800124605,7.588649869219613,5.818009991905044,3.365890388440462,8.178785758037058,4.187791566478072,2.545820279962347,2.836401586842143,2.23656984440713,1.524675454417073,1.854182035649239,4.256110679303125,5.406977866801039,2.764209285525665,1.584064158820361,2.069092743485603,1.314257481345542,1.220039373065232,2.133717347592315,2.058624517633454,2.000420831146162,2.336457744614297,5.194505212197893,1.49193492123589,7.988031170151292,2.66371890948196,2.847459339719888,2.360769434576855,2.418132029900183,2.584649930599616,4.579697057698446,1.862410973776009,3.449572591817388,3.424756375124547,4.375763521638984,11.32028534971007,3.876784915295312,3.427336137094376,2.524959578967726,3.335394985334277,1.424985478493359,2.03366724641368,3.817269812516377,1.618149030550941,3.309892325346431,1.095726829073112,10.42583357329311,1.809688354838647,3.340690533938541,2.816348377210849,6.358248881885288,2.92350089165783,2.802065536035504,1.65008587335631,3.065914488343021,2.859799150019312,4.566259904713723,3.349120862247865,9.337529581717998,1.894599211664437,2.324598851506747,2.970392621057412,5.096047190685833,0.4795187917120019,5.075109260571048,1.97877344135477,1.879283360319197,2.568751612843259,9.644253907291123,5.786827605637975,1.716755742842765,1.311586114948158,2.292634475773705,1.375388935911605,0.9790166623404792,1.837613613763911,8.066026204237462,2.081935558029835,10.4518068249912,16.64452232588217,13.33749934916171,8.040407212831211,15.84320679805987,0.9074761191603007,1.622218762968499,0.863104567795522,13.55532786694025],null,null,{&#34;interactive&#34;:true,&#34;className&#34;:&#34;&#34;,&#34;stroke&#34;:true,&#34;color&#34;:&#34;white&#34;,&#34;weight&#34;:1,&#34;opacity&#34;:0.5,&#34;fill&#34;:true,&#34;fillColor&#34;:&#34;darkred&#34;,&#34;fillOpacity&#34;:0.4},null,null,[&#34;&lt;b&gt; The Children&#39;s Hospital at Westmead &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  749,161 &lt;br/&gt; Network:  Sydney Children&#39;s Hospitals Network &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Sydney Children&#39;s Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  484,072 &lt;br/&gt; Network:  Sydney Children&#39;s Hospitals Network &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; St Vincent&#39;s Hospital [Darlinghurst] &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  625,015 &lt;br/&gt; Network:  St Vincent&#39;s Health Network &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Canterbury Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  564,495 &lt;br/&gt; Network:  Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Royal Prince Alfred Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  1,004,250 &lt;br/&gt; Network:  Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Concord Repatriation Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  517,955 &lt;br/&gt; Network:  Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Camden Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  161,387 &lt;br/&gt; Network:  South Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Fairfield Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  463,473 &lt;br/&gt; Network:  South Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Liverpool Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  1,075,876 &lt;br/&gt; Network:  South Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Campbelltown Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  947,091 &lt;br/&gt; Network:  South Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Bankstown Lidcombe Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  690,362 &lt;br/&gt; Network:  South Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Bowral Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  258,117 &lt;br/&gt; Network:  South Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Sydney Hospital / Sydney Eye Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  432,230 &lt;br/&gt; Network:  South Eastern Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Prince of Wales Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  743,874 &lt;br/&gt; Network:  South Eastern Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; St George Hospital NSW &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  995,243 &lt;br/&gt; Network:  South Eastern Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Sutherland Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  725,755 &lt;br/&gt; Network:  South Eastern Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Bulli Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  51,418 &lt;br/&gt; Network:  Illawarra Shoalhaven &lt;br/&gt; Years Reporting:  9&#34;,&#34;&lt;b&gt; Milton Ulladulla Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  193,592 &lt;br/&gt; Network:  Illawarra Shoalhaven &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Shoalhaven Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  506,190 &lt;br/&gt; Network:  Illawarra Shoalhaven &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Wollongong Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  860,001 &lt;br/&gt; Network:  Illawarra Shoalhaven &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Shellharbour Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  412,026 &lt;br/&gt; Network:  Illawarra Shoalhaven &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Auburn Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  369,060 &lt;br/&gt; Network:  Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Blacktown Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  648,201 &lt;br/&gt; Network:  Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Mount Druitt Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  455,145 &lt;br/&gt; Network:  Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Westmead Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  933,252 &lt;br/&gt; Network:  Western Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Blue Mountains Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  231,789 &lt;br/&gt; Network:  Nepean Blue Mountains &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Nepean Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  901,927 &lt;br/&gt; Network:  Nepean Blue Mountains &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Hawkesbury Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  329,867 &lt;br/&gt; Network:  Nepean Blue Mountains &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Lithgow Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  162,508 &lt;br/&gt; Network:  Nepean Blue Mountains &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Hornsby Ku-ring-gai Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  524,899 &lt;br/&gt; Network:  Northern Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Mona Vale Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  243,327 &lt;br/&gt; Network:  Northern Sydney &lt;br/&gt; Years Reporting:  8&#34;,&#34;&lt;b&gt; Royal North Shore Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  1,036,584 &lt;br/&gt; Network:  Northern Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Ryde Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  356,961 &lt;br/&gt; Network:  Northern Sydney &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Gosford Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  893,213 &lt;br/&gt; Network:  Central Coast &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Wyong Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  864,036 &lt;br/&gt; Network:  Central Coast &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Armidale Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  219,517 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Barraba Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  32,882 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Bingara Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  18,328 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Boggabri Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  10,660 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Glen Innes Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  66,768 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Gunnedah Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  114,757 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Guyra Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  25,568 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Inverell Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  127,103 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Manilla Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  41,700 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Moree Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  121,476 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Narrabri Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  74,642 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Tenterfield Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  31,903 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Quirindi Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  53,237 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Tamworth Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  554,809 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Tingha Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  3,433 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Vegetable Creek Multi Purpose Service Emmaville &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  3,964 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Walcha Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  18,469 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Warialda Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  17,826 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Wee Waa Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  24,881 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Werris Creek Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  1,741 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Bulahdelah Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  31,371 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  8&#34;,&#34;&lt;b&gt; Gloucester Soldiers&#39; Memorial Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  35,122 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Manning Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  405,595 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Cessnock Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  224,379 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Dungog Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  29,487 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Kurri Kurri Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  58,007 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Maitland Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  637,675 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Merriwa Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  12,905 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Muswellbrook Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  129,287 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Denman Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  8,171 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Calvary Mater Newcastle &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  481,261 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Belmont Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  344,182 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Scott Memorial Hospital, Scone &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  66,296 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Singleton Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  171,094 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Wilson Memorial Community Hospital, Murrurundi &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  21,146 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Tomaree Community Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  172,257 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; John Hunter Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  1,033,123 &lt;br/&gt; Network:  Hunter New England &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Ballina District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  221,959 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Casino and District Memorial Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  177,576 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Bonalbo Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  2,331 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  3&#34;,&#34;&lt;b&gt; Grafton Base Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  327,260 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Kyogle Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  60,223 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Lismore Base Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  454,697 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Nimbin Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  34,657 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Maclean District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  167,260 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Murwillumbah District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  226,546 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; The Tweed Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  650,662 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Urbenville Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  9,151 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Bellinger River District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  53,802 &lt;br/&gt; Network:  Mid North Coast &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Coffs Harbour Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  520,924 &lt;br/&gt; Network:  Mid North Coast &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Dorrigo Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  24,155 &lt;br/&gt; Network:  Mid North Coast &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Kempsey District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  337,823 &lt;br/&gt; Network:  Mid North Coast &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Macksville District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  149,241 &lt;br/&gt; Network:  Mid North Coast &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Port Macquarie Base Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  501,263 &lt;br/&gt; Network:  Mid North Coast &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Batemans Bay Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  192,553 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; South East Regional Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  217,422 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Bombala Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  18,856 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Braidwood Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  18,084 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Cooma Hospital and Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  116,580 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Crookwell District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  51,344 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Delegate Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  2,351 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Goulburn Base Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  242,559 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Moruya Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  142,573 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Pambula Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  33,036 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  9&#34;,&#34;&lt;b&gt; Queanbeyan Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  238,405 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Yass District Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  62,504 &lt;br/&gt; Network:  Southern NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Lake Cargelligo Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  23,099 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Wyalong Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  28,673 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Barham Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  17,828 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Berrigan Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  8,285 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Culcairn Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  12,253 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Corowa Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  64,560 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Deniliquin Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  104,195 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Finley Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  27,232 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Henty Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  8,943 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Holbrook Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  15,258 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Jerilderie Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  6,156 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Urana Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  5,305 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Tocumwal Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  16,226 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Tumbarumba Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  15,104 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Boorowa Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  14,262 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Murrumburrah-Harden Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  19,456 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Young Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  96,167 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Batlow/Adelong Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  7,933 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Griffith Base Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  268,762 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Gundagai Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  25,288 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Hay Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  28,897 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Hillston Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  19,863 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Junee Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  20,840 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Coolamon-Ganmain Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  23,809 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Leeton Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  74,750 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Lockhart Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  12,362 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Narrandera Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  42,410 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Temora Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  41,802 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Tumut Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  68,241 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Wagga Wagga Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  539,763 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Cootamundra Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  53,565 &lt;br/&gt; Network:  Murrumbidgee &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Bourke Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  41,865 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Brewarrina Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  22,722 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Cobar Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  39,649 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Collarenebri Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  7,237 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Coolah Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  14,740 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Coonabarabran Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  51,933 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Baradine Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  9,332 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Coonamble Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  39,045 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Gulargambone Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  1,945 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  5&#34;,&#34;&lt;b&gt; Dubbo Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  457,836 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Dunedoo Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  11,672 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Gilgandra Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  39,775 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Gulgong Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  28,269 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Mudgee Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  144,083 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Narromine Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  30,461 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Nyngan Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  27,983 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Trangie Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  9,704 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Walgett Multipurpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  33,501 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Warren Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  29,148 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Wellington Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  74,312 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Lightning Ridge Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  39,976 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Bathurst Base Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  367,242 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Blayney Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  12,793 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Canowindra Soldiers Memorial Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  19,259 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Condobolin Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  31,446 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Cowra Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  92,556 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Eugowra Memorial Multipurpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  298 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  4&#34;,&#34;&lt;b&gt; Lachlan Health Service - Forbes &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  91,797 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Grenfell Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  13,955 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Molong Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  12,587 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Oberon Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  23,517 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Orange Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  391,765 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Lachlan Health Service - Parkes &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  119,349 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Peak Hill Multipurpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  10,504 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Trundle Multi Purpose Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  6,131 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Rylstone Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  18,733 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Tottenham Multipurpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  6,742 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Tullamore Multi Purpose Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  3,416 &lt;br/&gt; Network:  Western NSW &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Balranald Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  12,035 &lt;br/&gt; Network:  Far West &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Broken Hill Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  274,036 &lt;br/&gt; Network:  Far West &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; Wilcannia Multi Purpose Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  15,448 &lt;br/&gt; Network:  Far West &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Albury Wodonga Health [Albury Campus] &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  460,120 &lt;br/&gt; Network:  Albury Wodonga Health &lt;br/&gt; Years Reporting:  13&#34;,&#34;&lt;b&gt; The Canberra Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  718,088 &lt;br/&gt; Network:  Australian Capital Territory &lt;br/&gt; Years Reporting:  8&#34;,&#34;&lt;b&gt; North Canberra Hospital (previously known as Calvary Public Hospital Bruce) &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  403,452 &lt;br/&gt; Network:  Australian Capital Territory &lt;br/&gt; Years Reporting:  7&#34;,&#34;&lt;b&gt; Byron Central Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  188,514 &lt;br/&gt; Network:  Northern NSW &lt;br/&gt; Years Reporting:  9&#34;,&#34;&lt;b&gt; Northern Beaches Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  487,958 &lt;br/&gt; Network:  Northern Sydney &lt;br/&gt; Years Reporting:  6&#34;,&#34;&lt;b&gt; Ivanhoe Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  2,935 &lt;br/&gt; Network:  Far West &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Menindee Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  9,379 &lt;br/&gt; Network:  Far West &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; Tibooburra Health Service &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  2,655 &lt;br/&gt; Network:  Far West &lt;br/&gt; Years Reporting:  11&#34;,&#34;&lt;b&gt; North Canberra Hospital &lt;\/b&gt;&lt;br/&gt; Total ED Presentations:  59,534 &lt;br/&gt; Network:  Australian Capital Territory &lt;br/&gt; Years Reporting:  1&#34;],null,null,{&#34;interactive&#34;:false,&#34;permanent&#34;:false,&#34;direction&#34;:&#34;auto&#34;,&#34;opacity&#34;:1,&#34;offset&#34;:[0,0],&#34;textsize&#34;:&#34;10px&#34;,&#34;textOnly&#34;:false,&#34;className&#34;:&#34;&#34;,&#34;sticky&#34;:true},null]},{&#34;method&#34;:&#34;addProviderTiles&#34;,&#34;args&#34;:[&#34;CartoDB.Positron&#34;,null,null,{&#34;errorTileUrl&#34;:&#34;&#34;,&#34;noWrap&#34;:false,&#34;detectRetina&#34;:false}]},{&#34;method&#34;:&#34;addControl&#34;,&#34;args&#34;:[&#34;&lt;div style=\&#34;background: white; padding: 8px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.2); font-family: Arial, sans-serif;\&#34;&gt;&lt;div style=\&#34;font-size: 12px; font-weight: bold; color: #333; margin-bottom: 10px; border-bottom: 1px solid #ddd; padding-bottom: 8px;\&#34;&gt;NSW &amp; ACT Emergencies&lt;\/div&gt;&lt;div style=\&#34;margin: 5px 0; display: flex; align-items: center;\&#34;&gt;&lt;div style=\&#34;width: 20px; height: 10px; display: flex; justify-content: center; align-items: center; margin-right: 8px;\&#34;&gt;&lt;span style=\&#34;width: 20px; height: 20px; border-radius: 50%; background: darkred; display: block;\&#34;&gt;&lt;\/span&gt;&lt;\/div&gt;&lt;span style=\&#34;font-size: 11px;\&#34;&gt;High Volume&lt;\/span&gt;&lt;\/div&gt;&lt;div style=\&#34;margin: 8px 0; display: flex; align-items: center;\&#34;&gt;&lt;div style=\&#34;width: 20px; height: 10px; display: flex; justify-content: center; align-items: center; margin-right: 8px;\&#34;&gt;&lt;span style=\&#34;width: 12px; height: 12px; border-radius: 50%; background: darkred; display: block;\&#34;&gt;&lt;\/span&gt;&lt;\/div&gt;&lt;span style=\&#34;font-size: 11px;\&#34;&gt;Medium Volume&lt;\/span&gt;&lt;\/div&gt;&lt;div style=\&#34;margin: 8px 0; display: flex; align-items: center;\&#34;&gt;&lt;div style=\&#34;width: 20px; height: 10px; display: flex; justify-content: center; align-items: center; margin-right: 8px;\&#34;&gt;&lt;span style=\&#34;width: 6px; height: 6px; border-radius: 50%; background: darkred; display: block;\&#34;&gt;&lt;\/span&gt;&lt;\/div&gt;&lt;span style=\&#34;font-size: 11px;\&#34;&gt;Low Volume&lt;\/span&gt;&lt;\/div&gt;&lt;\/div&gt;&#34;,&#34;topright&#34;,null,&#34;info legend&#34;]}],&#34;limits&#34;:{&#34;lat&#34;:[-43.657607,-9.221187],&#34;lng&#34;:[112.921124,159.10542]},&#34;setView&#34;:[[-32.2431,148.6019],6,[]]},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;&#xD;&#xA;&lt;p&gt;These three visualizations reveal key patterns in the NSW and ACT emergency department data. The time series shows clear seasonal fluctuations with potential COVID-19 impacts. The triage distribution highlights the relative frequency of different urgency levels. The interactive map allows exploration of individual hospitals and their networks, with markers sized by presentation volume.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Compositional modeling of plant communities with Dirichlet regression</title>
  <link>https://ecogambler.netlify.app/blog/plant-community-dirichlet/</link>
  <pubDate>Mon, 20 Oct 2025 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/plant-community-dirichlet/</guid>
  <description>&lt;p&gt;Compositional data, where observations represent proportions that sum to a constant, are ubiquitous in ecology, yet many analysts fall back on problematic approaches like separate binomial models, beta regression on ratios, or worse, standard linear regression on raw proportions. These methods ignore the fundamental constraint that proportions must sum to unity and fail to model the inherent dependencies between components. &#xA;&lt;a href=&#34;https://doi.org/10.1111/j.2517-6161.1982.tb01195.x&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aitchison&amp;rsquo;s landmark work&lt;/a&gt; established the mathematical foundation for proper compositional analysis, while &#xA;&lt;a href=&#34;https://link.springer.com/book/10.1007/978-3-642-36809-7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;van den Boogaart &amp;amp; Tolosana-Delgado&lt;/a&gt; provide comprehensive coverage of modern compositional data analysis methods.&lt;/p&gt;&#xA;&lt;p&gt;Here I demonstrate how Dirichlet regression with Gaussian process smooths provides a principled, flexible framework for modeling plant community composition across environmental gradients. I&amp;rsquo;ll use &#xA;&lt;a href=&#34;https://link.springer.com/article/10.1007/s11222-022-10167-2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Riutort-Mayol et al&amp;rsquo;s approximate Hilbert space Gaussian processes&lt;/a&gt;, which make these models computationally tractable even for moderately large datasets.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;overview-of-this-post&#34;&gt;Overview of this post&#xA;  &lt;a href=&#34;#overview-of-this-post&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Compositional data appears everywhere in scientific research: microbiome relative abundances in biology, market share distributions in economics, geological mineral compositions in earth sciences, time allocation in behavioral studies, and survey response proportions in social research. Yet despite this ubiquity, many analysts resort to problematic approaches that ignore the fundamental constraint that components must sum to a constant (typically 1 or 100%).&lt;/p&gt;&#xA;&lt;p&gt;This post addresses two critical challenges data scientists face with compositional data. Methodologically, I demonstrate why standard approaches like separate Binomial models or Beta regression on ratios fail to capture the inherent dependencies between components, leading to impossible predictions and inefficient inference. If you&amp;rsquo;ve worked with &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GAMs for time series analysis&lt;/a&gt; like I have, you&amp;rsquo;ll appreciate how Gaussian processes provide similar flexibility for capturing nonlinear relationships while respecting compositional constraints.&lt;/p&gt;&#xA;&lt;p&gt;Computationally, I show how approximate Hilbert space Gaussian processes make sophisticated nonlinear modeling feasible for realistic dataset sizes, overcoming the traditional scalability limitations of GP methods. This builds on the same computational advances that make &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;complex hierarchical models&lt;/a&gt; practical for everyday use.&lt;/p&gt;&#xA;&lt;p&gt;I begin with the mathematical foundation of the Dirichlet distribution and its regression parameterization, emphasizing how brms enables separate linear predictors for each component. Next, I simulate realistic plant community data to demonstrate complex ecological relationships. I then fit Dirichlet regression models with bivariate Gaussian process smooths, extract and visualize predictions across environmental gradients, and interpret the results. Throughout, I emphasize practical implementation details and computational considerations that make this approach accessible for real-world applications.&lt;/p&gt;&#xA;&lt;p&gt;By the end, you&amp;rsquo;ll understand when and how to apply Dirichlet regression to your own compositional data, regardless of scientific domain. Plus, you&amp;rsquo;ll never again have to explain to a collaborator why your separate logistic regressions predict that 130% of survey respondents chose option A.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;the-dirichlet-distribution-and-compositional-constraints&#34;&gt;The Dirichlet distribution and compositional constraints&#xA;  &lt;a href=&#34;#the-dirichlet-distribution-and-compositional-constraints&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;For a &lt;code&gt;\({\color{#FDE725}{K}}\)&lt;/code&gt;-component composition &lt;code&gt;\({\color{#440154}{\boldsymbol{y}}} = ({\color{#440154}{y_1}}, {\color{#440154}{y_2}}, \ldots, {\color{#440154}{y_K}})\)&lt;/code&gt; where &lt;code&gt;\(\sum_{k=1}^{\color{#FDE725}{K}} {\color{#440154}{y_k}} = 1\)&lt;/code&gt; and &lt;code&gt;\({\color{#440154}{y_k}} &amp;gt; 0\)&lt;/code&gt;, the Dirichlet distribution provides a natural model:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$${\color{#440154}{\boldsymbol{y}}} \sim \text{Dirichlet}({\color{#31688E}{\boldsymbol{\alpha}}})$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;where &lt;code&gt;\({\color{#31688E}{\boldsymbol{\alpha}}} = ({\color{#31688E}{\alpha_1}}, {\color{#31688E}{\alpha_2}}, \ldots, {\color{#31688E}{\alpha_K}})\)&lt;/code&gt; are positive concentration parameters. The probability density is:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$f({\color{#440154}{\boldsymbol{y}}}|{\color{#31688E}{\boldsymbol{\alpha}}}) = \frac{\Gamma({\color{#31688E}{\alpha_0}})}{\prod_{k=1}^{\color{#FDE725}{K}} \Gamma({\color{#31688E}{\alpha_k}})} \prod_{k=1}^{\color{#FDE725}{K}} {\color{#440154}{y_k}}^{{\color{#31688E}{\alpha_k}} - 1}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;with &lt;code&gt;\({\color{#31688E}{\alpha_0}} = \sum_{k=1}^{\color{#FDE725}{K}} {\color{#31688E}{\alpha_k}}\)&lt;/code&gt; and &lt;code&gt;\(\Gamma(\cdot)\)&lt;/code&gt; the gamma function. The expected proportion for component &lt;code&gt;\(k\)&lt;/code&gt; is &lt;code&gt;\(\mathbb{E}[{\color{#440154}{y_k}}] = {\color{#31688E}{\alpha_k}} / {\color{#31688E}{\alpha_0}}\)&lt;/code&gt;, while the precision (inverse variance) increases with &lt;code&gt;\({\color{#31688E}{\alpha_0}}\)&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;In regression contexts, we model how &lt;code&gt;\({\color{#31688E}{\boldsymbol{\alpha}}}\)&lt;/code&gt; depends on predictors. The brms package uses a multivariate logit parameterization where the expected proportions &lt;code&gt;\({\color{#35B779}{\boldsymbol{\mu}}} = \mathbb{E}[{\color{#440154}{\boldsymbol{y}}}]\)&lt;/code&gt; are linked to linear predictors via:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$${\color{#35B779}{\mu_j}} = \frac{\exp({\color{#21918C}{\eta_j}})}{\sum_{k=1}^{\color{#FDE725}{K}} \exp({\color{#21918C}{\eta_k}})}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;where &lt;code&gt;\({\color{#21918C}{\eta_j}}\)&lt;/code&gt; is the linear predictor for category &lt;code&gt;\(j\)&lt;/code&gt;. For identifiability, one category (typically the last) serves as reference with &lt;code&gt;\({\color{#21918C}{\eta_{\text{ref}}}} = 0\)&lt;/code&gt;. This means we estimate separate linear predictors for &lt;code&gt;\({\color{#FDE725}{K}}-1\)&lt;/code&gt; categories:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$${\color{#21918C}{\eta_j}} = \boldsymbol{x}^T \boldsymbol{\beta}_j + f_j(\boldsymbol{x}), \quad j = 1, \ldots, {\color{#FDE725}{K}}-1$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;where &lt;code&gt;\(f_j(\cdot)\)&lt;/code&gt; represents smooth functions (like our Gaussian processes). This approach naturally ensures &lt;code&gt;\(\sum_{k=1}^K \mu_k = 1\)&lt;/code&gt; while allowing each functional group to have its own flexible, nonlinear response to environmental gradients.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;parameter-guide-for-dirichlet-regression&#34;&gt;Parameter guide for Dirichlet regression&#xA;  &lt;a href=&#34;#parameter-guide-for-dirichlet-regression&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Let me break down what each parameter means in our ecological context, using the same color scheme as above:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Observed composition&lt;/strong&gt; &lt;code&gt;\({\color{#440154}{\boldsymbol{y}}} = ({\color{#440154}{y_1}}, ..., {\color{#440154}{y_K}})\)&lt;/code&gt;: The actual proportions we observe at each site. In our case, this is a 5-element vector containing the relative abundances of grass, forb, shrub, tree, and lichen. These must sum to 1 and all be positive.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Concentration parameters&lt;/strong&gt; &lt;code&gt;\({\color{#31688E}{\boldsymbol{\alpha}}} = ({\color{#31688E}{\alpha_1}}, ..., {\color{#31688E}{\alpha_K}})\)&lt;/code&gt;: These control both the expected proportions and the precision of the distribution. Higher &lt;code&gt;\({\color{#31688E}{\alpha_k}}\)&lt;/code&gt; means functional group &lt;code&gt;\(k\)&lt;/code&gt; has higher expected proportion. The sum &lt;code&gt;\({\color{#31688E}{\alpha_0}} = \sum_k {\color{#31688E}{\alpha_k}}\)&lt;/code&gt; determines overall precision. Larger values mean less variance around expected proportions.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Expected proportions&lt;/strong&gt; &lt;code&gt;\({\color{#35B779}{\boldsymbol{\mu}}} = ({\color{#35B779}{\mu_1}}, ..., {\color{#35B779}{\mu_K}})\)&lt;/code&gt;: The mean of the Dirichlet distribution, representing expected composition at any given environmental combination. This is what we&amp;rsquo;re ultimately interested in predicting, how community composition changes across environmental gradients.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Linear predictors&lt;/strong&gt; &lt;code&gt;\({\color{#21918C}{\eta_j}}\)&lt;/code&gt; for &lt;code&gt;\(j = 1, ..., {\color{#FDE725}{K}}-1\)&lt;/code&gt;: The unconstrained predictions before applying the softmax transformation. This is where we place our Gaussian process smooths of elevation and temperature. Note we only model &lt;code&gt;\({\color{#FDE725}{K}}-1\)&lt;/code&gt; predictors, with the last category serving as reference.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Number of categories&lt;/strong&gt; &lt;code&gt;\({\color{#FDE725}{K}}\)&lt;/code&gt;: The dimensionality of our compositional data. For plant communities, &lt;code&gt;\({\color{#FDE725}{K}}=5\)&lt;/code&gt; functional groups. This could be any number of categories in other applications like market shares, time allocation, or mineral compositions.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;The key insight is that the linear predictors &lt;code&gt;\(\eta_j\)&lt;/code&gt; are where we incorporate environmental effects through Gaussian process smooths, allowing each functional group to have its own flexible, nonlinear response to environmental gradients while ensuring all predictions respect compositional constraints.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This tutorial relies on the following packages:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(brms)            &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Bayesian modeling with Stan&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(tidyverse)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Data manipulation and visualization  &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(viridis)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Color palettes&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(patchwork)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Plot composition&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(waffle)          &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Waffle plots for compositional visualization&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(cowplot)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract and manipulate plot components&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A custom &lt;code&gt;ggplot2&lt;/code&gt; theme; feel free to ignore if you have your own plot preferences&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Set consistent ggplot theme for all visualizations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_set&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    base_size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;15&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    base_family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;serif&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    axis.line.x.bottom &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    axis.line.y.left &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;simulating-plant-community-data&#34;&gt;Simulating plant community data&#xA;  &lt;a href=&#34;#simulating-plant-community-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;I simulate realistic plant community composition data across elevation and temperature gradients, where five functional groups (grasses, forbs, shrubs, trees, lichens) respond differently to environmental conditions. This simulation captures the ecological reality that different plant types show varying tolerance ranges and optimal growing conditions along environmental gradients—a pattern we&amp;rsquo;ll later model using Dirichlet regression.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;simulate_plant_community &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    n_sites &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;60&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation_range &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    temp_range &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;25&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;42&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Generate elevation gradient with uniform random sampling&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;runif&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    n_sites, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation_range[1], &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation_range[2]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  elev_norm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; (elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; elevation_range[1]) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (elevation_range[2] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; elevation_range[1])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create realistic temperature-elevation relationship with plateau&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Temperature decreases with elevation but plateaus at high elevations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plateau_point &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sharpness &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  temp_factor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;tanh&lt;/span&gt;(sharpness &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; (elev_norm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; plateau_point)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; temp_range[1] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (temp_range[2] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; temp_range[1]) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temp_factor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n_sites, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Define functional group responses to environmental gradients&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Each group has distinct ecological preferences that create realistic&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# community assembly patterns along elevation and temperature gradients&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Grasses: peak abundance at mid-elevations with moderate temperatures&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Strong quadratic responses in both elevation and temperature&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  grass_logit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#099&#34;&gt;0.08&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.004&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.02&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Forbs: prefer lower-mid elevations and warmer temperatures&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Negative elevation effect with positive temperature response&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  forb_logit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.12&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#099&#34;&gt;0.005&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-0.03&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Shrubs: adapted to mid-high elevations with moderate-cool temperatures&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Positive elevation effect with cool temperature preference&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  shrub_logit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#099&#34;&gt;-0.04&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.003&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature^2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Trees: dominate at lower elevations and warmer temperatures&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Strong negative elevation effects with positive temperature response&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tree_logit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#099&#34;&gt;0.15&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.005&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.04&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Lichens: alpine specialists preferring high elevation, cool temperatures&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Strong positive elevation effect with negative temperature preference&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  lichen_logit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-1.8&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; elevation^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#099&#34;&gt;-0.1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.003&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature^2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Apply softmax transformation to ensure probabilities sum to 1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This converts unconstrained logits to valid probability simplex&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  logits &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cbind&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grass_logit, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    forb_logit, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    shrub_logit, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tree_logit, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lichen_logit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  exp_logits &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(logits)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; exp_logits &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rowSums&lt;/span&gt;(exp_logits)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Set constant precision parameter for all sites&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This keeps the focus on mean compositional responses&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  precision &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Generate Dirichlet-distributed compositions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Each site gets alpha parameters = expected proportions * precision&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  compositions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; n_sites, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;n_sites) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    alpha_params &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; probs[i, ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; precision&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    compositions[i, ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; brms&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rdirichlet&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, alpha_params)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add small offset and renormalize to ensure no exact zeros&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Dirichlet distribution requires all components &amp;gt; 0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  offset &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.001&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  compositions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; compositions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; offset&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  compositions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; compositions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rowSums&lt;/span&gt;(compositions)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Return structured data frame with environmental predictors and compositions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    site_id &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;n_sites,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; elevation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grass &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; compositions[, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    forb &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; compositions[, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    shrub &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; compositions[, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;], &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tree &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; compositions[, &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lichen &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; compositions[, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plant_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;simulate_plant_community&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Define functional groups for consistent use across analysis&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;functional_groups &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;forb&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;grass&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;lichen&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;shrub&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;tree&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&amp;rsquo;s verify our simulated compositions respect the fundamental constraint that proportions must sum to unity:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Verify compositions sum to 1 (within numerical precision)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rowSums&lt;/span&gt;(plant_data[, functional_groups]) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. &#xD;&#xA;##       1       1       1       1       1       1&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;exploratory-visualization&#34;&gt;Exploratory visualization&#xA;  &lt;a href=&#34;#exploratory-visualization&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;These exploratory plots serve a crucial purpose before diving into modeling. The top panel shows how elevation and temperature covary in our simulated landscape—this realistic temperature lapse rate will affect how we interpret subsequent model results. The bottom panels reveal the raw compositional patterns that our Dirichlet regression will attempt to capture with smooth functions.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Visualize the environmental relationship between elevation and temperature&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This shows the realistic temperature-elevation gradient we simulated&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plant_data, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(elevation, temperature)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;loess&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Elevation (km)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Temperature (°C)&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Reshape data to long format for plotting all functional groups together&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This transformation allows us to visualize compositional changes efficiently&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plant_long &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; plant_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    temperature, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grass&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;lichen&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_longer&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grass&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;lichen, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;functional_group&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;proportion&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Visualize how community composition changes along elevation gradient&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Each functional group shows distinct elevational preferences&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plant_long, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    proportion, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; functional_group&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;loess&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_viridis_d&lt;/span&gt;(name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Functional\nGroup&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lims&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Elevation (km)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Relative abundance&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Visualize how community composition changes along temperature gradient&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Temperature effects complement elevation patterns in shaping communities&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p3 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plant_long, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    temperature, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    proportion, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; functional_group&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;loess&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_viridis_d&lt;/span&gt;(name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Functional\nGroup&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lims&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Temperature (°C)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create a more compact legend with smaller text and tighter spacing&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p2_compact_legend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; p2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    legend.title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_text&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;9&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    legend.text &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_text&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    legend.key.size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;unit&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;lines&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    legend.margin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;margin&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    legend.box.margin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;margin&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract the compact legend&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;legend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; cowplot&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;get_legend&lt;/span&gt;(p2_compact_legend)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Remove legends from both composition plots&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p2_no_legend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; p2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p3_no_legend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; p3 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Combine bottom plots first, then add legend&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bottom_row &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; (p2_no_legend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt; p3_no_legend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt; legend) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  patchwork&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_layout&lt;/span&gt;(widths &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;9&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Combine top and bottom&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; bottom_row&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/plant-community-dirichlet/index_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;dirichlet-regression-with-gaussian-processes&#34;&gt;Dirichlet regression with Gaussian processes&#xA;  &lt;a href=&#34;#dirichlet-regression-with-gaussian-processes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Now comes the core modeling step: fitting Dirichlet regression with bivariate Gaussian process smooths. But first, let me explain why Gaussian processes are particularly well-suited for this ecological problem.&lt;/p&gt;&#xA;&lt;p&gt;Why choose Gaussian processes over other smoothing methods? Standard approaches like polynomial regression or splines make strong assumptions about functional form. Polynomials assume global relationships, while splines assume local smoothness within predefined knots. Gaussian processes, by contrast, are non-parametric: they let the data determine the appropriate level of smoothness at each point in covariate space. This flexibility is crucial for ecological data where relationships might be smooth in some regions (gradual transitions between communities) but abrupt in others (sharp ecotones at treelines).&lt;/p&gt;&#xA;&lt;p&gt;Traditional GPs face a computational challenge: they scale as O(n³) with sample size, making them impractical for datasets with more than 500 observations. The approximate Hilbert space Gaussian processes implemented in &lt;code&gt;brms&lt;/code&gt; use basis function expansions that reduce this to O(n), enabling GP flexibility on realistic ecological datasets. This isn&amp;rsquo;t just a computational nicety, it opens up sophisticated nonparametric modeling for the sample sizes we actually encounter in field studies.&lt;/p&gt;&#xA;&lt;p&gt;The compositional modeling advantage here is that we can model each functional group&amp;rsquo;s response surface simultaneously while respecting compositional constraints. Unlike separate GAMs for each species that might predict impossible total abundances, Dirichlet regression with GPs ensures all predictions lie on the probability simplex.&lt;/p&gt;&#xA;&lt;p&gt;For the GP kernel, I use the exponential covariance function rather than the more common squared exponential (RBF) kernel. The exponential kernel is computationally more efficient in the Hilbert space approximation while still capturing smooth nonlinear relationships. This makes the difference between a model that fits in minutes versus hours for ecological datasets.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Prepare response matrix for Dirichlet regression&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Each row represents a site&amp;#39;s complete community composition&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;with&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plant_data, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cbind&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grass, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    forb, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    shrub, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tree, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lichen&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; Y&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Verify no zeros exist (Dirichlet distribution requires positive values)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Our simulation ensures this, but it&amp;#39;s good practice to check&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(Y)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Specify model formula with bivariate Gaussian process smooth&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# k=10 basis functions provide good balance between flexibility and efficiency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# c=5/4 sets the boundary factor for the approximation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model_formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;bf&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gp&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    temperature, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cov &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;exponential&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit Dirichlet regression model using Stan via brms&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This estimates separate GP surfaces for each functional group&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plant_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;brm&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  model_formula,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; plant_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; brms&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dirichlet&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  chains &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  iter &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  warmup &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cores &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  seed &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;42&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  backend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;cmdstanr&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  silent &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;model-predictions-and-effects&#34;&gt;Model predictions and effects&#xA;  &lt;a href=&#34;#model-predictions-and-effects&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;With our fitted model, we can now extract predictions across environmental gradients to understand precisely how community composition responds to elevation and temperature. This is where we transition from model fitting to interpretation, and where understanding different types of posterior predictions becomes crucial.&lt;/p&gt;&#xA;&lt;p&gt;I use &lt;code&gt;posterior_epred()&lt;/code&gt; rather than &lt;code&gt;posterior_predict()&lt;/code&gt; because I want the expected values of the posterior predictive distribution, not new random draws from it. Andrew Heiss has an &#xA;&lt;a href=&#34;https://www.andrewheiss.com/blog/2022/09/26/guide-visualizing-types-posteriors/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;excellent guide to visualizing different types of posteriors&lt;/a&gt; that explains these distinctions clearly. For compositional data, &lt;code&gt;posterior_epred()&lt;/code&gt; gives us the model&amp;rsquo;s best estimate of expected proportions at each environmental combination, while &lt;code&gt;posterior_predict()&lt;/code&gt; would add additional Dirichlet sampling variation on top. Since we want to understand the underlying functional relationships rather than prediction intervals for new observations, &lt;code&gt;posterior_epred()&lt;/code&gt; is the right choice.&lt;/p&gt;&#xA;&lt;p&gt;I&amp;rsquo;ll create three complementary prediction scenarios: univariate effects along each environmental axis (holding the other at its mean), plus bivariate surfaces showing interactive effects. The prediction strategy here is key to interpretation. I create three different prediction grids that answer different ecological questions:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create elevation gradient with temperature held at mean for marginal effects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This asks: &amp;#34;How does composition change with elevation at average temperature?&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;elev_grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;elevation), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;elevation), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;temperature)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create temperature gradient with elevation held at mean for marginal effects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This asks: &amp;#34;How does composition change with temperature at average elevation?&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temp_grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;elevation),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;temperature), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;temperature), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create bivariate prediction grid for interactive response surfaces&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This asks: &amp;#34;How does composition vary across the full elevation-temperature space?&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Coarser 20x20 grid (400 points) balances detail with computational efficiency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;elev_seq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;elevation), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;elevation), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temp_seq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;temperature), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;temperature), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bivariate_grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expand.grid&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; elev_seq, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temp_seq&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract posterior predictions from fitted Dirichlet model&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# posterior_epred gives expected values (means) of predictive distribution&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# rather than new random samples, perfect for understanding relationships&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;elev_post_pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_epred&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plant_model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; elev_grid, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ndraws &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temp_post_pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_epred&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plant_model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temp_grid, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ndraws &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bivar_post_pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_epred&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plant_model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; bivariate_grid, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ndraws &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now I need to convert these posterior prediction arrays into something we can actually plot. The &lt;code&gt;posterior_epred&lt;/code&gt; function returns a three-dimensional array: 500 posterior draws × 100 prediction points × 5 functional groups. This represents our uncertainty about expected proportions at each environmental combination.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Function to calculate summary statistics from posterior prediction draws&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This converts arrays of posterior samples into plottable summaries&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calc_pred_summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(post_draws, grid_data) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  n_cats &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(post_draws)[3]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Validate dimensions match expected functional groups&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This catches potential mismatches between model and data&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt; (n_cats &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(functional_groups)) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;stop&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Number of categories in posterior draws (&amp;#34;&lt;/span&gt;, n_cats, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;) doesn&amp;#39;t match functional groups (&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(functional_groups), &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;)&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  result &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; grid_data&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate summary statistics for each functional group&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Mean captures central tendency, quantiles provide uncertainty&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq_along&lt;/span&gt;(functional_groups)) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cat_name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; functional_groups[i]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cat_draws &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; post_draws[, , i]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate posterior mean and 95% credible intervals efficiently&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This summarizes 500 posterior draws into point estimates + uncertainty&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    stats &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      cat_draws, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(x), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, &lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;, names &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;, names &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Assign summary statistics to result dataframe with clear naming&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    result[&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[paste0&lt;/span&gt;(cat_name, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;_mean&amp;#34;&lt;/span&gt;)]] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; stats[&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;mean&amp;#34;&lt;/span&gt;, ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    result[&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[paste0&lt;/span&gt;(cat_name, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;_lower&amp;#34;&lt;/span&gt;)]] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; stats[&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;lower&amp;#34;&lt;/span&gt;, ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    result[&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[paste0&lt;/span&gt;(cat_name, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;_upper&amp;#34;&lt;/span&gt;)]] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; stats[&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;upper&amp;#34;&lt;/span&gt;, ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;return&lt;/span&gt;(result)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Apply summary function to convert posterior arrays to dataframes&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;elev_summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;calc_pred_summary&lt;/span&gt;(elev_post_pred, elev_grid)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temp_summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;calc_pred_summary&lt;/span&gt;(temp_post_pred, temp_grid)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bivar_summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;calc_pred_summary&lt;/span&gt;(bivar_post_pred, bivariate_grid)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;marginal-effects-univariate-environmental-responses&#34;&gt;Marginal effects: univariate environmental responses&#xA;  &lt;a href=&#34;#marginal-effects-univariate-environmental-responses&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Marginal effects plots reveal how each functional group responds to single environmental gradients while holding other variables constant. These plots answer questions like &amp;ldquo;How does community composition change as I walk up an elevation transect at average temperature?&amp;rdquo; The ribbons around each line represent our uncertainty about these relationships. Wider ribbons indicate less confidence, typically where we have fewer data points or the GP is interpolating across larger gaps.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Function to create marginal effects plots for any environmental variable&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This unified approach ensures consistent styling across all visualizations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;create_marginal_plot &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(pred_data, x_var, x_label) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Reshape prediction data from wide to long format for ggplot&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract only the focal variable and all functional group statistics&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  plot_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; pred_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;all_of&lt;/span&gt;(x_var), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matches&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;(&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste&lt;/span&gt;(functional_groups, collapse &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;|&amp;#34;&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;)_(mean|lower|upper)$&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_longer&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      cols &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;all_of&lt;/span&gt;(x_var),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      names_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;functional_group&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;stat&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      names_pattern &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;(.+)_(mean|lower|upper)$&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      values_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_wider&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      names_from &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; stat, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      values_from &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; value&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create ggplot with ribbon for uncertainty and line for mean response&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Consistent styling across all marginal effects plots&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    plot_data, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; .data[[x_var]], &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mean, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; functional_group, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; functional_group&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;(linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_viridis_d&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Functional\nGroup&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      option &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;D&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_viridis_d&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Functional\nGroup&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      option &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;D&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; x_label, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Predicted Proportion&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;right&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Generate marginal effects plots&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;create_marginal_plot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  elev_summary, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;elevation&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Elevation (km)&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;create_marginal_plot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  temp_summary, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;temperature&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Temperature (°C)&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Display elevation effects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_elevation&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/plant-community-dirichlet/index_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Display temperature effects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_temperature&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/plant-community-dirichlet/index_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These marginal effects reveal clear ecological zonation patterns. The elevation responses show grasses peaking around 1.5km elevation, consistent with montane grassland ecology. Trees decline steadily with elevation from maximum abundance at low elevations, capturing realistic treeline dynamics. Lichens show the opposite pattern, with minimal presence below 2km but increasing dramatically at high elevations where harsh conditions exclude other functional groups.&lt;/p&gt;&#xA;&lt;p&gt;The temperature responses show equally complex patterns. Lichens dominate at the coldest temperatures (~8°C), decline at moderate temperatures, then increase again toward warmer conditions, creating a bimodal response. Grasses show a complex multimodal temperature response with peaks around 11°C and 20°C. Trees exhibit a strong positive response to warming, reaching maximum abundance around 25°C. Forbs and shrubs remain relatively stable across temperature gradients.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;visualizing-predicted-communities-with-waffle-plots&#34;&gt;Visualizing predicted communities with waffle plots&#xA;  &lt;a href=&#34;#visualizing-predicted-communities-with-waffle-plots&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Before diving into complex bivariate surfaces, let&amp;rsquo;s visualize what these predicted communities actually look like at specific elevations. Waffle plots provide an intuitive representation where each square represents an individual plant, making abstract proportions concrete and interpretable.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Prepare data for multiple elevations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;elev_values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1.6&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;2.0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;2.4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;2.8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;3.2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;total_plants &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Build waffle data for all elevations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;all_waffle_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NULL&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt; (elev &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; elev_values) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Prepare prediction point at mean temperature&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  pred_point &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; elev,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(plant_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;temperature)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Get predictions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_epred&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    plant_model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred_point, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ndraws &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate mean proportions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mean_props &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(pred[, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, ], &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, mean)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Convert to counts ensuring sum equals total_plants&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  counts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(mean_props &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; total_plants)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(counts) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!=&lt;/span&gt; total_plants) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    diff &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; total_plants &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(counts)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_idx &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;which.max&lt;/span&gt;(counts)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    counts[max_idx] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; counts[max_idx] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; diff&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create expanded data for this elevation (one row per plant)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq_along&lt;/span&gt;(functional_groups)) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt; (counts[i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      elev_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        elevation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(elev, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;km&amp;#34;&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(elev_values, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;km&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        functional_group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          functional_groups[i], &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;forb&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;grass&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;lichen&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;shrub&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;tree&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, counts[i])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      all_waffle_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbind&lt;/span&gt;(all_waffle_data, elev_data)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create faceted waffle plot&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;all_waffle_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; functional_group, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; count&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  waffle&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_waffle&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    n_rows &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    flip &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    make_proportional &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; elevation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_viridis_d&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Functional Group&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    option &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;D&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coord_equal&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_minimal&lt;/span&gt;(base_size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;15&lt;/span&gt;, base_family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;serif&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;bottom&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    legend.direction &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;horizontal&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    strip.background &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panel.grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panel.background &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    axis.text &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    axis.title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    axis.ticks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;guides&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;guide_legend&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      title.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;top&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      title.hjust &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/plant-community-dirichlet/index_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These waffle plots make the compositional changes tangible. At low elevations (1.2km), grasses (blue squares) dominate with trees (yellow) as codominants and small amounts of forbs (purple). Moving upslope to 1.6km, grasses remain dominant but trees and shrubs (green) become more prominent. At 2.0km, we see the beginning of the major transition as lichens (teal) start appearing significantly alongside the still-dominant grasses. By 2.4km, lichens become the dominant functional group with grasses remaining substantial. At the highest elevation (3.2km), lichens overwhelmingly dominate the alpine community. Each square represents an individual plant out of 50 total, so readers can literally count how community composition shifts from grass-tree lowlands to lichen-dominated alpine zones, much more intuitive than abstract proportions.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;bivariate-surfaces-capturing-environmental-interactions&#34;&gt;Bivariate surfaces: capturing environmental interactions&#xA;  &lt;a href=&#34;#bivariate-surfaces-capturing-environmental-interactions&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;While marginal effects are useful, they miss a crucial aspect of ecological reality: environmental variables interact. Temperature and elevation don&amp;rsquo;t operate independently. Their combined effects often differ from what we&amp;rsquo;d predict by simply adding their separate influences. Bivariate response surfaces reveal these interactions by showing how functional groups respond across the full environmental space.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Function to create bivariate response surface for focal functional group&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Shows how group abundance varies across both environmental dimensions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;create_bivariate_plot &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(pred_data, focal_group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;grass&amp;#34;&lt;/span&gt;) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Validate that focal group is one of the modeled functional groups&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;focal_group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%in%&lt;/span&gt; functional_groups) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;stop&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;focal_group must be one of: &amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste&lt;/span&gt;(functional_groups, collapse &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;, &amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Construct column name and legend title for focal group&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  col_name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(focal_group, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;_mean&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  legend_title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; stringr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;str_to_title&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste&lt;/span&gt;(focal_group, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;\nProportion&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create response surface plot with raster and contour overlay&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pred_data, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; elevation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_raster&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; .data[[col_name]]), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      interpolate &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_contour&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(z &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; .data[[col_name]]), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_viridis_c&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; legend_title, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      option &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;plasma&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Elevation (km)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Temperature (°C)&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Generate bivariate surface plots for key functional groups&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_bivariate_grass &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;create_bivariate_plot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  bivar_summary, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;grass&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_bivariate_tree &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;create_bivariate_plot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  bivar_summary, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;tree&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Display grass response surface&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_bivariate_grass&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/plant-community-dirichlet/index_files/figure-html/unnamed-chunk-13-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Display tree response surface&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p_bivariate_tree&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/plant-community-dirichlet/index_files/figure-html/unnamed-chunk-14-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These bivariate surfaces reveal interactions that marginal plots miss entirely. The grass surface shows a clear &amp;ldquo;sweet spot&amp;rdquo; around 1.2-1.4km elevation and 12-15°C temperature, not just peak abundance at mid-elevation, but specifically at this elevation-temperature combination. The tree surface demonstrates highest abundances at the lowest elevations (1.0km) combined with the warmest temperatures (25°C), with tree proportions declining steeply as both elevation increases and temperatures cool, perfectly capturing treeline ecology.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;model-validation-checking-our-compositional-residuals&#34;&gt;Model validation: checking our compositional residuals&#xA;  &lt;a href=&#34;#model-validation-checking-our-compositional-residuals&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Before diving into ecological interpretation, let&amp;rsquo;s validate that our Dirichlet regression actually captures the patterns in our data. This step is crucial but often skipped in compositional analyses. I&amp;rsquo;ll show you how to compute proper residuals for compositional data and why traditional approaches fail.&lt;/p&gt;&#xA;&lt;p&gt;Computing residuals for compositional data isn&amp;rsquo;t straightforward. You can&amp;rsquo;t just subtract predicted from observed proportions because this ignores the constraint that components sum to unity and the unique variance structure of the Dirichlet distribution. Following &#xA;&lt;a href=&#34;https://github.com/maiermarco/DirichletReg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maier&amp;rsquo;s approach in the DirichletReg package&lt;/a&gt;, we need to account for both the mean-variance relationship and the precision parameter.&lt;/p&gt;&#xA;&lt;p&gt;The key insight is that for Dirichlet regression, the variance of each component depends on both its expected proportion μ and the overall precision φ:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\text{Var}(Y_k) = \frac{\mu_k(1-\mu_k)}{1+\phi}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;This formula captures two important features: components with intermediate proportions (μ ≈ 0.5) have higher variance than those near 0 or 1, and higher precision φ reduces variance across all components. Traditional Pearson residuals ignore this structure entirely.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract fitted values from our Dirichlet model&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# brms returns a 3D array: [sites, statistics, components]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fitted_values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;fitted&lt;/span&gt;(plant_model)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fitted_values[, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Estimate&amp;#34;&lt;/span&gt;, ]  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract just the expected proportions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract precision parameter from posterior samples&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# In brms, phi controls the Dirichlet precision&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;phi_samples &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as_draws_df&lt;/span&gt;(plant_model) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;contains&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;phi&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;phi_mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(phi_samples[[1]])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Observed compositions as matrix&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.matrix&lt;/span&gt;(plant_data[, functional_groups])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate proper Dirichlet variance structure&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This accounts for both mean-variance relationship AND precision&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;V &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; mu) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; phi_mean)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Standardized residuals: (observed - expected) / sqrt(variance)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# These should be approximately normal if our model fits well&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pearson_residuals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; (Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; mu) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sqrt&lt;/span&gt;(V)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now let&amp;rsquo;s examine whether our residuals show problematic patterns. Well-behaved residuals should be roughly normal and show no systematic trends across environmental gradients. If we see strong patterns, it suggests our model is missing important relationships.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create Q-Q plots to check if standardized residuals are approximately normal&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Reshape residuals to long format for easy plotting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;residual_long &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; pearson_residuals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.data.frame&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(site_id &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nrow&lt;/span&gt;(pearson_residuals)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_longer&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cols &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt;site_id,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;functional_group&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;residual&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Q-Q plot comparing residuals to theoretical normal distribution&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  residual_long,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(sample &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; residual, color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; functional_group)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;stat_qq&lt;/span&gt;(alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;stat_qq_line&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; functional_group, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;free&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_viridis_d&lt;/span&gt;(name &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Functional\nGroup&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Theoretical quantiles&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Sample quantiles&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/plant-community-dirichlet/index_files/figure-html/unnamed-chunk-16-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These Q-Q plots reveal how well our model captures the data structure for each functional group. Points should roughly follow the diagonal line if residuals are normally distributed. What we see here is largely reassuring: most functional groups show reasonably normal residual behavior, though some groups like forbs and lichens exhibit moderate deviations from normality in the tails.&lt;/p&gt;&#xA;&lt;p&gt;These moderate deviations aren&amp;rsquo;t necessarily problematic. They likely reflect the ecological reality that some sites have genuinely unusual community compositions that any model would struggle to predict perfectly. The Gaussian process smooths are doing well at capturing the main compositional patterns while the Dirichlet structure ensures all predictions respect compositional constraints.&lt;/p&gt;&#xA;&lt;p&gt;Compare this to what happens with naive approaches that ignore compositional constraints. If we fit separate binomial models for each functional group, we often get predicted total abundances that exceed 100%—a mathematical impossibility that reveals fundamental model misspecification. Our Dirichlet approach automatically prevents such nonsensical predictions while providing flexible nonlinear responses through Gaussian processes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;model-interpretation-and-ecological-insights&#34;&gt;Model interpretation and ecological insights&#xA;  &lt;a href=&#34;#model-interpretation-and-ecological-insights&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The Dirichlet regression successfully captures the complex, nonlinear relationships between environmental gradients and plant community composition. What makes this particularly satisfying is how the model recovers the ecological patterns we built into our simulation while respecting compositional constraints.&lt;/p&gt;&#xA;&lt;p&gt;What&amp;rsquo;s particularly elegant about this approach is how the compositional constraint enforcement works seamlessly. Unlike separate binomial models that could predict impossible total abundances exceeding 100%, our Dirichlet regression automatically ensures all predictions sum to unity. This isn&amp;rsquo;t just a statistical nicety, it reflects the biological reality that plant communities partition available space and resources.&lt;/p&gt;&#xA;&lt;p&gt;The approximate Hilbert space Gaussian processes deserve special mention here. Traditional GP methods would be computationally prohibitive for this dataset size, but the Hilbert space approximation maintains the flexibility to capture nonlinear responses while scaling to realistic sample sizes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;take-home-messages&#34;&gt;Take-home messages&#xA;  &lt;a href=&#34;#take-home-messages&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Dirichlet regression with Gaussian process smooths offers a principled framework for compositional data that:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Respects the mathematical constraints of compositional data&lt;/li&gt;&#xA;&lt;li&gt;Models dependencies between components naturally&lt;/li&gt;&#xA;&lt;li&gt;Provides flexible, nonlinear relationships via Gaussian processes&lt;/li&gt;&#xA;&lt;li&gt;Scales computationally via approximate Hilbert space methods&lt;/li&gt;&#xA;&lt;li&gt;Generates predictions that automatically satisfy compositional constraints&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;For data scientists working with compositional data, whether ecological communities, market shares, time allocation, or survey responses, this framework offers a principled alternative to problematic approaches. The combination of Dirichlet regression with approximate Gaussian processes provides both statistical rigor and computational tractability. Most importantly, it generates predictions that respect the mathematical structure of your data, avoiding the impossible predictions that plague naive approaches.&lt;/p&gt;&#xA;&lt;p&gt;I&amp;rsquo;d encourage you to try this approach on your own compositional datasets. The &lt;code&gt;brms&lt;/code&gt; package makes implementation remarkably straightforward, and the computational efficiency of approximate GPs means you can fit these models on realistic dataset sizes without specialized hardware. The investment in learning this framework pays dividends in more reliable predictions and deeper insights into how your compositions respond to predictors.  Plus, you&amp;rsquo;ll never again have to explain to a collaborator why your separate logistic regressions predict that 130% of survey respondents chose option A. If you&amp;rsquo;re new to Bayesian modeling in ecology, I cover &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/talk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;getting started with mvgam and brms for ecological data&lt;/a&gt; in many of my talks.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material for working with compositional data analysis and Gaussian processes&lt;/p&gt;&#xA;&lt;p&gt;Aitchison, J. (1986). &#xA;&lt;a href=&#34;https://books.google.com/books/about/The_Statistical_Analysis_of_Compositiona.html?id=b_2YQgAACAAJ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Statistical Analysis of Compositional Data&lt;/a&gt;. &lt;em&gt;Chapman and Hall&lt;/em&gt;, London.&lt;/p&gt;&#xA;&lt;p&gt;van den Boogaart, K. G., &amp;amp; Tolosana-Delgado, R. (2013). &#xA;&lt;a href=&#34;https://doi.org/10.1007/978-3-642-36809-7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Analyzing compositional data with R&lt;/a&gt;. &lt;em&gt;Springer&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Bürkner, P. C. (2017). &#xA;&lt;a href=&#34;https://doi.org/10.18637/jss.v080.i01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;brms: An R package for Bayesian multilevel models using Stan&lt;/a&gt;. &lt;em&gt;Journal of Statistical Software&lt;/em&gt;, 80(1), 1-28.&lt;/p&gt;&#xA;&lt;p&gt;Bürkner, P. C. (2018). &#xA;&lt;a href=&#34;https://doi.org/10.32614/RJ-2018-017&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Advanced Bayesian multilevel modeling with the R package brms&lt;/a&gt;. &lt;em&gt;The R Journal&lt;/em&gt;, 10(1), 395-411.&lt;/p&gt;&#xA;&lt;p&gt;Hijazi, R. H., &amp;amp; Jernigan, R. W. (2009). &#xA;&lt;a href=&#34;https://www.researchgate.net/publication/228576713_Modelling_compositional_data_using_Dirichlet_regression_models&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modelling compositional data using Dirichlet regression models&lt;/a&gt;. &lt;em&gt;Journal of Applied Probability &amp;amp; Statistics&lt;/em&gt;, 4(1), 77-91.&lt;/p&gt;&#xA;&lt;p&gt;Maier, M. J. (2014). &#xA;&lt;a href=&#34;https://epub.wu.ac.at/4077/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DirichletReg: Dirichlet regression for compositional data in R&lt;/a&gt;. &lt;em&gt;Research Report Series&lt;/em&gt;, Department of Statistics and Mathematics, 125.&lt;/p&gt;&#xA;&lt;p&gt;Rasmussen, C. E., &amp;amp; Williams, C. K. I. (2006). &#xA;&lt;a href=&#34;http://gaussianprocess.org/gpml/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gaussian processes for machine learning&lt;/a&gt;. &lt;em&gt;MIT Press&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Riutort-Mayol, G., Bürkner, P. C., Andersen, M. R., Solin, A., &amp;amp; Vehtari, A. (2023). &#xA;&lt;a href=&#34;https://doi.org/10.1007/s11222-022-10167-2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Practical Hilbert space approximate Bayesian Gaussian processes for probabilistic programming&lt;/a&gt;. &lt;em&gt;Statistics and Computing&lt;/em&gt;, 33(1), 17.&lt;/p&gt;&#xA;&lt;p&gt;Thorson, J. T., Ianelli, J. N., Larsen, E. A., Ries, L., Scheuerell, M. D., Szuwalski, C., &amp;amp; Zipkin, E. F. (2016). &#xA;&lt;a href=&#34;https://doi.org/10.1111/geb.12464&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Joint dynamic species distribution models: a tool for community ordination and spatio-temporal monitoring&lt;/a&gt;. &lt;em&gt;Global Ecology and Biogeography&lt;/em&gt;, 25(9), 1144-1158.&lt;/p&gt;&#xA;&lt;p&gt;Warton, D. I., Blanchet, F. G., O&amp;rsquo;Hara, R. B., Ovaskainen, O., Taskinen, S., Walker, S. C., &amp;amp; Hui, F. K. (2015). &#xA;&lt;a href=&#34;https://doi.org/10.1016/j.tree.2015.09.007&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;So many variables: joint modeling in community ecology&lt;/a&gt;. &lt;em&gt;Trends in Ecology &amp;amp; Evolution&lt;/em&gt;, 30(12), 766-779.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>GAMs for Customer Lifetime Value (CLV) prediction</title>
  <link>https://ecogambler.netlify.app/blog/clv-prediction/</link>
  <pubDate>Sat, 11 Oct 2025 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/clv-prediction/</guid>
  <description>&lt;p&gt;I typically work in quantitative ecology and molecular epidemiology, where we use statistical models to predict species distributions or disease transmission patterns. Recently though, I had an interesting conversation with a data science PhD student who mentioned they were applying GAMs to predict Customer Lifetime Value at a SaaS startup. This caught my attention because CLV prediction, as it turns out, faces remarkably similar statistical challenges to ecological forecasting: nonlinear relationships that saturate at biological or business limits, hierarchical structures where groups behave differently, and the need to balance model flexibility with interpretability for stakeholders who need to understand &lt;em&gt;why&lt;/em&gt; the model makes certain predictions.&lt;/p&gt;&#xA;&lt;p&gt;After diving into the business analytics literature, I discovered that companies take wildly different approaches to this problem. Many rely on simple heuristics like average order value × frequency × lifespan that ignore individual customer trajectories and temporal dynamics. Others implement sophisticated probabilistic models (the Pareto/NBD and BG/NBD families are particularly elegant), though these often require specialized knowledge to tune and interpret. Black-box machine learning models can capture complex patterns but sacrifice the interpretability that executives need for strategic decisions. Meanwhile, standard regression approaches often predict impossible values like negative revenue or infinite growth.&lt;/p&gt;&#xA;&lt;p&gt;&#xA;&lt;a href=&#34;https://doi.org/10.1201/9781315370279&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Generalized Additive Models&lt;/a&gt; provide a compelling middle ground that I think deserves more attention in this space. GAMs capture complex nonlinear relationships while maintaining full interpretability through visualizable smooth functions. They handle the heteroscedastic variance inherent in revenue data, automatically adapt to saturation effects, and provide uncertainty quantification that&amp;rsquo;s crucial for risk assessment. This post demonstrates how to build CLV models that respect business constraints, capturing channel decay patterns, tier-specific behaviors, and feature adoption dynamics, while remaining straightforward enough to deploy without extensive infrastructure or specialized optimization expertise.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;understanding-saas-business-dynamics&#34;&gt;Understanding SaaS business dynamics&#xA;  &lt;a href=&#34;#understanding-saas-business-dynamics&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Before we dive into the modeling (I promise we&amp;rsquo;ll get to the GAMs soon), it&amp;rsquo;s worth understanding why &#xA;&lt;a href=&#34;https://en.wikipedia.org/wiki/Software_as_a_service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Software as a Service (SaaS)&lt;/a&gt; businesses present such interesting statistical challenges. Unlike traditional software vendors who sell one-time licenses, or e-commerce platforms with discrete transactions, SaaS companies operate on subscription-based recurring revenue. Customers pay monthly or annually for continued access to cloud-hosted software, which fundamentally changes the economics and, more importantly for us, the statistical patterns we need to model.&lt;/p&gt;&#xA;&lt;p&gt;Here&amp;rsquo;s the key challenge: &#xA;&lt;a href=&#34;https://blog.hubspot.com/service/what-does-cac-stand-for&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;customer acquisition costs&lt;/a&gt; are typically massive relative to monthly revenue. Think about it, a customer paying $99/month with a $500 acquisition cost needs at least six months just to break even. This is where accurate CLV prediction becomes critical. You need to know which customer segments will stick around long enough to justify that upfront investment, and traditional models often miss the mark completely.&lt;/p&gt;&#xA;&lt;p&gt;What makes this particularly interesting from a modeling perspective is how customer value evolves. &#xA;&lt;a href=&#34;https://userpilot.com/blog/feature-adoption/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Feature adoption&lt;/a&gt; doesn&amp;rsquo;t just correlate with retention, it actively drives &#xA;&lt;a href=&#34;https://blog.hubspot.com/sales/saas-revenue-model&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;expansion revenue&lt;/a&gt; through tier upgrades and add-ons. I&amp;rsquo;ve seen datasets where highly engaged Basic tier customers generate more lifetime value than barely-engaged Enterprise customers, despite the 6x price difference. Meanwhile, &#xA;&lt;a href=&#34;https://blog.hubspot.com/service/customer-success&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;customer success teams&lt;/a&gt; intervene based on usage patterns, creating feedback loops where our predictions influence outcomes. Add in the fact that churned customers can be reactivated (unlike, say, a dead coral reef in my usual work), and you&amp;rsquo;ve got a complex dynamic system.&lt;/p&gt;&#xA;&lt;p&gt;The statistical requirements here are non-trivial: we need models that handle nonlinear feature effects (adoption plateaus around 80-90% for most products), tier-specific behaviors (Enterprise customers behave fundamentally differently), temporal decay patterns (paid acquisition channels show diminishing returns), and heteroscedastic variance (high-value customers are inherently more variable). Linear models with their constant effects and variance assumptions? They&amp;rsquo;ll predict negative revenue or infinite growth. Simple multipliers? They miss all the interesting dynamics. This is exactly where GAMs shine.&lt;/p&gt;&#xA;&lt;p&gt;In this post, I&amp;rsquo;ll walk through building a production-ready CLV prediction model using GAMs, starting from simulated data that captures realistic SaaS dynamics through to extracting specific business insights like upgrade thresholds and feature investment ROI. By the end, you&amp;rsquo;ll have a complete workflow that you can adapt to your own customer data, whether you&amp;rsquo;re in SaaS, e-commerce, or any business with recurring customer relationships.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Before we dive into the modeling, let&amp;rsquo;s load our packages. Nothing exotic here, just the usual suspects for GAM fitting and visualization:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Load libraries&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mgcv)            &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit flexible GAMs with smooth terms&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(tidyverse)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Data manipulation and visualization&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(marginaleffects) &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract interpretable predictions from GAMs&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(gratia)          &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Beautiful plots and posterior sampling for GAMs&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(scales)          &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format axes for currency and percentages&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Set a clean plotting theme&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_set&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_bw&lt;/span&gt;(base_size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;15&lt;/span&gt;, base_family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;serif&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(panel.grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;()))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;simulating-realistic-saas-customer-dynamics&#34;&gt;Simulating realistic SaaS customer dynamics&#xA;  &lt;a href=&#34;#simulating-realistic-saas-customer-dynamics&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Let&amp;rsquo;s build some synthetic data that captures real &#xA;&lt;a href=&#34;https://blog.hubspot.com/marketing/b2b-saas-marketing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;B2B SaaS&lt;/a&gt; patterns. I&amp;rsquo;m a big believer in &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;simulation for understanding model behavior&lt;/a&gt;, it&amp;rsquo;s something I use constantly in my ecological work, and it translates perfectly here. By controlling the data generating process, we know exactly what patterns our GAM should recover.&lt;/p&gt;&#xA;&lt;p&gt;I&amp;rsquo;ll simulate 100 customers tracked over 5 months, using realistic SaaS pricing tiers: Basic ($99/month), Pro ($299/month), and Enterprise ($599/month). The target variable is 6-month CLV, a common planning horizon in SaaS businesses. Now here&amp;rsquo;s where it gets interesting, and where we build in patterns that would break traditional models:&lt;/p&gt;&#xA;&lt;p&gt;First, feature adoption naturally plateaus. Nobody uses 100% of features (trust me, I still discover new RStudio shortcuts after a decade). Second, paid acquisition channels show decay, customers attracted by promotions gradually revert to their natural engagement levels. Third, and this is crucial, Enterprise customers don&amp;rsquo;t just have higher baseline value, they exhibit completely different response curves to adoption. These nonlinearities are exactly what GAMs handle naturally, no feature engineering required.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Set seed for reproducibility&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;55&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Generate customer-month observations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;train_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expand.grid&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  customer_id &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  month &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Assign customers to pricing tiers with typical SaaS distribution&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Basic&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Pro&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Enterprise&amp;#34;&lt;/span&gt;), &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          replace &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;))[customer_id],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Customer acquisition channels affect initial value and retention&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    acquisition_channel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Organic&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Paid&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Partner&amp;#34;&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;, replace &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)[customer_id],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Feature adoption grows over time but naturally caps around 95%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    feature_adoption_pct &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmin&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;95&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmax&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                         &lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; month &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                         &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n&lt;/span&gt;(), &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;))),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Monthly recurring revenue depends on tier&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    base_mrr &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;case_when&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Basic&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;99&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Pro&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;299&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Enterprise&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;599&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;99&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Paid acquisition provides early boost that decays over time&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    marketing_boost &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ifelse&lt;/span&gt;(acquisition_channel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Paid&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                            &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; month), &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# CLV with stronger saturation effects for Enterprise&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    adoption_multiplier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;case_when&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Enterprise&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.05&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; feature_adoption_pct)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Pro&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; (feature_adoption_pct&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; (feature_adoption_pct&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate CLV with clear asymptotic behavior&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    clv_6m &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; base_mrr &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; adoption_multiplier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; marketing_boost) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n&lt;/span&gt;(), &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.15&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Convert to factors after numeric calculations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(contract_tier, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Basic&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Pro&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Enterprise&amp;#34;&lt;/span&gt;)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    acquisition_channel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(acquisition_channel)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Let&amp;#39;s visualize the data we just created to understand the patterns&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# we&amp;#39;re asking our GAM to capture&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(train_data, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; feature_adoption_pct, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; clv_6m, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; contract_tier)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add individual customer data points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use a quadratic term to show nonlinear relationships&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;lm&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poly&lt;/span&gt;(x, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format y-axis as currency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use consistent color scheme across tiers&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Separate panels by acquisition channel&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; acquisition_channel) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add informative axis labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Feature Adoption Rate (%)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;6-Month Customer Lifetime Value ($)&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Contract Tier&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-4-1.png&#34; alt=&#34;Scatter plot showing SaaS customer lifetime value CLV prediction by feature adoption percentage across three pricing tiers Basic Pro Enterprise and three acquisition channels Organic Paid Partner with polynomial smoothing curves&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Notice how the relationship between adoption and CLV isn&amp;rsquo;t just nonlinear, it&amp;rsquo;s differently nonlinear for each tier. Enterprise customers hit a ceiling hard (classic diminishing returns), while Basic tier customers show nearly linear growth. The Paid acquisition channel generates higher initial CLV, but look closely at high adoption rates, that premium fades. This suggests organic customers eventually match paid ones if they stick around and engage with the product. But we will see a clearer plot of these relationships when we &lt;em&gt;estimate&lt;/em&gt; them using our GAM below.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Now examine temporal patterns - how does CLV evolve over time?&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;train_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; month, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; clv_6m, color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; acquisition_channel)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add LOESS smoothing with confidence bands for each channel&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; acquisition_channel),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;loess&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format y-axis as currency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Apply consistent color scheme for channels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create separate panels for each tier with independent y-scales&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; contract_tier, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;free_y&amp;#34;&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add informative axis labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Months Since Customer Acquisition&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;6-Month Customer Lifetime Value ($)&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Channel&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Channel&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-5-1.png&#34; alt=&#34;LOESS smoothed trends with confidence intervals showing B2B SaaS customer lifetime value over 5 months comparing Organic Paid Partner acquisition channels across Basic Pro Enterprise pricing tiers&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The temporal patterns here are interesting. Paid customers maintain higher CLV consistently, but the effect varies by tier. In Enterprise, we&amp;rsquo;re talking nearly $2,000 premium for Paid acquisition, while in Basic it&amp;rsquo;s much smaller. Partner channels are the wild card, they match Organic in most tiers but start to outperform in Pro. If I were building acquisition strategy from these patterns, we might want to focus paid spending on Enterprise and partner relationships on Pro customers.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;initial-gam-gaussian-with-log-link&#34;&gt;Initial GAM: Gaussian with log link&#xA;  &lt;a href=&#34;#initial-gam-gaussian-with-log-link&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;But rather than trying to make interpretations directly from the observed data, we would do better by fitting some models. So let&amp;rsquo;s fit our first GAM. I&amp;rsquo;m starting with a Gaussian distribution and log link, which at least ensures positive predictions (unlike linear models that cheerfully predict negative revenue):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit our first GAM with hierarchical smooths&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;clv_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_6m &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Global smooth of feature adoption: captures the overall&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# nonlinear relationship between adoption and CLV&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(feature_adoption_pct, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tier-specific adoption curves: allows each tier to have&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# different saturation patterns (e.g., Enterprise plateaus earlier)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(feature_adoption_pct, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; contract_tier, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Channel-specific temporal effects: models how acquisition&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# channel impacts CLV evolution over customer lifetime&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(month, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; acquisition_channel, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Overall time trend: captures market-wide changes or &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# seasonal patterns affecting all customers&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(month, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; train_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;REML&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gaussian&lt;/span&gt;(link &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(clv_model)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: gaussian &#xD;&#xA;## Link function: log &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## clv_6m ~ contract_tier + s(feature_adoption_pct, k = 6) + s(feature_adoption_pct, &#xD;&#xA;##     by = contract_tier, k = 6) + s(month, by = acquisition_channel, &#xD;&#xA;##     k = 4) + s(month, k = 4)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##                         Estimate Std. Error t value Pr(&amp;gt;|t|)    &#xD;&#xA;## (Intercept)              6.55559    0.08326   78.74   &amp;lt;2e-16 ***&#xD;&#xA;## contract_tierPro         1.25791    0.08945   14.06   &amp;lt;2e-16 ***&#xD;&#xA;## contract_tierEnterprise  2.72850    0.08356   32.66   &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##                                                      edf   Ref.df     F p-value&#xD;&#xA;## s(feature_adoption_pct)                         2.530042 3.042080 1.424 0.22991&#xD;&#xA;## s(feature_adoption_pct):contract_tierBasic      0.001621 0.003221 0.005 0.99691&#xD;&#xA;## s(feature_adoption_pct):contract_tierPro        1.001362 1.002606 0.684 0.40869&#xD;&#xA;## s(feature_adoption_pct):contract_tierEnterprise 1.681453 1.959838 0.725 0.52648&#xD;&#xA;## s(month):acquisition_channelOrganic             1.000103 1.000205 4.438 0.03566&#xD;&#xA;## s(month):acquisition_channelPaid                0.451201 0.749047 0.136 0.74953&#xD;&#xA;## s(month):acquisition_channelPartner             1.000556 1.001099 4.129 0.04265&#xD;&#xA;## s(month)                                        1.000119 1.000227 9.978 0.00168&#xD;&#xA;##                                                   &#xD;&#xA;## s(feature_adoption_pct)                           &#xD;&#xA;## s(feature_adoption_pct):contract_tierBasic        &#xD;&#xA;## s(feature_adoption_pct):contract_tierPro          &#xD;&#xA;## s(feature_adoption_pct):contract_tierEnterprise   &#xD;&#xA;## s(month):acquisition_channelOrganic             * &#xD;&#xA;## s(month):acquisition_channelPaid                  &#xD;&#xA;## s(month):acquisition_channelPartner             * &#xD;&#xA;## s(month)                                        **&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Rank: 33/35&#xD;&#xA;## R-sq.(adj) =  0.959   Deviance explained =   96%&#xD;&#xA;## -REML = 4118.5  Scale est. = 8.0808e+05  n = 500&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Take a moment to look at that summary output. The model structure here deserves some attention because it showcases what makes GAMs so powerful. We&amp;rsquo;ve got a global smooth of &lt;code&gt;feature_adoption_pct&lt;/code&gt; that captures the overall adoption-CLV relationship, then &lt;code&gt;by = contract_tier&lt;/code&gt; terms that let each tier deviate from this baseline. Think of it as saying &amp;ldquo;there&amp;rsquo;s a general pattern, but Enterprise customers can do their own thing if the data supports it.&amp;rdquo;&lt;/p&gt;&#xA;&lt;p&gt;This hierarchical setup is more elegant than fitting separate models per tier (which would ignore shared patterns) but more flexible than forcing all tiers into the same mold. The same logic applies to our temporal smooths, we model overall time trends while allowing channels to evolve differently. As &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;I&amp;rsquo;ve discussed elsewhere&lt;/a&gt;, the penalized likelihood estimation automatically handles the bias-variance tradeoff. Weak tier-specific patterns get shrunk toward zero (defaulting to the global pattern), while strong signals are preserved.&lt;/p&gt;&#xA;&lt;p&gt;But here&amp;rsquo;s the problem with this Gaussian model: it assumes constant variance. In revenue data? That&amp;rsquo;s wishful thinking. High-value Enterprise customers vary wildly in their outcomes, while Basic customers are more predictable. This heteroscedasticity isn&amp;rsquo;t just a statistical nuisance, it directly impacts business decisions about risk and investment.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;the-tweedie-advantage-matching-the-datas-reality&#34;&gt;The Tweedie advantage: Matching the data&amp;rsquo;s reality&#xA;  &lt;a href=&#34;#the-tweedie-advantage-matching-the-datas-reality&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Here&amp;rsquo;s something that took me years to fully appreciate: choosing the right distribution family is often more important than adding model complexity. Business metrics, particularly revenue, violate pretty much every assumption of the Gaussian distribution. Values are strictly positive, the variance grows with the mean (bigger customers are less predictable), and you might have exact zeros when customers churn immediately. Sound familiar? In ecology, we deal with the same issues when modeling species abundance.&lt;/p&gt;&#xA;&lt;p&gt;The Tweedie distribution handles all of this elegantly. Mathematically, it&amp;rsquo;s characterized by its variance function:&#xA;&lt;code&gt;$$\text{Var}(Y) = \phi \cdot \mu^p$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;where &lt;code&gt;\(\mu\)&lt;/code&gt; is the mean, &lt;code&gt;\(\phi\)&lt;/code&gt; is the dispersion parameter, and &lt;code&gt;\(p\)&lt;/code&gt; is the power parameter. Now here&amp;rsquo;s the clever bit: when &lt;code&gt;\(1 &amp;lt; p &amp;lt; 2\)&lt;/code&gt;, you get a compound Poisson-Gamma distribution that models continuous positive values with possible exact zeros. The parameter &lt;code&gt;\(p\)&lt;/code&gt; tells you about your data&amp;rsquo;s nature. Values near 1 suggest count-like behavior, near 2 indicates pure continuous data, and CLV typically lands around 1.5 to 1.8 (mostly continuous revenue with occasional immediate churners).&lt;/p&gt;&#xA;&lt;p&gt;What I find particularly satisfying is how this matches business reality. Enterprise customers with high mean CLV naturally show more variance than predictable Basic customers, and the Tweedie captures this automatically through that &lt;code&gt;\(\mu^p\)&lt;/code&gt; relationship. No variance stabilizing transformations, no separate zero-inflation component, just pick the right tool for the job. As &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;I&amp;rsquo;ve written about when modeling temporal patterns&lt;/a&gt;, respecting your data&amp;rsquo;s generative process isn&amp;rsquo;t just statistically proper, it leads to better predictions and honest uncertainty estimates.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Now fit with Tweedie distribution - same model structure,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# just changing the family to handle heteroscedastic variance&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;clv_tweedie &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_6m &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Global adoption smooth: overall adoption-CLV relationship&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(feature_adoption_pct, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tier-specific adoption responses: different value curves&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# per pricing tier (Enterprise vs Pro vs Basic)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(feature_adoption_pct, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; contract_tier, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Channel decay patterns: how acquisition source affects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# CLV trajectory over time &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(month, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; acquisition_channel, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Market-wide temporal effects: overall time trends&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(month, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; train_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;REML&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tweedie family: handles positive continuous data with&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# potential exact zeros and heteroscedastic variance&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;tw&lt;/span&gt;(link &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Compare model fits - lower AIC is better&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;AIC&lt;/span&gt;(clv_model, clv_tweedie)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##                   df      AIC&#xD;&#xA;## clv_model   13.75832 8235.860&#xD;&#xA;## clv_tweedie 14.28479 7248.197&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# The power parameter tells us about our data&amp;#39;s nature&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cat&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Estimated Tweedie power parameter:&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(clv_tweedie&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;family&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;getTheta&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;), &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;), &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Estimated Tweedie power parameter: 1.935&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That estimated power parameter tells us something important about our CLV data. We&amp;rsquo;re not dealing with pure counts (p=1) or pure continuous data (p=2), but something in between, exactly what you&amp;rsquo;d expect from subscription revenue with occasional zeros.&lt;/p&gt;&#xA;&lt;p&gt;Let&amp;rsquo;s visualize the fitted smooth functions to understand what the model learned about feature adoption and temporal patterns:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Visualize the smooth functions for feature adoption across tiers&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This shows the predicted CLV response to adoption for each tier&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;marginaleffects&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_tweedie, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;feature_adoption_pct&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;contract_tier&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;contract_tier&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format y-axis as currency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use consistent color scheme&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Clean up labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Feature Adoption Rate (%)&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Predicted CLV&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Remove redundant legend since we&amp;#39;re faceting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-8-1.png&#34; alt=&#34;GAM predictions showing nonlinear feature adoption effects by contract tier&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The smooth functions reveal some interesting patterns: Enterprise customers show classic saturation behavior, plateauing around 75% adoption as expected. Pro customers demonstrate steady growth with mild saturation at high adoption levels. Most intriguingly, Basic customers show a peaked response, with CLV actually declining after around 50% adoption. This suggests Basic customers might hit complexity barriers where additional features create more confusion than value.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Visualize temporal patterns by acquisition channel&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This reveals how CLV evolves differently for each channel over time&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;marginaleffects&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_tweedie, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;month&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;acquisition_channel&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;acquisition_channel&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format y-axis as currency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use consistent color scheme&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Clean up labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Months Since Acquisition&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Predicted CLV&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Remove redundant legend since we&amp;#39;re faceting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-9-1.png&#34; alt=&#34;GAM predictions showing channel-specific temporal decay patterns&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The temporal patterns tell a compelling story about channel effectiveness over time. Paid acquisition actually shows declining CLV, suggesting that promotional incentives attract customers who don&amp;rsquo;t stick around or engage deeply. Organic and Partner channels both show steady growth, with customers becoming more valuable as they mature and discover the product&amp;rsquo;s value naturally. This decay in Paid channel effectiveness over time is exactly the kind of pattern that traditional multiplier models would miss completely.&lt;/p&gt;&#xA;&lt;p&gt;Now let me show you why using the Tweedie matters for actual business decisions. I&amp;rsquo;m going to use &#xA;&lt;a href=&#34;https://gavinsimpson.github.io/gratia/articles/posterior-simulation.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;posterior simulation&lt;/a&gt; to generate prediction intervals, not just standard errors around the mean, but full uncertainty including observation-level variance. This is what executives actually need to know: &amp;ldquo;what&amp;rsquo;s the range of possible outcomes for this customer segment?&amp;rdquo;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Draw posterior samples from both models (includes all sources of uncertainty)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;posterior_gaussian &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_samples&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; train_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  seed &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;42&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  unconditional &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mvn_method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;mgcv&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;posterior_tweedie &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_samples&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_tweedie, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; train_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  seed &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;42&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  unconditional &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mvn_method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;mgcv&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Helper function to extract quantiles from posterior tibble&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;get_intervals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(posterior_tbl) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  posterior_tbl &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;group_by&lt;/span&gt;(.row) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(.response, &lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(.response, &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      .groups &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;drop&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate prediction intervals from posterior samples&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pred_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; train_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Get point predictions for plotting centers&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pred_gaussian &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(clv_model, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ., &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pred_tweedie &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(clv_tweedie, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ., &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate intervals for both models&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;bind_cols&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;get_intervals&lt;/span&gt;(posterior_gaussian) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(lower_gaussian &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower, upper_gaussian &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;get_intervals&lt;/span&gt;(posterior_tweedie) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(lower_tweedie &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower, upper_tweedie &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate interval width to highlight heteroscedasticity&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    interval_width_gaussian &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper_gaussian &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; lower_gaussian,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    interval_width_tweedie &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper_tweedie &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; lower_tweedie&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Reshape data for faceting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pred_data_long &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; pred_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_longer&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cols &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_gaussian, pred_tweedie),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_pattern &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;pred_(.*)&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;predicted&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add corresponding intervals&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ifelse&lt;/span&gt;(model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gaussian&amp;#34;&lt;/span&gt;, lower_gaussian, lower_tweedie),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ifelse&lt;/span&gt;(model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gaussian&amp;#34;&lt;/span&gt;, upper_gaussian, upper_tweedie),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create model labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(model,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gaussian&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;tweedie&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Gaussian&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Tweedie&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create comparison plot with facets&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(pred_data_long, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; clv_6m, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; predicted)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add prediction interval as ribbon&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower, ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add actual vs predicted points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add perfect prediction line (45-degree)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_abline&lt;/span&gt;(slope &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, intercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use consistent color scheme&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format axes for currency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_x_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create side-by-side panels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; model, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add informative labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Actual CLV&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Predicted CLV&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Remove legend since facet labels show the model&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-10-1.png&#34; alt=&#34;Comparison of prediction intervals between Gaussian and Tweedie GAMs for CLV, showing wider intervals for high-value customers under Tweedie&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create interval width comparison plot to highlight heteroscedasticity&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pred_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_longer&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cols &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(interval_width_gaussian, interval_width_tweedie),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_pattern &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;interval_width_(.*)&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;interval_width&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gaussian&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;tweedie&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Gaussian&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Tweedie&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; clv_6m, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; interval_width)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add scatter points colored by model&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model), alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add smoothed trend lines to show patterns&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;loess&amp;#34;&lt;/span&gt;, se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use consistent color scheme&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format axes appropriately&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_x_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Facet by model for clarity&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; model, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;free_y&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add informative labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Actual Customer Lifetime Value&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;95% Prediction Interval Width&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-11-1.png&#34; alt=&#34;Comparison of prediction interval width vs CLV showing heteroscedasticity in Tweedie model&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Look at that difference! The Tweedie model&amp;rsquo;s prediction intervals expand for high-value customers, while the Gaussian stubbornly maintains constant width. This isn&amp;rsquo;t just statistical pedantry, it directly impacts business decisions. When you&amp;rsquo;re evaluating a potential Enterprise account worth $10,000+, you need to know that outcome could range from $7,000 to $15,000, not the false precision of ±$2,000 that the Gaussian suggests. &#xA;&lt;a href=&#34;https://en.wikipedia.org/wiki/Heteroscedasticity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Heteroscedasticity&lt;/a&gt; isn&amp;rsquo;t a nuisance here, it&amp;rsquo;s a feature of the business reality we&amp;rsquo;re modeling.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;extracting-actionable-insights&#34;&gt;Extracting actionable insights&#xA;  &lt;a href=&#34;#extracting-actionable-insights&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Alright, we&amp;rsquo;ve got a well-fitting model with appropriate uncertainty quantification. But so what? In my experience, the real value of GAMs comes from their ability to answer specific &amp;ldquo;what if&amp;rdquo; questions. Let me show you how to extract insights that actually drive decisions.&lt;/p&gt;&#xA;&lt;p&gt;I&amp;rsquo;ll tackle two questions that came up in my conversation with that data science student: First, if we improve feature adoption by 10% across our customer base, what&amp;rsquo;s the expected CLV impact? Second, at what adoption level does it make financial sense to upgrade Basic customers to Pro? These aren&amp;rsquo;t hypothetical, companies make million-dollar decisions based on these calculations.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;quantifying-feature-adoption-roi&#34;&gt;Quantifying feature adoption ROI&#xA;  &lt;a href=&#34;#quantifying-feature-adoption-roi&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Let&amp;rsquo;s start with marginal effects. In ecology, we use these constantly to understand how species respond to environmental changes. Here, we&amp;rsquo;re asking: &amp;ldquo;what&amp;rsquo;s the derivative of CLV with respect to feature adoption?&amp;rdquo; The &lt;code&gt;marginaleffects&lt;/code&gt; package makes this straightforward, and unlike taking derivatives by hand, it properly accounts for all the smooth functions and their interactions.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate marginal effects - essentially taking derivatives&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# of our smooth functions while accounting for uncertainty&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;adoption_effects &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; marginaleffects&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;avg_slopes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_tweedie,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;feature_adoption_pct&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; train_data&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Population-averaged marginal effect (across all customers)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;adoption_effects&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;##  Estimate Std. Error    z Pr(&amp;gt;|z|)    S 2.5 % 97.5 %&#xD;&#xA;##      13.8       3.27 4.23   &amp;lt;0.001 15.4  7.42   20.2&#xD;&#xA;## &#xD;&#xA;## Term: feature_adoption_pct&#xD;&#xA;## Type: response&#xD;&#xA;## Comparison: dY/dX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate marginal effects by tier for more granular insights&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tier_effects &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; marginaleffects&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;avg_slopes&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_tweedie,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;feature_adoption_pct&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;contract_tier&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; train_data&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Show tier-specific ROI differences&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tier_effects &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate 10% improvement impact with confidence intervals&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    impact_10pct &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; estimate &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lower_10pct &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; (estimate &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.96&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; std.error) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    upper_10pct &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; (estimate &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.96&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; std.error) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; contract_tier, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; impact_10pct, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; contract_tier)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add confidence intervals as error bars&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_errorbar&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower_10pct, ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper_10pct),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                width &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;, linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add point estimates&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format y-axis as currency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use consistent color scheme&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_color_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkblue&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add informative labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Contract Tier&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;CLV Impact of 10% Adoption Improvement&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-13-1.png&#34; alt=&#34;ROI visualization showing CLV impact of feature adoption improvements across customer tiers&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;identifying-upgrade-thresholds&#34;&gt;Identifying upgrade thresholds&#xA;  &lt;a href=&#34;#identifying-upgrade-thresholds&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Here&amp;rsquo;s a more complex question that showcases GAM flexibility: when should you upgrade Basic customers to Pro? This isn&amp;rsquo;t about forcing upgrades (that rarely works), but rather identifying customers who would benefit from Pro features and justify the investment.&lt;/p&gt;&#xA;&lt;p&gt;The list prices are Basic ($99/month) and Pro ($299/month), a $200 difference. However, the real cost of upgrading a customer might be higher than this sticker price difference. You need to factor in customer success time for onboarding Pro features, potential discounts you&amp;rsquo;ll offer to ease the transition, and implementation support. Let&amp;rsquo;s suppose this upgrade pushes the real incremental cost to around $300/month. Over our 6-month CLV horizon, that&amp;rsquo;s an $1,800 investment. The question becomes: at what adoption level does the incremental CLV exceed this cost?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Build a prediction grid to explore the full adoption range&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;adoption_range &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;15&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;95&lt;/span&gt;, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create prediction grid for both tiers&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;prediction_grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expand.grid&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  feature_adoption_pct &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; adoption_range,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Basic&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Pro&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  month &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  acquisition_channel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Organic&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    predicted_clv &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(clv_tweedie, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ., type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Reshape to have Basic and Pro CLV in separate columns&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;threshold_analysis &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; prediction_grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_wider&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_from &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; contract_tier,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    names_prefix &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;clv_&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values_from &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; predicted_clv&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Rename columns to lowercase for consistency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rename&lt;/span&gt;(clv_basic &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; clv_Basic, clv_pro &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; clv_Pro) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    marginal_benefit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; clv_pro &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; clv_basic,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Upgrade cost: $300/month price difference * 6 months = $1,800 total&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    upgrade_cost &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;300&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    net_benefit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; marginal_benefit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; upgrade_cost,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    roi_ratio &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; marginal_benefit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; upgrade_cost&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Visualize the upgrade decision as cost-benefit analysis&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(threshold_analysis, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; feature_adoption_pct)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Show marginal benefit of upgrading&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; marginal_benefit), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Show upgrade cost&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_hline&lt;/span&gt;(yintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1800&lt;/span&gt;, color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.2&lt;/span&gt;, linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;dashed&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add shaded region where upgrades are profitable&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; threshold_analysis &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(marginal_benefit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; upgrade_cost),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upgrade_cost, ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; marginal_benefit),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add annotations using actual data values for positioning&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;annotate&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;45&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1830&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           label &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Upgrade Cost ($1,800)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, hjust &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;annotate&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;80&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1900&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           label &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Marginal Benefit\n(Pro CLV - Basic CLV)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, hjust &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format axes for currency and percentages&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_x_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;percent_format&lt;/span&gt;(scale &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add informative labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Feature Adoption Rate&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Incremental Value&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-15-1.png&#34; alt=&#34;Upgrade cost-benefit analysis showing when Basic to Pro upgrades become profitable&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The model identifies a clear threshold at 55% adoption. Below that, you&amp;rsquo;re losing money on upgrades (spending $1,800 to gain $1,400-1,700 in CLV). Above 55%, the marginal benefits exceed the costs and keep growing. By 75% adoption, you&amp;rsquo;re looking at $2,000+ gains. This transforms a fuzzy &amp;ldquo;high engagement&amp;rdquo; heuristic into a concrete decision rule: monitor Basic customers, and when they cross 55% adoption, that&amp;rsquo;s your signal to discuss Pro features.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;scenario-planning-where-to-invest-development-resources&#34;&gt;Scenario planning: Where to invest development resources&#xA;  &lt;a href=&#34;#scenario-planning-where-to-invest-development-resources&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;We can also perform detailed scenario planning using our GAM. Our results suggest that Basic customers hit complexity barriers that prevent them from extracting value. So let&amp;rsquo;s model a scenario: what if we invested in simplification features that help Basic customers get more value from the product?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Extract just Basic tier customers for our scenario&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;basic_customers &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; train_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Basic&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Scenario: New features double the adoption impact for Basic customers&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This represents UI simplification, better onboarding, or automation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;scenario_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; basic_customers &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create a synthetic &amp;#34;Pro-like&amp;#34; response to adoption for Basic tier&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# This models features that help Basic users extract more value&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    original_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; contract_tier,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    contract_tier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Pro&amp;#34;&lt;/span&gt;, levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Basic&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Pro&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Enterprise&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Generate predictions with uncertainty&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;baseline_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_samples&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_tweedie, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; basic_customers,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  seed &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;42&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  unconditional &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mvn_method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;mgcv&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Predict with improved value extraction&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;scenario_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;posterior_samples&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  clv_tweedie, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scenario_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  seed &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;42&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  unconditional &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mvn_method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;mgcv&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate per-customer impact to inform investment decisions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;impact_per_customer &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;tibble&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  baseline &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; baseline_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;group_by&lt;/span&gt;(.row) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(base_clv &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(.response), .groups &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;drop&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pull&lt;/span&gt;(base_clv),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  scenario &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scenario_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;group_by&lt;/span&gt;(.row) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(scen_clv &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(.response), .groups &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;drop&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pull&lt;/span&gt;(scen_clv)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    uplift &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scenario &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; baseline,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    roi_multiplier &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scenario &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; baseline&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Aggregate results&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;investment_impact &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;tibble&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  metric &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Mean CLV Uplift per Customer&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;95% CI Lower&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;95% CI Upper&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Mean ROI Multiple&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  value &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(impact_per_customer&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;uplift),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(impact_per_customer&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;uplift, &lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(impact_per_customer&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;uplift, &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(impact_per_customer&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;roi_multiplier))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;investment_impact&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## # A tibble: 4 × 2&#xD;&#xA;##   metric                         value&#xD;&#xA;##   &amp;lt;chr&amp;gt;                          &amp;lt;dbl&amp;gt;&#xD;&#xA;## 1 Mean CLV Uplift per Customer 1781.  &#xD;&#xA;## 2 95% CI Lower                 1329.  &#xD;&#xA;## 3 95% CI Upper                 2127.  &#xD;&#xA;## 4 Mean ROI Multiple               3.52&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Visualize investment impact distribution&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(impact_per_customer, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; uplift)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_histogram&lt;/span&gt;(bins &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;25&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;darkred&amp;#34;&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;white&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Format x-axis as currency&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_x_continuous&lt;/span&gt;(labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;dollar) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add informative labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;CLV Uplift per Basic Customer&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Frequency&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/clv-prediction/index_files/figure-html/unnamed-chunk-17-1.png&#34; alt=&#34;Distribution of CLV uplift from feature investments that help Basic customers extract more value&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The results could make a case for simplification. If we can help Basic customers extract Pro-like value from their current adoption levels, we&amp;rsquo;re looking at $1781 uplift per customer. With typical feature development costs around $500 per customer for this scale of work, that&amp;rsquo;s a 3.6x return. Strategies to do this would depend on the context, but if we could help a Basic customer currently stuck at 40% adoption to reach 70% adoption (maybe with with better UX design), this would be one way of improving CLV by building customer loyalty.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;taking-it-further&#34;&gt;Taking it further&#xA;  &lt;a href=&#34;#taking-it-further&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;If you want to push these models even further, here are some directions to explore:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;&#xA;&lt;a href=&#34;https://github.com/nicholasjclark/mvgam&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mvgam&lt;/a&gt;&lt;/strong&gt;: My R package for Bayesian Dynamic GAMs handles temporal dependencies and multivariate outcomes. Perfect if you&amp;rsquo;re modeling customer cohorts with correlated behaviors or want proper time series features&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Hierarchical structures&lt;/strong&gt;: The &#xA;&lt;a href=&#34;https://cran.r-project.org/package=gamm4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;gamm4&lt;/code&gt;&lt;/a&gt; and &#xA;&lt;a href=&#34;https://paul-buerkner.github.io/brms/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;brms&lt;/code&gt;&lt;/a&gt; packages let you build models with customer-level random effects, useful when you have repeat observations&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Zero-inflation&lt;/strong&gt;: If you have many customers who never generate value, check out the &lt;code&gt;ziP()&lt;/code&gt; or &lt;code&gt;ziplss()&lt;/code&gt; families in &#xA;&lt;a href=&#34;https://cran.r-project.org/package=mgcv&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mgcv&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Time-varying effects&lt;/strong&gt;: Use tensor products &lt;code&gt;te()&lt;/code&gt; to let feature importance change over the customer lifecycle&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;wrapping-up&#34;&gt;Wrapping up&#xA;  &lt;a href=&#34;#wrapping-up&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;We&amp;rsquo;ve covered a lot of ground here, from understanding why SaaS CLV presents unique modeling challenges to extracting specific business insights from smooth functions. The key advantages of using GAMs for CLV prediction:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;Nonlinear relationships emerge naturally&lt;/strong&gt; - We discovered Enterprise customers plateau hard while Basic customers grow linearly, without any manual feature engineering&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Appropriate uncertainty quantification&lt;/strong&gt; - The Tweedie distribution gives us honest prediction intervals that grow with customer value, not the false precision of constant variance&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Actionable thresholds&lt;/strong&gt; - We identified the exact 55% adoption level where Basic-to-Pro upgrades become profitable, transforming vague heuristics into decision rules&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Scenario modeling&lt;/strong&gt; - We can simulate interventions and get uncertainty bounds on their impact, critical for investment decisions&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;What strikes me most is how similar these business problems are to ecological modeling challenges. In both domains, we need flexible models that respect natural constraints, provide interpretable outputs, and quantify uncertainty honestly. GAMs deliver on all fronts.&lt;/p&gt;&#xA;&lt;p&gt;Try this approach on your own customer data. I&amp;rsquo;d be curious to hear what nonlinear patterns and thresholds you discover. The code above should translate directly, though you&amp;rsquo;ll need to adjust the variable names and tier structures to match your business model.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material about GAMs for business applications and customer analytics&lt;/p&gt;&#xA;&lt;p&gt;Basu, A. (2023). &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/full/10.1002/mar.21908&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Marketing analytics: the bridge between customer psychology and marketing decision‐making&lt;/a&gt;. &lt;em&gt;Psychology &amp;amp; Marketing&lt;/em&gt;, 40(12), 2509-2528.&lt;/p&gt;&#xA;&lt;p&gt;Glady, N., Baesens, B., &amp;amp; Croux, C. (2009). &#xA;&lt;a href=&#34;https://www.sciencedirect.com/science/article/abs/pii/S037722170800442X&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modeling churn using customer lifetime value&lt;/a&gt;. &lt;em&gt;European Journal of Operational Research&lt;/em&gt;, 197(1), 402-411.&lt;/p&gt;&#xA;&lt;p&gt;Pedersen, E. J., Miller, D. L., Simpson, G. L., &amp;amp; Ross, N. (2019). &#xA;&lt;a href=&#34;https://peerj.com/articles/6876/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hierarchical generalized additive models in ecology: an introduction with mgcv&lt;/a&gt;. &lt;em&gt;PeerJ&lt;/em&gt;, 7, e6876.&lt;/p&gt;&#xA;&lt;p&gt;Theodorakopoulos, L., Kotsiantis, S., &amp;amp; Koumanakos, E. (2024). &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/10.1155/2024/3641502&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Leveraging big data analytics for understanding consumer behavior in digital marketing: a systematic review&lt;/a&gt;. &lt;em&gt;Human Behavior and Emerging Technologies&lt;/em&gt;, 2024, 3641502.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>State-Space Vector Autoregressions in mvgam</title>
  <link>https://ecogambler.netlify.app/blog/vector-autoregressions/</link>
  <pubDate>Fri, 06 Sep 2024 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/vector-autoregressions/</guid>
  <description>&lt;p&gt;&#xA;&lt;a href=&#34;https://otexts.com/fpp3/VAR.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vector Autoregressions (VAR models)&lt;/a&gt;, also known in the ecological literature as &#xA;&lt;a href=&#34;https://atsa-es.github.io/MARSS/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Multivariate Autoregressions (MAR models)&lt;/a&gt;, are a class of Dynamic Linear Models that offer a principled way to model both delayed and contemporaneous interactions among sets of multiple time series. These models are widely used in econometrics and psychology, among other fields, where they can be analyzed to ask many interesting questions about &#xA;&lt;a href=&#34;https://www.jstor.org/stable/2951647&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;potential causality&lt;/a&gt;, &#xA;&lt;a href=&#34;https://www.r-econometrics.com/timeseries/irf/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cascading temporal interaction effects&lt;/a&gt; or &#xA;&lt;a href=&#34;https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/0012-9615%282003%29073%5B0301%3AECSAEI%5D2.0.CO%3B2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;community stability&lt;/a&gt;. A VAR(1) model, where temporal interactions among series can take place at a lag of one time step, is defined as:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$y_t \sim{MVNormal}(\alpha + A * y_{t-1}, \Sigma)$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Where:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;\(y_t\)&lt;/code&gt; is a vector of time series observations at time &lt;code&gt;\(t\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;\(\alpha\)&lt;/code&gt; is a vector of constants capturing the long-term means of each series in &lt;code&gt;\(y\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;\(A\)&lt;/code&gt; is a matrix of autoregressive coefficients estimating lagged dependence and cross-dependence between the elements of &lt;code&gt;\(y\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;\(\Sigma\)&lt;/code&gt; determines the spread (or flexibility) of the process and any contemporaneous correlations among time series errors&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Many R packages exist to estimate parameters of VARs, including the &#xA;&lt;a href=&#34;https://cran.r-project.org/web/packages/vars/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;vars&lt;/code&gt;&lt;/a&gt; and &#xA;&lt;a href=&#34;https://bsvars.github.io/bsvars/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;bsvars&lt;/code&gt;&lt;/a&gt; packages. However, as we can see from the model description above, the traditional VAR model makes two big assumptions: first, this model assumes that the time series being analyzed do not show any measurement error. This assumption may hold for certain types of time series that can be nearly perfectly measured, such as sales of items in a store with accurate digital sale tracking. But it is likely to be broken for the majority of series that are measured with imperfect detectors or with time-varying effort. This can be resolved if we instead refer to a &#xA;&lt;a href=&#34;chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/https://www.cs.unc.edu/~welch/kalman/media/pdf/Kalman1960.pdf&#34;&gt;State-Space&lt;/a&gt; representation of the model:&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/nicholasjclark/mvgam/refs/heads/master/vignettes/SS_model.svg&#34; alt=&#34;Illustration of a basic State-Space model, which assumes that  a latent dynamic process (X) can evolve independently from the way we take observations (Y) of that process&#34;&gt;&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;A State-Space model is convenient for dealing with many types of real-world time series because they can readily handle observation error, missing values and a broad range of dependency structures. For example, we can modify the VAR(1) described above to a State-Space representation using:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$y_t \sim{MVNormal}(\alpha + x_t, \Sigma_{obs})$$&lt;/code&gt;&#xA;&lt;code&gt;$$x_t \sim{MVNormal}(A * x_{t-1}, \Sigma_{process})$$&lt;/code&gt;&#xA;Where the observation time series &lt;code&gt;\(y_t\)&lt;/code&gt; are now considered to be noisy observations of some latent &lt;code&gt;\(process\)&lt;/code&gt; (labelled as &lt;code&gt;\(x_t\)&lt;/code&gt;) and it is this &lt;code&gt;\(process\)&lt;/code&gt; that evolves as a Vector Autoregression. The advantage of this model is that we can separately estimate process and observation errors (modelled using the two &lt;code&gt;\(\Sigma\)&lt;/code&gt; matrices). This type of formulation is available using the &#xA;&lt;a href=&#34;https://atsa-es.github.io/MARSS/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;MARSS&lt;/code&gt;&lt;/a&gt; package, which has a wonderfully detailed &#xA;&lt;a href=&#34;chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/https://cran.r-project.org/web/packages/MARSS/vignettes/UserGuide.pdf&#34;&gt;list of worked examples&lt;/a&gt; to showcase how flexible and useful these models are.&lt;/p&gt;&#xA;&lt;p&gt;But the above approach does not address the second major limitation of traditional VARS, which is that they assume that the observation series can be captured with a Gaussian observation model. This makes it difficult to fit VARs to many real-world time series such as counts of multiple species over time, time series of non-negative rates or proportions of customers that responded to a set of surveys. It turns out that this limitation is a much bigger issue when it comes to fitting VARs to real-world data. At the time of writing I could not find a single R package that makes these models accessible, apart from my &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mvgam&lt;/code&gt;&lt;/a&gt; package. Given that the question of how to fit time series models to non-Gaussian observations comes up &#xA;&lt;a href=&#34;https://stats.stackexchange.com/questions/161617/software-or-workarounds-for-vector-autoregression-on-count-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;again&lt;/a&gt; and &#xA;&lt;a href=&#34;https://stats.stackexchange.com/questions/47204/how-to-regress-a-time-series-of-proportions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;again&lt;/a&gt; and &#xA;&lt;a href=&#34;https://stats.stackexchange.com/questions/244660/modeling-multivariate-time-series-count-data-in-r&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;again&lt;/a&gt; (and &#xA;&lt;a href=&#34;https://stats.stackexchange.com/questions/70182/time-series-dynamic-poisson-regression&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;again&lt;/a&gt;), often with unsatisfying answers, this post will demonstrate how the &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mvgam&lt;/code&gt;&lt;/a&gt; package can fill this gap. Herein I will show how the package can be used to fit complex multivariate autoregressive models to non-Gaussian time series and how to interrogate the models to ask insightful questions about temporal interactions, variance decompositions and community stability.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This tutorial relies on the following packages (note that &#xA;&lt;a href=&#34;https://github.com/nicholasjclark/mvgam/tree/master&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mvgam&lt;/code&gt; version 1.1.3 or higher&lt;/a&gt; is required to carry out these analyses):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mvgam)           &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit, interrogate and forecast DGAMs&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(tidyverse)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tidy and flexible data manipulation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ggplot2)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Flexible plotting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(tidybayes)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Graceful plotting of Bayesian posterior estimates&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(farver)          &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Colour space manipulations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I also define a few plotting utilities to streamline my analysis workflow&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_set&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;(base_size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;15&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        base_family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;serif&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;myhist &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;...&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_histogram&lt;/span&gt;(col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;#B97C7C&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;...&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hist_theme &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(axis.line.y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        axis.ticks.y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        axis.text.y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_blank&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;load-manipulate-and-plot-the-data&#34;&gt;Load, manipulate and plot the data&#xA;  &lt;a href=&#34;#load-manipulate-and-plot-the-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;We will work with a set of annual American kestrel (&lt;em&gt;Falco sparverius&lt;/em&gt;) abundance time series, which represent adjusted annual counts of this species taken in three adjacent regions of British Columbia, Canada. These data were collected annually, corrected for changes in observer coverage and detectability, and logged. They can be accessed in the &#xA;&lt;a href=&#34;https://atsa-es.github.io/MARSS/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;MARSS&lt;/code&gt;&lt;/a&gt; package&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;load&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;url&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;https://github.com/atsa-es/MARSS/raw/master/data/kestrel.rda&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(kestrel)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##      Year British.Columbia Alberta Saskatchewan&#xD;&#xA;## [1,] 1969            0.754   0.460        0.000&#xD;&#xA;## [2,] 1970            0.673   0.899        0.192&#xD;&#xA;## [3,] 1971            0.734   1.133        0.280&#xD;&#xA;## [4,] 1972            0.589   0.528        0.386&#xD;&#xA;## [5,] 1973            1.405   0.789        0.451&#xD;&#xA;## [6,] 1974            0.624   0.528        0.234&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Arrange the data into a &lt;code&gt;data.frame&lt;/code&gt; that spreads the time series observations into a &amp;rsquo;long&amp;rsquo; format, &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/articles/data_in_mvgam.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;which is required for &lt;code&gt;mvgam&lt;/code&gt; modelling&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;regions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;BC&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Alb&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Sask&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;do.call&lt;/span&gt;(rbind,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq_along&lt;/span&gt;(regions),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(year &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; kestrel[, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Reverse the logging so that we deal directly &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# with the detection-adjusted counts&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             adj_count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(kestrel[, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; x]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             region &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; regions[x])})) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Add series and time indicators for mvgam modelling&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.factor&lt;/span&gt;(region),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; year)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Inspect the time series data structure&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(model_data)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##   year adj_count region series time&#xD;&#xA;## 1 1969  2.125485     BC     BC 1969&#xD;&#xA;## 2 1970  1.960109     BC     BC 1970&#xD;&#xA;## 3 1971  2.083398     BC     BC 1971&#xD;&#xA;## 4 1972  1.802185     BC     BC 1972&#xD;&#xA;## 5 1973  4.075527     BC     BC 1973&#xD;&#xA;## 6 1974  1.866379     BC     BC 1974&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glimpse&lt;/span&gt;(model_data)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Rows: 120&#xD;&#xA;## Columns: 5&#xD;&#xA;## $ year      &amp;lt;dbl&amp;gt; 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, …&#xD;&#xA;## $ adj_count &amp;lt;dbl&amp;gt; 2.125485, 1.960109, 2.083398, 1.802185, 4.075527, 1.866379, …&#xD;&#xA;## $ region    &amp;lt;chr&amp;gt; &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, &amp;#34;BC&amp;#34;, …&#xD;&#xA;## $ series    &amp;lt;fct&amp;gt; BC, BC, BC, BC, BC, BC, BC, BC, BC, BC, BC, BC, BC, BC, BC, …&#xD;&#xA;## $ time      &amp;lt;dbl&amp;gt; 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, …&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;levels&lt;/span&gt;(model_data&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] &amp;#34;Alb&amp;#34;  &amp;#34;BC&amp;#34;   &amp;#34;Sask&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Plot all three the time series together using &lt;code&gt;mvgam&lt;/code&gt;&amp;rsquo;s &lt;code&gt;plot_mvgam_series()&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;adj_count&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;all&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-8-1.png&#34; alt=&#34;American kestrel adjusted count time series in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Now plot some additional features, including the empirical CDF and estimated autocorrelation functions, for just one series at a time&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;adj_count&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-10-1.png&#34; alt=&#34;American kestrel time series features in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;adj_count&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-12-1.png&#34; alt=&#34;American kestrel time series features in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These latter plots make it immediately apparent that our outcome variable, i.e. the adjusted counts of kestrels in each region over time, only takes on non-negative real numbers:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; adj_count)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Adjusted count&amp;#39;&lt;/span&gt;, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist_theme&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-13-1.png&#34; alt=&#34;Empirical distribution of American kestrel adjusted counts&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;build-a-state-space-var1-model&#34;&gt;Build a State-Space VAR(1) model&#xA;  &lt;a href=&#34;#build-a-state-space-var1-model&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Fitting a multivariate time series model to these adjusted counts is not easy using existing R packages. We&amp;rsquo;d almost certainly have to log-transform the outcome and hope that we don&amp;rsquo;t lose too much inferential ability in doing so. But, &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;as I&amp;rsquo;ve shown in other blogposts on this site&lt;/a&gt;, there is a better and simpler way to respect the nature of these observations using &lt;code&gt;mvgam&lt;/code&gt;. Here we will consider a State-Space model that uses a latent Vector Autoregression as a VAR(1) process. This is done by taking advantage of two key features of the workhorse &lt;code&gt;mvgam()&lt;/code&gt; function: First, we can use the &lt;code&gt;trend_formula&lt;/code&gt; argument to specify that we want a State-Space model. And second, we can use the &lt;code&gt;trend_model&lt;/code&gt; argument to specify that we want the latent process to evolve as a Vector Autoregression of order 1. The &#xA;&lt;a href=&#34;https://github.com/nicholasjclark/mvgam/raw/master/misc/mvgam_cheatsheet.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mvgam&lt;/code&gt; cheatsheet&lt;/a&gt; goes into some detail about how each of these arguments work, but your best bet is to read the extensive documentation in &lt;code&gt;?mvgam::mvgam&lt;/code&gt; to fully understand how these models can be constructed. &lt;code&gt;mvgam&lt;/code&gt; also takes advantage of &#xA;&lt;a href=&#34;https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2079648&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a major development in Bayesian VAR modelling, originally published by Sarah Heaps, that enforces stationarity through a principled prior on the autoregressive coefficients&lt;/a&gt;. This is extremely helpful for ensuring that we find well-behaving models that don&amp;rsquo;t give nonsensical and unwieldy forecasts where the forecast variance grows without bound. Given that the average counts of these series seems to vary across regions, we will also want to include region-level intercepts in the process model. And finally, given the nature of the response variable (non-negative real values), a suitable observation family would be the Gamma distribution. First we should inspect default prior distributions for the stochastic parameters involved in our model:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;def_priors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;get_mvgam_priors&lt;/span&gt;(adj_count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               trend_formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; region,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               trend_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;VAR&lt;/span&gt;(cor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Gamma&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;def_priors[, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##                                           param_info&#xD;&#xA;## 1                                        (Intercept)&#xD;&#xA;## 2                                   process error sd&#xD;&#xA;## 3           diagonal autocorrelation population mean&#xD;&#xA;## 4       off-diagonal autocorrelation population mean&#xD;&#xA;## 5       diagonal autocorrelation population variance&#xD;&#xA;## 6   off-diagonal autocorrelation population variance&#xD;&#xA;## 7      shape1 for diagonal autocorrelation precision&#xD;&#xA;## 8  shape1 for off-diagonal autocorrelation precision&#xD;&#xA;## 9      shape2 for diagonal autocorrelation precision&#xD;&#xA;## 10 shape2 for off-diagonal autocorrelation precision&#xD;&#xA;## 11                             Gamma shape parameter&#xD;&#xA;## 12                         (Intercept) for the trend&#xD;&#xA;## 13                             regionBC fixed effect&#xD;&#xA;## 14                           regionSask fixed effect&#xD;&#xA;##                                      prior&#xD;&#xA;## 1    (Intercept) ~ student_t(3, 0.6, 2.5);&#xD;&#xA;## 2         sigma ~ inv_gamma(1.418, 0.452);&#xD;&#xA;## 3                               es[1] = 0;&#xD;&#xA;## 4                               es[2] = 0;&#xD;&#xA;## 5                     fs[1] = sqrt(0.455);&#xD;&#xA;## 6                     fs[2] = sqrt(0.455);&#xD;&#xA;## 7                           gs[1] = 1.365;&#xD;&#xA;## 8                           gs[2] = 1.365;&#xD;&#xA;## 9                        hs[1] = 0.071175;&#xD;&#xA;## 10                       hs[2] = 0.071175;&#xD;&#xA;## 11              shape ~ gamma(0.01, 0.01);&#xD;&#xA;## 12 (Intercept)_trend ~ student_t(3, 0, 2);&#xD;&#xA;## 13    regionBC_trend ~ student_t(3, 0, 2);&#xD;&#xA;## 14  regionSask_trend ~ student_t(3, 0, 2);&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The priors for regression coefficients (&lt;code&gt;(Intercept)_trend&lt;/code&gt;, &lt;code&gt;regionBC_trend&lt;/code&gt; and &lt;code&gt;regionsSask_trend&lt;/code&gt;) and for the process variances (&lt;code&gt;sigma&lt;/code&gt;, which represent the diagonals of the process error matrix &lt;code&gt;\(\Sigma_{process}\)&lt;/code&gt;) are by default set to be quite vague. It is generally good practice to update these using domain knowledge if you want a model that is well-behaved and computationally efficient. Given that the adjusted counts are fairly small and that the Gamma distribution in &lt;code&gt;mvgam&lt;/code&gt; uses a log-link function, we don&amp;rsquo;t expect massive effect sizes in the linear predictor so a more suitable priors for the regression coefficients would be Standard Normal (i.e. &lt;code&gt;\(\beta \sim Normal(0, 1)\)&lt;/code&gt;). We can also change the default half-T prior on the process variances to an Exponential prior that places less belief on extremely large variances. We will leave the priors for the Gamma shape parameter and for the autoregressive partial autocorrelations (which are described in detail by &#xA;&lt;a href=&#34;https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2079648&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sarah Heaps in her wonderful VAR stationarity paper&lt;/a&gt;) as default. So our first model to consider is:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;varmod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvgam&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Observation formula, empty to only consider the Gamma observation process&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; adj_count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Process model formula that includes regional intercepts &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  trend_formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; region,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# A VAR(1) dynamic process with fully parameterized covariance matrix Sigma&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  trend_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;VAR&lt;/span&gt;(cor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Modified prior distributions using brms::prior()&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  priors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;std_normal&lt;/span&gt;(), class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Intercept_trend),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;std_normal&lt;/span&gt;(), class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; b),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exponential&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;), class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# The time series data in &amp;#39;long&amp;#39; format&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# A Gamma observation family&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Gamma&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Forcing all three series to share the same Gamma shape parameter&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  share_obs_params &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Stan control arguments&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  adapt_delta &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.95&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  burnin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  samples &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  silent &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;model-diagnostics-and-inferences&#34;&gt;Model diagnostics and inferences&#xA;  &lt;a href=&#34;#model-diagnostics-and-inferences&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;This model only takes a few seconds to fit four parallel Hamiltonian Monte Carlo chains, though we do get some minor warnings about a few Hamiltonian Monte Carlo divergences which I have mostly mitigated by setting &lt;code&gt;adapt_delta = 0.95&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(varmod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## GAM observation formula:&#xD;&#xA;## adj_count ~ 1&#xD;&#xA;## &#xD;&#xA;## GAM process formula:&#xD;&#xA;## ~region&#xD;&#xA;## &#xD;&#xA;## Family:&#xD;&#xA;## Gamma&#xD;&#xA;## &#xD;&#xA;## Link function:&#xD;&#xA;## log&#xD;&#xA;## &#xD;&#xA;## Trend model:&#xD;&#xA;## VAR(cor = TRUE)&#xD;&#xA;## &#xD;&#xA;## &#xD;&#xA;## N process models:&#xD;&#xA;## 3 &#xD;&#xA;## &#xD;&#xA;## N series:&#xD;&#xA;## 3 &#xD;&#xA;## &#xD;&#xA;## N timepoints:&#xD;&#xA;## 40 &#xD;&#xA;## &#xD;&#xA;## Status:&#xD;&#xA;## Fitted using Stan &#xD;&#xA;## 4 chains, each with iter = 2000; warmup = 1000; thin = 1 &#xD;&#xA;## Total post-warmup draws = 4000&#xD;&#xA;## &#xD;&#xA;## &#xD;&#xA;## Observation shape parameter estimates:&#xD;&#xA;##       2.5% 50% 97.5% Rhat n_eff&#xD;&#xA;## shape   21  33    58    1   500&#xD;&#xA;## &#xD;&#xA;## GAM observation model coefficient (beta) estimates:&#xD;&#xA;##             2.5% 50% 97.5% Rhat n_eff&#xD;&#xA;## (Intercept)    0   0     0  NaN   NaN&#xD;&#xA;## &#xD;&#xA;## Process model VAR parameter estimates:&#xD;&#xA;##           2.5%    50% 97.5% Rhat n_eff&#xD;&#xA;## A[1,1]  0.0014  0.570  0.98 1.01   902&#xD;&#xA;## A[1,2] -0.5200 -0.040  0.26 1.01   701&#xD;&#xA;## A[1,3] -0.0930  0.560  2.10 1.00   407&#xD;&#xA;## A[2,1] -0.2300  0.310  1.30 1.01   753&#xD;&#xA;## A[2,2] -0.5100  0.420  0.85 1.01   545&#xD;&#xA;## A[2,3] -0.2900  0.690  2.80 1.00   505&#xD;&#xA;## A[3,1] -0.1000  0.110  0.55 1.00   880&#xD;&#xA;## A[3,2] -0.1800  0.033  0.23 1.01   586&#xD;&#xA;## A[3,3]  0.1400  0.650  1.10 1.01   713&#xD;&#xA;## &#xD;&#xA;## Process error parameter estimates:&#xD;&#xA;##               2.5%      50% 97.5% Rhat n_eff&#xD;&#xA;## Sigma[1,1]  0.0045  0.02200 0.058 1.01   461&#xD;&#xA;## Sigma[1,2] -0.0077  0.00880 0.033 1.00  1465&#xD;&#xA;## Sigma[1,3] -0.0110 -0.00045 0.008 1.00  1207&#xD;&#xA;## Sigma[2,1] -0.0077  0.00880 0.033 1.00  1465&#xD;&#xA;## Sigma[2,2]  0.0180  0.04800 0.100 1.00   886&#xD;&#xA;## Sigma[2,3] -0.0062  0.00460 0.019 1.00  1399&#xD;&#xA;## Sigma[3,1] -0.0110 -0.00045 0.008 1.00  1207&#xD;&#xA;## Sigma[3,2] -0.0062  0.00460 0.019 1.00  1399&#xD;&#xA;## Sigma[3,3]  0.0012  0.00530 0.021 1.00   340&#xD;&#xA;## &#xD;&#xA;## GAM process model coefficient (beta) estimates:&#xD;&#xA;##                    2.5%   50% 97.5% Rhat n_eff&#xD;&#xA;## (Intercept)_trend  0.40  0.70  0.95    1  1732&#xD;&#xA;## regionBC_trend    -0.12  0.15  0.37    1  2606&#xD;&#xA;## regionSask_trend  -0.54 -0.38 -0.21    1  1778&#xD;&#xA;## &#xD;&#xA;## Stan MCMC diagnostics:&#xD;&#xA;## ✔ No issues with effective samples per iteration&#xD;&#xA;## ✔ Rhat looks good for all parameters&#xD;&#xA;## ✔ No issues with divergences&#xD;&#xA;## ✔ No issues with maximum tree depth&#xD;&#xA;## &#xD;&#xA;## Samples were drawn using sampling(hmc). For each parameter, n_eff is a&#xD;&#xA;##   crude measure of effective sample size, and Rhat is the potential scale&#xD;&#xA;##   reduction factor on split MCMC chains (at convergence, Rhat = 1)&#xD;&#xA;## &#xD;&#xA;## Use how_to_cite() to get started describing this model&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We can inspect posterior estimates for some of the key parameters using &lt;code&gt;bayesplot&lt;/code&gt; functionality. For State-Space models, it is particularly recommended to inspect estimates for process and observation scale parameters (labelled as &lt;code&gt;sigma&lt;/code&gt; and &lt;code&gt;shape&lt;/code&gt; in the model&amp;rsquo;s MCMC output):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mcmc_plot&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;sigma&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          regex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;trace&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-17-1.png&#34; alt=&#34;mvgam posterior estimates using bayesplot&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mcmc_plot&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;shape&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;trace&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-18-1.png&#34; alt=&#34;mvgam posterior estimates using bayesplot&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Looking at possible coupling between these estimates is also a good idea, which you can do with the &lt;code&gt;pairs()&lt;/code&gt; function:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pairs&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;shape&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;sigma&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      regex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      off_diag_args &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-19-1.png&#34; alt=&#34;mvgam posterior pairs plots&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Overall these estimates are quite stable and well-behaved. We can also inspect estimates for any linear predictor effects (in both the process and observation models) using &lt;code&gt;conditional_effects()&lt;/code&gt;, which makes use of the wonderful &#xA;&lt;a href=&#34;https://marginaleffects.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;marginaleffects&lt;/code&gt;&lt;/a&gt; package (see &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this post on interpreting Generalized Additive Models using &lt;code&gt;marginaleffects&lt;/code&gt;&lt;/a&gt; for a glimpse into the full power of this package). Since we only have the varying intercepts as regressors in our model, we only get one plot from this call:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;conditional_effects&lt;/span&gt;(varmod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-20-1.png&#34; alt=&#34;mvgam conditional_effects plots&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;By default &lt;code&gt;conditional_effects()&lt;/code&gt; will return predictions on the response scale (i.e. considering the full uncertainty in posterior predictions). But we can also plot these on the link or expectation scales if we wish:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;conditional_effects&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-21-1.png&#34; alt=&#34;mvgam posterior pairs plots&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Posterior predictive checks are also useful for interrogating a Bayesian model. &lt;code&gt;mvgam&lt;/code&gt; offers multiple ways to do this. First we can compute unconditional posterior predictive checks, which integrate over the possible (stable) temporal states that &lt;em&gt;could have&lt;/em&gt; been encountered for each series. In other words, these plots show us the types of predictions that we might make if we had no observations to inform the states of the latent VAR(1) process:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pp_check&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;dens_overlay_grouped&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;region&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         ndraws &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-22-1.png&#34; alt=&#34;mvgam posterior predictive checks&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Obviously these prediction densities are more variable than the actual observation densities. But the main shapes seem to have been reasonably well captured. &lt;code&gt;mvgam&lt;/code&gt; can also create conditional posterior predictive checks, using the actual latent temporal states that were estimated when the model conditioned on the observed data:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ppc&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;density&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-24-1.png&#34; alt=&#34;mvgam posterior predictive checks&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ppc&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;density&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-26-1.png&#34; alt=&#34;mvgam posterior predictive checks&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ppc&lt;/span&gt;(varmod,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;density&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-28-1.png&#34; alt=&#34;mvgam posterior predictive checks&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These plots match the data more closely, which is expected when using a flexible autoregressive process to capture the unobserved dynamics. Next we can compute and plot probabilistic conditional hindcasts for each series:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hcs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hindcast&lt;/span&gt;(varmod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(hcs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-31-1.png&#34; alt=&#34;mvgam probabilistic hindcasts&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(hcs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-33-1.png&#34; alt=&#34;mvgam probabilistic hindcasts&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(hcs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-35-1.png&#34; alt=&#34;mvgam probabilistic hindcasts&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;model-expansion&#34;&gt;Model expansion&#xA;  &lt;a href=&#34;#model-expansion&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Given the subtle variations in the shapes of these observed distributions for each series, there may be support for fitting an equivalent model that allows the Gamma shape parameters to vary among series. Let&amp;rsquo;s fit a second model that allows this:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;varmod2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvgam&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Observation formula, empty to only consider the Gamma observation process&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; adj_count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Process model formula that includes regional intercepts &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  trend_formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; region,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# A VAR(1) dynamic process with fully parameterized covariance matrix Sigma&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  trend_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;VAR&lt;/span&gt;(cor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Modified prior distributions using brms::prior()&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  priors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;std_normal&lt;/span&gt;(), class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Intercept_trend),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;std_normal&lt;/span&gt;(), class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; b),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exponential&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;), class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# The time series data in &amp;#39;long&amp;#39; format&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# A Gamma observation family&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Gamma&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Varying Gamma shape parameters per series&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  share_obs_params &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Stan control arguments&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  adapt_delta &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.95&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  burnin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  samples &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  silent &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This model also fits well and encounters few sampling issues&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(varmod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## GAM observation formula:&#xD;&#xA;## adj_count ~ 1&#xD;&#xA;## &#xD;&#xA;## GAM process formula:&#xD;&#xA;## ~region&#xD;&#xA;## &#xD;&#xA;## Family:&#xD;&#xA;## Gamma&#xD;&#xA;## &#xD;&#xA;## Link function:&#xD;&#xA;## log&#xD;&#xA;## &#xD;&#xA;## Trend model:&#xD;&#xA;## VAR(cor = TRUE)&#xD;&#xA;## &#xD;&#xA;## &#xD;&#xA;## N process models:&#xD;&#xA;## 3 &#xD;&#xA;## &#xD;&#xA;## N series:&#xD;&#xA;## 3 &#xD;&#xA;## &#xD;&#xA;## N timepoints:&#xD;&#xA;## 40 &#xD;&#xA;## &#xD;&#xA;## Status:&#xD;&#xA;## Fitted using Stan &#xD;&#xA;## 4 chains, each with iter = 2000; warmup = 1000; thin = 1 &#xD;&#xA;## Total post-warmup draws = 4000&#xD;&#xA;## &#xD;&#xA;## &#xD;&#xA;## Observation shape parameter estimates:&#xD;&#xA;##          2.5% 50% 97.5% Rhat n_eff&#xD;&#xA;## shape[1]   12  26   120 1.01   371&#xD;&#xA;## shape[2]   13  35   190 1.01   301&#xD;&#xA;## shape[3]   21  39   100 1.00   493&#xD;&#xA;## &#xD;&#xA;## GAM observation model coefficient (beta) estimates:&#xD;&#xA;##             2.5% 50% 97.5% Rhat n_eff&#xD;&#xA;## (Intercept)    0   0     0  NaN   NaN&#xD;&#xA;## &#xD;&#xA;## Process model VAR parameter estimates:&#xD;&#xA;##          2.5%     50% 97.5% Rhat n_eff&#xD;&#xA;## A[1,1] -0.046  0.5600  1.00 1.00   899&#xD;&#xA;## A[1,2] -0.430 -0.0089  0.26 1.00  1147&#xD;&#xA;## A[1,3] -0.090  0.4200  1.60 1.01   796&#xD;&#xA;## A[2,1] -0.260  0.3900  2.30 1.01   376&#xD;&#xA;## A[2,2] -0.590  0.3800  0.85 1.01   495&#xD;&#xA;## A[2,3] -0.370  0.5600  2.60 1.01   704&#xD;&#xA;## A[3,1] -0.088  0.1700  1.10 1.01   312&#xD;&#xA;## A[3,2] -0.210  0.0440  0.28 1.00   741&#xD;&#xA;## A[3,3] -0.035  0.5700  0.98 1.00   693&#xD;&#xA;## &#xD;&#xA;## Process error parameter estimates:&#xD;&#xA;##               2.5%      50%  97.5% Rhat n_eff&#xD;&#xA;## Sigma[1,1]  0.0020  0.01800 0.0630 1.03   210&#xD;&#xA;## Sigma[1,2] -0.0078  0.00800 0.0320 1.00   930&#xD;&#xA;## Sigma[1,3] -0.0120 -0.00025 0.0083 1.00   938&#xD;&#xA;## Sigma[2,1] -0.0078  0.00800 0.0320 1.00   930&#xD;&#xA;## Sigma[2,2]  0.0180  0.05200 0.1100 1.00   673&#xD;&#xA;## Sigma[2,3] -0.0074  0.00440 0.0200 1.00  1326&#xD;&#xA;## Sigma[3,1] -0.0120 -0.00025 0.0083 1.00   938&#xD;&#xA;## Sigma[3,2] -0.0074  0.00440 0.0200 1.00  1326&#xD;&#xA;## Sigma[3,3]  0.0017  0.00740 0.0280 1.01   321&#xD;&#xA;## &#xD;&#xA;## GAM process model coefficient (beta) estimates:&#xD;&#xA;##                    2.5%   50% 97.5% Rhat n_eff&#xD;&#xA;## (Intercept)_trend  0.38  0.71  0.93    1  1358&#xD;&#xA;## regionBC_trend    -0.12  0.14  0.34    1  2081&#xD;&#xA;## regionSask_trend  -0.54 -0.40 -0.21    1  1216&#xD;&#xA;## &#xD;&#xA;## Stan MCMC diagnostics:&#xD;&#xA;## ✔ No issues with effective samples per iteration&#xD;&#xA;## ✔ Rhat looks good for all parameters&#xD;&#xA;## ✔ No issues with divergences&#xD;&#xA;## ✔ No issues with maximum tree depth&#xD;&#xA;## &#xD;&#xA;## Samples were drawn using sampling(hmc). For each parameter, n_eff is a&#xD;&#xA;##   crude measure of effective sample size, and Rhat is the potential scale&#xD;&#xA;##   reduction factor on split MCMC chains (at convergence, Rhat = 1)&#xD;&#xA;## &#xD;&#xA;## Use how_to_cite() to get started describing this model&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;But now we have three shape parameters to inspect:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mcmc_plot&lt;/span&gt;(varmod2,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;shape&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          regex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;trace&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-38-1.png&#34; alt=&#34;mvgam posterior estimates using bayesplot&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The unconditional posterior predictive checks look slightly better for the first and third series (&lt;code&gt;&#39;Alb&#39;&lt;/code&gt; and &lt;code&gt;&#39;Sask&lt;/code&gt;&amp;rsquo;):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pp_check&lt;/span&gt;(varmod2,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;dens_overlay_grouped&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;region&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         ndraws &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-39-1.png&#34; alt=&#34;mvgam posterior predictive checks&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;And so do the probabilistic conditional hindcasts:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hcs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hindcast&lt;/span&gt;(varmod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(hcs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-42-1.png&#34; alt=&#34;mvgam probabilistic hindcasts&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(hcs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-44-1.png&#34; alt=&#34;mvgam probabilistic hindcasts&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(hcs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-46-1.png&#34; alt=&#34;mvgam probabilistic hindcasts&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;model-comparison-with-loo_compare&#34;&gt;Model comparison with &lt;code&gt;loo_compare()&lt;/code&gt;&#xA;  &lt;a href=&#34;#model-comparison-with-loo_compare&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;The plots for the second model look &lt;em&gt;slightly&lt;/em&gt; better for some of the series, but of course this is a more complex model so we may expect that. Generally we may want to select among these two competing models, and the approximate leave-one-out cross-validation routines provided by the &#xA;&lt;a href=&#34;https://mc-stan.org/loo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;loo&lt;/code&gt;&lt;/a&gt; package allow us to do this. We simply call &lt;code&gt;loo_compare()&lt;/code&gt; and feed in the set of models that we&amp;rsquo;d like to compare:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;loo_compare&lt;/span&gt;(varmod, varmod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##         elpd_diff se_diff&#xD;&#xA;## varmod2       0.0     0.0&#xD;&#xA;## varmod       -3.6     1.9&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The second model has slightly but consistently higher leave-one-out expected log predictive densities than the first model, so it appears to be slightly favoured. But of course we may wish to use other forms of model comparison, such as &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/articles/forecast_evaluation.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;computing proper scoring rules for out-of-sample probabilistic forecasts&lt;/a&gt;. But for simplicity we will stick with the second model for further interrogation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;interrogating-var1-models-in-mvgam&#34;&gt;Interrogating VAR(1) models in &lt;code&gt;mvgam&lt;/code&gt;&#xA;  &lt;a href=&#34;#interrogating-var1-models-in-mvgam&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;There are &lt;em&gt;many&lt;/em&gt; useful questions that can be approached using VAR models, which I eluded to at the beginning of this post. &lt;code&gt;mvgam&lt;/code&gt; has support for a growing number of investigations that can be performed using built-in functions, and this section will highlight some of those functionalities.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;inspecting-ar-coefficient-and-covariance-estimates&#34;&gt;Inspecting AR coefficient and covariance estimates&#xA;  &lt;a href=&#34;#inspecting-ar-coefficient-and-covariance-estimates&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;One of the first things we might want to do with a VAR(1) model is to inspect the &lt;code&gt;\(A\)&lt;/code&gt; matrix, which includes the autoregressive coefficients that estimate lagged dependence and cross-dependence between the elements of the latent process model. By default &lt;code&gt;bayesplot&lt;/code&gt; will plot these in the wrong order, so a bit of rearranging of the parameter estimates is needed to show the full matrix of estimates:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A_pars &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(j &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    A_pars[i, j] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;A[&amp;#39;&lt;/span&gt;, i, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;,&amp;#39;&lt;/span&gt;, j, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;]&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mcmc_plot&lt;/span&gt;(varmod2,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(A_pars)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;hist&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-49-1.png&#34; alt=&#34;mvgam vector autoregressive coefficient inspection&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot makes it clear that there is broad posterior support for positive interactions among the three latent processes. For example, the estimates in &lt;code&gt;A[2,3]&lt;/code&gt; capture how an &lt;em&gt;increase&lt;/em&gt; in the process for series 3 (&lt;code&gt;&#39;Sask&#39;&lt;/code&gt;) at time &lt;code&gt;\(t\)&lt;/code&gt; is expected to impact the process for series 2 (&lt;code&gt;&#39;BC&#39;&lt;/code&gt;) at time  &lt;code&gt;\(t+1\)&lt;/code&gt;. This might make biological sense as it could be possible that increasing populations in one region lead to subsequent increases in other regions due to dispersal events.&lt;/p&gt;&#xA;&lt;p&gt;We might also want to look at evidence for contemporaneous associations among these processes, which are captured in the covariance matrix &lt;code&gt;\(\Sigma_{process}\)&lt;/code&gt;. The same rearrangement of parameters is needed to get these in the right order:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Sigma_pars &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(j &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Sigma_pars[i, j] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Sigma[&amp;#39;&lt;/span&gt;, i, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;,&amp;#39;&lt;/span&gt;, j, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;]&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mcmc_plot&lt;/span&gt;(varmod2,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(Sigma_pars)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;hist&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-50-1.png&#34; alt=&#34;mvgam vector autoregressive covariance inspection&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Again we see many positive covariances which suggests that these processes are not evolving independently, but are rather likely to be co-responding to some broader phenomena&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;impulse-response-functions&#34;&gt;Impulse Response Functions&#xA;  &lt;a href=&#34;#impulse-response-functions&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Generalized or Orthogonalized Impulse Response Functions (IRFs) can be computed using the posterior estimates of Vector Autoregressive parameters from &lt;code&gt;mvgam&lt;/code&gt; models fitted with &lt;code&gt;VAR()&lt;/code&gt; trend models. This function runs a simulation whereby a positive &amp;ldquo;shock&amp;rdquo; is generated for a target process at time &lt;code&gt;\(t = 0\)&lt;/code&gt;. All else remaining stable, it then monitors how each of the remaining processes in the latent VAR would be expected to respond over the forecast horizon &lt;code&gt;\(h\)&lt;/code&gt;. The function computes IRFs for all processes in the object and returns them in an array that can be plotted using the &lt;code&gt;S3&lt;/code&gt; &lt;code&gt;plot()&lt;/code&gt; function. Here we will use the generalized IRF, which makes no assumptions about the order in which the series appear in the VAR process, and inspect how each process is expected to respond to a sudden, positive &lt;em&gt;pulse&lt;/em&gt; from the other processes over a horizon of 12 years.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;irfs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;irf&lt;/span&gt;(varmod2,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            orthogonal &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(irfs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-53-1.png&#34; alt=&#34;mvgam vector autoregressive impulse response functions&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(irfs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-55-1.png&#34; alt=&#34;mvgam vector autoregressive impulse response functions&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(irfs,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-57-1.png&#34; alt=&#34;mvgam vector autoregressive impulse response functions&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These plots make it clear that, if one region experienced a temporary pulse in the number of American kestrels, we&amp;rsquo;d expect the remaining regions to show contemporaneous and/or subsequent increases over the following years. Moreover, we&amp;rsquo;d expect the effects of this pulse to reverberate for many years, thanks to the strong positive dependencies that are shown among all three series.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;forecast-error-variance-decompositions&#34;&gt;Forecast Error Variance Decompositions&#xA;  &lt;a href=&#34;#forecast-error-variance-decompositions&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Using the same logic as above, we can inspect forecast error variance decompositions (FEVDs) for each process using the &lt;code&gt;fevd()&lt;/code&gt; function. This type of analysis asks how orthogonal shocks to all process in the system contribute to the variance of forecast uncertainty for a focal process over increasing horizons. In other words, the proportion of the forecast variance of each latent time series can be attributed to the effects of the other series in the VAR proces. FEVDs are useful because some shocks may not be expected to cause variations in the short-term but may cause longer-term fluctuations&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fevds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;fevd&lt;/span&gt;(varmod2, h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;S3&lt;/code&gt; &lt;code&gt;plot()&lt;/code&gt; function for these objects returns a &lt;code&gt;ggplot&lt;/code&gt; object that shows the mean expected contribution to forecast error variance for each process in the VAR model:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(fevds) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#DCBCBC&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#5C0000&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-59-1.png&#34; alt=&#34;mvgam vector autoregressive forecast error variance decompositions&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot shows that the variance of forecast uncertainty for each process is initially dominated by contributions from that same process (i.e. self-dependent effects) but that effects from other processes become more important over increasing forecast horizons. Given what we saw from the IRF plots above, these long-term contributions from interactions among the processes makes sense.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;community-stability-metrics&#34;&gt;Community stability metrics&#xA;  &lt;a href=&#34;#community-stability-metrics&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;&lt;code&gt;mvgam&lt;/code&gt; can also calculate a range of community stability metrics, which can be used to assess how important inter-series dependencies are to the variability of a multivariate system and to ask how systems are expected to respond to environmental perturbations. The &lt;code&gt;stability()&lt;/code&gt; function computes a posterior distribution for the long-term stationary forecast distribution of the system, which&#xA;has mean &lt;code&gt;\(\mu_{\infty}\)&lt;/code&gt; and variance &lt;code&gt;\(\Sigma_{\infty}\)&lt;/code&gt;, to then calculate the following quantities:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;prop_int&lt;/code&gt;: Proportion of the volume of the stationary forecast distribution that is attributable to lagged interactions (i.e. how important are the autoregressive interaction coefficients in &lt;code&gt;\(A\)&lt;/code&gt; for explaining the shape of the stationary forecast distribution?): &lt;code&gt;\(det(A)^2\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;prop_int_adj&lt;/code&gt;: Same as &lt;code&gt;prop_int&lt;/code&gt; but scaled by the number of series &lt;code&gt;\(p\)&lt;/code&gt; to facilitate direct comparisons among systems with different numbers of interacting variables: &lt;code&gt;\(det(A)^{2/p}\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;prop_int_offdiag&lt;/code&gt;: Sensitivity of &lt;code&gt;prop_int&lt;/code&gt; to inter-series interactions (i.e. how important are the off-diagonals of the autoregressive coefficient matrix &lt;code&gt;\(A\)&lt;/code&gt; for shaping &lt;code&gt;prop_int&lt;/code&gt;?), calculated as the relative magnitude of the &lt;em&gt;off-diagonals&lt;/em&gt; in the partial derivative matrix: &lt;code&gt;\([2~det(A) (A^{-1})^T]\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;prop_int_diag&lt;/code&gt;: Sensitivity of &lt;code&gt;prop_int&lt;/code&gt; to intra-series interactions (i.e. how important are the&#xA;diagonals of the autoregressive coefficient matrix &lt;code&gt;\(A\)&lt;/code&gt; for shaping &lt;code&gt;prop_int&lt;/code&gt;?), calculated as the&#xA;relative magnitude of the &lt;em&gt;diagonals&lt;/em&gt; in the partial derivative matrix: &lt;code&gt;\([2~det(A) (A^{-1})^T]\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;prop_cov_offdiag&lt;/code&gt;: Sensitivity of &lt;code&gt;\(\Sigma_{\infty}\)&lt;/code&gt; to inter-series error correlations (i.e. how important are off-diagonal covariances in &lt;code&gt;\(\Sigma\)&lt;/code&gt; for shaping &lt;code&gt;\(\Sigma_{\infty}\)&lt;/code&gt;?), calculated as the relative magnitude of the &lt;em&gt;off-diagonals&lt;/em&gt; in the partial derivative matrix: &lt;code&gt;\([2~det(\Sigma_{\infty}) (\Sigma_{\infty}^{-1})^T]\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;prop_cov_diag&lt;/code&gt;: Sensitivity of &lt;code&gt;\(\Sigma_{\infty}\)&lt;/code&gt; to error variances (i.e. how important are diagonal variances in &lt;code&gt;\(\Sigma\)&lt;/code&gt; for shaping &lt;code&gt;\(\Sigma_{\infty}\)&lt;/code&gt;?), calculated as the relative magnitude of the &lt;em&gt;diagonals&lt;/em&gt; in the partial derivative matrix: &lt;code&gt;\([2~det(\Sigma_{\infty}) (\Sigma_{\infty}^{-1})^T]\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;reactivity&lt;/code&gt;: A measure of the degree to which the system moves away from a stable equilibrium following a perturbation. Values &lt;code&gt;&amp;gt; 0&lt;/code&gt; suggest the system is reactive, whereby a perturbation of the system in one period can be amplified into the next period. If &lt;code&gt;\(\sigma_{max}(A)\)&lt;/code&gt; is the largest singular value of &lt;code&gt;\(A\)&lt;/code&gt;, then reactivity is defined as: &lt;code&gt;\(log\sigma_{max}(A)\)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;mean_return_rate&lt;/code&gt;: Asymptotic (long-term) return rate of the mean of the transition distribution to the stationary mean, calculated using the largest eigenvalue of the matrix &lt;code&gt;\(A\)&lt;/code&gt;: &lt;code&gt;\(max(\lambda_{A})\)&lt;/code&gt;. Lower values suggest greater stability of the system&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;var_return_rate&lt;/code&gt;: Asymptotic (long-term) return rate of the variance of the transition distribution to the stationary variance: &lt;code&gt;\(max(\lambda_{A \otimes{A}})\)&lt;/code&gt;. Again, lower values suggest greater stability of the system&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;metrics &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;stability&lt;/span&gt;(varmod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can plot the posterior distribution of reactivity, which is &#xA;&lt;a href=&#34;https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/13-0996.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;perhaps the most commonly calculated metric of ecological community stability&lt;/a&gt;, using &lt;code&gt;ggplot()&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(metrics, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; reactivity)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Reactivity&amp;#39;&lt;/span&gt;, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist_theme&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-61-1.png&#34; alt=&#34;mvgam vector autoregressive community reactivity estimates&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This system is considered to be &amp;ldquo;reactive&amp;rdquo;, whereby this index of the community&amp;rsquo;s short-term response to perturbations is mostly estimated to be &lt;code&gt;&amp;gt;0&lt;/code&gt;. Again this is not surprising, as both the &lt;code&gt;irf()&lt;/code&gt; and &lt;code&gt;fevd()&lt;/code&gt; plots show that the time series of adjusted counts in each region is highly dependent on time-lagged adjusted counts in other regions.&lt;/p&gt;&#xA;&lt;p&gt;Another useful question to ask from these metrics is what are the relative importances of the diagonals for determining the contributions of the &lt;code&gt;\(A\)&lt;/code&gt; and &lt;code&gt;\(\Sigma\)&lt;/code&gt; matrices to the shape of the stationary forecast distribution. In other words, we can decompose the contributions of these two matrices to the system&amp;rsquo;s stochastic equilibrium to understand which components (i.e. the self-dependence vs the inter-dependence effects) seem to have the biggest influences on the variability of the system. What follows is some rather long-winded code that will calculate and plot these contributions, using some helpful example code provided by &#xA;&lt;a href=&#34;https://www.mjskay.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matthew Kay&lt;/a&gt;, maintainer of the &#xA;&lt;a href=&#34;https://mjskay.github.io/tidybayes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;tidybayes&lt;/code&gt;&lt;/a&gt; package&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Gather posterior estimates of relative contributions for each matrix&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# into a tidy format for tidybayes plotting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;prop_df &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbind&lt;/span&gt;(metrics &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(prop_cov_diag,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  prop_cov_offdiag) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rename&lt;/span&gt;(diagonals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; prop_cov_diag,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  off_diagonals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; prop_cov_offdiag) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(.draw &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Process error (Sigma)&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_longer&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(diagonals, off_diagonals),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        names_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Parameters&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        values_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;proportion&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  metrics &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(prop_int_diag,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  prop_int_offdiag) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rename&lt;/span&gt;(diagonals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; prop_int_diag,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  off_diagonals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; prop_int_offdiag) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(.draw &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Autoregressive coefs (A)&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tidyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pivot_longer&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(diagonals, off_diagonals),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        names_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Parameters&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        values_to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;proportion&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate blurred color maps to graphically represent uncertainty&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# in these contributions&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; .Machine&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;double.eps, length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;200&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;df_curves &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; prop_df &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(cumulative_proportion &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cumsum&lt;/span&gt;(proportion),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                .by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(.draw, group)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;reframe&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`P&lt;/span&gt;(value)` &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ecdf&lt;/span&gt;(cumulative_proportion)(p)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ecdf&lt;/span&gt;(cumulative_proportion &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; proportion)(p),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    proportion &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; p,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(group, Parameters))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Set the colours and their labels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fill_scale &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_manual&lt;/span&gt;(values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;lightgrey&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fill_scale&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;train&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;diagonals&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;off_diagonals&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we can plot these relative contributions in a way that aims to represent their associated posterior uncertainties&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;df_curves &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summarise&lt;/span&gt;(color &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;encode_colour&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`P&lt;/span&gt;(value)` &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%*%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;decode_colour&lt;/span&gt;(fill_scale&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;map&lt;/span&gt;(Parameters),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                          to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;oklab&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          from &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;oklab&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    .by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(group,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            proportion)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_blank&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Parameters),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(Parameters &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;diagonals&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                              &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;off_diagonals&amp;#34;&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_slab&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; proportion,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; group,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;I&lt;/span&gt;(color),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    thickness &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fill_type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;auto&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    side &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;both&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;stat_pointinterval&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; group,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; proportion,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        group &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Parameters),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; prop_df &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(proportion &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cumsum&lt;/span&gt;(proportion),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             .by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(.draw, group)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(Parameters &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;off_diagonals&amp;#34;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  fill_scale &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_y_continuous&lt;/span&gt;(limits &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coord_cartesian&lt;/span&gt;(expand &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Contribution to stationary distribution&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/vector-autoregressions/index_files/figure-html/unnamed-chunk-63-1.png&#34; alt=&#34;mvgam vector autoregressive community reactivity estimates&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;And there we have it. This plot demonstrates that, within the contribution of the &lt;code&gt;\(A\)&lt;/code&gt; matrix to the stable distribution, the off-diagonals (i.e. the lagged autoregressive interaction effects) play a sizable role. However, within the contribution of the &lt;code&gt;\(\Sigma\)&lt;/code&gt; matrix to the stable distribution, the diagonals (i.e. the process variances) are much more important than are the off-diagonal covariances. This gives us some insights into the relative importances of lagged vs contemporaneous &amp;ldquo;interactions&amp;rdquo; and can hopefully facilitate more in-depth ecological analyses.&lt;/p&gt;&#xA;&lt;p&gt;Also, although we haven&amp;rsquo;t covered it in this example, there is of course no reason why you cannot include complex covariate effects in either the process or observation models. Indeed, &lt;code&gt;mvgam()&lt;/code&gt; can readily handle a wide range of effects including multidimensional penalized smooth functions, Gaussian Process functions, monotonic smooth functions, &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;distributed lag nonlinear effects&lt;/a&gt;, seasonality and &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time-varying seasonality&lt;/a&gt;, and hierarchical effects. It is also easy to generate probabilistic forecasts from these models, which you can learn more about by reading the &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/articles/forecast_evaluation.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;forecast and forecast evaluation vignette&lt;/a&gt;. These options should hopefully make &lt;code&gt;mvgam&lt;/code&gt; a very attractive resource for tackling real-world multivariate time series when we do not wish to ignore important drivers or use time series transformations that make both inference and prediction difficult. Thanks for your time!&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material about Vector Autoregressive models and Dynamic GAMs for time series modeling / forecasting&lt;/p&gt;&#xA;&lt;p&gt;Hampton, S. E., Holmes, E. E., Scheef, L. P., Scheuerell, M. D., Katz, S. L., Pendleton, D. E., &amp;amp; Ward, E. J. (2013). &#xA;&lt;a href=&#34;https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/13-0996.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quantifying effects of abiotic and biotic drivers on community dynamics with multivariate autoregressive (MAR) models&lt;/a&gt;. &lt;em&gt;Ecology&lt;/em&gt;, 94(12), 2663-2669.&lt;/p&gt;&#xA;&lt;p&gt;Hannaford, N. E., Heaps, S. E., Nye, T. M., Curtis, T. P., Allen, B., Golightly, A., &amp;amp; Wilkinson, D. J. (2023). &#xA;&lt;a href=&#34;https://www.sciencedirect.com/science/article/pii/S0167947322002390&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;A sparse Bayesian hierarchical vector autoregressive model for microbial dynamics in a wastewater treatment plant&lt;/a&gt;. &lt;em&gt;Computational Statistics &amp;amp; Data Analysis&lt;/em&gt;, 179, 107659.&lt;/p&gt;&#xA;&lt;p&gt;Heaps, S. E. (2023). &#xA;&lt;a href=&#34;https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2079648&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Enforcing stationarity through the prior in vector autoregressions&lt;/a&gt;. &lt;em&gt;Journal of Computational and Graphical Statistics&lt;/em&gt;, 32(1), 74-83.&lt;/p&gt;&#xA;&lt;p&gt;Karunarathna, K. A. N. K., Wells, K., &amp;amp; Clark, N. J. (2024). &#xA;&lt;a href=&#34;https://www.sciencedirect.com/science/article/pii/S0304380024000371&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modelling nonlinear responses of a desert rodent species to environmental change with hierarchical dynamic generalized additive models&lt;/a&gt;. &lt;em&gt;Ecological Modelling&lt;/em&gt;, 490, 110648.&lt;/p&gt;&#xA;&lt;p&gt;Lütkepohl, H (2006). &#xA;&lt;a href=&#34;https://link.springer.com/book/10.1007/978-3-540-27752-1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;New introduction to multiple time series analysis&lt;/a&gt;. Springer, New York.&lt;/p&gt;&#xA;&lt;p&gt;Pesaran, P. H., &amp;amp; Yongcheol, S. (1998). &#xA;&lt;a href=&#34;https://www.sciencedirect.com/science/article/pii/S0165176597002140&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Generalized impulse response analysis in linear multivariate models&lt;/a&gt; &lt;em&gt;Economics Letters&lt;/em&gt; 58: 17-29.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Incorporating time-varying seasonality in forecast models</title>
  <link>https://ecogambler.netlify.app/blog/time-varying-seasonality/</link>
  <pubDate>Tue, 11 Jun 2024 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/time-varying-seasonality/</guid>
  <description>&lt;p&gt;Seasonality is very common in real-world time series. Many series vary in periodic, regular ways. For example, ice cream sales tend to be higher in warmer holiday months, while counts of migratory birds fluctuate strongly around the annual migration cycle. Because of how pervasive seasonality is, many time series and forecasting methods have been developed specifically to deal with this feature. For example, &#xA;&lt;a href=&#34;https://otexts.com/fpp3/seasonal-arima.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Seasonal ARIMA (SARIMA) models&lt;/a&gt; use differencing at seasonal lags to model seasonality in addition to other autoregressive features. Many types of &#xA;&lt;a href=&#34;https://otexts.com/fpp3/ets.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Exponential Smoothing models&lt;/a&gt; can also capture seasonality by propagating separate seasonal states in State-Space form. These methods are extremely useful for modeling real-valued time series and generating reasonable forecasts, and they can both readily handle time-varying seasonal patterns. But when it comes to regression-based models (&#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/mvgam-on-cran/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;which can do a &lt;em&gt;much&lt;/em&gt; better job capturing relevant features of the data, such as overdispersion, boundedness, missingness or zero-inflation&lt;/a&gt;), options for capturing seasonality, and time-varying seasonality, are more limited. The purpose of this brief post is to highlight one strategy for capturing seasonality, and time-varying seasonal patterns, in Dynamic Generalized Additive Models.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This tutorial relies on the following packages:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mvgam)           &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit, interrogate and forecast DGAMs&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(dplyr)           &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tidy and flexible data manipulation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(forecast)        &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Construct fourier terms for time series&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ggplot2)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Flexible plotting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_set&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_bw&lt;/span&gt;())      &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Black and White ggplot2 theme&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(gratia)          &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Graceful plotting of smooth terms&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(marginaleffects) &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Interrogating regression models&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(patchwork)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Combining ggplot objects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(janitor)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Creating clean, tidy variable names&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h1 id=&#34;plotting-a-seasonal-time-series&#34;&gt;Plotting a seasonal time series&#xA;  &lt;a href=&#34;#plotting-a-seasonal-time-series&#34;&gt;&lt;/a&gt;&#xA;&lt;/h1&gt;&#xA;&lt;p&gt;We will work with the &lt;code&gt;AirPassengers&lt;/code&gt; dataset, which is a time series of monthly international airline passengers from 1949 - 1960 (recorded in thousands). Load the data and plot the series&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;AirPassengers&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(AirPassengers, bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-3-1.png&#34; alt=&#34;The AirPassengers time series in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;It is clear from this plot that there is strong seasonality in the passenger numers, but this pattern also appears to be changing over time. One common way to inpsect possible seasonal patterns is to calculate and plot an STL decomposition (Seasonal and Trend decomposition using Loess), which uses loess smoothing to iteratively smooth and remove certain components of the data (i.e. the long-term &lt;em&gt;trend&lt;/em&gt;, which may be nonlinear, and the potentially time-varying &lt;em&gt;seasoanality&lt;/em&gt;)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;stl&lt;/span&gt;(AirPassengers, s.window &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;9&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;autoplot&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-4-1.png&#34; alt=&#34;An STL decomposition of the AirPassengers dataset in R, useful for time series modeling and forecasting&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;You can read about ways to modify this plot by changing the the periods over which the trend and seasonal components are smoothed using the &lt;code&gt;t.window&lt;/code&gt; and &lt;code&gt;s.window&lt;/code&gt; arguments, but they aren&amp;rsquo;t that important for this post. The key message is that there appears to be a long-term, nonlinear &lt;em&gt;trend&lt;/em&gt; and a cyclic seasonal pattern that varies over time, not just in magnitude but also perhaps a bit in shape. Now for some models. First let&amp;rsquo;s convert the series to a &lt;code&gt;data.frame()&lt;/code&gt; object that is suitable for modeling with the {&lt;code&gt;mgcv&lt;/code&gt;} and {&lt;code&gt;mvgam&lt;/code&gt;} packages. This function will also automatically split the data into training and testing sets, which makes it easy to evaluate different models on their forecasting abilities.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;airdat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;series_to_mvgam&lt;/span&gt;(AirPassengers, freq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;frequency&lt;/span&gt;(AirPassengers))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glimpse&lt;/span&gt;(airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Rows: 122&#xD;&#xA;## Columns: 6&#xD;&#xA;## $ y      &amp;lt;dbl&amp;gt; 112, 118, 132, 129, 121, 135, 148, 148, 136, 119, 104, 118, 115…&#xD;&#xA;## $ season &amp;lt;dbl&amp;gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, …&#xD;&#xA;## $ year   &amp;lt;dbl&amp;gt; 1949, 1949, 1949, 1949, 1949, 1949, 1949, 1949, 1949, 1949, 194…&#xD;&#xA;## $ date   &amp;lt;dttm&amp;gt; 1949-01-01 00:00:00, 1949-01-31 10:00:00, 1949-03-02 20:00:01,…&#xD;&#xA;## $ series &amp;lt;fct&amp;gt; series_1, series_1, series_1, series_1, series_1, series_1, ser…&#xD;&#xA;## $ time   &amp;lt;int&amp;gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, …&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Once the data are in the correct &lt;em&gt;long&lt;/em&gt; format, we can easily plot some features of the time series using some of {&lt;code&gt;mvgam&lt;/code&gt;}&amp;rsquo;s &lt;code&gt;S3&lt;/code&gt; functions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_test)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-6-1.png&#34; alt=&#34;Features of the AirPassengers time series in R, including a CDF and ACF to view temporal autocorrelation&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The Autocorrelation Function (ACF) plot clearly shows evidence of strong autocorrelation and seasonality, which we hope to capture in our models&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;fit-an-mvgam-model-using-a-tensor-product-interaction&#34;&gt;Fit an &lt;code&gt;mvgam&lt;/code&gt; model using a tensor product interaction&#xA;  &lt;a href=&#34;#fit-an-mvgam-model-using-a-tensor-product-interaction&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Now we can fit a model to these data to try and capture both components, i.e. the trend and seasonal patterns. Those of you familiar with {&lt;code&gt;mgcv&lt;/code&gt;} will know that the traditional way to model time-varying effects is to use a &#xA;&lt;a href=&#34;https://rdrr.io/cran/mgcv/man/te.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tensor product smooth (using the &lt;code&gt;te()&lt;/code&gt; wrapper)&lt;/a&gt; to capture a nonlinear interaction between &amp;rsquo;time&amp;rsquo; and whatever covariate we are interested in (&amp;lsquo;season&amp;rsquo;, in this case). This is a useful first step to model smoothly-varying effects, and we have a lot of flexibility to describe the marginal effects within a &lt;code&gt;te()&lt;/code&gt; smooth. For example, in the below model we set up the effect of &amp;lsquo;season&amp;rsquo; using &#xA;&lt;a href=&#34;https://fromthebottomoftheheap.net/2014/05/09/modelling-seasonal-data-with-gam/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a cyclic smooth (&lt;code&gt;bs = &#39;cc&#39;&lt;/code&gt;)&lt;/a&gt; that forces the seasonal pattern to begin and end in the same place (i.e. there is no discontinuity allowed at the end points of the spline, meaning that this effect constrains the smooth to be &lt;em&gt;periodic&lt;/em&gt;).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvgam&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# A tensor product of season and time&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(season, time,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Cyclic and thin-plate marginal bases&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;cc&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;tp&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Reasonable complexities&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;15&lt;/span&gt;)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Define where the seasonal ends should &amp;#39;join&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              knots &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(season &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;12.5&lt;/span&gt;)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Allow for overdispersion in the count series&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nb&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Define the data and newdata for automatic forecasting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_test,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Silence printed messages&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              silent &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can conveniently use &lt;code&gt;gratia::draw()&lt;/code&gt; to view the &amp;rsquo;time&amp;rsquo; * &amp;lsquo;season&amp;rsquo; smooth interaction function from the model&amp;rsquo;s underlying &lt;code&gt;gam&lt;/code&gt; object (stored in the &lt;code&gt;mgcv_model&lt;/code&gt; slot of the returned model object)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draw&lt;/span&gt;(mod1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mgcv_model)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-8-1.png&#34; alt=&#34;Partial effect of time-varying seasonality from a Generalized Additive Model, fitted in mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The primary seasonal pattern can be viewed using &lt;code&gt;plot_predictions()&lt;/code&gt; from the {&lt;code&gt;marginaleffects&lt;/code&gt;} package, &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;which is an extremely useful package for using targeted predictions to interrogate nonlinear effects from GAMs&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(mod1, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;season&amp;#39;&lt;/span&gt;, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-9-1.png&#34; alt=&#34;Conditional seasonal effect from a Generalized Additive Model with time-varying seasonality, fitted in mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Out-of-sample forecasts from this model aren&amp;rsquo;t too bad here, but perhaps the uncertainty is a bit too wide. This is not unexpected if you take some time to understand how splines extrapolate beyond the training data&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod1, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;forecast&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Out of sample DRPS:&#xD;&#xA;## 897.952959&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-10-1.png&#34; alt=&#34;Forecasts from a Dynamic Generalized Additive Model with time-varying seasonality using a tensor product, fitted in mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This model is not too bad, but it might not be preferable for a few reasons:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;We are capturing the temporal dimension with a spline, and we all know that &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;splines generally give poor extrapolation behaviours&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;This model assumes that the seasonal pattern changes at the same rate that the temporal spline changes, and this might not always be the most suitable model&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;using-fourier-terms-to-capture-time-varying-seasonality&#34;&gt;Using Fourier terms to capture time-varying seasonality&#xA;  &lt;a href=&#34;#using-fourier-terms-to-capture-time-varying-seasonality&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;There is another way we can model time-varying seasonality, in this case using a &#xA;&lt;a href=&#34;https://otexts.com/fpp3/useful-predictors.html#useful-predictors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fourier transform&lt;/a&gt;. A Fourier series uses sets of sine and cosine terms at different frequencies, which can be weighted to approximate a huge variety of periodic functions. First compute sine and cosine functions using the &lt;code&gt;forecast::fourier()&lt;/code&gt; function, which automatically recognises the monthly periodicity of the &lt;code&gt;AirPassengers&lt;/code&gt; data to calculate Fourier terms of the corrrect frequencies. Here we set the order &lt;code&gt;K&lt;/code&gt; equal to &lt;code&gt;4&lt;/code&gt;, which gives us a total of &lt;code&gt;8&lt;/code&gt; sine and cosine predictors that we can use as regressors in our dynamic model. This sort of model is often referred to as &#xA;&lt;a href=&#34;https://otexts.com/fpp3/dhr.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;harmonic regression&lt;/em&gt;&lt;/a&gt; because the successive Fourier terms can be thought of as representing harmonics of the previous Fourier terms.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(forecast&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;fourier&lt;/span&gt;(AirPassengers, K &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use clean_names as fourier() gives terrible name types&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  janitor&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;clean_names&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&amp;gt;&lt;/span&gt; fourier_terms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glimpse&lt;/span&gt;(fourier_terms)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Rows: 144&#xD;&#xA;## Columns: 8&#xD;&#xA;## $ s1_12 &amp;lt;dbl&amp;gt; 0.5000000, 0.8660254, 1.0000000, 0.8660254, 0.5000000, 0.0000000…&#xD;&#xA;## $ c1_12 &amp;lt;dbl&amp;gt; 0.8660254, 0.5000000, 0.0000000, -0.5000000, -0.8660254, -1.0000…&#xD;&#xA;## $ s2_12 &amp;lt;dbl&amp;gt; 0.8660254, 0.8660254, 0.0000000, -0.8660254, -0.8660254, 0.00000…&#xD;&#xA;## $ c2_12 &amp;lt;dbl&amp;gt; 0.5, -0.5, -1.0, -0.5, 0.5, 1.0, 0.5, -0.5, -1.0, -0.5, 0.5, 1.0…&#xD;&#xA;## $ s3_12 &amp;lt;dbl&amp;gt; 1, 0, -1, 0, 1, 0, -1, 0, 1, 0, -1, 0, 1, 0, -1, 0, 1, 0, -1, 0,…&#xD;&#xA;## $ c3_12 &amp;lt;dbl&amp;gt; 0, -1, 0, 1, 0, -1, 0, 1, 0, -1, 0, 1, 0, -1, 0, 1, 0, -1, 0, 1,…&#xD;&#xA;## $ s4_12 &amp;lt;dbl&amp;gt; 0.8660254, -0.8660254, 0.0000000, 0.8660254, -0.8660254, 0.00000…&#xD;&#xA;## $ c4_12 &amp;lt;dbl&amp;gt; -0.5, -0.5, 1.0, -0.5, -0.5, 1.0, -0.5, -0.5, 1.0, -0.5, -0.5, 1…&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Viewing these Fourier terms (for the first 24 time points) gives a sense of how they can be thought of as a particular type of basis expansion&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.matrix&lt;/span&gt;(fourier_terms)[1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;24&lt;/span&gt;,], type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Function value&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; viridis&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;viridis&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;), lty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-12-1.png&#34; alt=&#34;Fourier terms for a dynamic harmonic regression&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;Now we can add these new predictors to the training and testing datasets. It is important that we have these terms for the out-of-sample testing set as well, because these will be used to help compute forecasts from our model&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;bind_cols&lt;/span&gt;(fourier_terms[1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train), ])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_test &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_test &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;bind_cols&lt;/span&gt;(fourier_terms&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(fourier_terms), ])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next we can fit an &lt;code&gt;mvgam()&lt;/code&gt; model that includes a smooth nonlinear temporal trend and time-varying seasonality, but using the Fourier terms in place of the cyclic smooth like we did above. This is done by first using a monotonic smooth of &amp;rsquo;time&amp;rsquo; that ensures the temporal trend never declines, which seems appropriate here. The {&lt;code&gt;mvgam&lt;/code&gt;} package includes options for monotonically increasing or monotonically decreasing smooths using the &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/reference/monotonic.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;moi&lt;/code&gt; and &lt;code&gt;mod&lt;/code&gt; basis constructors&lt;/a&gt;. This is a nice feature that is difficult to incorporate in normal GAMs fitted in either {&lt;code&gt;mgcv&lt;/code&gt;} or {&lt;code&gt;brms&lt;/code&gt;}. The time-varying seasonality is captured by allowing the coefficients on the Fourier terms to vary over time using separate splines that take advantage of the &lt;code&gt;&#39;by&#39;&lt;/code&gt; argument in the &lt;code&gt;s()&lt;/code&gt; wrapper. This effectively sets up independent smooths of &amp;rsquo;time&amp;rsquo; that are then interacted with the Fourier terms, formulating a time-varying coefficient model for each Fourier term.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvgam&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Monotonic smooth of time to ensure the trend&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# either increases or flattens, but does not &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# decrease&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;moi&amp;#39;&lt;/span&gt;, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Time-varying fourier coefficients to capture&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# possibly changing seasonality&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s1_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c1_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s2_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c2_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s3_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c3_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Response family and data as before&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nb&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_test,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              silent &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Of course this model still uses a spline of &amp;rsquo;time&amp;rsquo; for the trend, but the monotonic restriction ensures that the predictions are at least somewhat controllable. This second model is preferred based on in-sample fits, which we can readily compare using the Approximate Leave-One-Out Cross-Validation with functionality from the wonderful &#xA;&lt;a href=&#34;https://mc-stan.org/loo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;{&lt;code&gt;loo&lt;/code&gt;} package&lt;/a&gt;. A higher Expected Log Predictive Density (ELPD) is preferred here&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;loo_compare&lt;/span&gt;(mod1, mod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##      elpd_diff se_diff&#xD;&#xA;## mod2   0.0       0.0  &#xD;&#xA;## mod1 -16.8       2.8&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;But what about forecasts? Here we plot out-of-sample forecasts from both models, which again show that the second model is slightly preferred&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod1, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;forecast&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Out of sample DRPS:&#xD;&#xA;## 897.952959&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod2, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;forecast&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Out of sample DRPS:&#xD;&#xA;## 667.239806&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-16-1.png&#34; alt=&#34;Comparing forecast distributions from two Dynamic Generalized Additive Models with time-varying seasonal components, fitted in mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Look at the partial effect plots for the smooths to see how some of the Fourier coefficients are estimated to change over time&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gratia&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draw&lt;/span&gt;(mod2&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mgcv_model, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;7&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-17-1.png&#34; alt=&#34;Time-varying Fourier coefficients from a Dynamic Harmonic Regression, fitted in mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;plotting-trend-and-seasonal-components-from-a-harmonic-regression&#34;&gt;Plotting trend and seasonal components from a harmonic regression&#xA;  &lt;a href=&#34;#plotting-trend-and-seasonal-components-from-a-harmonic-regression&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Plotting this model takes a bit more work, as we need to use targeted predictions from the model to visualise the two primary effects (i.e. the nonlinear trend and the time-varying seasonality).&lt;/p&gt;&#xA;&lt;p&gt;First a plot of the trend, which can be done easily in this model using the &lt;code&gt;&#39;condition&#39;&lt;/code&gt; argument in &lt;code&gt;plot_predictions()&lt;/code&gt; to compute expectations from the model (i.e. predictions on the outcome scale, but ignoring the overdispersion parameter from the Negative Binomial sampling distribution)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(mod2, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;time&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;expected&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Expected passengers&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Long-term trend&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And now the time-varying seasonal pattern, which requires subtracting the conditional trend predictions from the total predictions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;with_season &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(mod2, summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;expected&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;agg_over_season &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(mod2, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;datagrid&lt;/span&gt;(model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mod2,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                              time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;expected&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;season_preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; with_season &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; agg_over_season&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(airdat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;data_train &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(season_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, mean),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(season_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(season_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;))),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;()&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Expected passengers&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time-varying seasonality&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can now plot these effects together using functionality from the {&lt;code&gt;patchwork&lt;/code&gt;} package&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; p2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_layout&lt;/span&gt;(ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-20-1.png&#34; alt=&#34;Plotting nonlinear trends and time-varying seasonality from a harmonic regression Dynamic Generalized Additive Model, fitted in mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot clearly shows how the model has estimated both components, and that the seasonal pattern changes in both shape and magnitude over time&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;time-varying-periodicity&#34;&gt;Time-varying periodicity?&#xA;  &lt;a href=&#34;#time-varying-periodicity&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The above example shows how Fourier terms can be used to capture time-varying seasonality. But what if the periodicity itself is changing over time? In other words, how might we model a series that starts out with regular periodic variation that occurs every ~ 8 weeks but that proceeds to show a shrinking or expanding periodic window? Below is a very brief example of how we could expand the Fourier strategy to potentially model this&lt;/p&gt;&#xA;&lt;p&gt;First, I define function to construct monotonically increasing or decreasing&#xA;coefficients. This will be helpful to simulate time-varying periodicity&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;monotonic_fun &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(times, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sort&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale&lt;/span&gt;(times)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; x) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; x))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now for the simulation, which involves constructing Fourier series for two different periodicities (&lt;code&gt;k = 12&lt;/code&gt; and &lt;code&gt;k = 6&lt;/code&gt; in this example), each with three Fourier terms. I then simulate time-varying coefficients for these terms, forcing the period-12 terms to decline toward zero over time while allowing the period-6 terms to increase over time. These coefficients, together with the simulated Fourier terms themselves, should give us the ingredients to simulate a time series in which the periodicity shrinks from ~12 to ~6 over time&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;123&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;times &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;120&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Construct Fourier series for two different periodicities&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(forecast&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;fourier&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ts&lt;/span&gt;(times, frequency &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;), K &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;bind_cols&lt;/span&gt;(forecast&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;fourier&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ts&lt;/span&gt;(times, frequency &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;), K &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use clean_names as fourier() gives terrible name types&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  janitor&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;clean_names&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&amp;gt;&lt;/span&gt; fourier_terms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Create the time-varying Fourier coefficients&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;betas &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(times), ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(fourier_terms))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Period 12 coefficients drop montonically toward zero over time&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p12_names &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;grep&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;_12&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;names&lt;/span&gt;(fourier_terms), fixed &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; p12_names){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  betas[, i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;monotonic_fun&lt;/span&gt;(times, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;runif&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;-3&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;-0.25&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Period 6 coefficients increase monotonically over time&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p6_names &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;grep&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;_6&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;names&lt;/span&gt;(fourier_terms), fixed &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; p6_names){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  betas[, i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;monotonic_fun&lt;/span&gt;(times, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;runif&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the Fourier coefficients through time&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matplot&lt;/span&gt;(betas, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; viridis&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;viridis&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;), lty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-23-1.png&#34; alt=&#34;Time-varying periodicity simulated in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Now calculate the linear predictor and plot it&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;vector&lt;/span&gt;(length &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(times))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(times)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mu[i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.matrix&lt;/span&gt;(fourier_terms)[i, ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%*%&lt;/span&gt; betas[i, ] &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mu, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-24-1.png&#34; alt=&#34;Time-varying periodicity simulated in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Finally, add some Gaussian Random Walk noise and plot the resulting simulated time series&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cumsum&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(times), sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(y, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-25-1.png&#34; alt=&#34;Time-varying periodicity simulated in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Now we can construct the data for modeling; this assumes we&amp;rsquo;ve thought carefully about the problem and have included the Fourier series for both periodicities as predictors&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(y, time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; times) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;bind_cols&lt;/span&gt;(fourier_terms)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And we can now fit the dynamic GAM, which uses a State-Space representation&#xA;to capture time-varying seasonality, periodicity and the Random Walk autocorrelation process&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod3 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvgam&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Observation formula; empty&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Process formula contains the seasonal terms&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  trend_formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Time-varying fourier coefficients to capture&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# possibly changing seasonality AND periodicity&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s1_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c1_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s2_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c2_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s3_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c3_12, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s1_6, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c1_6, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; s2_6, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c2_6, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c3_6, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Random walk for the trend&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  trend_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;RW&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Gaussian observations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gaussian&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Realistic priors on variance components&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  priors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exponential&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exponential&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma_obs)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Sampler settings&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  burnin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  samples &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  silent &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Data&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the time-varying Fourier coefficients as before, using &lt;code&gt;gratia::draw()&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gratia&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draw&lt;/span&gt;(mod3&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;trend_mgcv_model)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-28-1.png&#34; alt=&#34;Time-varying Fourier coefficients to model time-varying periodicity in mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;As before, our model has successfully captured the time-varying coefficients for these terms. Notice how many of the period-12 terms (i.e. &lt;code&gt;s1_12&lt;/code&gt; and &lt;code&gt;c3_12&lt;/code&gt;) are estimated to decline over time, while many of the period-6 terms (i.e. &lt;code&gt;s2_6&lt;/code&gt; and &lt;code&gt;c3_6&lt;/code&gt;) are estimated to increase over time. It is encouraging that the model has been able to find these while also dealing with the Random Walk autocorrelation process and the two variance terms (process error and observation error).&lt;/p&gt;&#xA;&lt;p&gt;We can also plot the time-varying seasonality using posterior expectations as we did for the first example above. But note that this plot does not include the Random Walk component in its predictions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;season_preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(mod3, summary &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;expected&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(season_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, mean),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(season_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(season_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;))),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Posterior expectations&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time-varying seasonality&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we can extract the RW trend that was estimated and subtract the seasonal predictions, which will give us a view of the potentially nonlinear trend that was estimated by the model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trend_preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hindcast&lt;/span&gt;(mod3, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;expected&amp;#39;&lt;/span&gt;)&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;hindcasts[[1]] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  season_preds&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(trend_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, mean),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(trend_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(trend_preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(x, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;))),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Posterior expectations&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;RW trend&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Once again, we can plot the two together using {&lt;code&gt;patchwork&lt;/code&gt;}&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; p2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_layout&lt;/span&gt;(ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/time-varying-seasonality/index_files/figure-html/unnamed-chunk-31-1.png&#34; alt=&#34;Capturing time-varying periodicity in harmonic regression models using mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This post has hopefully given you some ideas about useful modeling strategies for dealing with time-varying seasonality. Of course, we may want to try and &lt;em&gt;explain&lt;/em&gt; why seasonality varies over time. In that case, I often find &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;distributed lag predictors&lt;/a&gt; to be especially helpful. Thanks for reading!&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material about Dynamic Harmonic Regression and using GAMs for time series modeling / forecasting&lt;/p&gt;&#xA;&lt;p&gt;Autin, M. A., &amp;amp; Edwards, D. &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/abs/10.1002/env.1013&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nonparametric harmonic regression for estuarine water quality data&lt;/a&gt; &lt;em&gt;Environmetrics&lt;/em&gt; 21.6 (2010): 588-605.&lt;/p&gt;&#xA;&lt;p&gt;Karunarathna, K. A. N. K., Wells, K., &amp;amp; Clark, N. J. (2024). &#xA;&lt;a href=&#34;https://www.sciencedirect.com/science/article/pii/S0304380024000371&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modelling nonlinear responses of a desert rodent species to environmental change with hierarchical dynamic generalized additive models&lt;/a&gt;. &lt;em&gt;Ecological Modelling&lt;/em&gt;, 490, 110648.&lt;/p&gt;&#xA;&lt;p&gt;Young, P. C., Pedregal, D. J., &amp;amp; Tych, W. (1999). &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/10.1002/%28SICI%291099-131X%28199911%2918:6%3C369::AID-FOR748%3E3.0.CO;2-K&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dynamic harmonic regression&lt;/a&gt;. &lt;em&gt;Journal of Forecasting&lt;/em&gt;, 18, 369–394.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>First release of mvgam(v1.1.0) to CRAN</title>
  <link>https://ecogambler.netlify.app/blog/mvgam-on-cran/</link>
  <pubDate>Wed, 08 May 2024 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/mvgam-on-cran/</guid>
  <description>&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;welcoming-mvgam-to-the-comprehensive-r-archive-network-cran&#34;&gt;Welcoming mvgam to the Comprehensive R Archive Network (CRAN)&#xA;  &lt;a href=&#34;#welcoming-mvgam-to-the-comprehensive-r-archive-network-cran&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The goal of &lt;code&gt;mvgam&lt;/code&gt; is to use a Bayesian framework to estimate parameters of Dynamic Generalized Additive Models (DGAMs) for time series with dynamic trend components. The package provides an interface to fit Bayesian DGAMs using &#xA;&lt;a href=&#34;https://mc-stan.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;Stan&lt;/code&gt;&lt;/a&gt; as the backend, and is particularly suited to the estimation of complex State-Space models. The formula syntax is based on that of the package &#xA;&lt;a href=&#34;https://cran.r-project.org/web/packages/mgcv/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mgcv&lt;/code&gt;&lt;/a&gt; to provide a familiar GAM modelling interface. There is also built-in support for the increasingly powerful &#xA;&lt;a href=&#34;https://marginaleffects.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;marginaleffects&lt;/code&gt; package&lt;/a&gt; to make interpretation easy. The motivation for the package and some of its primary objectives are described in detail by Clark &amp;amp; Wells 2022 (published in &#xA;&lt;a href=&#34;https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13974&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Methods in Ecology and Evolution&lt;/a&gt;). An introduction to the package and some worked examples are also shown in the below seminar:&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Ecological Forecasting with Dynamic Generalized Additive Models DGAMs)&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;&#xA;  &lt;iframe src=&#34;https://www.youtube-nocookie.com/embed/0zZopLlomsQ&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;The first release of &lt;code&gt;mvgam&lt;/code&gt; &#xA;&lt;a href=&#34;https://cran.rstudio.com/web/packages/mvgam/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;has now been published on CRAN&lt;/a&gt;. While the package has featured on this blog before, for example when I explained &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hierarchical distributed lag models&lt;/a&gt; and &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;how to model temporally autocorrelated time series with nonlinear trends&lt;/a&gt;, I have not thorougly introduced the it yet. So the purpose of this brief post is to cover some of the features of this stable release, and to hint at a few of the development goals for upcoming releases.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;what-are-generalized-additive-models-gams&#34;&gt;What are Generalized Additive Models (GAMs)?&#xA;  &lt;a href=&#34;#what-are-generalized-additive-models-gams&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Generalized Additive Models (GAMs) are flexible tools that replace one or more predictors in a Generalized Linear Model (GLM) with &lt;em&gt;smooth functions&lt;/em&gt; of predictors. These are helpful for learning arbitrarily complex, nonlinear relationships between predictors and conditional responses without needing &lt;em&gt;a priori&lt;/em&gt; expectations about the shapes of these relationships. Rather, they are learned using &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;penalized smoothing splines&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;smooth_only.gif&#34; alt=&#34;Generalized Additive Models learn nonlinear effects from data using smoothing splines&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;How do these work? The secret is a &lt;em&gt;basis expansion&lt;/em&gt;, which in lay terms means that the covariate (time, in this example) is evaluated at a smaller set of &lt;em&gt;basis functions&lt;/em&gt; designed to cover the range of the observed covariate values. Below is one particular type of basis, called a cubic regression basis.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;basis-functions-1.svg&#34; alt=&#34;How basis functions can be used to build a smoothing spline in a GAM&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;Each basis function acts on its own local neighbourhood of the covariate. Once we have constructed the basis, we can estimate weights for each function. The weights allow the basis functions to have different impacts on the shape of the spline. They also give us a target for learning splines from data, as the weights act as the regression coefficients.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;basis_weights.gif&#34; alt=&#34;How basis functions can be used to build a smoothing spline in a GAM&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;There are many more types of basis expansions that can be used to form penalized smooths, including multidimensional smooths, spatial smooths or even monotonic smooths. For more information on GAMs and how they can smooth through data, see &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;my blogpost on how to interpret nonlinear effects from Generalized Additive Models&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;what-does-mvgam-do&#34;&gt;What does mvgam do?&#xA;  &lt;a href=&#34;#what-does-mvgam-do&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;&lt;code&gt;mvgam&lt;/code&gt; is designed to propagate unobserved temporal processes to capture latent dynamics in the observed time series. This works in a state-space format, with the temporal &lt;em&gt;trend&lt;/em&gt; evolving independently of the observation process. Briefly, assume &lt;code&gt;\(\tilde{\boldsymbol{y}}_{i,t}\)&lt;/code&gt; is the conditional expectation of response variable &lt;code&gt;\(\boldsymbol{i}\)&lt;/code&gt; at time &lt;code&gt;\(\boldsymbol{t}\)&lt;/code&gt;. Assuming &lt;code&gt;\(\boldsymbol{y_i}\)&lt;/code&gt; is drawn from an exponential distribution with an invertible link function, the linear predictor for a multivariate Dynamic GAM can be written as:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$for~i~in~1:N_{series}~...$$&lt;/code&gt;&#xA;&lt;code&gt;$$for~t~in~1:N_{timepoints}~...$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$g^{-1}(\tilde{\boldsymbol{y}}_{i,t})=\alpha_{i}+\sum\limits_{j=1}^J\boldsymbol{s}_{i,j,t}\boldsymbol{x}_{j,t}+\boldsymbol{z}_{i,t}\,,$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Here &lt;code&gt;\(\alpha\)&lt;/code&gt; are the unknown intercepts, the &lt;code&gt;\(\boldsymbol{s}\)&lt;/code&gt;&amp;rsquo;s are unknown smooth functions of covariates &lt;code&gt;\((\boldsymbol{x})\)&lt;/code&gt;&amp;rsquo;s, which can potentially vary among the response series, and &lt;code&gt;\(\boldsymbol{z}\)&lt;/code&gt; are dynamic latent processes. Each smooth function &lt;code&gt;\(\boldsymbol{s_j}\)&lt;/code&gt; is composed of basis expansions whose coefficients, which must be estimated, control the functional relationship between &lt;code&gt;\(\boldsymbol{x}_{j}\)&lt;/code&gt; and &lt;code&gt;\(g^{-1}(\tilde{\boldsymbol{y}})\)&lt;/code&gt;. But note that we can also include smooth functions of covariates in the process models &lt;code&gt;\(\boldsymbol{z}\)&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Several advantages of GAMs are that they can model a diversity of response families, including discrete distributions (i.e. Poisson, Negative Binomial, Gamma) that accommodate common ecological features such as zero-inflation or overdispersion, and that they can be formulated to include hierarchical smoothing for multivariate responses. &lt;code&gt;mvgam&lt;/code&gt; supports a number of different observation families, which are summarized below.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;supported-observation-families&#34;&gt;Supported observation families&#xA;  &lt;a href=&#34;#supported-observation-families&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;&lt;code&gt;mvgam&lt;/code&gt; was originally designed to analyse and forecast time series of non-negative integer-valued data (counts). These data are traditionally challenging to analyse with existing time series analysis packages. But further development of &lt;code&gt;mvgam&lt;/code&gt; has resulted in support for a growing number of observation families that extend to other types of data. Currently, the package can handle data for the following families:&lt;/p&gt;&#xA;&lt;table&gt;&#xA;&lt;thead&gt;&#xA;&lt;tr&gt;&#xA;&lt;th style=&#34;text-align:center&#34;&gt;Distribution&lt;/th&gt;&#xA;&lt;th style=&#34;text-align:center&#34;&gt;Function&lt;/th&gt;&#xA;&lt;th style=&#34;text-align:center&#34;&gt;Support&lt;/th&gt;&#xA;&lt;th style=&#34;text-align:center&#34;&gt;Extra parameter(s)&lt;/th&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/thead&gt;&#xA;&lt;tbody&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Gaussian (identity link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;gaussian()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Real values in &lt;code&gt;\((-\infty, \infty)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;\(\sigma\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Student&amp;rsquo;s T (identity link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;student-t()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Heavy-tailed real values in &lt;code&gt;\((-\infty, \infty)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;\(\sigma\)&lt;/code&gt;, &lt;code&gt;\(\nu\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;LogNormal (identity link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;lognormal()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Positive real values in &lt;code&gt;\([0, \infty)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;\(\sigma\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Gamma (log link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;Gamma()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Positive real values in &lt;code&gt;\([0, \infty)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;\(\alpha\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Beta (logit link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;betar()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Real values (proportional) in &lt;code&gt;\([0,1]\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;\(\phi\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Bernoulli (logit link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;bernoulli()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Binary data in &lt;code&gt;\({0,1}\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;-&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Poisson (log link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;poisson()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Non-negative integers in &lt;code&gt;\((0,1,2,...)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;-&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Negative Binomial2 (log link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;nb()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Non-negative integers in &lt;code&gt;\((0,1,2,...)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;\(\phi\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Binomial (logit link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;binomial()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Non-negative integers in &lt;code&gt;\((0,1,2,...)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;-&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Beta-Binomial (logit link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;beta_binomial()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Non-negative integers in &lt;code&gt;\((0,1,2,...)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;\(\phi\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Poisson Binomial N-mixture (log link)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;&lt;code&gt;nmix()&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;Non-negative integers in &lt;code&gt;\((0,1,2,...)\)&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td style=&#34;text-align:center&#34;&gt;-&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;For all supported observation families, any extra parameters that need to be estimated (i.e. the &lt;code&gt;\(\sigma\)&lt;/code&gt; in a Gaussian model or the &lt;code&gt;\(\phi\)&lt;/code&gt; in a Negative Binomial model) are by default estimated independently for each series. However, users can opt to force all series to share extra observation parameters using &lt;code&gt;share_obs_params = TRUE&lt;/code&gt; in &lt;code&gt;mvgam()&lt;/code&gt;. Note that default link functions cannot currently be changed.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;supported-temporal-dynamic-processes&#34;&gt;Supported temporal dynamic processes&#xA;  &lt;a href=&#34;#supported-temporal-dynamic-processes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The dynamic processes that &lt;code&gt;mvgam&lt;/code&gt; can fit to time series can take a wide variety of forms, some of which can be multivariate to allow the different time series to interact or be correlated. When using the &lt;code&gt;mvgam()&lt;/code&gt; function, the user chooses between different process models with the &lt;code&gt;trend_model&lt;/code&gt; argument. Available process models are described in &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/reference/mvgam_trends.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;?mvgam_trends&lt;/code&gt;&lt;/a&gt; and detailed below.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;independent-random-walks&#34;&gt;Independent Random Walks&#xA;  &lt;a href=&#34;#independent-random-walks&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Use &lt;code&gt;trend_model = &#39;RW&#39;&lt;/code&gt; or &lt;code&gt;trend_model = RW()&lt;/code&gt; to set up a model where each series in &lt;code&gt;data&lt;/code&gt; has independent latent temporal dynamics of the form:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_{i,t} &amp;amp; \sim \text{Normal}(z_{i,t-1}, \sigma_i) \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Process error parameters &lt;code&gt;\(\sigma\)&lt;/code&gt; are modeled independently for each series. If a moving average process is required, use &lt;code&gt;trend_model = RW(ma = TRUE)&lt;/code&gt; to set up the following:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_{i,t} &amp;amp; = z_{i,t-1} + \theta_i * error_{i,t-1} + error_{i,t} \\&#xD; error_{i,t} &amp;amp; \sim \text{Normal}(0, \sigma_i) \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Moving average coefficients &lt;code&gt;\(\theta\)&lt;/code&gt; are independently estimated for each series and will be forced to be stationary by default &lt;code&gt;\((abs(\theta)&amp;lt;1)\)&lt;/code&gt;. Only moving averages of order &lt;code&gt;\(q=1\)&lt;/code&gt; are currently allowed.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;multivariate-random-walks&#34;&gt;Multivariate Random Walks&#xA;  &lt;a href=&#34;#multivariate-random-walks&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;If more than one series is included in &lt;code&gt;data&lt;/code&gt; &lt;code&gt;\((N_{series} &amp;gt; 1)\)&lt;/code&gt;, a multivariate Random Walk can be set up using &lt;code&gt;trend_model = RW(cor = TRUE)&lt;/code&gt;, resulting in the following:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_{t} &amp;amp; \sim \text{MVNormal}(z_{t-1}, \Sigma) \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Where the latent process estimate &lt;code&gt;\(z_t\)&lt;/code&gt; now takes the form of a vector. The covariance matrix &lt;code&gt;\(\Sigma\)&lt;/code&gt; will capture contemporaneously correlated process errors. It is parameterised using a Cholesky factorization, which requires priors on the series-level variances &lt;code&gt;\(\sigma\)&lt;/code&gt; and on the strength of correlations using &lt;code&gt;Stan&lt;/code&gt;&amp;rsquo;s &lt;code&gt;lkj_corr_cholesky&lt;/code&gt; distribution.&lt;/p&gt;&#xA;&lt;p&gt;Moving average terms can also be included for multivariate random walks, in which case the moving average coefficients &lt;code&gt;\(\theta\)&lt;/code&gt; will be parameterised as an &lt;code&gt;\(N_{series} * N_{series}\)&lt;/code&gt; matrix&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;autoregressive-processes&#34;&gt;Autoregressive processes&#xA;  &lt;a href=&#34;#autoregressive-processes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Autoregressive models up to &lt;code&gt;\(p=3\)&lt;/code&gt;, in which the autoregressive coefficients are estimated independently for each series, can be used by specifying &lt;code&gt;trend_model = &#39;AR1&#39;&lt;/code&gt;, &lt;code&gt;trend_model = &#39;AR2&#39;&lt;/code&gt;, &lt;code&gt;trend_model = &#39;AR3&#39;&lt;/code&gt;, or &lt;code&gt;trend_model = AR(p = 1, 2, or 3)&lt;/code&gt;. For example, a univariate AR(1) model takes the form:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_{i,t} &amp;amp; \sim \text{Normal}(ar1_i * z_{i,t-1}, \sigma_i) \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;All options are the same as for Random Walks, but additional options will be available for placing priors on the autoregressive coefficients. By default, these coefficients will not be forced into stationarity, but users can impose this restriction by changing the upper and lower bounds on their priors. See &lt;code&gt;?get_mvgam_priors&lt;/code&gt; for more details.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;vector-autoregressive-processes&#34;&gt;Vector Autoregressive processes&#xA;  &lt;a href=&#34;#vector-autoregressive-processes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;A Vector Autoregression of order &lt;code&gt;\(p=1\)&lt;/code&gt; can be specified if &lt;code&gt;\(N_{series} &amp;gt; 1\)&lt;/code&gt; using &lt;code&gt;trend_model = &#39;VAR1&#39;&lt;/code&gt; or &lt;code&gt;trend_model = VAR()&lt;/code&gt;. A VAR(1) model takes the form:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_{t} &amp;amp; \sim \text{Normal}(A * z_{t-1}, \Sigma) \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Where &lt;code&gt;\(A\)&lt;/code&gt; is an &lt;code&gt;\(N_{series} * N_{series}\)&lt;/code&gt; matrix of autoregressive coefficients in which the diagonals capture lagged self-dependence (i.e. the effect of a process at time &lt;code&gt;\(t\)&lt;/code&gt; on its own estimate at time &lt;code&gt;\(t+1\)&lt;/code&gt;), while off-diagonals capture lagged cross-dependence (i.e. the effect of a process at time &lt;code&gt;\(t\)&lt;/code&gt; on the process for another series at time &lt;code&gt;\(t+1\)&lt;/code&gt;). By default, the covariance matrix &lt;code&gt;\(\Sigma\)&lt;/code&gt; will assume no process error covariance by fixing the off-diagonals to &lt;code&gt;\(0\)&lt;/code&gt;. To allow for correlated errors, use &lt;code&gt;trend_model = &#39;VAR1cor&#39;&lt;/code&gt; or &lt;code&gt;trend_model = VAR(cor = TRUE)&lt;/code&gt;. A moving average of order &lt;code&gt;\(q=1\)&lt;/code&gt; can also be included using &lt;code&gt;trend_model = VAR(ma = TRUE, cor = TRUE)&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Note that for all VAR models, stationarity of the process is enforced with a structured prior distribution that is described in detail in &#xA;&lt;a href=&#34;https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2079648&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Heaps 2022&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Heaps, Sarah E. &amp;ldquo;&#xA;&lt;a href=&#34;https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2079648&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Enforcing stationarity through the prior in vector autoregressions.&lt;/a&gt;&amp;rdquo; &lt;em&gt;Journal of Computational and Graphical Statistics&lt;/em&gt; 32.1 (2023): 74-83.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;gaussian-processes&#34;&gt;Gaussian Processes&#xA;  &lt;a href=&#34;#gaussian-processes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;The final option for modelling temporal dynamics is to use a Gaussian Process with squared exponential kernel. These are set up independently for each series (there is currently no multivariate GP option), using &lt;code&gt;trend_model = &#39;GP&#39;&lt;/code&gt;. The dynamics for each latent process are modelled as:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z &amp;amp; \sim \text{MVNormal}(0, \Sigma_{error}) \\&#xD; \Sigma_{error}[t_i, t_j] &amp;amp; = \alpha^2 * exp(-0.5 * ((|t_i - t_j| / \rho))^2) \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;The latent dynamic process evolves from a complex, high-dimensional Multivariate Normal distribution which depends on &lt;code&gt;\(\rho\)&lt;/code&gt; (often called the length scale parameter) to control how quickly the correlations between the model&amp;rsquo;s errors decay as a function of time. For these models, covariance decays exponentially fast with the squared distance (in time) between the observations. The functions also depend on a parameter &lt;code&gt;\(\alpha\)&lt;/code&gt;, which controls the marginal variability of the temporal function at all points; in other words it controls how much the GP term contributes to the linear predictor. &lt;code&gt;mvgam&lt;/code&gt; capitalizes on some advances that allow GPs to be approximated using Hilbert space basis functions, which &#xA;&lt;a href=&#34;https://link.springer.com/article/10.1007/s11222-022-10167-2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;considerably speed up computation at little cost to accuracy or prediction performance&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;piecewise-logistic-and-linear-trends&#34;&gt;Piecewise logistic and linear trends&#xA;  &lt;a href=&#34;#piecewise-logistic-and-linear-trends&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Modeling growth for many types of time series is often similar to modeling population growth in natural ecosystems, where there series exhibits nonlinear growth that saturates at some particular carrying capacity. The logistic trend model available in {&lt;code&gt;mvgam&lt;/code&gt;} allows for a time-varying capacity &lt;code&gt;\(C(t)\)&lt;/code&gt; as well as a non-constant growth rate. Changes in the base growth rate &lt;code&gt;\(k\)&lt;/code&gt; are incorporated by explicitly defining changepoints throughout the training period where the growth rate is allowed to vary. The changepoint vector &lt;code&gt;\(a\)&lt;/code&gt; is represented as a vector of &lt;code&gt;1&lt;/code&gt;s and &lt;code&gt;0&lt;/code&gt;s, and the rate of growth at time &lt;code&gt;\(t\)&lt;/code&gt; is represented as &lt;code&gt;\(k+a(t)^T\delta\)&lt;/code&gt;. Potential changepoints are selected uniformly across the training period, and the number of changepoints, as well as the flexibility of the potential rate changes at these changepoints, can be controlled using &lt;code&gt;trend_model = PW()&lt;/code&gt;. The full piecewise logistic growth model is then:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_t &amp;amp; = \frac{C_t}{1 + \exp(-(k+a(t)^T\delta)(t-(m+a(t)^T\gamma)))}  \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;For time series that do not appear to exhibit saturating growth, a piece-wise constant rate of growth can often provide a useful trend model. The piecewise linear trend is defined as:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_t &amp;amp; = (k+a(t)^T\delta)t + (m+a(t)^T\gamma)  \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;In both trend models, &lt;code&gt;\(m\)&lt;/code&gt; is an offset parameter that controls the trend intercept. Because of this parameter, it is not recommended that you include an intercept in your observation formula because this will not be identifiable. You can read about the full description of piecewise linear and logistic trends &#xA;&lt;a href=&#34;https://www.tandfonline.com/doi/abs/10.1080/00031305.2017.1380080&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;in this paper by Taylor and Letham&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Sean J. Taylor and Benjamin Letham. &amp;ldquo;&#xA;&lt;a href=&#34;https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1380080&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Forecasting at scale.&lt;/a&gt;&amp;rdquo; &lt;em&gt;The American Statistician&lt;/em&gt; 72.1 (2018): 37-45.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;continuous-time-ar1-processes&#34;&gt;Continuous time AR(1) processes&#xA;  &lt;a href=&#34;#continuous-time-ar1-processes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Most trend models in the &lt;code&gt;mvgam()&lt;/code&gt; function expect time to be measured in regularly-spaced, discrete intervals (i.e. one measurement per week, or one per year for example). But some time series are taken at irregular intervals and we&amp;rsquo;d like to model autoregressive properties of these. The &lt;code&gt;trend_model = CAR()&lt;/code&gt; can be useful to set up these models, which currently only support autoregressive processes of order &lt;code&gt;1&lt;/code&gt;. The evolution of the latent dynamic process follows the form:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\begin{align*}&#xD; z_{i,t} &amp;amp; \sim \text{Normal}(ar1_i^{distance} * z_{i,t-1}, \sigma_i) \end{align*}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Where &lt;code&gt;\(distance\)&lt;/code&gt; is a vector of non-negative measurements of the time differences between successive observations. See &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/reference/RW.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the &lt;strong&gt;Examples&lt;/strong&gt; section in &lt;code&gt;?CAR&lt;/code&gt;&lt;/a&gt; for an illustration of how to set these models up.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;regression-formulae&#34;&gt;Regression formulae&#xA;  &lt;a href=&#34;#regression-formulae&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;&lt;code&gt;mvgam&lt;/code&gt; supports an observation model regression formula, built off the &lt;code&gt;mgcv&lt;/code&gt; package, as well as an optional process model regression formula. The formulae supplied to &lt;code&gt;mvgam()&lt;/code&gt; are exactly like those supplied to &lt;code&gt;glm()&lt;/code&gt; except that smooth terms, &lt;code&gt;s()&lt;/code&gt;,&#xA;&lt;code&gt;te()&lt;/code&gt;, &lt;code&gt;ti()&lt;/code&gt; and &lt;code&gt;t2()&lt;/code&gt;, time-varying effects using &lt;code&gt;dynamic()&lt;/code&gt;, monotonically increasing (using &lt;code&gt;s(x, bs = &#39;moi&#39;)&lt;/code&gt;) or decreasing penalized splines (using &lt;code&gt;s(x, bs = &#39;mod&#39;)&lt;/code&gt;; see &lt;code&gt;?smooth.construct.moi.smooth.spec&lt;/code&gt; for details), as well as Gaussian Process functions using &lt;code&gt;gp()&lt;/code&gt;, can be added to the right hand side (and &lt;code&gt;.&lt;/code&gt; is not supported in &lt;code&gt;mvgam&lt;/code&gt; formulae). See &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/reference/mvgam_formulae.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;?mvgam_formulae&lt;/code&gt;&lt;/a&gt; for more guidance.&lt;/p&gt;&#xA;&lt;p&gt;For setting up State-Space models, the optional process model formula can be used (see &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/articles/trend_formulas.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the State-Space model vignette&lt;/a&gt; and &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/articles/trend_formulas.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the shared latent states vignette&lt;/a&gt; for guidance on using trend formulae).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;see-the-cheatsheet-for-a-workflow-overview&#34;&gt;See the cheatsheet for a workflow overview&#xA;  &lt;a href=&#34;#see-the-cheatsheet-for-a-workflow-overview&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&lt;a href=&#34;https://github.com/nicholasjclark/mvgam/raw/master/misc/mvgam_cheatsheet.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;img src=&#34;https://github.com/nicholasjclark/mvgam/raw/master/misc/mvgam_cheatsheet.png&#34; alt=&#34;mvgam usage cheatsheet&#34;&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;future-plans&#34;&gt;Future plans&#xA;  &lt;a href=&#34;#future-plans&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;I have several priorities to help improve the workflow of &lt;code&gt;mvgam&lt;/code&gt;, as well as some features I would like to implement. These include&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Converting all graphics to &lt;code&gt;ggplot2&lt;/code&gt; so that users can modify figures as they wish&lt;/li&gt;&#xA;&lt;li&gt;Incorporating options for hierarchical modelling of dynamic process parameters (such as &lt;code&gt;\(\sigma\)&lt;/code&gt; parameters in AR or RW processes)&lt;/li&gt;&#xA;&lt;li&gt;Adding support for zero-inflated observation models&lt;/li&gt;&#xA;&lt;li&gt;Adding support for more flexible predictor effects including correlated random effects, hierarchical GPs with shared length scales &lt;code&gt;\(\rho\)&lt;/code&gt; and dynamic factor spatiotemporal effects&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</description>
  </item>
<item>
  <title>How to interpret and report nonlinear effects from Generalized Additive Models</title>
  <link>https://ecogambler.netlify.app/blog/interpreting-gams/</link>
  <pubDate>Thu, 02 May 2024 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/interpreting-gams/</guid>
  <description>&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;what-are-generalized-additive-models-gams&#34;&gt;What are Generalized Additive Models (GAMs)?&#xA;  &lt;a href=&#34;#what-are-generalized-additive-models-gams&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Generalized Additive Models (GAMs) are flexible tools that replace one or more predictors in a Generalized Linear Model (GLM) with &lt;em&gt;smooth functions&lt;/em&gt; of predictors. These are helpful for learning arbitrarily complex, nonlinear relationships between predictors and conditional responses without needing &lt;em&gt;a priori&lt;/em&gt; expectations about the shapes of these relationships. Rather, they are learned using &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;penalized smoothing splines&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;smooth_only.gif&#34; alt=&#34;Generalized Additive Models learn nonlinear effects from data using smoothing splines&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;How do these work? The secret is a &lt;em&gt;basis expansion&lt;/em&gt;, which in lay terms means that the covariate (time, in this example) is evaluated at a smaller set of &lt;em&gt;basis functions&lt;/em&gt; designed to cover the range of the observed covariate values. Below is one particular type of basis, called a cubic regression basis.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;basis-functions-1.svg&#34; alt=&#34;How basis functions can be used to build a smoothing spline in a GAM&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;Each basis function acts on its own local neighbourhood of the covariate. Once we have constructed the basis, we can estimate weights for each function. The weights allow the basis functions to have different impacts on the shape of the spline. They also give us a target for learning splines from data, as the weights act as the regression coefficients.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;basis_weights.gif&#34; alt=&#34;How basis functions can be used to build a smoothing spline in a GAM&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;There are many more types of basis expansions that can be used to form penalized smooths, including multidimensional smooths, spatial smooths or even monotonic smooths.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;when-should-you-use-a-generalized-additive-model&#34;&gt;When should you use a Generalized Additive Model?&#xA;  &lt;a href=&#34;#when-should-you-use-a-generalized-additive-model&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;GAMs are incredibly useful for several reasons. Some of these include:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;You suspect there are nonlinear relationships among your response(s) and your predictor(s)&lt;/li&gt;&#xA;&lt;li&gt;You have no prior knowledge about what kind of shapes these relationships might take&lt;/li&gt;&#xA;&lt;li&gt;You are aware that high-order polynomials can capture nonlinear effects, but &#xA;&lt;a href=&#34;https://www.youtube.com/watch?v=F0N4b7K_iYQ&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;you know that these are extremely unwieldy and dangerous&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;You&amp;rsquo;d like to learn these shapes from your data without severe risks of overfitting&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;But unfortunately, GAMs are often considered difficult to interpret (at least compared to simpler linear models). For better or worse, &#xA;&lt;a href=&#34;https://academic.oup.com/aje/article/177/4/292/147738&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;we as scientists are often trained to look first at summary outputs from regression models and try to interpret the coefficients, their standard errors and their approximate &lt;em&gt;p&lt;/em&gt;-values directly&lt;/a&gt;. I don&amp;rsquo;t agree with this practice, but it is so ingrained in tradition that it isn&amp;rsquo;t going away anytime soon. But this type of direct (dare I say, &lt;em&gt;lazy&lt;/em&gt;?) interpretation is even more challenging when it comes to GAMs. This is because we can get summary statistics for tens or even hundreds of basis coefficients, none of which can be interpreted individually.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;featured.png&#34; alt=&#34;How do we interpret nonlinear effects from Generalized Additive Models (GAMs)?&#34;&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;how-do-we-interpret-nonlinear-effects-from-generalized-additive-models-gams&#34;&gt;How do we interpret nonlinear effects from Generalized Additive Models (GAMs)?&#xA;  &lt;a href=&#34;#how-do-we-interpret-nonlinear-effects-from-generalized-additive-models-gams&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;I&amp;rsquo;ve taught several workshops on GAMs and given many more seminars, and consistently this is the most common question I receive. In this post, I illustrate the challenges of smoothing spline interpretation, and I provide 3 pointers that you can follow to start understanding, interpreting and reporting nonlinear effects from GAMs. I will make use of the widely popular &#xA;&lt;a href=&#34;https://cran.r-project.org/web/packages/mgcv/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the {&lt;code&gt;mgcv&lt;/code&gt;} R package&lt;/a&gt; for fitting GAMs to data. And I will show how the powerful &#xA;&lt;a href=&#34;https://marginaleffects.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;{&lt;code&gt;marginaleffects&lt;/code&gt;} R package&lt;/a&gt; can be used to easily generate plots, summaries and hypothesis tests to help us interpret these models.&lt;/p&gt;&#xA;&lt;p&gt;Note however that this post emphasizes how to &lt;em&gt;interpret&lt;/em&gt; fitted nonlinear functions. I will not talk about how to address statistical significance or how to select and build models. There are many other useful resources to guide these steps, most notably the help documentation in the {&lt;code&gt;mgcv&lt;/code&gt;} package (starting with &lt;code&gt;?mgcv::gam.models&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup-and-the-initial-gam-model&#34;&gt;Environment setup and the initial GAM model&#xA;  &lt;a href=&#34;#environment-setup-and-the-initial-gam-model&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This tutorial relies on the following packages:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mgcv)            &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit and interrogate GAMs&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(tidyverse)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tidy and flexible data manipulation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(marginaleffects) &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Compute conditional and marginal effects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ggplot2)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Flexible plotting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(patchwork)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Combining ggplot objects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I&amp;rsquo;ll also define a custom &lt;code&gt;ggplot2&lt;/code&gt; theme&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_set&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;(base_size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;, base_family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;serif&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(axis.line.x.bottom &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                    size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  axis.line.y.left &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                  size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  panel.spacing &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;unit&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;lines&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  legend.margin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;margin&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;-15&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now I load the &lt;code&gt;CO2&lt;/code&gt; data from the built-in datasets that are installed with R. These data contain measurements from an experiment on the cold tolerance of the grass species &lt;em&gt;Echinochloa crus-galli&lt;/em&gt;, which you can read more about using &lt;code&gt;?CO2&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data&lt;/span&gt;(CO2, package &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;datasets&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Inspect the data structure and dimensions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glimpse&lt;/span&gt;(CO2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Rows: 84&#xD;&#xA;## Columns: 5&#xD;&#xA;## $ Plant     &amp;lt;ord&amp;gt; Qn1, Qn1, Qn1, Qn1, Qn1, Qn1, Qn1, Qn2, Qn2, Qn2, Qn2, Qn2, …&#xD;&#xA;## $ Type      &amp;lt;fct&amp;gt; Quebec, Quebec, Quebec, Quebec, Quebec, Quebec, Quebec, Queb…&#xD;&#xA;## $ Treatment &amp;lt;fct&amp;gt; nonchilled, nonchilled, nonchilled, nonchilled, nonchilled, …&#xD;&#xA;## $ conc      &amp;lt;dbl&amp;gt; 95, 175, 250, 350, 500, 675, 1000, 95, 175, 250, 350, 500, 6…&#xD;&#xA;## $ uptake    &amp;lt;dbl&amp;gt; 16.0, 30.4, 34.8, 37.2, 35.3, 39.2, 39.7, 13.6, 27.3, 37.1, …&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now some manipulations for modeling&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plant &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; CO2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as_tibble&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rename&lt;/span&gt;(plant &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Plant, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Type, treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Treatment) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(plant &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(plant, ordered &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I fit a Generalized Additive Model to these data, specifying a parametric interaction between &lt;code&gt;treatment&lt;/code&gt; and &lt;code&gt;type&lt;/code&gt; as well as random (hierarchical) intercepts for each &lt;code&gt;plant&lt;/code&gt; and using Carbon Dioxide uptake (&lt;code&gt;uptake&lt;/code&gt;) as the non-negative, real-valued response. The nonlinear part comes from a &#xA;&lt;a href=&#34;https://fromthebottomoftheheap.net/2017/10/10/difference-splines-i/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;factor smooth interaction&lt;/em&gt;&lt;/a&gt; that allows a nonlinear effect of Carbon Dioxide concentration (&lt;code&gt;conc&lt;/code&gt;) to vary for different levels of the cold treatment variable (&lt;code&gt;treatment&lt;/code&gt;). Given the nature of the response, a &lt;code&gt;Gamma()&lt;/code&gt; distribution is an appropriate observation model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model_1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(uptake &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(plant, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;re&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(conc, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; treatment, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;7&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; plant, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;REML&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Gamma&lt;/span&gt;(link &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Look at the sumary of this model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(model_1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: Gamma &#xD;&#xA;## Link function: log &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## uptake ~ treatment * type + s(plant, bs = &amp;#34;re&amp;#34;) + s(conc, by = treatment, &#xD;&#xA;##     k = 7)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##                                  Estimate Std. Error t value Pr(&amp;gt;|t|)    &#xD;&#xA;## (Intercept)                       3.51609    0.06376  55.143  &amp;lt; 2e-16 ***&#xD;&#xA;## treatmentchilled                 -0.11321    0.09018  -1.255 0.213987    &#xD;&#xA;## typeMississippi                  -0.31196    0.09018  -3.459 0.000978 ***&#xD;&#xA;## treatmentchilled:typeMississippi -0.36041    0.12753  -2.826 0.006311 ** &#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##                               edf Ref.df      F p-value    &#xD;&#xA;## s(plant)                    7.032   8.00  8.022  &amp;lt;2e-16 ***&#xD;&#xA;## s(conc):treatmentnonchilled 5.193   5.68 83.888  &amp;lt;2e-16 ***&#xD;&#xA;## s(conc):treatmentchilled    5.013   5.55 58.970  &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.957   Deviance explained = 95.5%&#xD;&#xA;## -REML = 239.08  Scale est. = 0.010327  n = 84&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There seem to be lots of &amp;ldquo;&lt;em&gt;significant&lt;/em&gt;&amp;rdquo; effects here, but how on Earth do we interpret these smooth terms? The summary gives no indication of the magnitude, direction or overall shape of these smooth effects. Nor do the coefficients, for that matter:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(model_1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##                      (Intercept)                 treatmentchilled &#xD;&#xA;##                      3.516091294                     -0.113205794 &#xD;&#xA;##                  typeMississippi treatmentchilled:typeMississippi &#xD;&#xA;##                     -0.311956077                     -0.360409395 &#xD;&#xA;##                       s(plant).1                       s(plant).2 &#xD;&#xA;##                     -0.041226486                     -0.015294663 &#xD;&#xA;##                       s(plant).3                       s(plant).4 &#xD;&#xA;##                      0.056521148                     -0.040103411 &#xD;&#xA;##                       s(plant).5                       s(plant).6 &#xD;&#xA;##                      0.026931174                      0.013172237 &#xD;&#xA;##                       s(plant).7                       s(plant).8 &#xD;&#xA;##                     -0.055925539                      0.049887951 &#xD;&#xA;##                       s(plant).9                      s(plant).10 &#xD;&#xA;##                      0.006037588                     -0.215582180 &#xD;&#xA;##                      s(plant).11                      s(plant).12 &#xD;&#xA;##                      0.097118479                      0.118463702 &#xD;&#xA;##    s(conc):treatmentnonchilled.1    s(conc):treatmentnonchilled.2 &#xD;&#xA;##                      5.232322869                      1.133239546 &#xD;&#xA;##    s(conc):treatmentnonchilled.3    s(conc):treatmentnonchilled.4 &#xD;&#xA;##                     -1.904830565                      0.129187847 &#xD;&#xA;##    s(conc):treatmentnonchilled.5    s(conc):treatmentnonchilled.6 &#xD;&#xA;##                      0.236060128                      1.202602610 &#xD;&#xA;##       s(conc):treatmentchilled.1       s(conc):treatmentchilled.2 &#xD;&#xA;##                      3.690591324                      2.117499952 &#xD;&#xA;##       s(conc):treatmentchilled.3       s(conc):treatmentchilled.4 &#xD;&#xA;##                     -2.367697749                      0.063467378 &#xD;&#xA;##       s(conc):treatmentchilled.5       s(conc):treatmentchilled.6 &#xD;&#xA;##                      0.236541597                      0.967747793&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The coefficients labelled &lt;code&gt;s(conc):treatmentnonchilled&lt;/code&gt; and &lt;code&gt;s(conc):treatmentchilled&lt;/code&gt; are the basis function weights that control the shape of these splines. But without having a full understanding of what these basis functions look like and how they act collectively to form the spline, we are fairly lost for interpretation.&lt;/p&gt;&#xA;&lt;p&gt;Now I will walk through 3 steps that you can use to help with interpreting and reporting nonlinear effects from GAMs. These steps are by no means exhaustive, but given the&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;step-1-vizualising-gam-outputs&#34;&gt;Step 1: Vizualising GAM outputs&#xA;  &lt;a href=&#34;#step-1-vizualising-gam-outputs&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Visuals are by-far our best go-to tool for understanding GAMs. This is why the {&lt;code&gt;mgcv&lt;/code&gt;} package has some simple but powerful plotting routines that we can apply directly to fitted &lt;code&gt;gam&lt;/code&gt; objects. See &lt;code&gt;?mgcv::plot.gam&lt;/code&gt; for more details about default plotting.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;plotting-gam-effects-on-the-link-scale&#34;&gt;Plotting GAM effects on the link scale&#xA;  &lt;a href=&#34;#plotting-gam-effects-on-the-link-scale&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;The most common visualisattion that users make when working with GAMs are &#xA;&lt;a href=&#34;https://noamross.github.io/gams-in-r-course/chapter2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;partial effects&lt;/em&gt; plots on the link scale&lt;/a&gt;. Basically, these plots show the individual component effect of a smooth function on the link scale, conditional on all other terms in the model being set to zero. Because most smooth terms in {&lt;code&gt;mgcv&lt;/code&gt;} are zero-centred to maintain identifiability, they are convenient to look at because we can immediately make some interpretations. For example, we can see the partial effect of the &lt;code&gt;conc&lt;/code&gt; smooth for the &lt;code&gt;nonchilled treatment&lt;/code&gt; by selecting the second smooth term in the model:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(model_1, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, shade &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, lty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-10-1.png&#34; alt=&#34;How to interpret GAM partial effect plots in mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot shows that, for the &lt;code&gt;nonchilled treatment&lt;/code&gt;, the effect of &lt;code&gt;conc&lt;/code&gt; on the linear predictor is mostly negative (below zero) for small values of &lt;code&gt;conc&lt;/code&gt;, but it quickly becomes positive (above zero) for intermediate values of &lt;code&gt;conc&lt;/code&gt;. It then begins to plateau at larger values of &lt;code&gt;conc&lt;/code&gt;. We can also look at the effect for the other level of &lt;code&gt;treatment&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(model_1, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, shade &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, lty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-11-1.png&#34; alt=&#34;How to interpret GAM partial effect plots in mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot looks broadly similar, but it is not identical to the &lt;code&gt;nonchilled treatment&lt;/code&gt; effect.&lt;/p&gt;&#xA;&lt;p&gt;These plots are a good first step to interrogate GAMs, but they have several limitations:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;They only show what the model expects to see if &lt;em&gt;all other terms are dropped&lt;/em&gt;. These are not helpful if we want to aggregate over multiple smooths (i.e. &lt;em&gt;What is the average smooth effect of &lt;code&gt;conc&lt;/code&gt;?&lt;/em&gt;) or in situations where covariates occur in multiple terms. For example, a formula such as: &lt;code&gt;y ~ s(rain) + s(temp) + s(year) + ti(rain, temp) + ti(rain, year) + ti(temp, year)&lt;/code&gt; is perfectly allowed in &lt;code&gt;gam()&lt;/code&gt; (and very useful in many contexts). But the effects of our predictors of interest are spread across multiple smooth functions and we cannot interpret these individually&lt;/li&gt;&#xA;&lt;li&gt;These plots are shown on the link scale, which can often translate nonlinearly into effects on the scale of interest (the response scale. For example we have a log link function in this &lt;code&gt;Gamma()&lt;/code&gt; observation model, so the partial effects are not the same as what we&amp;rsquo;d expect on the actual scale of &lt;code&gt;uptake&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;We cannot ask more targeted questions using these plots, such as &lt;em&gt;How does the effect of &lt;code&gt;conc&lt;/code&gt; differ among treatment groups?&lt;/em&gt; or &lt;em&gt;How much more uptake would we expect if &lt;code&gt;conc&lt;/code&gt; increased from 150 to 300 mL/L?&lt;/em&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;For the remainder of this post, I&amp;rsquo;ll switch over to making plots and summaries using the elegant {&lt;code&gt;marginaleffects&lt;/code&gt;} package. It turns out that the functions available in this package make answering &lt;em&gt;all&lt;/em&gt; of the above questions easy and seamless. Moreover, we could easily fit different kinds of models (i.e. GLMs, location-scale models, survival models etc&amp;hellip;) to these same data and use &lt;em&gt;the exact same functions&lt;/em&gt; for making model comparisons. To begin illustrating, I&amp;rsquo;ll tackle the first point above by computing and plotting the average smooth effect of &lt;code&gt;conc&lt;/code&gt; across all &lt;code&gt;treatment&lt;/code&gt; levels. Again this plot is made on the link scale, but it is no longer zero-centred because the intercepts are taken into account&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model_1, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Linear predictor (link scale)&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Average smooth effect of concentration&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Aggregated across treatments and types&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-12-1.png&#34; alt=&#34;How to interpret GAM partial effect plots using marginaleffects&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Of course we can very readily split these plots by &lt;code&gt;treatment&lt;/code&gt; and &lt;code&gt;type&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model_1, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;treatment&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Linear predictor (link scale)&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Average smooth effect of concentration&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Per treatment, per type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-13-1.png&#34; alt=&#34;How to interpret GAM partial effect plots using marginaleffects&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There are many more possibilities for making simple, one-line-of-code targeted plots using &lt;code&gt;plot_predictions()&lt;/code&gt;. See &lt;code&gt;?marginaleffects::plot_predictions&lt;/code&gt; for guidance. But we can do much more than plot conditional predictions using this framework. For example, &#xA;&lt;a href=&#34;https://fromthebottomoftheheap.net/2014/05/15/identifying-periods-of-change-with-gams/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;we often want to understand how the &lt;em&gt;slope&lt;/em&gt; of a fitted function changes across the range of a covariate&lt;/a&gt;. We can calculate the slopes (i.e. the first derivatives) of our smooth functions using the &lt;code&gt;plot_slopes()&lt;/code&gt; function, which conveniently has very similar arguments and structure to &lt;code&gt;plot_predictions()&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_slopes&lt;/span&gt;(model_1, variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;treatment&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_hline&lt;/span&gt;(yintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;1st derivative of the linear predictor&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Conditional slopes of the concentration effect&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Per treatment, per type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-14-1.png&#34; alt=&#34;How to interpret GAM partial derivatives using marginaleffects&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot makes it more clear that the slope is positive up until we hit &lt;code&gt;conc&lt;/code&gt; values near 260, beyond which the function plateaus. Now we will tackle the second point above, which relates to probably the second-most common question users ask when working with GAMs in {&lt;code&gt;mgcv&lt;/code&gt;}:&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;How do I plot smooth effects on the outcome scale?&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;plotting-gam-effects-on-the-response-scale&#34;&gt;Plotting GAM effects on the response scale&#xA;  &lt;a href=&#34;#plotting-gam-effects-on-the-response-scale&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;In fact this is dead-simple with {&lt;code&gt;marginaleffects&lt;/code&gt;}. We just change &lt;code&gt;type = &#39;response&#39;&lt;/code&gt; and away we go! Of course we now have options to show the observed values on these plots, which is something we might often want to do&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model_1, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;, points &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 rug &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Expected response&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Average smooth effect of concentration&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Aggregated across treatments and types&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-15-1.png&#34; alt=&#34;How to interpret GAM partial effect plots on the response scale using marginaleffects&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Here is the average smooth of &lt;code&gt;conc&lt;/code&gt; once again, but this time on the scale of the response variable. The points and rugs show observed values, which makes it clear that a single effect of &lt;code&gt;conc&lt;/code&gt; would not be enough to capture the heterogeneity in the data. Splitting by &lt;code&gt;treatment&lt;/code&gt; and &lt;code&gt;type&lt;/code&gt; again makes things more clear&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model_1, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;treatment&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;, points &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 rug &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Expected response&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Average smooth effect of concentration&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Per treatment, per type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-16-1.png&#34; alt=&#34;How to interpret GAM partial effect plots on the response scale using marginaleffects&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These types of plots give us more ability to interrogate and criticize our fitted models. Some questions you can start to ask when trying to interpret or report functions from GAMs include:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Does the function reach an aysmptote anywhere over its range?&lt;/li&gt;&#xA;&lt;li&gt;Is the function highly wiggly, or does it appear smooth?&lt;/li&gt;&#xA;&lt;li&gt;Does the function appear to have multiple modes, and does this make sense?&lt;/li&gt;&#xA;&lt;li&gt;Are there large regions over which you have few data points, and does the function&amp;rsquo;s uncertainty grow appropriately?&lt;/li&gt;&#xA;&lt;li&gt;Are there any points that look like outliers, which the function may be responding strongly to?&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;And in case you were wondering, yes you can also plot slopes on the scale of the response:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_slopes&lt;/span&gt;(model_1, variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;treatment&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_hline&lt;/span&gt;(yintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;1st derivative of the expected response&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Conditional slopes of the concentration effect&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Per treatment, per type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-17-1.png&#34; alt=&#34;How to interpret GAM partial derivatives on the response scale using marginaleffects&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;By now you may be wondering &lt;em&gt;where&lt;/em&gt; these predictions are coming from. This brings me to the next tool in your arsenal for interpreting GAMs, simulation&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;step-2-simulating-from-fitted-gam-models&#34;&gt;Step 2: Simulating from fitted GAM models&#xA;  &lt;a href=&#34;#step-2-simulating-from-fitted-gam-models&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;In a related blog post, &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;I show how simulating data in R can be essential to understand models and their limitations&lt;/a&gt;. This is especially applicable to GAMs because this simulation involves producing the &#xA;&lt;a href=&#34;https://stat.ethz.ch/R-manual/R-devel/library/mgcv/html/predict.gam.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;linear predictor (i.e. design) matrix&lt;/em&gt;&lt;/a&gt;. This matrix is what we get when our covariates are evaluated at their respective basis functions.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;using-type--lpmatrix-to-understand-what-coefficients-mean-in-a-gam-model&#34;&gt;Using &lt;code&gt;type = &#39;lpmatrix&#39;&lt;/code&gt; to understand what coefficients mean in a GAM model&#xA;  &lt;a href=&#34;#using-type--lpmatrix-to-understand-what-coefficients-mean-in-a-gam-model&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Generating the linear predictor matrix, which I&amp;rsquo;ll refer to as &lt;code&gt;\(X_{lp}\)&lt;/code&gt;, is simple in {&lt;code&gt;mgcv&lt;/code&gt;}. We just use &lt;code&gt;predict.gam()&lt;/code&gt; and set &lt;code&gt;type = &#39;lpmatrix&#39;&lt;/code&gt;. This can be done for &lt;em&gt;new&lt;/em&gt; data or for the original data that were used to fit the model. Here is the latter:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Xp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(model_1, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;lpmatrix&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(Xp)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 84 28&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can see there are 84 rows in the matrix, corresponding to the 84 observations in our data. But we have 28 columns, many of which represent the basis functions for the two smooth terms in the model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colnames&lt;/span&gt;(Xp)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##  [1] &amp;#34;(Intercept)&amp;#34;                      &amp;#34;treatmentchilled&amp;#34;                &#xD;&#xA;##  [3] &amp;#34;typeMississippi&amp;#34;                  &amp;#34;treatmentchilled:typeMississippi&amp;#34;&#xD;&#xA;##  [5] &amp;#34;s(plant).1&amp;#34;                       &amp;#34;s(plant).2&amp;#34;                      &#xD;&#xA;##  [7] &amp;#34;s(plant).3&amp;#34;                       &amp;#34;s(plant).4&amp;#34;                      &#xD;&#xA;##  [9] &amp;#34;s(plant).5&amp;#34;                       &amp;#34;s(plant).6&amp;#34;                      &#xD;&#xA;## [11] &amp;#34;s(plant).7&amp;#34;                       &amp;#34;s(plant).8&amp;#34;                      &#xD;&#xA;## [13] &amp;#34;s(plant).9&amp;#34;                       &amp;#34;s(plant).10&amp;#34;                     &#xD;&#xA;## [15] &amp;#34;s(plant).11&amp;#34;                      &amp;#34;s(plant).12&amp;#34;                     &#xD;&#xA;## [17] &amp;#34;s(conc):treatmentnonchilled.1&amp;#34;    &amp;#34;s(conc):treatmentnonchilled.2&amp;#34;   &#xD;&#xA;## [19] &amp;#34;s(conc):treatmentnonchilled.3&amp;#34;    &amp;#34;s(conc):treatmentnonchilled.4&amp;#34;   &#xD;&#xA;## [21] &amp;#34;s(conc):treatmentnonchilled.5&amp;#34;    &amp;#34;s(conc):treatmentnonchilled.6&amp;#34;   &#xD;&#xA;## [23] &amp;#34;s(conc):treatmentchilled.1&amp;#34;       &amp;#34;s(conc):treatmentchilled.2&amp;#34;      &#xD;&#xA;## [25] &amp;#34;s(conc):treatmentchilled.3&amp;#34;       &amp;#34;s(conc):treatmentchilled.4&amp;#34;      &#xD;&#xA;## [27] &amp;#34;s(conc):treatmentchilled.5&amp;#34;       &amp;#34;s(conc):treatmentchilled.6&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;These correspond to the coefficients, &lt;code&gt;\(\beta\)&lt;/code&gt;, that we extracted earlier from the fitted model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(model_1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;all.equal&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;names&lt;/span&gt;(beta), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colnames&lt;/span&gt;(Xp))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] TRUE&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If we use linear algebra to cross-multiply these coefficients with the design matrix &lt;code&gt;\((X_{lp}\beta)\)&lt;/code&gt; we get the predicted values on the link scale:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(Xp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%*%&lt;/span&gt; beta)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Running these through the inverse link function (which is &lt;code&gt;exp()&lt;/code&gt; in the case of our log link) gives us the fitted values from the model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;all.equal&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;fitted&lt;/span&gt;(model_1), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(preds))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] TRUE&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As with the examples &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;in my other blog post about simulation in R&lt;/a&gt;, you can investigate uncertainties in these predictions by drawing &lt;code&gt;\(\beta\)&lt;/code&gt; coefficients from the model&amp;rsquo;s implied multivariate normal posterior distribution. But I won&amp;rsquo;t cover that again here.&lt;/p&gt;&#xA;&lt;p&gt;This is all well and good, but it becomes much more useful when we supply &lt;em&gt;new&lt;/em&gt; data to the &lt;code&gt;predict.gam()&lt;/code&gt; function. For example, what might we predict if we had a new measurement for plant &lt;code&gt;Qn1&lt;/code&gt; measured on &lt;code&gt;treatment = nonchilled&lt;/code&gt; in &lt;code&gt;type = Mississippi&lt;/code&gt; and with CO2 concentration &lt;code&gt;conc = 278&lt;/code&gt;? This could be a targeted scenario that we are interested in:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newXp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(model_1, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;lpmatrix&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(plant &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Qn1&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;nonchilled&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Mississippi&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;278&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(newXp)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1]  1 28&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we have taken our relatively simple scenario and run it through all necessary basis evaluations to produce the design matrix. Generating expected &lt;code&gt;uptake&lt;/code&gt; from this scenario is then as simple as:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(newXp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%*%&lt;/span&gt; beta)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##       [,1]&#xD;&#xA;## 1 27.56059&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It might be difficult to appreciate the power of this approach, but the possibilities to explore targeted scenarios are endless once you master these steps. For example, we can use these steps to see what the underlying basis functions for the effect of &lt;code&gt;conc&lt;/code&gt; look like. Simply simulate a sequence of fake &lt;code&gt;conc&lt;/code&gt; values to cover the range of the covariate and run those through the &lt;code&gt;predict.gam()&lt;/code&gt; function (keeping the other covariates fixed to particular values):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;conc_seq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(from &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(plant&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;conc), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(plant&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;conc), length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newdat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     plant &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Qn1&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;nonchilled&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Mississippi&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newXp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(model_1, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;lpmatrix&amp;#39;&lt;/span&gt;, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newdat)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Find which coefficients belong to the first smooth of &lt;code&gt;conc&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;conc_coefs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; model_1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;smooth[[2]]&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;first.para&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;model_1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;smooth[[2]]&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;last.para&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;conc_coefs&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 17 18 19 20 21 22&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And now set all cells in the &lt;code&gt;\(X_{lp}\)&lt;/code&gt; matrix that don&amp;rsquo;t correspond to these coefficients to zero&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newXp_adj &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(newXp), nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(newXp))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newXp_adj[,conc_coefs] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; newXp[, conc_coefs]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Generate the predictions on the link scale and plot the functions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plot_dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;do.call&lt;/span&gt;(rbind, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq_along&lt;/span&gt;(conc_coefs), &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(basis){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(basis_func &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;bs&amp;#39;&lt;/span&gt;, basis),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             value &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newXp_adj[, conc_coefs[basis]] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; beta[conc_coefs[basis]])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(plot_dat, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; value, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; basis_func)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;(linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Basis function value&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-28-1.png&#34; alt=&#34;Using simulations to understand basis functions in GAMs in mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Essentially these steps are what we need to interrogate GAMs. But as you can see, it can be tedious to create the &lt;code&gt;newdata&lt;/code&gt; object because we need to specify values for all of the covariates. Even the ones we aren&amp;rsquo;t interested in (such as &lt;code&gt;plant&lt;/code&gt; or &lt;code&gt;type&lt;/code&gt; in the above example). This is where the automation from {&lt;code&gt;marginaleffects&lt;/code&gt;} becomes so extraordinarily valuable. By using sophisticated rules to automatically set values for missing predictors, creating these &lt;code&gt;newdata&lt;/code&gt; scenarios is effortless. The magic happens using the &lt;code&gt;datagrid()&lt;/code&gt; function:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newdat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;datagrid&lt;/span&gt;(conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq, model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(newdat)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##    uptake  treatment   type plant      conc&#xD;&#xA;## 1 27.2131 nonchilled Quebec   Qn1  95.00000&#xD;&#xA;## 2 27.2131 nonchilled Quebec   Qn1  96.81363&#xD;&#xA;## 3 27.2131 nonchilled Quebec   Qn1  98.62725&#xD;&#xA;## 4 27.2131 nonchilled Quebec   Qn1 100.44088&#xD;&#xA;## 5 27.2131 nonchilled Quebec   Qn1 102.25451&#xD;&#xA;## 6 27.2131 nonchilled Quebec   Qn1 104.06814&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here you can see that only the &lt;code&gt;conc&lt;/code&gt; variable changes across rows, while all other variables are fixed. You can use &lt;code&gt;?marginaleffects::datagrid&lt;/code&gt; to see what the default rules are for fixing these (and how you can change them if you wish). Combining {&lt;code&gt;mgcv&lt;/code&gt;}&amp;rsquo;s &lt;code&gt;predict.gam(..., type = &#39;lpmatrix&#39;)&lt;/code&gt; and {&lt;code&gt;marginaleffects&lt;/code&gt;}&amp;rsquo;s &lt;code&gt;datagrid(...)&lt;/code&gt; function gives you all the flexibility you need to ask targeted questions using fake data simulation. In fact, when you call &lt;code&gt;plot_predictions()&lt;/code&gt; or &lt;code&gt;plot_slopes()&lt;/code&gt;, behind the scenes is a clever run of calls to &lt;code&gt;datagrid()&lt;/code&gt; to set up the design matrices.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;sidenote-marginaleffects-works-for-many-model-classes&#34;&gt;Sidenote: &lt;code&gt;marginaleffects&lt;/code&gt; works for &lt;em&gt;many&lt;/em&gt; model classes&#xA;  &lt;a href=&#34;#sidenote-marginaleffects-works-for-many-model-classes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;Obviously {&lt;code&gt;marginaleffects&lt;/code&gt;} is incredibly useful for interrogating GAMs as it provides a clean, simple interface for understanding nonlinear effects. But in fact the power of this framework is much broader, as it can support a &lt;em&gt;huge&lt;/em&gt; number of model classes in R (over 100 at the time of writing). This makes model comparison an absolute breeze. For example, let&amp;rsquo;s fit a GLM with some wacky polynomial interaction effects to the same data (Please note I&amp;rsquo;m not advocating for this model. No. It is a &lt;em&gt;bad&lt;/em&gt; model)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model_2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glm&lt;/span&gt;(uptake &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poly&lt;/span&gt;(conc, &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; plant,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; plant, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Gamma&lt;/span&gt;(link &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And we can remake one of the plots of the concentration effect from the GAM that we made earlier&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model_1, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;treatment&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;, points &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 rug &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Expected response&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Average smooth effect of concentration&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Per treatment, per type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-31-1.png&#34; alt=&#34;Visualising complex nonlinear interactions using marginaleffects and mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;We can produce the exact same plot, but now with the GLM. Notice how not a single character in the call to &lt;code&gt;plot_predictions()&lt;/code&gt; has to change apart from the model argument&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model_2, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;conc&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;treatment&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;, points &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 rug &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Expected response&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Average smooth effect of concentration&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Per treatment, per type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-32-1.png&#34; alt=&#34;Visualising complex nonlinear interactions using marginaleffects and mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Ok but how do we go beyond these relatively &amp;ldquo;simple&amp;rdquo; plots to ask more direct questions from our models?&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;step-3-making-useful-comparisons-with-gams&#34;&gt;Step 3: Making useful comparisons with GAMs&#xA;  &lt;a href=&#34;#step-3-making-useful-comparisons-with-gams&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;In their recent book &#xA;&lt;a href=&#34;https://avehtari.github.io/ROS-Examples/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Regression and Other Stories&lt;/a&gt;, authors Gelman, Hill and Vehtari advocate that regression outputs should be interpreted as &lt;em&gt;comparisons&lt;/em&gt;. This is helpful because most of our models are descriptive rather than emulations of some causal assumptions we might have about the data-generating process. But it also helps to give us ideas about how we can use regression models to compare different scenarios and ask the model what it thinks might be plausible.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;difference-smooths-how-does-a-smooth-effect-vary-among-groups&#34;&gt;Difference smooths: how does a smooth effect vary among groups?&#xA;  &lt;a href=&#34;#difference-smooths-how-does-a-smooth-effect-vary-among-groups&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;&#xA;&lt;a href=&#34;https://stats.stackexchange.com/questions/642947/interpretation-of-effect-of-factor-by-smooths-in-gam&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;A recent post on Cross Validated on computing differences among smooths in factor-smooth interactions&lt;/a&gt; (which partly motivated this post) provides useful context to help showcase the power of {&lt;code&gt;marginaleffects&lt;/code&gt;} for making comparisons in GAMs. The user was interested in fitting the same type of GAM that I fit above (including a factor-smooth interaction) to understand how nonlinear effects vary among factor levels. The question is straightforward enough, but it turns out this can be challenging to calculate by hand. But fortunately we have the family of &lt;code&gt;comparisons()&lt;/code&gt; functions from {&lt;code&gt;marginaleffects&lt;/code&gt;} to help. These are designed to &lt;em&gt;compare&lt;/em&gt; predictions among different scenarios to compute differences, calculate ratios or run any user-specified function (i.e. changes in log odds or elasticities, if we so wish). See &lt;code&gt;?marginaleffects::comparisons&lt;/code&gt; for more guidance.&lt;/p&gt;&#xA;&lt;p&gt;As an example, we can calculate the average expected difference in &lt;code&gt;uptake&lt;/code&gt; values between treatments by aggregating over &lt;code&gt;type&lt;/code&gt; and &lt;code&gt;conc&lt;/code&gt;. This gives us the &amp;ldquo;global&amp;rdquo; effect of &lt;code&gt;treatment&lt;/code&gt;, irrespective of &lt;code&gt;type&lt;/code&gt; or &lt;code&gt;conc&lt;/code&gt; values and can be a useful summary measure&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;avg_comparisons&lt;/span&gt;(model_1, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;datagrid&lt;/span&gt;(conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;treatment&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;##       Term                         Contrast        type Estimate Std. Error&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled) Quebec         -4.76       3.04&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled) Mississippi   -10.71       2.20&#xD;&#xA;##      z Pr(&amp;gt;|z|)    S 2.5 % 97.5 %&#xD;&#xA;##  -1.57    0.117  3.1 -10.7   1.19&#xD;&#xA;##  -4.87   &amp;lt;0.001 19.8 -15.0  -6.40&#xD;&#xA;## &#xD;&#xA;## Columns: term, contrast, type, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted &#xD;&#xA;## Type:  response&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we can see that, on the scale of the response, the average difference among treatments is stronger for &lt;code&gt;type = Mississippi&lt;/code&gt; than for &lt;code&gt;type = Quebec&lt;/code&gt;. This contrast comes with an estimated effect size and &lt;em&gt;p&lt;/em&gt;-value, which you can read more about in &lt;code&gt;?marginaleffects::comparisons&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;Alternatively, we can target the original poster&amp;rsquo;s estimand of interest: what is the average difference between treatments across a sequence of &lt;code&gt;conc&lt;/code&gt; values (i.e. what is the difference among the smooths?)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;avg_comparisons&lt;/span&gt;(model_1, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;datagrid&lt;/span&gt;(conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;treatment&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;conc&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;##       Term                         Contrast   conc        type Estimate&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)   95.0 Quebec         0.413&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)   95.0 Mississippi   -3.114&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)   96.8 Quebec         0.373&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)   96.8 Mississippi   -3.183&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)   98.6 Quebec         0.332&#xD;&#xA;##  Std. Error      z Pr(&amp;gt;|z|)   S  2.5 % 97.5 %&#xD;&#xA;##        1.60  0.258  0.79644 0.3  -2.73   3.55&#xD;&#xA;##        1.02 -3.057  0.00224 8.8  -5.11  -1.12&#xD;&#xA;##        1.61  0.232  0.81662 0.3  -2.78   3.53&#xD;&#xA;##        1.03 -3.102  0.00192 9.0  -5.19  -1.17&#xD;&#xA;##        1.62  0.205  0.83731 0.3  -2.84   3.51&#xD;&#xA;## --- 990 rows omitted. See ?print.marginaleffects --- &#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)  996.4 Mississippi  -11.426&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)  998.2 Quebec        -4.436&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled)  998.2 Mississippi  -11.427&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled) 1000.0 Quebec        -4.435&#xD;&#xA;##  treatment mean(chilled) - mean(nonchilled) 1000.0 Mississippi  -11.428&#xD;&#xA;##  Std. Error      z Pr(&amp;gt;|z|)    S  2.5 % 97.5 %&#xD;&#xA;##        2.75 -4.156  &amp;lt; 0.001 14.9 -16.81  -6.04&#xD;&#xA;##        3.97 -1.119  0.26334  1.9 -12.21   3.34&#xD;&#xA;##        2.76 -4.147  &amp;lt; 0.001 14.9 -16.83  -6.03&#xD;&#xA;##        3.98 -1.115  0.26467  1.9 -12.23   3.36&#xD;&#xA;##        2.76 -4.138  &amp;lt; 0.001 14.8 -16.84  -6.02&#xD;&#xA;## Columns: term, contrast, conc, type, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted &#xD;&#xA;## Type:  response&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This gives us the expected difference among the two smooths for a broad sequence of &lt;code&gt;conc&lt;/code&gt; values. It is extremely useful because it already takes into account any variation in intercepts or other effects where &lt;code&gt;treatment&lt;/code&gt; or &lt;code&gt;conc&lt;/code&gt; might show up in the model. Of course looking at a returned &lt;code&gt;tibble&lt;/code&gt; with 1,000 rows is not very helpful, so we can plot these differences instead:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_comparisons&lt;/span&gt;(model_1, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;datagrid&lt;/span&gt;(conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;treatment&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;conc&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_hline&lt;/span&gt;(yintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Estimated difference&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Difference between treatment levels&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       subtitle &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Chilled - nonchilled, per type&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/interpreting-gams/index_files/figure-html/unnamed-chunk-35-1.png&#34; alt=&#34;Plotting model comparisons using marginaleffects and mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;We can also ask questions such as &lt;em&gt;At what values of &lt;code&gt;conc&lt;/code&gt; does the nonlinear slope grow the fastest?&lt;/em&gt;. This kind of question is extremely useful in time series modeling, for example if we wanted to know when a population trend was increasing (or decreasing) the fastest. Supplying a custom function to the &lt;code&gt;comparisons()&lt;/code&gt; function achieves this for us:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;max_growth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(hi, lo, x) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dydx &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; (hi &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; lo) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1e-6&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dydx_max &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dydx)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x[dydx &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; dydx_max][1]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;comparisons&lt;/span&gt;(model_1,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;datagrid&lt;/span&gt;(conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;conc&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1e-6&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  vcov &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;treatment&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  comparison &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; max_growth)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;##  Term Contrast  treatment Estimate&#xD;&#xA;##  conc   +1e-06 nonchilled      157&#xD;&#xA;##  conc   +1e-06 chilled         151&#xD;&#xA;## &#xD;&#xA;## Columns: term, contrast, treatment, estimate &#xD;&#xA;## Type:  response&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we can see that, for both treatments, the slope of the nonlinear effect appears to be increasing most rapidly near values of &lt;code&gt;conc = 155&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Or we can ask &lt;em&gt;At what values of &lt;code&gt;conc&lt;/code&gt; does the slope differ significantly from zero?&lt;/em&gt;. By once again aggregating over &lt;code&gt;type&lt;/code&gt; and computing first derivatives across a range of &lt;code&gt;conc&lt;/code&gt; values, we can use the &lt;code&gt;hypotheses()&lt;/code&gt; function which, by default, asks if a quantity is significantly different from zero:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hypotheses&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;slopes&lt;/span&gt;(model_1,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;datagrid&lt;/span&gt;(conc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; conc_seq,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          treatment &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; unique),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;conc&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;conc&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;treatment&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(p.value &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.05&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;##  Term    Contrast  conc  treatment Estimate Std. Error    z Pr(&amp;gt;|z|)    S&#xD;&#xA;##  conc mean(dY/dX)  95.0 nonchilled  0.00809   0.000876 9.23   &amp;lt;0.001 65.0&#xD;&#xA;##  conc mean(dY/dX)  95.0 chilled     0.00647   0.000829 7.80   &amp;lt;0.001 47.2&#xD;&#xA;##  conc mean(dY/dX)  96.8 nonchilled  0.00809   0.000875 9.24   &amp;lt;0.001 65.1&#xD;&#xA;##  conc mean(dY/dX)  96.8 chilled     0.00647   0.000829 7.81   &amp;lt;0.001 47.3&#xD;&#xA;##  conc mean(dY/dX)  98.6 nonchilled  0.00808   0.000874 9.25   &amp;lt;0.001 65.2&#xD;&#xA;##     2.5 %  97.5 %&#xD;&#xA;##  6.37e-03 0.00980&#xD;&#xA;##  4.84e-03 0.00809&#xD;&#xA;##  6.37e-03 0.00980&#xD;&#xA;##  4.84e-03 0.00809&#xD;&#xA;##  6.37e-03 0.00980&#xD;&#xA;## --- 196 rows omitted. See ?print.marginaleffects --- &#xD;&#xA;##  conc mean(dY/dX) 278.2 nonchilled  0.00127   0.000503 2.53   0.0114 6.5&#xD;&#xA;##  conc mean(dY/dX) 280.0 nonchilled  0.00122   0.000511 2.39   0.0168 5.9&#xD;&#xA;##  conc mean(dY/dX) 281.8 nonchilled  0.00117   0.000521 2.25   0.0242 5.4&#xD;&#xA;##  conc mean(dY/dX) 283.6 nonchilled  0.00113   0.000535 2.10   0.0355 4.8&#xD;&#xA;##  conc mean(dY/dX) 285.4 nonchilled  0.00108   0.000547 1.97   0.0484 4.4&#xD;&#xA;##     2.5 %  97.5 %&#xD;&#xA;##  2.87e-04 0.00226&#xD;&#xA;##  2.21e-04 0.00222&#xD;&#xA;##  1.53e-04 0.00219&#xD;&#xA;##  7.67e-05 0.00218&#xD;&#xA;##  7.52e-06 0.00215&#xD;&#xA;## Columns: term, contrast, conc, treatment, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted &#xD;&#xA;## Type:  link&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sometimes we might want more specific hypotheses, and these are often readily achievable using {&lt;code&gt;marginaleffects&lt;/code&gt;}. See for example &#xA;&lt;a href=&#34;https://stats.stackexchange.com/questions/634907/get-unbiased-derivative-from-gam/643454#643454&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this post on Cross Validated looking into biases of slope estimates from GAMs&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;how-do-i-report-effects-from-gams-in-scientific-publications&#34;&gt;How do I report effects from GAMs in scientific publications?&#xA;  &lt;a href=&#34;#how-do-i-report-effects-from-gams-in-scientific-publications&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Hopefully that rundown gives you some helpful tools and tips to interrogate your GAMs. I haven&amp;rsquo;t dived into multidimensional smooths in this post, but in principle the workflow doesn&amp;rsquo;t need to change much. You just need to be specific about the types of comparisons you want to make and let {&lt;code&gt;marginaleffects&lt;/code&gt;} turn the inference crank. I&amp;rsquo;ll sum up by attempting to tackle another one of the most common questions I get asked about GAMs: how do I report these things? Here are a few points that I think are valuable for reporting nonlinear effects of GAMs in scientific communications:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Avoid reliance on &lt;em&gt;p&lt;/em&gt;-values and statistical significance. Discretizing these effects into some arbitrary binary classification does nothing but throw out valuable information&lt;/li&gt;&#xA;&lt;li&gt;Focus on how these effects influence expected change &lt;em&gt;on the scale of the outcome&lt;/em&gt;. We use GAMs and GLMs because we want to model real things in the world that aren&amp;rsquo;t Gaussian, so we use link functions that are often nonlinear. Interpreting effects on the scale of the linear predictor is hard for everyone&lt;/li&gt;&#xA;&lt;li&gt;Use simulations to understand what your model thinks is plausible, and fully describe (and justify) your simulation strategy&lt;/li&gt;&#xA;&lt;li&gt;Make comparisons against different models (i.e. polynomial, linear) to get a sense for how sensitive your conclusions are to the choice of functional form&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Thanks very much for your time!&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material for working with and interrogating GAMs&lt;/p&gt;&#xA;&lt;p&gt;Christensen, E. M., Simpson, G. L., &amp;amp; Ernest, S. M. (2019). &#xA;&lt;a href=&#34;https://royalsocietypublishing.org/doi/full/10.1098/rspb.2019.2269&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Established rodent community delays recovery of dominant competitor following experimental disturbance&lt;/a&gt;. &lt;em&gt;Proceedings of the Royal Society B&lt;/em&gt;, 286(1917), 20192269.&lt;/p&gt;&#xA;&lt;p&gt;Clark, N. J., Ernest, S. K. M., Senyondo, H., Simonis, J. L., White, E. P., Yennis, G. M., &amp;amp; Karunarathna, K. A. N. K. (2023). &#xA;&lt;a href=&#34;https://ecoevorxiv.org/repository/view/5143/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Multi-species dependencies improve forecasts of population dynamics in a long-term monitoring study&lt;/a&gt;. &lt;em&gt;Biorxiv&lt;/em&gt;, doi: &#xA;&lt;a href=&#34;https://doi.org/10.32942/X2TS34&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://doi.org/10.32942/X2TS34&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Karunarathna, K. A. N. K., Wells, K., &amp;amp; Clark, N. J. (2024). &#xA;&lt;a href=&#34;https://www.sciencedirect.com/science/article/pii/S0304380024000371&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modelling nonlinear responses of a desert rodent species to environmental change with hierarchical dynamic generalized additive models&lt;/a&gt;. &lt;em&gt;Ecological Modelling&lt;/em&gt;, 490, 110648.&lt;/p&gt;&#xA;&lt;p&gt;Pedersen, E. J., Miller, D. L., Simpson, G. L., &amp;amp; Ross, N. (2019). &#xA;&lt;a href=&#34;https://peerj.com/articles/6876/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hierarchical generalized additive models in ecology: an introduction with mgcv&lt;/a&gt;. &lt;em&gt;PeerJ&lt;/em&gt;, 7, e6876.&lt;/p&gt;&#xA;&lt;p&gt;Ross, N. (2019). &#xA;&lt;a href=&#34;https://noamross.github.io/gams-in-r-course/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GAMs in R: a free interactive course using mgcv&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Simpson, G. L. (2018). &#xA;&lt;a href=&#34;https://www.frontiersin.org/articles/10.3389/fevo.2018.00149/full&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modelling palaeoecological time series using generalised additive models&lt;/a&gt;. &lt;em&gt;Frontiers in Ecology and Evolution&lt;/em&gt;, 6, 149.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Simulating data for model exploration in R</title>
  <link>https://ecogambler.netlify.app/blog/simulating-data-r/</link>
  <pubDate>Tue, 12 Mar 2024 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/simulating-data-r/</guid>
  <description>&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;purpose&#34;&gt;Purpose&#xA;  &lt;a href=&#34;#purpose&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following passage is quoted directly from &lt;em&gt;Regression and other stories&lt;/em&gt; (Gelman, Hill and Vehtari 2022). &amp;ldquo;Simulation of random variables is important in applied statistics for several reasons. First, we use probability models to mimic variation in the world, and the tools of simulation can help us better understand how this variation plays out. Patterns of randomness are notoriously contrary to normal human thinking—our brains don’t seem to be able to do a good job understanding that random swings will be present in the short term but average out in the long run—and in many cases simulation is a big help in training our intuitions about averages and variation. Second, we can use simulation to approximate the sampling distribution of data and propagate this to the sampling distribution of statistical estimates and procedures. Third, regression models are not deterministic; they produce probabilistic predictions. Simulation is the most convenient and general way to represent uncertainties in forecasts&amp;rdquo;&lt;/p&gt;&#xA;&lt;p&gt;This script walks through some potential uses of simulation, but it is by no means exhaustive. First, generate some nice plotting colours&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_light &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#DCBCBC&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_light_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#C79999&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_mid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_mid_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_dark &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F2727&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_dark_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#7C0000&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next we define a few helper functions for making nice plots&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;myhist &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  xlim,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;missing&lt;/span&gt;(xlim)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(x)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(x, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; xlim,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; xlab,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; main)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;myscatter &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     y, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; x, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.25&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; xlab,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ylab)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; x, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_dark,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mypred_plot &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(predictions, pred_values,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       ylim,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Predictions&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Covariate&amp;#39;&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.7&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.95&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sapply&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(predictions),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(n) &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(predictions[n,],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; probs, na.rm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;missing&lt;/span&gt;(ylim)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(cred)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;n&amp;#34;&lt;/span&gt;, bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; xlab,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ylab,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(pred_values),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ylim)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_values, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_values)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[1,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[9,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_light, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_values, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_values)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[2,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[8,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_light_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_values, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_values)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[3,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[7,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_values, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_values)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[4,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[6,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(pred_values, cred[5,], col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_dark, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;simulating-a-simple-linear-regression&#34;&gt;Simulating a simple linear regression&#xA;  &lt;a href=&#34;#simulating-a-simple-linear-regression&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;A linear regression generally assumes additive, linear effects of predictors on the mean of a response variable. It also assumes the errors (unexplained variation) are independent and identically distributed (i.e. the same variance / sd) applies to  the full distribution of errors. We will simulate a vegetation cover outcome variable under the following model:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\boldsymbol{vegetation}\sim \text{Normal}(\mu,\sigma)$$&lt;/code&gt;&#xA;A linear predictor is modeled on the &lt;code&gt;\(identity\)&lt;/code&gt; scale to capture effects of covariates on &lt;code&gt;\(\mu\)&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\mu=\alpha+{\beta_{temp}}*\boldsymbol{temperature}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;We simulate data with a single predictor, &lt;code&gt;\(temperature\)&lt;/code&gt;, and with varying sample sizes to inspect the influence of sample size on our inferences. Start with a sample size of &lt;code&gt;300&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;300&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;First we will simulate the predictor variable, &lt;code&gt;\(temperature\)&lt;/code&gt;. Our first decision is to think about what distribution the predictor might have. For many modelling approaches, it is often useful to transform continuous predictors so they are standard normal in distribution (i.e. &lt;code&gt;\(\boldsymbol{temperature}\sim \text{Normal}(0,1)\)&lt;/code&gt;). This might be the case if we were to measure temperature and then standardise it to unit variance&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1971&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temperature_raw &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;14&lt;/span&gt;, sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(temperature_raw, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Raw temperature&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;It is often useful to standardize variables to unit variance before modelling; this helps us to compare effects from different predictors but also helps to specify useful prior distributions when fitting Bayesian models. This is most commonly done by shifting the mean to &lt;code&gt;0&lt;/code&gt; and dividing by &lt;code&gt;1sd&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temperature_scaled &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; (temperature_raw &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(temperature_raw)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(temperature_scaled, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Scaled temperature&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This shifts the distribution but it does not change the properties of the variable&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myscatter&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_raw,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_scaled,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Raw temperature&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Scaled temperature&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Now simulate the actual linear effect of &lt;code&gt;\(temperature\)&lt;/code&gt; on the mean of our outcome, &lt;code&gt;\(vegetation\)&lt;/code&gt;. This is captured by the coefficient &lt;code&gt;\({\beta_{temp}}\)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_temp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next we need to simulate the intercept &lt;code&gt;\(\alpha\)&lt;/code&gt;. This parameter represents the average vegetation when temperature is at &lt;code&gt;0&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The other parameter we need to simulate is the standard deviation of the errors &lt;code&gt;\(\sigma\)&lt;/code&gt;; we don&amp;rsquo;t expect that temperature is the only mechanism influencing vegetation, so we need to include unexplained variation&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Finally, we have the components to simulate our outcome variable, &lt;code&gt;\(vegetation\)&lt;/code&gt;. Simulate the linear predictor, which is &lt;code&gt;\(\mu=\alpha+{\beta_{temp}}*\boldsymbol{temperature}\)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; beta_temp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature_raw&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(mu, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(mu))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Next, complete the probabilistic data generation by simulating the observations. Here we assume vegetation is normally distributed, so we use the random number generator &lt;code&gt;rnorm()&lt;/code&gt;. Use &lt;code&gt;?rnorm&lt;/code&gt; to learn more about normal distribution functions in &lt;code&gt;R&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mu, sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(vegetation, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Vegetation&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There should be an obvious positive relationship between raw &lt;code&gt;\(temperature\)&lt;/code&gt; and &lt;code&gt;\(vegetation\)&lt;/code&gt;; but it also shouldn&amp;rsquo;t be a perfect 1:1 relationship&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myscatter&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_raw, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Raw temperature&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Vegetation&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;We can now estimate the effect of temperature on the mean of vegetation using the &lt;code&gt;lm()&lt;/code&gt; function in &lt;code&gt;R&lt;/code&gt;. This function uses iteratively reweighted least squares to estimate model parameters in a maximum likelihood framework. But we will use the scaled version of temperature to showcase how this gives us coefficients that we can still interpret&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;veg_mod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lm&lt;/span&gt;(vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; temperature_scaled)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(veg_mod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Call:&#xD;&#xA;## lm(formula = vegetation ~ temperature_scaled)&#xD;&#xA;## &#xD;&#xA;## Residuals:&#xD;&#xA;##     Min      1Q  Median      3Q     Max &#xD;&#xA;## -4.3773 -1.4182 -0.0611  1.2073  5.6760 &#xD;&#xA;## &#xD;&#xA;## Coefficients:&#xD;&#xA;##                    Estimate Std. Error t value Pr(&amp;gt;|t|)    &#xD;&#xA;## (Intercept)          4.6737     0.1168   40.01   &amp;lt;2e-16 ***&#xD;&#xA;## temperature_scaled   1.2222     0.1170   10.45   &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Residual standard error: 2.023 on 298 degrees of freedom&#xD;&#xA;## Multiple R-squared:  0.268,&#x9;Adjusted R-squared:  0.2655 &#xD;&#xA;## F-statistic: 109.1 on 1 and 298 DF,  p-value: &amp;lt; 2.2e-16&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The coefficients are harder to interpret now because we scaled the predictor&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(veg_mod) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##        (Intercept) temperature_scaled &#xD;&#xA;##           4.673721           1.222223&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Compare these estimates to the true values&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cbind&lt;/span&gt;(alpha, beta_temp)[1,]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##     alpha beta_temp &#xD;&#xA;##      1.00      0.25&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Both of these coefficients need to be interpreted by taking into account the standard deviation of the predictor variable, &lt;code&gt;\(vegetation\)&lt;/code&gt;. Once we back-transform, we can see the point estimates are very close to the true simulated values. This is a useful first check to ensure the model is able to recover simulated parameters. It is always surprising how often a model is not able to recover these when we simulate, especially for more complex models / simulations&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(veg_mod) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##        (Intercept) temperature_scaled &#xD;&#xA;##          0.9237536          0.2415704&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We can also calculate uncertainties of these coefficients, again on the appropriate scale&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;confint&lt;/span&gt;(veg_mod) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##                        2.5 %    97.5 %&#xD;&#xA;## (Intercept)        0.8783128 0.9691943&#xD;&#xA;## temperature_scaled 0.1960538 0.2870871&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally, for most maximum likelihood models in &lt;code&gt;R&lt;/code&gt; (&lt;code&gt;lm&lt;/code&gt;, &lt;code&gt;glm&lt;/code&gt;, &lt;code&gt;gam&lt;/code&gt; etc&amp;hellip;.) we can draw samples of regression coefficients from the implied posterior distribution. Maximum likelihood finds the posterior mode and then uses gradients around the mode to approximate the posterior with a Gaussian (Normal) distribution. So the posterior of coefficients is always multivariate normal. All we need to generate samples from this posterior is the variance-covariance matrix and the mean coefficients&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mean_coefs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(veg_mod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coef_vcv &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;vcov&lt;/span&gt;(veg_mod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Generate 2,000 regression coefficient samples from the implied multivariate normal posterior distribution. We can use the &lt;code&gt;mvrnorm()&lt;/code&gt; function from the &lt;code&gt;MASS&lt;/code&gt; package to make this simple&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;require&lt;/span&gt;(MASS)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;install.packages&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;MASS&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Loading required package: MASS&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coef_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2000&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mean_coefs, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coef_vcv)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(coef_posterior)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##      (Intercept) temperature_scaled&#xD;&#xA;## [1,]    4.821914          1.2911135&#xD;&#xA;## [2,]    4.572132          1.2185941&#xD;&#xA;## [3,]    4.612218          1.4297919&#xD;&#xA;## [4,]    4.534363          1.3223695&#xD;&#xA;## [5,]    4.636644          1.3577525&#xD;&#xA;## [6,]    4.866013          0.9418046&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Instead of simply looking at confidence intervals of coefficients, we can now inspect the full distribution and overlay the true simulated value. Remember to adjust for the  scaling of the variable&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coef_posterior[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Posterior temp coefficient (unscaled)&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-20-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Prediction intervals can also be obtained once we have the posterior estimates. Predicting from models is a crucial step to understand them and interrogate their weaknesses. To make predictions, we usually must supply &lt;code&gt;newdata&lt;/code&gt; for predicting against. This would mean a new set of  temperature measurements, in our case. The best way to do this, depending  on model complexity, is to create a sequence of measurements for the variable of interest that we&amp;rsquo;d like predictions for. See &lt;code&gt;?predict.lm&lt;/code&gt; for more details&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newtemps &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(from &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(temperature_scaled),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                to &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(temperature_scaled),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(newtemps)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. &#xD;&#xA;## -3.26551 -1.61228  0.04094  0.04094  1.69416  3.34738&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Create an empty &lt;code&gt;matrix&lt;/code&gt; to store the predictions. We want to predict at these new &lt;code&gt;\(temperature\)&lt;/code&gt; values for each combination of posterior coefficients so we can visualise uncertainty in those predictions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;predictions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(coef_posterior),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(newtemps))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(predictions)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 1000 2000&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now fill the matrix with the predicted mean for each of the new &lt;code&gt;\(temperature\)&lt;/code&gt; measurements, using each posterior draw of regression coefficients&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(predictions)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  predictions[,i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; coef_posterior[i,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; (coef_posterior[i,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; newtemps)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot empirical quantile ribbons of the predictions to visualise them, and overlay the simulated values as points&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mypred_plot&lt;/span&gt;(predictions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; predictions,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Temperature (scaled)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Vegetation (expectation only)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            pred_values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newtemps,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(predictions, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;)))))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_scaled, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_scaled, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-24-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The uncertainty about this line seems far too narrow, and that&amp;rsquo;s because it is! We have ignored the stochastic component, which is the normally distributed errors. This means we have only predicted the mean, otherwise known as the expectation. But we can easily compute full probabilistic predictions and re-plot. All we need is the sd estimate for &lt;code&gt;\(\sigma\)&lt;/code&gt;, which is stored as &lt;code&gt;sigma&lt;/code&gt; in the model. This estimate is extremely close to our true simulated value&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sigma_estimate &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(veg_mod)&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;sigma&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sigma_estimate; sigma&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 2.023472&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 2&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now compute predictions using normal random draws with appropriate probabilistic uncertainty&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;predictions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(coef_posterior),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(newtemps))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(predictions)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  predictions[,i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(predictions),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coef_posterior[i,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; (coef_posterior[i,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; newtemps),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma_estimate)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the full prediction distribution&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mypred_plot&lt;/span&gt;(predictions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; predictions,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Temperature (scaled)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Vegetation (full uncertainty)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            pred_values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newtemps,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(predictions, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;)))))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_scaled, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_scaled, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-27-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This model fits the data very well, with good coverage properties of the prediction uncertainties. But what happens if we decrease the sample size to &lt;code&gt;10&lt;/code&gt; and run the process again?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temperature_raw &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;14&lt;/span&gt;, sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temperature_scaled &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; (temperature_raw &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(temperature_raw)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; beta_temp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature_raw&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mu, sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;veg_mod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lm&lt;/span&gt;(vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; temperature_scaled)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mean_coefs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(veg_mod); coef_vcv &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;vcov&lt;/span&gt;(veg_mod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coef_posterior_new &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2000&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mean_coefs, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coef_vcv)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot posterior estimates from both simulations, but use the same &lt;code&gt;x-axis&lt;/code&gt; limits so the distributions can be compared&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coef_posterior[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coef_posterior[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    coef_posterior_new[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw))),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;N = 300&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coef_posterior_new[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coef_posterior[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      coef_posterior_new[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sd&lt;/span&gt;(temperature_raw))),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Posterior temp coefficient (unscaled)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;N = 30&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-29-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;How does this wider uncertainty translate into the predictions?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sigma_estimate &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(veg_mod)&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;sigma&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;predictions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(coef_posterior_new),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(newtemps))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(predictions)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  predictions[,i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(predictions),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coef_posterior_new[i,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; (coef_posterior_new[i,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; newtemps),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sigma_estimate)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mypred_plot&lt;/span&gt;(predictions &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; predictions,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Temperature (scaled)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Vegetation (full uncertainty)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            pred_values &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newtemps,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(predictions, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.025&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.975&lt;/span&gt;)))))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_scaled, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature_scaled, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       cex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-30-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Changing sample size is just one way to get a feel for how challenging some modelling problems can be to tackle. You can also change &lt;code&gt;\(\sigma\)&lt;/code&gt;, the &lt;code&gt;\({\beta_{temp}}\)&lt;/code&gt; coefficient, and / or the &lt;code&gt;\(\alpha\)&lt;/code&gt; coefficient to understand what those changes might mean&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;inspecting-confounding-and-its-influence-on-causal-inferences&#34;&gt;Inspecting confounding and its influence on causal inferences&#xA;  &lt;a href=&#34;#inspecting-confounding-and-its-influence-on-causal-inferences&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;In this next example, we will simulate a data-generating process that has a strong confounder (in the form of a collider). This will illustrate how wrong our conclusions can be if we simply throw all variables into a regression and interpret them as real risk factors / causal effects. We will use a similar approach as above, where the goal is to model &lt;code&gt;\(vegetation\)&lt;/code&gt; density&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;11155&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;\(temperature\)&lt;/code&gt; again is our main predictor of interest. This time we&amp;rsquo;ll ignore the scaling and just run with the scaled version for simplicity&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(N, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;\(temperature\)&lt;/code&gt; again has a strong positive, linear effect on &lt;code&gt;\(vegetation\)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_temp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(N, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myscatter&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Temperature&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Vegetation&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-33-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;But this time, &lt;code&gt;\(temperature\)&lt;/code&gt; also influences &lt;code&gt;\(pollinator density\)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_temp_pollinators &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And &lt;code&gt;\(vegetation\)&lt;/code&gt;, our outcome of interest, equally influences &lt;code&gt;\(pollinator density\)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_veg_pollinators &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The problem here is that pollinators now exists as a collider variable; both our outcome of interest and one of our predictors influences this variable. This is an all-too-common issue we are faced with in regressin modelling&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pollinators &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(N, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_temp_pollinators &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       beta_veg_pollinators &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There are now strong apparent relationships all around&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myscatter&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; temperature,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pollinators,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Temperature&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Pollinators&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myscatter&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; vegetation,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pollinators,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Vegetation&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Pollinators&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-37-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If we thought that pollinator density could be a reasonable predictor of vegetation, the standard approach we would often take would be to fit univariate models for each of our predictors and then choose which ones to include in a final model based on some arbitrary significance threshold. Let&amp;rsquo;s see what happens if we do this&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;temp_only &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lm&lt;/span&gt;(vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; temperature)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(temp_only)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Call:&#xD;&#xA;## lm(formula = vegetation ~ temperature)&#xD;&#xA;## &#xD;&#xA;## Residuals:&#xD;&#xA;##      Min       1Q   Median       3Q      Max &#xD;&#xA;## -2.44451 -0.69136  0.03974  0.65918  2.26335 &#xD;&#xA;## &#xD;&#xA;## Coefficients:&#xD;&#xA;##             Estimate Std. Error t value Pr(&amp;gt;|t|)    &#xD;&#xA;## (Intercept) -0.14338    0.09937  -1.443    0.152    &#xD;&#xA;## temperature  0.79203    0.09952   7.959 3.11e-12 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Residual standard error: 0.9885 on 98 degrees of freedom&#xD;&#xA;## Multiple R-squared:  0.3926,&#x9;Adjusted R-squared:  0.3864 &#xD;&#xA;## F-statistic: 63.34 on 1 and 98 DF,  p-value: 3.106e-12&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;veg_only &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lm&lt;/span&gt;(vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; pollinators)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(veg_only)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Call:&#xD;&#xA;## lm(formula = vegetation ~ pollinators)&#xD;&#xA;## &#xD;&#xA;## Residuals:&#xD;&#xA;##      Min       1Q   Median       3Q      Max &#xD;&#xA;## -1.94531 -0.57399 -0.06453  0.57038  1.91163 &#xD;&#xA;## &#xD;&#xA;## Coefficients:&#xD;&#xA;##             Estimate Std. Error t value Pr(&amp;gt;|t|)    &#xD;&#xA;## (Intercept) -0.15133    0.08499  -1.781   0.0781 .  &#xD;&#xA;## pollinators  0.53784    0.04864  11.057   &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Residual standard error: 0.846 on 98 degrees of freedom&#xD;&#xA;## Multiple R-squared:  0.555,&#x9;Adjusted R-squared:  0.5505 &#xD;&#xA;## F-statistic: 122.2 on 1 and 98 DF,  p-value: &amp;lt; 2.2e-16&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Both predictors are found to be significant in univariate models; the standard approach we are taught now is to include them both in a final multivariable model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;final_mod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lm&lt;/span&gt;(vegetation &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; temperature &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; pollinators)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(final_mod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Call:&#xD;&#xA;## lm(formula = vegetation ~ temperature + pollinators)&#xD;&#xA;## &#xD;&#xA;## Residuals:&#xD;&#xA;##     Min      1Q  Median      3Q     Max &#xD;&#xA;## -1.8385 -0.5926 -0.0930  0.5014  1.8816 &#xD;&#xA;## &#xD;&#xA;## Coefficients:&#xD;&#xA;##             Estimate Std. Error t value Pr(&amp;gt;|t|)    &#xD;&#xA;## (Intercept) -0.15736    0.08454  -1.861   0.0657 .  &#xD;&#xA;## temperature  0.19296    0.12839   1.503   0.1361    &#xD;&#xA;## pollinators  0.45497    0.07333   6.205 1.35e-08 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Residual standard error: 0.8407 on 97 degrees of freedom&#xD;&#xA;## Multiple R-squared:  0.5652,&#x9;Adjusted R-squared:  0.5562 &#xD;&#xA;## F-statistic: 63.04 on 2 and 97 DF,  p-value: &amp;lt; 2.2e-16&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This model is supported by &lt;code&gt;AIC&lt;/code&gt; over the simpler models. The lower the &lt;code&gt;AIC&lt;/code&gt;, the better are the penalized in-sample predictions from the model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;full model better&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;temp only better&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;veg only better&amp;#39;&lt;/span&gt;)&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[which.min&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;AIC&lt;/span&gt;(final_mod),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                 &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;AIC&lt;/span&gt;(temp_only),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                 &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;AIC&lt;/span&gt;(veg_only)))]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] &amp;#34;full model better&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A type II &lt;code&gt;ANOVA&lt;/code&gt; reveals that if we wanted the most parsimonious model, we&amp;rsquo;d be justified in dropping &lt;code&gt;\(temperature\)&lt;/code&gt; (even though this is the effect we actually care about!)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;drop1&lt;/span&gt;(final_mod, test &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;F&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Single term deletions&#xD;&#xA;## &#xD;&#xA;## Model:&#xD;&#xA;## vegetation ~ temperature + pollinators&#xD;&#xA;##             Df Sum of Sq    RSS     AIC F value    Pr(&amp;gt;F)    &#xD;&#xA;## &amp;lt;none&amp;gt;                   68.551 -31.759                      &#xD;&#xA;## temperature  1    1.5962 70.147 -31.457  2.2586    0.1361    &#xD;&#xA;## pollinators  1   27.2062 95.757  -0.335 38.4969 1.349e-08 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In fact, just about any model selection routine you use on these data will favour the multivariable model (stepwise selection, ridge regression, LASSO etc&amp;hellip;.). But why do these general model selection routines favour a model that discards &lt;code&gt;\(temperature\)&lt;/code&gt;. How does the estimated effect of temperature on vegetation resemble what we simulated as the actual truth?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;confint&lt;/span&gt;(final_mod)[2,]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##       2.5 %      97.5 % &#xD;&#xA;## -0.06186813  0.44778663&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_temp&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 0.75&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It misses. &lt;strong&gt;Badly&lt;/strong&gt;. This is because of the influence of collider bias. We must be very cautious when throwing all sorts of variables into models and assuming the resulting estimates can be interpreted in any meaningful way. The correct approach here would actually be to omit &lt;code&gt;\(pollinators\)&lt;/code&gt; altogether. This is better for inference, even though it doesn&amp;rsquo;t fit the data as well. We&amp;rsquo;ve already done that in our &lt;code&gt;temp_only&lt;/code&gt; model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;confint&lt;/span&gt;(temp_only)[2,]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##     2.5 %    97.5 % &#xD;&#xA;## 0.5945409 0.9895126&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_temp&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 0.75&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;effects-are-often-estimated-with-more-precision-when-including-other-predictors&#34;&gt;Effects are often estimated with more precision when including other predictors&#xA;  &lt;a href=&#34;#effects-are-often-estimated-with-more-precision-when-including-other-predictors&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Here we will explore why it is often important to adjust for other variables when estimating effects, even if those other variables are not &amp;ldquo;significant&amp;rdquo;. Simulate a scenario where age and season show independent effects on some disease&amp;rsquo;s infection probability&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5555&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;200&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Simulate &lt;code&gt;\(age\)&lt;/code&gt; as a log-normally distributed, positive continuous variable&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;age &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rlnorm&lt;/span&gt;(N)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(age, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Age&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-45-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Simulate a cyclic seasonal pattern to replicate what we often see with transmittable diseases, which is a fairly strong and consistent variation in risk across seasons. This type of simulation can be done with combinations of &lt;code&gt;sine&lt;/code&gt; and &lt;code&gt;cosine&lt;/code&gt; functions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;season_function &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;((&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sin&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cos&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sin&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;)[1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(season_function, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Seasonal effect&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-46-1.png&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&lt;p&gt;Convert season to a numeric indicator of month, just like we would use in a model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;season &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ceiling&lt;/span&gt;(N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;))[1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(season, &lt;span style=&#34;color:#099&#34;&gt;24&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##  [1]  1  2  3  4  5  6  7  8  9 10 11 12  1  2  3  4  5  6  7  8  9 10 11 12&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Calculate infection probability with an &lt;code&gt;\(age\)&lt;/code&gt; effect of &lt;code&gt;-0.4&lt;/code&gt; (on the log scale) and with a minor seasonal effect. We use the &lt;code&gt;plogis&lt;/code&gt; function, which uses the &lt;code&gt;inverse logit&lt;/code&gt; transformation to convert real-valued continuous variables to the probability scale. This is the same link function that is used in logistic regression (where the outcomes are &lt;code&gt;1s&lt;/code&gt; and &lt;code&gt;0s&lt;/code&gt;) and in Beta regression (where the outcome is a proportion on &lt;code&gt;(1,0)&lt;/code&gt;). We will use Beta regression here, which assumes the following:&#xA;&lt;code&gt;$$\boldsymbol{inf~prob}\sim \text{Beta}(logit^{-1}(\mu)*\phi,(1-logit^{-1}(\mu))*\phi)$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\mu={\alpha}+{\beta_{age}}*\boldsymbol{log(age)}+f(season)$$&lt;/code&gt;&#xA;Where &lt;code&gt;\(\phi\)&lt;/code&gt; is a shape parameter that controls the spread of the distribution. We can use &lt;code&gt;plogis&lt;/code&gt; to convert our simulated values from the real line to the probability scale (this is a fast and efficient version of &lt;code&gt;inverse logit&lt;/code&gt;)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_logage &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-0.4&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inf_prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plogis&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.3&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; season_function &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; beta_logage &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(age))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(inf_prob)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-48-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Fit a beta regression model that ignores season&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mgcv)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Loading required package: nlme&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## This is mgcv 1.8-42. For overview type &amp;#39;help(&amp;#34;mgcv-package&amp;#34;)&amp;#39;.&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_noseason &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(inf_prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(age),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;betar&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The estimate for &lt;code&gt;\(log(age)\)&lt;/code&gt; is fairly precise&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod_noseason)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: Beta regression(605.665) &#xD;&#xA;## Link function: logit &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## inf_prob ~ log(age)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##              Estimate Std. Error z value Pr(&amp;gt;|z|)    &#xD;&#xA;## (Intercept) -0.247234   0.005879  -42.05   &amp;lt;2e-16 ***&#xD;&#xA;## log(age)    -0.390477   0.006448  -60.56   &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.951   Deviance explained = 95.2%&#xD;&#xA;## -REML = -493.13  Scale est. = 1         n = 200&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Fit a model that includes only &lt;code&gt;\(season\)&lt;/code&gt;, which finds that this predictor is not statistically significant on its own. Again, the standard practice would be to drop this predictor when we proceed with a multivariable analysis&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_seasononly &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(inf_prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(season, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;cc&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;betar&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod_seasononly)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: Beta regression(29.583) &#xD;&#xA;## Link function: logit &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## inf_prob ~ s(season, bs = &amp;#34;cc&amp;#34;)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error z value Pr(&amp;gt;|z|)    &#xD;&#xA;## (Intercept) -0.24268    0.02574  -9.429   &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##                 edf Ref.df Chi.sq p-value&#xD;&#xA;## s(season) 0.0004364      8      0   0.607&#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  5.21e-08   Deviance explained = 0.000239%&#xD;&#xA;## -REML = -196.38  Scale est. = 1         n = 200&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Fit a model that includes both predictors&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_bothpredictors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(inf_prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(age) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(season, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;cc&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;betar&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The estimate for &lt;code&gt;log(age)&lt;/code&gt; also appears precise in this model, just like in the first model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod_bothpredictors)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: Beta regression(14453.538) &#xD;&#xA;## Link function: logit &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## inf_prob ~ log(age) + s(season, bs = &amp;#34;cc&amp;#34;)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##              Estimate Std. Error z value Pr(&amp;gt;|z|)    &#xD;&#xA;## (Intercept) -0.247699   0.001206  -205.5   &amp;lt;2e-16 ***&#xD;&#xA;## log(age)    -0.399987   0.001343  -297.9   &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##             edf Ref.df Chi.sq p-value    &#xD;&#xA;## s(season) 7.748      8   4518  &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.998   Deviance explained = 99.8%&#xD;&#xA;## -REML = -787.93  Scale est. = 1         n = 200&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;But which model gives us &lt;em&gt;better&lt;/em&gt; estimates for &lt;code&gt;log(age)&lt;/code&gt;? Draw 5,000 posterior estimates from each model&amp;rsquo;s posterior coefficient distribution. Because &lt;code&gt;gam()&lt;/code&gt; uses a form of maximum likelihood for estimation, the posterior once again is an implied multivariate Gaussian. The variance-covariance matrix for the coefficients is stored in the model object in the &lt;code&gt;Vc&lt;/code&gt; slot&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coefs_noseason &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5000&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(mod_noseason), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mod_noseason&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;Ve)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coefs_bothpredictors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5000&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(mod_bothpredictors), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mod_bothpredictors&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;Ve)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Calculate the continuous rank probability score (CRPS), a proper scoring rule for probabilistic predictions; a &lt;em&gt;lower&lt;/em&gt; score is better, as it indicates the probability density is more concentrated around the true value&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;require&lt;/span&gt;(scoringRules)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;install.packages&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;scoringRules&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Loading required package: scoringRules&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: package &amp;#39;scoringRules&amp;#39; was built under R version 4.3.2&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;score_noseason &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; scoringRules&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;crps_sample&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;score_bothpredictors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; scoringRules&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;crps_sample&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                              dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot estimates and print the CRPS for each model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Without seasonal adjustment; score = &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(score_noseason, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Posterior estimates for log(age)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;With seasonal adjustment; score = &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(score_bothpredictors, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-57-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here it is clear that &lt;em&gt;adjusting for important control variables, even if they aren&amp;rsquo;t &amp;ldquo;significant&amp;rdquo;, gives us better estimates of risk factors&lt;/em&gt;. What happens if we have binary outcomes as our dependent variable? This is often the case in disease surveillance. We can easily generate such data using another of &lt;code&gt;R&lt;/code&gt;&amp;rsquo;s random number generator functions. See &lt;code&gt;?rbinom&lt;/code&gt; for more details&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;infections &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbinom&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; inf_prob)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(infections, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Infection status&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-58-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Fit the same models as above, but this time use a Bernoulli observation model with logit link function. The full model we will fit is:&#xA;&lt;code&gt;$$\boldsymbol{infections}\sim \text{Bernoulli}(p)$$&lt;/code&gt;&#xA;&lt;code&gt;$$logit(p)={\alpha}+{\beta_{age}}*\boldsymbol{log(age)}+f(season)$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_noseason &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(infections &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(age),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;binomial&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod_noseason)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: binomial &#xD;&#xA;## Link function: logit &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## infections ~ log(age)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error z value Pr(&amp;gt;|z|)  &#xD;&#xA;## (Intercept)  -0.2423     0.1434  -1.689   0.0912 .&#xD;&#xA;## log(age)     -0.2517     0.1549  -1.625   0.1043  &#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.00824   Deviance explained = 0.98%&#xD;&#xA;## -REML = 137.81  Scale est. = 1         n = 200&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_seasononly &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(infections &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(season, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;cc&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;binomial&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod_seasononly)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: binomial &#xD;&#xA;## Link function: logit &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## infections ~ s(season, bs = &amp;#34;cc&amp;#34;)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error z value Pr(&amp;gt;|z|)  &#xD;&#xA;## (Intercept)  -0.2490     0.1449  -1.718   0.0858 .&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##            edf Ref.df Chi.sq p-value   &#xD;&#xA;## s(season) 1.95      8  8.352 0.00572 **&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.0423   Deviance explained =  3.8%&#xD;&#xA;## -REML = 135.62  Scale est. = 1         n = 200&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_bothpredictors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(infections &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(age) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(season, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;cc&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;binomial&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod_bothpredictors)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: binomial &#xD;&#xA;## Link function: logit &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## infections ~ log(age) + s(season, bs = &amp;#34;cc&amp;#34;)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error z value Pr(&amp;gt;|z|)  &#xD;&#xA;## (Intercept)  -0.2506     0.1461  -1.715   0.0863 .&#xD;&#xA;## log(age)     -0.2722     0.1594  -1.708   0.0877 .&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##             edf Ref.df Chi.sq p-value   &#xD;&#xA;## s(season) 1.985      8  8.743 0.00475 **&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.0512   Deviance explained = 4.93%&#xD;&#xA;## -REML = 135.02  Scale est. = 1         n = 200&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coefs_noseason &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5000&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(mod_noseason), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mod_noseason&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;Ve)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coefs_bothpredictors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5000&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(mod_bothpredictors), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mod_bothpredictors&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;Ve)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;score_noseason &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; scoringRules&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;crps_sample&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;score_bothpredictors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; scoringRules&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;crps_sample&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                              dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot estimates and print the CRPS for each model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Without seasonal adjustment; score = &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(score_noseason, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Posterior estimates for log(age)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coefs_noseason[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], coefs_bothpredictors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;With seasonal adjustment; score = &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(score_bothpredictors, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_logage, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-64-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this case it doesn&amp;rsquo;t make much difference whether we adjust for &lt;code&gt;\(season\)&lt;/code&gt; or not when estimating effect of &lt;code&gt;log(age)&lt;/code&gt;. This is because binary data has much less information than the proportional data we were using in the Beta regression. We&amp;rsquo;d need to boos our sample size to have a better chance of adequately estimating these effects with a logistic regression. This is another advantage of simulation, as it allows us to get a better sense of the limitations of our sampling designs&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;failing-to-account-for-unobserved-autocorrelation-causes-problems&#34;&gt;Failing to account for unobserved autocorrelation causes problems&#xA;  &lt;a href=&#34;#failing-to-account-for-unobserved-autocorrelation-causes-problems&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;In this final example, we will simulate a time series of counts that has autocorrelation in the underlying data-generating process. It is useful to get a sense of how models perform when we fail to take this autocorrelation into account. First we simulate the underlying autocorrelated trend, which follows an AR1 model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;arima.sim&lt;/span&gt;(model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(ar &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.7&lt;/span&gt;), n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myscatter&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; trend, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Trend&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(trend, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_dark, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-65-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Next we simulate our covariate, &lt;code&gt;\(rainfall\)&lt;/code&gt;, and it&amp;rsquo;s linear additive coefficient&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rainfall &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(N)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_rain &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Finally, we can simulate the counts. In this case, counts follow a Poisson observation process. Poisson regression that assumes the underlying mean evolves on the log scale:&#xA;&lt;code&gt;$$\boldsymbol{Counts}\sim \text{Poisson}(\lambda)$$&lt;/code&gt;&#xA;&lt;code&gt;$$log(\lambda)={\alpha}+{\beta_{rainfall}}*\boldsymbol{rainfall}+trend$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;In this example, the linear predictor, &lt;code&gt;\(log(\lambda)\)&lt;/code&gt; (referred to here as &lt;code&gt;\(\mu\)&lt;/code&gt;), captures the additive effects of the intercept &lt;code&gt;\(\alpha\)&lt;/code&gt;, the effect of &lt;code&gt;\(rainfall\)&lt;/code&gt; and the underlying trend on the the log of the mean for &lt;code&gt;\(counts\)&lt;/code&gt;. See &lt;code&gt;?rpois&lt;/code&gt; for more information about the Poisson distribution functions in &lt;code&gt;R&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; beta_rain &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; rainfall &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; trend&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;counts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rpois&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(mu))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the counts over time&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myscatter&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; counts, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Counts&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(counts, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_dark, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-68-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;When working with time series, it is always useful to understand whether there is any autocorrelation in the observations. This can be checked using the &lt;code&gt;acf()&lt;/code&gt; function&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;acf&lt;/span&gt;(counts)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-69-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This doesn&amp;rsquo;t give us too much concern, and many people would use the fact that none of the lags shows too much autocorrelation as evidence that they do not need to account for this in their models. But what happens when we ignore time in our models?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_notime &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(counts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; rainfall,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;acf&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;residuals&lt;/span&gt;(mod_notime))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-70-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There is some apparent autocorrelation left in the residuals. This means our model&amp;rsquo;s errors are not independent, which is a violation of the model&amp;rsquo;s assumptions. This can lead to overly precise standard errors and overconfident &lt;code&gt;p-values&lt;/code&gt;. But it can also lead to downright absurd estimates for our predictors. Let&amp;rsquo;s compare estimates of the &lt;code&gt;\(rainfall\)&lt;/code&gt; coefficient from this model with a model that does attempt to capture the effect of time. This is done using a flexible smoothing spline for time&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod_time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(counts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; rainfall &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As before, we can compare the accuracies of our posterior estimates of the &lt;code&gt;\(rainfall\)&lt;/code&gt; coefficient using probabilistic scoring rules&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coefs_notime&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5000&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(mod_notime), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mod_notime&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;Ve)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coefs_time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;5000&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(mod_time), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mod_time&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;Ve)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;score_notime &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; scoringRules&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;crps_sample&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_rain,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(coefs_notime[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;score_time&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; scoringRules&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;crps_sample&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_rain, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                  dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(coefs_time[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(coefs_notime[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coefs_notime[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], coefs_time[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Without time adjustment; score = &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(score_notime, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_rain, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_rain, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;myhist&lt;/span&gt;(coefs_time[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(coefs_notime[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], coefs_time[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;With time adjustment; score = &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;round&lt;/span&gt;(score_time, &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_rain, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_rain, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-72-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The model with the temporal component does better in this case, giving us more accurate estimates of our coefficient of interest. How does the smoothing spline capture this temporal variation?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod_time, shade &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, shade.col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_dark_highlight,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/simulating-data-r/index_files/figure-html/unnamed-chunk-73-1.png&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&lt;p&gt;More examples will follow, but now that you have the building blocks of simulation of random variables and random sampling, you can simulate more complex generative models directly&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Using Stan for logistic regressions with detection error</title>
  <link>https://ecogambler.netlify.app/blog/stan-detection-error/</link>
  <pubDate>Sun, 10 Mar 2024 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/stan-detection-error/</guid>
  <description>&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;required-libraries&#34;&gt;Required libraries&#xA;  &lt;a href=&#34;#required-libraries&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;&lt;code&gt;cmdstanr&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;purpose-and-model-introduction&#34;&gt;Purpose and model introduction&#xA;  &lt;a href=&#34;#purpose-and-model-introduction&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This script simulates binary observations of an imperfectly observed data generating process (i.e. our measurements are made with error). It also provides &lt;code&gt;Stan&lt;/code&gt; code for estimating parameters of the model in a Bayesian framework. The true infection status &lt;code&gt;\(z\)&lt;/code&gt; is assumed to be drawn from a Bernoulli distribution with probability &lt;code&gt;\(p\)&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$z\sim \text{Bernoulli}(p)$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;A linear predictor is modeled on the &lt;code&gt;\(logit\)&lt;/code&gt; scale to capture effects of covariates on &lt;code&gt;\(p\)&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$logit(p)={\alpha} + {\beta}*\boldsymbol{X}$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;\(\alpha\)&lt;/code&gt; is the intercept representing average infection probability when all predictor variables are set to their means, and &lt;code&gt;\(\beta\)&lt;/code&gt; is the set of regression coefficients that describe associations between predictor variables in the model design matrix &lt;code&gt;\(\boldsymbol{X}\)&lt;/code&gt; and &lt;code&gt;\(logit(p)\)&lt;/code&gt;. Unfortunately, as is the case in most diagnostic test scenarios, our measurements are made with error. A classic example would be a Kato Katz faecal smear to detect eggs of soil-transmitted helminths. We know these tests are not perfect. It is easy to miss a parasite egg when the smear quality is low. Or when parasite eggs are not being shed. Or because eggs are damn small and hard to see. Assume &lt;code&gt;\(\hat{SN}\)&lt;/code&gt; is our test&amp;rsquo;s sensitivity (the proportion of subjects &lt;em&gt;with&lt;/em&gt; the condition that tend to have a &lt;em&gt;positive&lt;/em&gt; test) and &lt;code&gt;\(\hat{SP}\)&lt;/code&gt; is the test&amp;rsquo;s specificity (the proportion of subjects &lt;em&gt;without&lt;/em&gt; the condition that tend to have a &lt;em&gt;negative&lt;/em&gt; test). Observations &lt;code&gt;\(\boldsymbol{Y}\)&lt;/code&gt; are assumed to be conditional on the latent, unobserved true infection status &lt;code&gt;\(z\)&lt;/code&gt; through the following set of equations:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\boldsymbol{Y}\sim \text{Bernoulli}(\hat{SN}),~if~~z~= 1$$&lt;/code&gt;&#xA;&lt;code&gt;$$\boldsymbol{Y}\sim \text{Bernoulli}(1 - \hat{SP}),~if~~z~= 0$$&lt;/code&gt;&#xA;Ignoring this detection error is bad. It can bias our estimates and lead to incorrect inferences. But there are several challenges with estimating such a model. First, we often do not know with precision what the test&amp;rsquo;s specificity and sensitivity are. So we need to estimate them. The second issue is that the &lt;code&gt;\(z\)&lt;/code&gt; represent latent discrete parameters. We do not know what the true infection status is. We could try to sample it, but it turns out that &#xA;&lt;a href=&#34;https://mc-stan.org/docs/2_22/stan-users-guide/latent-discrete-chapter.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sampling these latent values is problematic for advanced MCMC routines such as &lt;code&gt;Stan&lt;/code&gt;&amp;rsquo;s Hamiltonian Monte Carlo algorithm&lt;/a&gt;. Other types of samplers (i.e. Gibbs or Metropolis Hastings, like those used in &lt;code&gt;JAGS&lt;/code&gt; or &lt;code&gt;BUGS&lt;/code&gt;) will allow latent discrete parameters, but they are not efficient. Fortunately, probability theory tells us how we can account for the possibility that the true status &lt;code&gt;\(z\)&lt;/code&gt; was either a &lt;code&gt;1&lt;/code&gt; or a &lt;code&gt;0&lt;/code&gt; using a &#xA;&lt;a href=&#34;https://towardsdatascience.com/probability-concepts-explained-marginalisation-2296846344fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;marginal likelihood&lt;/a&gt;. The unconditional probability of the observed infection status &lt;code&gt;\(\boldsymbol{Y}\)&lt;/code&gt; is the sum of the probability in each unknown state (truly infected or truly uninfected) times the chance of being in each unknown state. This actually leads to &lt;em&gt;better&lt;/em&gt; estimates because the expectation at all possible values is being used, rather than being estimated by sampling a latent discrete parameter.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;define-the-joint-probabilistic-model&#34;&gt;Define the joint probabilistic model&#xA;  &lt;a href=&#34;#define-the-joint-probabilistic-model&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;First we will define the &lt;code&gt;Stan&lt;/code&gt; model code for estimating parameters under the model outlined above. This code uses a logical flag to allow us to tell the sampler whether or not to account for detection error. This will be useful for investigating the consequences of model misspecification.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model_code &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;data {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  int&amp;lt;lower=0&amp;gt; N; // number of observations&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  int&amp;lt;lower=0&amp;gt; P; // number of (standardised) predictor variables&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  array[N] int&amp;lt;lower=0, upper=1&amp;gt; y; // binary infection observations&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  matrix[N, P] x; // predictor design matrix&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=-1,upper=1&amp;gt; sensitivity_prior; // inerpretable prior on sensitivity&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=-1,upper=1&amp;gt; specificity_prior; // inerpretable prior on specificity&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  int&amp;lt;lower=0,upper=1&amp;gt; estimate_accuracy; // logical (include detection error or not)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;transformed data {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Convert diagnostic hyperpriors into values to feed to the dirichlet&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=0&amp;gt; sens_hyp;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=0&amp;gt; spec_hyp;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=0&amp;gt; remainder_hyp;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  sens_hyp = 1 / exp(sensitivity_prior);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  spec_hyp = 1 / exp(specificity_prior);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  remainder_hyp = exp(sensitivity_prior) + exp(specificity_prior);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // QR decomposition to deal with (possibly) correlated predictor variables&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // https://betanalpha.github.io/assets/case_studies/qr_regression.html&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  matrix[N, P] Q_ast;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  matrix[P, P] R_ast;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  matrix[P, P] R_ast_inverse;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  Q_ast = qr_thin_Q(x) * sqrt(N - 1);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  R_ast = qr_thin_R(x) / sqrt(N - 1);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  R_ast_inverse = inverse(R_ast);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;parameters {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector[P] theta; // QR decomposed regression coefficients&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real alpha; // intercept coefficient&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector&amp;lt;lower=1&amp;gt;[3] theta_acc; // hyperprior for test accuracy&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  simplex[3] accuracy; // sum-to-1 constraint for misclassification error&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;transformed parameters {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // test sensitivity and specificity&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=0, upper=1&amp;gt; sens;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=0, upper=1&amp;gt; spec;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // set both to 1 if we don&amp;#39;t want to estimate detection error&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  if (estimate_accuracy)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;   sens = 1 - accuracy[1];&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  else&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;   sens = 1;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  if (estimate_accuracy)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;   spec = 1 - accuracy[2];&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  else&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;   spec = 1;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // linear predictor for the logistic regression; here we can also include&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // terms for spatial, temporal, and spatiotemporal effects; some examples found here:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // https://mc-stan.org/docs/stan-users-guide/fit-gp.html&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // https://betanalpha.github.io/assets/case_studies/gp_part1/part1.html#1_gaussian_processes&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // https://github.com/nicholasjclark/mvgam&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector[N] logit_z = alpha + Q_ast * theta;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;model {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // informative hyperpriors on 1 - sensitivity and 1 - specificity&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  theta_acc[1] ~ normal(sens_hyp, 0.25);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  theta_acc[2] ~ normal(spec_hyp, 0.25);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // hyperprior for sum-to-one constraint&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  theta_acc[3] ~ normal(remainder_hyp, 0.25);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  accuracy ~ dirichlet(theta_acc);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // priors for regression coefficients&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // we assume the disease is a bit rare, so use an appropriate&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // prior on the intercept alpha&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  alpha ~ normal(-0.75, 1);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  theta ~ std_normal();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // marginal Bernoulli likelihood&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // the unconditional probability of the observed infection status is the sum of the &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // probability in each unknown state (truly infected or truly uninfected)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // times the chance of being in each unknown state&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // for each observation, we calculate the probability that the &amp;#39;true&amp;#39; status was a 1 &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // and the probability that the &amp;#39;true&amp;#39; status was a 0. Summing these probabilities on &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // the log scale is the same as multiplying them on the untransformed scale; this&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // allows us to average over (i.e. marginalise out) the latent infection status&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  for (n in 1:N) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    target += log_sum_exp(bernoulli_lpmf(y[n] | sens) + bernoulli_logit_lpmf(1 | logit_z[n]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;                          bernoulli_lpmf(1 - y[n] | spec) + bernoulli_logit_lpmf(0 | logit_z[n]));&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;generated quantities {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector&amp;lt;lower=0, upper=1&amp;gt;[N] prob;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  array[N] int&amp;lt;lower=0, upper=1&amp;gt; ypred;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector[P] beta;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // compute predicted infection probabilities (i.e. posterior expectations)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // for each individual in the dataset&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  for (n in 1:N) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    prob[n] = softmax([bernoulli_lpmf(y[n] | sens) + bernoulli_logit_lpmf(1 | logit_z[n]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;                       bernoulli_lpmf(1 - y[n] | spec) + bernoulli_logit_lpmf(0 | logit_z[n])]&amp;#39;)[1];&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // compute predicted infection statuses (i.e. posterior predictions)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // for each individual in the dataset&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  ypred = bernoulli_rng(prob);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // compute the regression coefficients for the original&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // (back-transformed) predictor variables&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  beta = R_ast_inverse * theta;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There is a lot going on in this model. It accepts interpretable hyperprior information for the test diagnostics (more on that below). It also uses a &#xA;&lt;a href=&#34;https://betanalpha.github.io/assets/case_studies/qr_regression.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;QR decomposition to handle possible colinearity among predictors&lt;/a&gt;. And of course, it marginalises over discrete latent infection status. Details of each of these procedures are not the main aim of this tutorial, but please see the relevant hyperlinks for more information. Load &lt;code&gt;cmdstanr&lt;/code&gt; and compile the model to &lt;code&gt;C++&lt;/code&gt; code. See &#xA;&lt;a href=&#34;https://mc-stan.org/cmdstanr/articles/cmdstanr.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;information here for troubleshooting advice when installing &lt;code&gt;Stan&lt;/code&gt; and &lt;code&gt;Cmdstan&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(cmdstanr)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cmdstan_model&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;write_stan_file&lt;/span&gt;(model_code),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        stanc_options &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;canonicalize=deprecations,braces,parentheses&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;simulate-data&#34;&gt;Simulate data&#xA;  &lt;a href=&#34;#simulate-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Now that the model is defined in &lt;code&gt;Stan&lt;/code&gt; language, we need to simulate data to explore the model. Here we define a function to generate simulated binary outcomes with user-specific sensitivity and specificity. This function was modified from a very helpful &#xA;&lt;a href=&#34;https://discourse.mc-stan.org/t/logistic-regression-without-a-gold-standard-error-in-observed-classification/28644&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;Stan&lt;/code&gt; discourse post&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sim_det_error &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;200&lt;/span&gt;, &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# sample size&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt;, &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# intercept (on logit scale)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# number of predictors&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          sn &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.85&lt;/span&gt;, &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# sensitivity of test&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          sp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.7&lt;/span&gt;) &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# specificity of test&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# generate random predictors; note that predictors should be mean-centred&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# prior to modelling for the QR decomposition to be effective&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(n&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;p, mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)               &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(x, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; n, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; p)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colnames&lt;/span&gt;(x) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;predictor_&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;p)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# generate beta coefficients&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  c &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(p, mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# design matrix and linear predictor&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  x_design &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cbind&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, n), x)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  c_full &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(alpha, c)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  odds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rowSums&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sweep&lt;/span&gt;(x_design, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, c_full, FUN &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# convert linear predictor to the probability scale (logit link)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  pr &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; (&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt;odds))                      &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# generate true infection data&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  truth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbinom&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; n, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pr)         &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# generate observed data with imperfect detection&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;integer&lt;/span&gt;(n)                               &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt; ( i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;n ) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y[i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ifelse&lt;/span&gt;(truth[i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbinom&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sn), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbinom&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; sp))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;return&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; n,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              P &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; p,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; x,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              true_status &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; truth,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              true_sens &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sn,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              true_spec &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sp,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              true_alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; alpha,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              true_betas &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Simulate some data with two predictors. Here sensitivity ($\hat{SN}$) = &lt;code&gt;0.75&lt;/code&gt; and specificity ($\hat{SP}$) = &lt;code&gt;0.85&lt;/code&gt;. Again, sensitivity is a measure of how well a test can identify true positives and specificity is a measure of how well a test can identify true negatives. These values are not unreasonable given our knowledge of how difficult it can be to detect parasite eggs in faecal smears&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sim_det_error&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;250&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-0.85&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, sn &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;, sp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.85&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The true (latent) prevalence is&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_status) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_status)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 0.324&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The observed prevalence is&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sum&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;y) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;y)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 0.316&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Add interpretable &amp;lsquo;prior&amp;rsquo; information about test accuracy to the data, which will be used to structure the prior distributions for test sensitivity and specificity. Here, we use a scale of &lt;code&gt;-1 to 1&lt;/code&gt; to define any prior information we may have about performance of a diagnostic test. A score of &lt;code&gt;-1&lt;/code&gt; means we are fairly certain the test is bad (low accuracy). A score of &lt;code&gt;1&lt;/code&gt; implies we are fairly certain the test is good. A score of &lt;code&gt;0&lt;/code&gt; means we are uncertain. Let&amp;rsquo;s assume the test gives reasonable accuracy because it is a commercial diagnostic.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;sensitivity_prior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;specificity_prior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;fit-competing-models&#34;&gt;Fit competing models&#xA;  &lt;a href=&#34;#fit-competing-models&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;We can assess whether it is problematic to ignore detection error when fitting models. We&amp;rsquo;ll do this by starting with a basic logistic regression that ignores this error. To do this, we include a logical flag to tell the sampler not to include detection error&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;estimate_accuracy &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now condition the model on the observed data using &lt;code&gt;Stan&lt;/code&gt; with the &lt;code&gt;CmdStan&lt;/code&gt; backend&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit_noerror &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; mod&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sample&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  chains &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  parallel_chains &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  refresh &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next we fit an equivalent model that does estimate detection error (i.e. we change the logical flag for &lt;code&gt;estimate_accuracy&lt;/code&gt; from &lt;code&gt;0&lt;/code&gt; to &lt;code&gt;1&lt;/code&gt;)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;estimate_accuracy &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit_error &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; mod&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sample&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  chains &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  parallel_chains &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  refresh &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Inspect sampler and convergence diagnostics. Any warnings of divergences or low energy should be taken seriously and inspected further. Fortunately our models fit without issue&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit_noerror&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diagnostic_summary&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## $num_divergent&#xD;&#xA;## [1] 0 0 0 0&#xD;&#xA;## &#xD;&#xA;## $num_max_treedepth&#xD;&#xA;## [1] 0 0 0 0&#xD;&#xA;## &#xD;&#xA;## $ebfmi&#xD;&#xA;## [1] 0.9662539 1.0130262 0.9480790 0.9575079&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diagnostic_summary&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## $num_divergent&#xD;&#xA;## [1] 0 0 0 0&#xD;&#xA;## &#xD;&#xA;## $num_max_treedepth&#xD;&#xA;## [1] 0 0 0 0&#xD;&#xA;## &#xD;&#xA;## $ebfmi&#xD;&#xA;## [1] 0.9283966 0.8561576 0.8213387 0.8475217&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Compute the usual MCMC summaries, which show that the Hamiltonian Monte Carlo chains have converged nicely&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit_noerror&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;alpha&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;beta&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## # A tibble: 3 × 10&#xD;&#xA;##   variable   mean median    sd   mad     q5    q95  rhat ess_bulk ess_tail&#xD;&#xA;##   &amp;lt;chr&amp;gt;     &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&#xD;&#xA;## 1 alpha    -0.868 -0.865 0.142 0.143 -1.11  -0.640  1.00    4238.    2562.&#xD;&#xA;## 2 beta[1]   0.345  0.346 0.150 0.147  0.100  0.591  1.00    3803.    3122.&#xD;&#xA;## 3 beta[2]   0.389  0.388 0.148 0.150  0.149  0.634  1.00    4341.    2867.&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;alpha&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;beta&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;sens&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;spec&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## # A tibble: 5 × 10&#xD;&#xA;##   variable   mean median     sd    mad     q5     q95  rhat ess_bulk ess_tail&#xD;&#xA;##   &amp;lt;chr&amp;gt;     &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&#xD;&#xA;## 1 alpha    -1.18  -1.16  0.679  0.673  -2.34  -0.0840  1.00    2060.    2461.&#xD;&#xA;## 2 beta[1]   0.799  0.722 0.466  0.400   0.199  1.65    1.00    1893.    1484.&#xD;&#xA;## 3 beta[2]   0.814  0.759 0.403  0.375   0.262  1.55    1.00    1950.    1799.&#xD;&#xA;## 4 sens      0.721  0.720 0.152  0.181   0.474  0.962   1.00    1456.    1391.&#xD;&#xA;## 5 spec      0.848  0.844 0.0648 0.0674  0.747  0.965   1.00    1542.    1056.&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;inference&#34;&gt;Inference&#xA;  &lt;a href=&#34;#inference&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Visualising the estimated coefficients for each of the models will allow us to ask whether ignoring detection error leads to biased inferences. First, define some colours for nice plots&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_light &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#DCBCBC&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_light_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#C79999&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_mid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_mid_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_dark &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F2727&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_dark_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#7C0000&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the estimates for the intercept parameter &lt;code&gt;\(\alpha\)&lt;/code&gt; and overlay the true simulated value in black&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;alphas_noerror &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_noerror&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;alpha&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;alphas_error &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;alpha&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;par&lt;/span&gt;(mar &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(alphas_noerror,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;grey&amp;#39;&lt;/span&gt;, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(alphas_noerror, alphas_error)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(alphas_noerror, alphas_error)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(alphas_noerror, alphas_error)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;No detection error&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(alphas_error,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Detection error&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(alphas_noerror, alphas_error)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(alphas_noerror, alphas_error)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(alphas_noerror, alphas_error)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(alpha))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-detection-error/index_files/figure-html/unnamed-chunk-20-1.png&#34; alt=&#34;Histograms of intercept parameter estimates when considering or ignoring detection error.&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The detection error model seems to struggle estimating &lt;code&gt;\(\alpha\)&lt;/code&gt; with precision, though our estimates are centred around the true simulated value. This parameter is a bit difficult to interpret in detection error models, so we will get back to that later. But our inferences on the effects of covariates are what we are primarily interested in. Next plot the estimated &lt;code&gt;\(\beta\)&lt;/code&gt; coefficients for the two predictors, and again overlay the true simulated values in black&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;betas_noerror &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_noerror&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;beta&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;betas_error &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;beta&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, byrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;grey&amp;#39;&lt;/span&gt;, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;No detection error&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[1], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[1], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(betas_error[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Detection error&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(beta[1]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[1], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[1], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;grey&amp;#39;&lt;/span&gt;, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;No detection error&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[2], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[2], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(betas_error[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(betas_noerror[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;], betas_error[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Detection error&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(beta[2]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[2], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_betas[2], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-detection-error/index_files/figure-html/unnamed-chunk-21-1.png&#34; alt=&#34;Histograms of coefficient parameter estimates when considering or ignoring detection error.&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Here it is immediately clear why we should account for imperfect detection when possible. The detection error model gives better estimates for both coefficients. If we had to make decisions based on these parameters, and we did not account for detection error, our decisions would be wrong. Why is there large uncertainty in these estimates? To answer this, we need to plot the estimates for the test diagnostics&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;par&lt;/span&gt;(mar &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;posterior_sens &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;sens&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(posterior_sens,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Sensitivity&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_sens, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_sens, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;posterior_spec &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;spec&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(posterior_spec,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Specificity&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_spec, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_spec, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-detection-error/index_files/figure-html/unnamed-chunk-22-1.png&#34; alt=&#34;Recovering diagnostic sensitivity and specificity using detection error models.&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Further investigation helps to diagnose why &lt;code&gt;\(\alpha\)&lt;/code&gt; is difficult to identify for the detection error model.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;par&lt;/span&gt;(mar &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;posterior_sens &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;sens&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(alphas_error, posterior_sens,  xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Sensitivity&amp;#39;&lt;/span&gt;, bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_sens, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_sens, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;posterior_spec &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit_error&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;spec&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(alphas_error, posterior_spec,  xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(alpha), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Specificity&amp;#39;&lt;/span&gt;, bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_spec, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_spec, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;true_alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-detection-error/index_files/figure-html/unnamed-chunk-23-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There are fundamental posterior correlations induced between &lt;code&gt;\(\alpha\)&lt;/code&gt; and sensitivity and between &lt;code&gt;\(\alpha\)&lt;/code&gt; and specificity. This model cannot estimate sensitivity or specificity with much precision, resulting in wide estimates of &lt;code&gt;\(\alpha\)&lt;/code&gt;. There is nothing implicitly wrong here, these uncertainties simply reflect reality: We do not know the true infection status, and we do not know the true test performance. Without knowing these, how can we precisely estimate the average infection probability &lt;code&gt;\(\alpha\)&lt;/code&gt;? Stronger priors on diagnostic accuracies could help, but these uncertainties will not entirely go away without sampling many more individuals.&lt;/p&gt;&#xA;&lt;p&gt;A very useful question raised by &#xA;&lt;a href=&#34;https://researchers.uq.edu.au/researcher/1308&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;A/Prof Joerg Henning&lt;/a&gt; relates to translating what these results might mean for a practicing clinician. Often we want to know how likely it is that a person is truly infected if they&amp;rsquo;ve returned a positive diagnostic test. A famous (and very topical) problem in probability theory is the &#xA;&lt;a href=&#34;https://www.youtube.com/watch?v=4bD0recrwiw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;base rate fallacy&lt;/a&gt;. This occurs when we ignore the background rate (or prevalence of disease, in our case) when interpreting test results. No test is perfect, so they will sometimes return false positives. But if there are very few true positives in the population (because the disease is rare), this can mean that a high proportion of people testing positive are actually &lt;em&gt;uninfected&lt;/em&gt;. To quote from &#xA;&lt;a href=&#34;https://en.wikipedia.org/wiki/Base_rate_fallacy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;Wikipedia&lt;/code&gt;&lt;/a&gt;: &amp;ldquo;It is especially counter-intuitive when interpreting a positive result in a test on a low-prevalence population after having dealt with positive results drawn from a high-prevalence population. If the false positive rate of the test is higher than the proportion of the new population with the condition, then a test administrator whose experience has been drawn from testing in a high-prevalence population may conclude from experience that a positive test result usually indicates a positive subject, when in fact a false positive is far more likely to have occurred.&amp;rdquo;&lt;/p&gt;&#xA;&lt;p&gt;We can use sampling from our model&amp;rsquo;s joint posterior distribution to calculate the probability that someone returning a positive test is actually infected, which requires the following equation:&#xA;&lt;code&gt;$$Pr(true~infect|pos~test) = Pr(pos~test|true~infect) * Pr(infected) / &#xD; (Pr(pos~test|true~infect) * Pr(infect) + Pr(pos~test|true~uninfect) * Pr(uninfect))$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;For details of this derivation, please read &#xA;&lt;a href=&#34;https://www.lri.fr/~mbl/COVID19/bayes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt; and &#xA;&lt;a href=&#34;https://en.wikipedia.org/wiki/Base_rate_fallacy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt;).&lt;/p&gt;&#xA;&lt;p&gt;Because I&amp;rsquo;m no wizard in probability theory, I&amp;rsquo;ll use brute force sampling to calculate this quantity. First, create a sample sequence to generate many posterior simulations. We do this because we want many thousands of samples, but we only have &lt;code&gt;4000&lt;/code&gt; in our posterior.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N_samples &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;25000&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sample_seq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(posterior_sens), N_samples, replace &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next, sample latent (true) infection status for &lt;code&gt;25000&lt;/code&gt; individuals using the logistic regression equation estimated by our model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;true_inf &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N_samples, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;x))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N_samples){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  true_inf[i,] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbinom&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;x),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; boot&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;inv.logit&lt;/span&gt;(alphas_error[sample_seq[i]] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                  dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%*%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(betas_noerror[sample_seq[i],])))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sample observed test diagnostics given our model&amp;rsquo;s estimates for sensitivity and specificity&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;test_results &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N_samples, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;x))    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N_samples){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(j &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(test_results)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    test_results[i,j] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ifelse&lt;/span&gt;(true_inf[i,j] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbinom&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                       size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                       prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; posterior_sens[sample_seq[i]]), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rbinom&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                       size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                       prob &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; posterior_spec[sample_seq[i]]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we have all the samples we need to calculate relevant probabilistic quantities. Calculate the probability that an individual returns a positive test if they are actually infected. We would hope this value would be high, but that is not always the case&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly infected)` &amp;lt;- vector(length = N_samples)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;for(i in 1:N_samples){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly infected)`[i] = sum(test_results[i, which(true_inf[i,] == 1)]) / &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    length(which(true_inf[i,] == 1))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quantile(`&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly infected)`, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.9&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##       10%       25%       50%       75%       90% &#xD;&#xA;## 0.5000000 0.5967742 0.7241379 0.8529412 0.9428571&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Next calculate the probability that any individual in the population is infected (prevalence)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`Pr&lt;/span&gt;(infected)` &amp;lt;- vector(length = N_samples)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;for(i in 1:N_samples){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(infected)`[i] = sum(true_inf[i,]) / length(true_inf[i,])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quantile(`&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(infected)`, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.9&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##   10%   25%   50%   75%   90% &#xD;&#xA;## 0.124 0.180 0.256 0.348 0.440&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we need the probability of returning a positive test if someone is truly uninfected. We would hope this value would be quite low&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly uninfected)` &amp;lt;- vector(length = N_samples)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;for(i in 1:N_samples){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly uninfected)`[i] = sum(test_results[i, which(true_inf[i,] == 0)]) / &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    length(which(true_inf[i,] == 0))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quantile(`&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly uninfected)`, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.9&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##        10%        25%        50%        75%        90% &#xD;&#xA;## 0.05552764 0.10256410 0.15384615 0.20105820 0.24117647&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now the probability that any individual is uninfected, which is &lt;code&gt;1 - Pr(infected)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`Pr&lt;/span&gt;(uninfected)` &amp;lt;- vector(length = N_samples)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;for(i in 1:N_samples){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(uninfected)`[i] = 1 - `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(infected)`[i]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quantile(`&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(uninfected)`, probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.25&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.75&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.9&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##   10%   25%   50%   75%   90% &#xD;&#xA;## 0.560 0.652 0.744 0.820 0.876&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally, we can calculate our quantity of interest: the probability that an individual is actually infected if they return a positive test&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`Pr&lt;/span&gt;(truly infected&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;positive test)` &amp;lt;- vector(length = N_samples)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;for(i in 1:N_samples){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(truly infected&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;positive test)`[i] = `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly infected)`[i] * `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(infected)`[i] / &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (`&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly infected)`[i] * `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(infected)`[i] + &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(positive test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;truly uninfected)`[i] * `&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;Pr&lt;/span&gt;(uninfected)`[i])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;`Pr&lt;/span&gt;(truly infected&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;positive test)`,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Pr(truly infected|positive test)&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-detection-error/index_files/figure-html/unnamed-chunk-32-1.png&#34; alt=&#34;Estimating true disease burden using detection error models in Stan.&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;With imperfect tests and somewhat rare infections (~&lt;code&gt;30%&lt;/code&gt; in this example), we can&amp;rsquo;t be too sure that a positive test means a true infection. This all changes of course if we have other reasons to believe a person is infected. For example, if we only test people that show some symptoms, we are sampling a very different population compared to the full population of healthy and unhealthy individuals. Hopefully this example illustrates why simple logistic regressions are often not enough to tackle the questions we are interested in.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Phylogenetic smoothing using mgcv</title>
  <link>https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/</link>
  <pubDate>Sat, 24 Feb 2024 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/</guid>
  <description>&lt;p&gt;I have been highly interested in multivariate time series modeling for the last few years and have spent a lot of time working out how to use hierarchical GAMs to tackle many of the questions I&amp;rsquo;m interested in. As you may already know, GAMs afford us a huge amount of flexibility to address nonlinear associations in ecological models (&#xA;&lt;a href=&#34;https://peerj.com/articles/6876/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;see this paper by Pedersen et al for some more context&lt;/a&gt;). I have done quite a bit of work to extend these models to also capture complex dynamic processes, which are available in my &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mvgam&lt;/code&gt;&lt;/a&gt; R package.&lt;/p&gt;&#xA;&lt;p&gt;But I have recently become aware that it is possible to use phylogenetic or functional information to regularize these hierarchical functions. This works by taking advantage of the hugely flexible &lt;code&gt;mrf&lt;/code&gt; basis that is provided in &lt;code&gt;mgcv&lt;/code&gt; (see &lt;code&gt;?mgcv::mrf&lt;/code&gt; for details). This basis allows users to provide their own penalty matrices, which will act as a prior precision for the basis coefficients when estimating the model. By providing the right kind of penalty matrix, for example one that is constructed from a phylogenetic tree or functional dendrogram, we can force the model to &lt;em&gt;regularize&lt;/em&gt; species&amp;rsquo; nonlinear effects toward those from their most closely related neighbours. This is an incredible advance that opens many new possibilities for asking targeted questions about niche conservatism, trait evolution, functional redundancy and a whole host of other directions. A very basic example of how this can be done in &lt;code&gt;mgcv&lt;/code&gt; is presented here.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Load libraries necessary for data manipulation and modeling&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ape)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mgcv)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mvnfast)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ggplot2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(dplyr)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(MRFtools) &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# devtools::install_github(&amp;#34;eric-pedersen/MRFtools&amp;#34;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A utility function to simulate from a squared exponential Gaussian Process, which we will use to create species&amp;rsquo; nonlinear temporal trends&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sim_gp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(N, alpha, rho){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;outer&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diag&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1e-9&lt;/span&gt;, N)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mvnfast&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rmvn&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, N),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Sigma)[1,]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;phylogenetically-structured-trends&#34;&gt;Phylogenetically structured trends&#xA;  &lt;a href=&#34;#phylogenetically-structured-trends&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Simulate a random phylogenetic tree to inform species&amp;rsquo; relationships&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N_species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tree &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rcoal&lt;/span&gt;(N_species, tip.label &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;sp_&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N_species))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;species_names &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; tree&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;tip.label&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(tree)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/index_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&lt;p&gt;Now simulate a &amp;lsquo;shared&amp;rsquo; nonlinear temporal trend, which will anchor each species&amp;rsquo; trend&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;shared &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sim_gp&lt;/span&gt;(N, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(shared, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Trend&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/index_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&lt;p&gt;Next we construct the phylogenetically-informed trends. In this example, each species&amp;rsquo; actual trend is a perturbation of the shared trend, whereby the final trend is a weighted sum of the shared trend and two other GP trends. Because the weights are simulated using phylogenetic information (using the &lt;code&gt;rTraitCont()&lt;/code&gt; function from the &lt;code&gt;ape&lt;/code&gt; library), this process allows us to construct smooth trends that will hopefully capture the property we&amp;rsquo;re after, i.e. that more closely related species will have more similar functional shapes&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;warp1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sim_gp&lt;/span&gt;(N, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;warp2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sim_gp&lt;/span&gt;(N, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;weights1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rTraitCont&lt;/span&gt;(tree)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;weights2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rTraitCont&lt;/span&gt;(tree)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the trends for each species and take noisy observations. For the third and seventh species, we set observations to &lt;code&gt;NA&lt;/code&gt; so we can test if the model is able to recover their trends. Store all necessary data in a &lt;code&gt;data.frame&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;do.call&lt;/span&gt;(rbind, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq_len&lt;/span&gt;(N_species),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(i){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        sp_trend &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; warp1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; weights1[i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          warp2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; weights2[i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; shared&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        obs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(N, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                     mean &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale&lt;/span&gt;(sp_trend)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                     sd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.35&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%in%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;7&lt;/span&gt;)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          weight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          obs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        } &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          weight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species_names[i],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   weight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weight,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   truth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale&lt;/span&gt;(sp_trend)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; obs)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      }))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;species, levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species_names)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We&amp;rsquo;ll also leave out the last 5 observations for each species so we can see how well (or how poorly) the trends extrapolate, though this isn&amp;rsquo;t the primary focus of the example&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;case_when&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;=&lt;/span&gt; N&lt;span style=&#34;color:#099&#34;&gt;-5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; y,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; N&lt;span style=&#34;color:#099&#34;&gt;-5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; y&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  )) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&amp;gt;&lt;/span&gt; dat&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;data-visualisation&#34;&gt;Data visualisation&#xA;  &lt;a href=&#34;#data-visualisation&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Plot the true simulated trends for each species&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(dat, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; truth, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;species, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;free_y&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/index_files/figure-html/unnamed-chunk-9-1.png&#34; alt=&#34;Simulating species&#39; nonlinear time trends using phylogenetic relationships.&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&lt;p&gt;Plot the noisy observations (noting that all obs are missing for two species)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(dat, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;weight, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;species, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;free_y&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 150 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/index_files/figure-html/unnamed-chunk-10-1.png&#34; alt=&#34;Simulating noisy observations of species&#39; nonlinear time trends using phylogenetic relationships.&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;model-setup&#34;&gt;Model setup&#xA;  &lt;a href=&#34;#model-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Create the MRF penalty matrix using the phylogenetic precision matrix&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;omega &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;solve&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;vcv&lt;/span&gt;(tree))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now add an MRF penalty that forces the temporal trend to evolve as a Random Walk using utilities provided by Pedersen et al&amp;rsquo;s &lt;code&gt;MRFtools&lt;/code&gt; package. This requires that we have a factor variable for &lt;code&gt;time&lt;/code&gt; in our data, and we should ensure the levels of this &lt;code&gt;time_factor&lt;/code&gt; go as high as we would potentially like to forecast. Note that this package can also create the phylogenetic penalty but I feel it is better to show these steps explicitly for this example.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rw_penalty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mrf_penalty&lt;/span&gt;(object &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;linear&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time_factor &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;factor&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Fit a GAM using a tensor product of the RW MRF basis and the phylogenetic MRF basis. We also use a &amp;lsquo;shared&amp;rsquo; smooth of time so that the phylogenetic smooths are estimated as deviations around this shared smooth. Set &lt;code&gt;drop.unused.levels = FALSE&lt;/code&gt; to ensure there are no errors because of the extra species and times in the penalty matrices&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(time_factor, species, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;mrf&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;mrf&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;, N_species),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  xt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(penalty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; rw_penalty), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(penalty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; omega))),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           drop.unused.levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;REML&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: gaussian &#xD;&#xA;## Link function: identity &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## y ~ s(time, k = 10) + te(time_factor, species, bs = c(&amp;#34;mrf&amp;#34;, &#xD;&#xA;##     &amp;#34;mrf&amp;#34;), k = c(8, N_species), xt = list(list(penalty = rw_penalty), &#xD;&#xA;##     list(penalty = omega)))&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error t value Pr(&amp;gt;|t|)  &#xD;&#xA;## (Intercept) -0.03469    0.01665  -2.084   0.0378 *&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##                            edf Ref.df      F p-value    &#xD;&#xA;## s(time)                  6.011  6.576  2.239  0.0281 *  &#xD;&#xA;## te(time_factor,species) 67.709 79.000 39.045  &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.892   Deviance explained =   91%&#xD;&#xA;## -REML = 291.42  Scale est. = 0.12468   n = 450&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;predictions-and-evaluation&#34;&gt;Predictions and evaluation&#xA;  &lt;a href=&#34;#predictions-and-evaluation&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Calculate predictions from the model for the full dataset (including the missing species) and overlay the actual true simulated trends as black points. Did the model successfully estimate the missing species&amp;rsquo; temporal trend?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(mod, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;, se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;fit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;fit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.96&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;se.fit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;fit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.96&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;se.fit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(dat, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; truth), col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;(linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower, ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;species, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;free_y&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/index_files/figure-html/unnamed-chunk-14-1.png&#34; alt=&#34;Predicting species&#39; nonlinear time trends using Hierarchical Generalized Additive Models with phylogenetic smooths.&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&lt;p&gt;Hot Damn it worked! But could we recover these missing trends without the information provided in the phylogenetic structure? Fit a second GAM that uses a similar hierarchical smooth of time, but in this case the deviations around the shared smooth do not have any phylogenetic information to leverage&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, species, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;fs&amp;#39;&lt;/span&gt;, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;REML&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           drop.unused.levels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning in gam.side(sm, X, tol = .Machine$double.eps^0.5): model has repeated&#xD;&#xA;## 1-d smooths of same variable.&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: gaussian &#xD;&#xA;## Link function: identity &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## y ~ s(time, k = 10) + s(time, species, bs = &amp;#34;fs&amp;#34;, k = 8)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error t value Pr(&amp;gt;|t|)&#xD;&#xA;## (Intercept) -0.03469    0.03615   -0.96    0.338&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##                    edf Ref.df     F  p-value    &#xD;&#xA;## s(time)          7.668  8.285  5.13 3.06e-06 ***&#xD;&#xA;## s(time,species) 56.239 78.000 38.27  &amp;lt; 2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## R-sq.(adj) =  0.889   Deviance explained = 90.5%&#xD;&#xA;## -REML = 285.82  Scale est. = 0.12807   n = 450&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now predict from the non-phylogenetic model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(mod2, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;, se &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;pred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;fit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;upper &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;fit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.96&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;se.fit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lower &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;fit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1.96&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;preds&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;se.fit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(dat, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; time, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; truth), col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;(linewidth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_ribbon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(ymin &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lower, ymax &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; upper, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; species),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;species, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;free_y&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(legend.position &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/phylogenetic-smooths-mgcv/index_files/figure-html/unnamed-chunk-16-1.png&#34; alt=&#34;Predicting species&#39; nonlinear time trends using hierarchical Generalized Additive Models.&#34; width=&#34;672&#34; /&gt;&#xD;&#xA;&lt;p&gt;Predictions from this model draw from the &amp;lsquo;average&amp;rsquo; smooth, rather than leveraging phylogenetic information, to predict the trends for the missing species. So the predictions for both missing species are identical. Obviously we can tell by eye that the predictions are worse than those from the phylogenetic model. But we could use Continuous Rank Probability Scores for each model&amp;rsquo;s predictions to quantify &lt;em&gt;how much&lt;/em&gt; worse&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material about Hierarchical Generalized Additive Models and comparative phylogenetic modeling&lt;/p&gt;&#xA;&lt;p&gt;Blomberg, S. P., Garland Jr, T., &amp;amp; Ives, A. R. (2003). &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/abs/10.1111/j.0014-3820.2003.tb00285.x&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Testing for phylogenetic signal in comparative data: behavioral traits are more labile&lt;/a&gt;. &lt;em&gt;Evolution&lt;/em&gt;, 57(4), 717-745.&lt;/p&gt;&#xA;&lt;p&gt;Clark, N. J., Drovetski, S. V., &amp;amp; Voelker, G. (2020). &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/full/10.1111/mec.15545&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Robust geographical determinants of infection prevalence and a contrasting latitudinal diversity gradient for haemosporidian parasites in Western Palearctic birds&lt;/a&gt;. &lt;em&gt;Molecular Ecology&lt;/em&gt;, 29(16), 3131-3143.&lt;/p&gt;&#xA;&lt;p&gt;Clark, N. J. (2023) &#xA;&lt;a href=&#34;https://github.com/nicholasjclark/physalia-forecasting-course&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ecological forecasting with R 📦&amp;rsquo;s {mvgam} and {brms}&lt;/a&gt;. A workshop hosted for &#xA;&lt;a href=&#34;https://www.physalia-courses.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Physalia Courses&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Pedersen, E. J., Miller, D. L., Simpson, G. L., &amp;amp; Ross, N. (2019). &#xA;&lt;a href=&#34;https://peerj.com/articles/6876/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hierarchical generalized additive models in ecology: an introduction with mgcv&lt;/a&gt;. &lt;em&gt;PeerJ&lt;/em&gt;, 7, e6876.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Using Stan to model geostatistical count data with distance matrices</title>
  <link>https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/</link>
  <pubDate>Thu, 16 Nov 2023 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/</guid>
  <description>&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;required-libraries&#34;&gt;Required libraries&#xA;  &lt;a href=&#34;#required-libraries&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;&lt;code&gt;cmdstanr&lt;/code&gt;&lt;br&gt;&#xA;&lt;code&gt;MASS&lt;/code&gt;&lt;br&gt;&#xA;&lt;code&gt;raster&lt;/code&gt;&lt;br&gt;&#xA;&lt;code&gt;ggplot2&lt;/code&gt;&lt;br&gt;&#xA;&lt;code&gt;viridis&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;purpose-and-model-introduction&#34;&gt;Purpose and model introduction&#xA;  &lt;a href=&#34;#purpose-and-model-introduction&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This script simulates Poisson observations of an underlying spatially autocorrelated data generating process. It also provides &lt;code&gt;Stan&lt;/code&gt; code for estimating parameters of the model in a Bayesian framework. Observations &lt;code&gt;\(\boldsymbol{Y}\)&lt;/code&gt; are assumed to be drawn from a Poisson distribution with location &lt;code&gt;\(\lambda\)&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$for\:i=1,...,N$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\boldsymbol{Y}_{i}\sim \text{Poisson}(\lambda_{i})$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;A linear predictor is modeled on the &lt;code&gt;\(log\)&lt;/code&gt; scale to capture effects of covariates and a spatial effect on &lt;code&gt;\(\lambda\)&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$log(\lambda)={\beta}*\boldsymbol{X}+\phi$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;\(\beta\)&lt;/code&gt; is the set of regression coefficients that describe associations between predictor variables in the model design matrix &lt;code&gt;\(\boldsymbol{X}\)&lt;/code&gt; and &lt;code&gt;\(log(\lambda)\)&lt;/code&gt;. &lt;code&gt;\(\phi\)&lt;/code&gt; captures spatial effects, which can be modeled using a wide variety of functions (i.e. splines, hierarchical intercepts indexed by region, Gaussian Processes etc&amp;hellip;). In this example, we use a spatial Gaussian Process with squared exponential covariance kernel:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$\phi\sim \text{MultiNormal}(0, \Sigma)$$&lt;/code&gt;&#xA;&lt;code&gt;\(\Sigma\)&lt;/code&gt; is a covariance matrix with:&#xA;&lt;code&gt;$$\Sigma[i, j] = \alpha^ 2* exp(-0.5 * ((\boldsymbol{distances[i, j]} / \rho))^2),~if~~i~!= j$$&lt;/code&gt;&#xA;&lt;code&gt;$$\Sigma[i, j] = \alpha^ 2,~if~~i~= j$$&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;The term &lt;code&gt;\(exp(-0.5 * ((\boldsymbol{distances[i, j]} / \rho)) ^ 2)\)&lt;/code&gt; is the spatial kernel function and depends on &lt;code&gt;\(\rho\)&lt;/code&gt; (often called the length scale parameter), which controls how quickly the correlations between spatial points decay as a function of geographical distance (in km). The parameter &lt;code&gt;\(\alpha\)&lt;/code&gt; controls the marginal variability of the spatial function at all points; in other words it controls how much the spatial term contributes to the linear predictor.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;define-the-joint-probabilistic-model&#34;&gt;Define the joint probabilistic model&#xA;  &lt;a href=&#34;#define-the-joint-probabilistic-model&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;First we will define the &lt;code&gt;Stan&lt;/code&gt; model code for estimating parameters under the model outlined above.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gp_stan_code &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;functions {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Function to compute the squared exponential covariance matrix and&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // take the cholesky decomposition for more efficient computation&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // of multivariate normal realisations&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  matrix L_cov_exp_quad_dis(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;          int N,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;          matrix distances,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#x9;&#x9;&#x9;    real alpha,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#x9;&#x9;&#x9;    real rho,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#x9;&#x9;&#x9;    real delta) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    matrix[N, N] Sigma;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    Sigma = square(alpha) * exp(-0.5 * (square(distances / rho))) +&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;            diag_matrix(rep_vector(delta, N));&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    return cholesky_decompose(Sigma);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;data {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    int N;                    // total number of observations&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    matrix[N, N] distances;   // distance matrix (in km)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    int K;                    // number of columns in the model matrix&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    matrix[N,K] X;            // the model matrix&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;    array[N] int&amp;lt;lower=0&amp;gt; y;  // the response variable (as non-negative integers)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;transformed data {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Small offset to ensure the covariance matrix is positive definite&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real delta = 1e-9;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;parameters {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Define any unknown parameters to be sampled&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector[K] beta;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=0&amp;gt; rho;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  real&amp;lt;lower=0&amp;gt; alpha;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector[N] eta;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;transformed parameters {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Calculate the latent Gaussian process function (phi)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  matrix[N, N] L_chol = L_cov_exp_quad_dis(N, distances, alpha, rho, delta);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  vector[N] gp_function = L_chol * eta;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;model {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Prior for the GP length scale (i.e. spatial decay)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // very small values will be inidentifiable, so an informative prior&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // is a must&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  rho ~ normal(2, 2.5);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Prior for the GP covariance magnitude&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  alpha ~ std_normal();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Multiplier for non-centred GP parameterisation&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  eta ~ std_normal();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // Likelihood, where the linear&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // predictor is an additive combination of the latent GP and&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  // fixed effects of covariates&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;  y ~ poisson_log(X * beta + gp_function);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Load &lt;code&gt;cmdstanr&lt;/code&gt; and compile the model to &lt;code&gt;C++&lt;/code&gt; code. See &#xA;&lt;a href=&#34;https://mc-stan.org/cmdstanr/articles/cmdstanr.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;information here for troubleshooting advice when installing &lt;code&gt;Stan&lt;/code&gt; and &lt;code&gt;Cmdstan&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(cmdstanr)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cmd_mod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cmdstan_model&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;write_stan_file&lt;/span&gt;(gp_stan_code),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         stanc_options &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;canonicalize=deprecations,braces,parentheses&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;simulate-spatially-autocorrelated-poisson-data&#34;&gt;Simulate spatially autocorrelated Poisson data&#xA;  &lt;a href=&#34;#simulate-spatially-autocorrelated-poisson-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Now that the model is defined in &lt;code&gt;Stan&lt;/code&gt; language, we need to simulate data to explore the model. We simulate 150 geospatial coordinates in roughly the Brisbane, Queensland area&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;150&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;runif&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, min &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-27.65&lt;/span&gt;, max &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;-27&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lon &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;runif&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N, min &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;152.8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;153&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coords &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.matrix&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cbind&lt;/span&gt;(lon, lat))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colnames&lt;/span&gt;(coords) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Longitude&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Latitude&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now simulate a precipitation variable and assign a positive coefficient for its effect on the process. We use a standard normal distribution for this simulation: &lt;code&gt;\(\boldsymbol{precip}\sim \text{Normal}(0,1)\)&lt;/code&gt;. This is useful as it mimics what we might see if we took a continuous variable and standardised it to unit variance. Many texts suggest you should do this for computational reasons. But really it just helps a bit for specifying priors&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;precip &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(N)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_precip &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Assign Gaussian Process parameter values to ensure there is obvious spatial autocorrelation (with spatial decay &lt;code&gt;\(\rho = 5km\)&lt;/code&gt;)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Calculate distances (in meters) between the points and ensure the resulting matrix is symmetric&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(raster)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pointDistance&lt;/span&gt;(coords, lonlat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[upper.tri&lt;/span&gt;(m)] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(m)&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[upper.tri&lt;/span&gt;(m)]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: package &amp;#39;raster&amp;#39; was built under R version 4.3.2&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Loading required package: sp&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: package &amp;#39;sp&amp;#39; was built under R version 4.3.2&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Convert distance (which is in meters) to kilometers and preview the distance matrix&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; m &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m[1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]&#xD;&#xA;## [1,]  0.000000 25.444495  7.862131 16.876604 10.948461 17.707530&#xD;&#xA;## [2,] 25.444495  0.000000 19.031165 19.933376 15.710278  8.403163&#xD;&#xA;## [3,]  7.862131 19.031165  0.000000  9.997982  3.407973 12.572540&#xD;&#xA;## [4,] 16.876604 19.933376  9.997982  0.000000  9.301197 17.395006&#xD;&#xA;## [5,] 10.948461 15.710278  3.407973  9.301197  0.000000  9.840844&#xD;&#xA;## [6,] 17.707530  8.403163 12.572540 17.395006  9.840844  0.000000&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(m)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1]  0.00000 69.91692&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Calculate the Gaussian Process squared exponential covariance matrix. A small offset is used on the diagonals to ensure the resulting matrix is Positive-Definite. This is a requirement for simulating multivariate normal draws. Preview the covariance matrix&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;K &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((m &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diag&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1e-9&lt;/span&gt;, N)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;K[1&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##              [,1]         [,2]         [,3]         [,4]        [,5]&#xD;&#xA;## [1,] 1.000000e+00 2.379914e-06 0.2904679164 0.0033580483 0.090956308&#xD;&#xA;## [2,] 2.379914e-06 1.000000e+00 0.0007146594 0.0003537961 0.007181431&#xD;&#xA;## [3,] 2.904679e-01 7.146594e-04 1.0000000010 0.1354445399 0.792719718&#xD;&#xA;## [4,] 3.358048e-03 3.537961e-04 0.1354445399 1.0000000010 0.177240942&#xD;&#xA;## [5,] 9.095631e-02 7.181431e-03 0.7927197180 0.1772409416 1.000000001&#xD;&#xA;## [6,] 1.890087e-03 2.435914e-01 0.0423674335 0.0023537992 0.144158155&#xD;&#xA;##             [,6]&#xD;&#xA;## [1,] 0.001890087&#xD;&#xA;## [2,] 0.243591437&#xD;&#xA;## [3,] 0.042367433&#xD;&#xA;## [4,] 0.002353799&#xD;&#xA;## [5,] 0.144158155&#xD;&#xA;## [6,] 1.000000001&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Simulate the latent Gaussian Process function as random draws from a zero-centred multivariate normal distribution with &lt;code&gt;K&lt;/code&gt; as the covariance matrix&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sim_gp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, N), Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; K)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we can finally simulate the observed counts, which follow the linear predictor we set out at the beginning of this tutorial&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sim_y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rpois&lt;/span&gt;(N, lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(sim_gp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; beta_precip &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; precip))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the data to observe the spatial pattern. First plot the latent function, which should show obvious spatial autocorrelation&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ggplot2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: package &amp;#39;ggplot2&amp;#39; was built under R version 4.3.3&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_y,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  GP &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_gp,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Longitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lon,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Latitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lat),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Latitude, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Longitude, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; GP)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, shape &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;21&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_continuous&lt;/span&gt;(type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;viridis&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_minimal&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-16-1.png&#34; alt=&#34;Simulating spatially autocorrelated data in R using a Gaussian Process&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Now plot the integer observations, which are naturally messier&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_y,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  GP &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_gp,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Longitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lon,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Latitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lat),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Latitude, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Longitude, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Y)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, shape &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;21&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_continuous&lt;/span&gt;(type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;viridis&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_minimal&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-17-1.png&#34; alt=&#34;Simulating spatially autocorrelated count data in R using a Gaussian Process&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;It is also worth plotting the observations against the predictors (precipitation, in this case)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(Y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_y,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Rainfall &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; precip),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Rainfall, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Y)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;, shape &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;21&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_minimal&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-18-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;fit-a-standard-generalized-linear-model-to-simulated-data&#34;&gt;Fit a standard Generalized Linear Model to simulated data&#xA;  &lt;a href=&#34;#fit-a-standard-generalized-linear-model-to-simulated-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;We can quickly understand why it is problematic to ignore spatial variation (or any kind of systematic heterogeneity) when fitting models. Start with a basic Poisson GLM that ignores the spatial component. Generally I would not advocate mixing Maximum Likelihood and Bayesian models. In my view, Bayesian is better because it forces us to think more deeply about the model and its connections to both data and prior knowledge. But a quick &lt;code&gt;glm&lt;/code&gt;, which uses iteratively reweighted least squares to find the Maximum Likelihood estimates of a Generalized Linear Model, will be fine for our purposes here&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nonspat_mod &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glm&lt;/span&gt;(sim_y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; precip, family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(nonspat_mod)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Call:&#xD;&#xA;## glm(formula = sim_y ~ precip, family = poisson())&#xD;&#xA;## &#xD;&#xA;## Coefficients:&#xD;&#xA;##             Estimate Std. Error z value Pr(&amp;gt;|z|)    &#xD;&#xA;## (Intercept)  0.50320    0.06460   7.789 6.74e-15 ***&#xD;&#xA;## precip       0.39753    0.06919   5.745 9.18e-09 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## (Dispersion parameter for poisson family taken to be 1)&#xD;&#xA;## &#xD;&#xA;##     Null deviance: 321.86  on 149  degrees of freedom&#xD;&#xA;## Residual deviance: 287.95  on 148  degrees of freedom&#xD;&#xA;## AIC: 554.01&#xD;&#xA;## &#xD;&#xA;## Number of Fisher Scoring iterations: 5&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Visualise the estimated precipitation regression coefficient &lt;code&gt;\(\beta_{precip}\)&lt;/code&gt;. First, define some colours for nice plots&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_light &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#DCBCBC&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_light_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#C79999&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_mid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_mid_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_dark &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F2727&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;c_dark_highlight &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#7C0000&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Because we fit the model using a form of maximum likelihood, parameter uncertainty can be recovered using the model&amp;rsquo;s assumed multivariate normal posterior distribution&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;coef_posteriors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2000&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                 mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;coef&lt;/span&gt;(nonspat_mod), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                 Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;vcov&lt;/span&gt;(nonspat_mod))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the estimates for &lt;code&gt;\(\beta_{precip}\)&lt;/code&gt; and overlay the true simulated value in black&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(coef_posteriors[,&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(beta[precip]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_precip, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_precip, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-22-1.png&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This parameter seems to be recovered well. But how do model residuals look?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;qqnorm&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;residuals&lt;/span&gt;(nonspat_mod), pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-6&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;qqline&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;residuals&lt;/span&gt;(nonspat_mod), lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-23-1.png&#34; alt=&#34;Failures of regression models that do not account for inherent spatial autocorrelation&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The model is not capturing the dispersion in the data. This suggests there is a problem. Plot residuals against observed values to see if there are any obvious patterns&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(sim_y, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;residuals&lt;/span&gt;(nonspat_mod),pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Residuals&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Observed counts&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-24-1.png&#34; alt=&#34;Failures of regression models that do not account for inherent spatial autocorrelation&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Another useful plot is to compare simulated counts to observed counts, which more closely inspects whether our simulations capture properties of the observed data&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2000&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(sim_y))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2000&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  preds[i, ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rpois&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(sim_y),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(coef_posteriors[i, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                     coef_posteriors[i, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; precip))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(sim_y, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     freq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#999&#34;&gt;F&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmax&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(sim_y), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(preds)), length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Observed counts&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(preds, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     freq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#999&#34;&gt;F&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmax&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(sim_y), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(preds)), length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Predicted counts&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-25-1.png&#34; alt=&#34;Failures of regression models that do not account for inherent spatial autocorrelation&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The model is overpredicting small observed values and underpredicting large observed values. Plotting residuals over space identifies what is going on&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(Residuals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;residuals&lt;/span&gt;(nonspat_mod),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Longitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lon,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Latitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lat),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Latitude, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Longitude, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Residuals)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, shape &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;21&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_continuous&lt;/span&gt;(type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;viridis&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_minimal&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-26-1.png&#34; alt=&#34;Failures of regression models that do not account for inherent spatial autocorrelation&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There are obvious spatial patterns in the model&amp;rsquo;s failures. We could compute a semivariogram to confirm but there is no need. We must proceed with a more appropriate model&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;fit-the-geostatistical-model-to-simulated-data&#34;&gt;Fit the geostatistical model to simulated data&#xA;  &lt;a href=&#34;#fit-the-geostatistical-model-to-simulated-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Organise the data for &lt;code&gt;Stan&lt;/code&gt; modelling into a list&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model_data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(N &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; N,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Distances matrix&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; m,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Number of covariates&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   K &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Covariate design matrix (for all points)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   X &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.matrix&lt;/span&gt;(precip),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Observed values of simulated outcomes&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_y)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Condition the model on the observed data; some early warnings are likely as the sampler chooses among initial values for GP parameters, which can sometimes lead to covariance matrices that are not positive definite. Usually this resolves as the sampler moves through the warmup phase&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; cmd_mod&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sample&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; model_data,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      chains &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      iter_warmup &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;500&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      iter_sampling &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      parallel_chains &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      refresh &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Inspect sampler and convergence diagnostics. Any warnings of divergences or low energy should be taken seriously and inspected further. Fortunately our model fits without issue&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diagnostic_summary&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## $num_divergent&#xD;&#xA;## [1] 0 0 0 0&#xD;&#xA;## &#xD;&#xA;## $num_max_treedepth&#xD;&#xA;## [1] 0 0 0 0&#xD;&#xA;## &#xD;&#xA;## $ebfmi&#xD;&#xA;## [1] 0.9313095 0.8574628 0.9105745 0.8735549&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A quick summary of parameters of interest&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;rho&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;alpha&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;beta&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## # A tibble: 3 × 10&#xD;&#xA;##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail&#xD;&#xA;##   &amp;lt;chr&amp;gt;    &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;&#xD;&#xA;## 1 rho      6.00   5.93  1.21   1.23   4.14  8.07   1.00     870.    1493.&#xD;&#xA;## 2 alpha    0.795  0.779 0.150  0.133  0.587 1.07   1.00    1797.    1829.&#xD;&#xA;## 3 beta[1]  0.366  0.364 0.0797 0.0811 0.240 0.499  1.00    6236.    2402.&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;These summaries are not that useful. Using posterior medians +/- credible intervals is never as informative as are visualisations of model parameters. Visualise posterior estimates for &lt;code&gt;\(\alpha\)&lt;/code&gt; and overlay the true simulated value in black&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;alpha&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(alpha))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; alpha, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-32-1.png&#34; alt=&#34;Stan geostatistical model predictions show adequate fit to the simulated data in R&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Repeat for the GP length scale parameter, &lt;code&gt;\(\rho\)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;rho&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(rho))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; rho, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; rho, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-33-1.png&#34; alt=&#34;Stan geostatistical model predictions show adequate fit to the simulated data in R&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Now look at the regression coefficient for precipitation, &lt;code&gt;\(\beta_{precip}\)&lt;/code&gt;. You could (and generally should) also devise scenarios for prediction to help you better understand the model&amp;rsquo;s assumptions. But we will leave parameter inspection here for now&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;beta[1]&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(beta[precip]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_precip, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(v &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; beta_precip, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-34-1.png&#34; alt=&#34;Stan geostatistical model predictions show adequate fit to the simulated data in R&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;As with any regression, we should inspect residuals for any obvious discrepancies. Because our data are discrete counts bounded at zero, standard residuals aren&amp;rsquo;t helpful. We will use randomized quantile (Dunn-Smyth) residuals, which should be approximately standard normal in distribution. Don&amp;rsquo;t worry too much about the details, but I&amp;rsquo;m showing this function so the tutorial has complete code&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ds_resids_pois &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(truth, fitted){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  na_obs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.na&lt;/span&gt;(truth)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  a_obs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ppois&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(truth[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;na_obs]) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; fitted[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;na_obs])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  b_obs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ppois&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(truth[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;na_obs]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; fitted[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;na_obs])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u_obs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;runif&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(fitted[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;na_obs]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 min &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmin&lt;/span&gt;(a_obs, b_obs), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 max &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmax&lt;/span&gt;(a_obs, b_obs))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;any&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.na&lt;/span&gt;(truth))){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    u_na &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;runif&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(fitted[na_obs]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  min &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, max &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    u &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;vector&lt;/span&gt;(length &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(truth))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    u[na_obs] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; u_na&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    u[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;na_obs] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; u_obs&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    u &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; u_obs&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dsres_out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;qnorm&lt;/span&gt;(u)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dsres_out&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[is.infinite&lt;/span&gt;(dsres_out)] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rnorm&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;which&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.infinite&lt;/span&gt;(dsres_out))))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dsres_out&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Calculate posterior retrodictions for the modeled observations. Notice how we use &lt;code&gt;rpois&lt;/code&gt; to generate Poisson draws with the exact linear predictor that was used in our &lt;code&gt;Stan&lt;/code&gt; model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;beta_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;beta[1]&amp;#34;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obs_gp_function_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;gp_function&amp;#39;&lt;/span&gt;,format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;draws_matrix&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(sim_y))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  preds[i, ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rpois&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(sim_y),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;((beta_posterior[i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; precip) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                          obs_gp_function_posterior[i,]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create a truth matrix for vectorised residual computation. This just replicates the observed values &lt;code&gt;1000&lt;/code&gt; times so we don&amp;rsquo;t have to use a for loop to calculate residuals for all &lt;code&gt;1000&lt;/code&gt; posterior predictions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;truth_mat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(sim_y, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(preds)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(preds),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    byrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Calculate posterior residuals&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;resids &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ds_resids_pois&lt;/span&gt;(truth &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(truth_mat),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                  fitted &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(preds)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(preds))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As we saw above with the non-spatial model, a useful diagnostic is to plot residuals against observed values to see if there are any systematic discrepancies in observations vs predictions. We will plot &lt;code&gt;50&lt;/code&gt; posterior draws of residuals because there is uncertainty in these parameters&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(sim_y, resids[1,], ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(resids), pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F272720&amp;#34;&lt;/span&gt;, bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Observed count&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Dunn-Smyth residual&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(sim_y, resids[i,], ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;range&lt;/span&gt;(resids), pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F272720&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;abline&lt;/span&gt;(h &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-39-1.png&#34; alt=&#34;Stan geostatistical model predictions show adequate fit to the simulated data in R&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There is no alarming pattern here, though the model does tend to slightly under-predict large values. A normal Q-Q plot checks if there is any over- or under-dispersion that is not being captured by the model&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;qqnorm&lt;/span&gt;(resids[1,], pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-6&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;), col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F272730&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;qqline&lt;/span&gt;(resids[1,], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;#80808040&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;qqline&lt;/span&gt;(resids[i,], lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;#80808040&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  test &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;qqnorm&lt;/span&gt;(resids[i,], plot &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#999&#34;&gt;F&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;points&lt;/span&gt;(test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;x, test&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;y, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F272730&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-40-1.png&#34; alt=&#34;Stan geostatistical model predictions show adequate fit to the simulated data in R&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The points all fall nicely along the 1:1 lines, suggesting the model can simulate data that follow the distribution of the observed values. We can also plot histograms of observations vs predictions, as we did with the nonspatial model above&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(sim_y, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     freq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#999&#34;&gt;F&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmax&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(sim_y), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(preds)), length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Observed counts&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hist&lt;/span&gt;(preds, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     freq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#999&#34;&gt;F&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     breaks &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pmax&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(sim_y), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(preds)), length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Predicted counts&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     yaxt &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-41-1.png&#34; alt=&#34;Stan geostatistical model predictions show adequate fit to the simulated data in R&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;layout&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;inference&#34;&gt;Inference&#xA;  &lt;a href=&#34;#inference&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The model appears to simulate realistic-looking data. Moreover, all of our parameters were recovered well by the model. But what do these parameters actually mean? The GP parameters are best interpreted together, as they form the spatial covariance kernel. Those of you that have worked with variograms before will be used to visualising how semivariance decays over distance. Here we will visualise how covariance decays over distance. It is certainly worth visualising the posterior estimates for this kernel to see if the model captures the simulated covariance well. Define a function to compute the covariance kernel for each posterior draw&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quad_kernel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(rho, alpha, distances){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  covs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Distances (in km) over which to compute the posterior kernel estimates&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;, length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;75&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Compute posterior kernels&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kernels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(distances))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rho_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;rho&amp;#39;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;df&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;rho&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;alpha_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;alpha&amp;#39;&lt;/span&gt;, format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;df&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;alpha&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  kernels[i,] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quad_kernel&lt;/span&gt;(rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; rho_posterior[i],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; alpha_posterior[i],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; distances)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Calculate posterior empirical quantiles for the kernel&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.3&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.7&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.95&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sapply&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(kernels),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(n) &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(kernels[,n],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                    probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; probs))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the estimated kernels and overlay the true simulated kernel in black&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pred_vals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; distances&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt;), ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(cred)), type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Distance (in km)&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Covariance&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_vals, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_vals)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[1,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[9,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_light, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_vals, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_vals)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[2,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[8,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_light_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_vals, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_vals)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[3,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[7,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_vals, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_vals)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[4,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[6,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_mid_highlight, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(pred_vals, cred[5,], col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; c_dark, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Overlay the true simulated kernel&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;true_kernel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quad_kernel&lt;/span&gt;(rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; rho,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; alpha,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; distances)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(pred_vals,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      true_kernel, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(pred_vals,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      true_kernel, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-46-1.png&#34; alt=&#34;Visualising spatial autocorrelation kernels fitted with the Stan geostatistical model&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot clearly shows that locations close together (further left on the x-axis) exhibit stronger covariance. The model does a reasonable job of estimating the true simulated kernel, though it does over-smooth a bit (because it slightly overestimates &lt;code&gt;\(\rho\)&lt;/code&gt;). We can&amp;rsquo;t expect perfection when we used a noisy observation process (Poisson draws) and only &lt;code&gt;150&lt;/code&gt; points. This is why it is so important to quantify our uncertainty in model parameters / functions.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;prediction&#34;&gt;Prediction&#xA;  &lt;a href=&#34;#prediction&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;A common goal in spatial modeling is to generate smoothed predictions for unsampled locations. We want our predictions to respect the spatial patterns that our model has estimated. We also want predictions to respect uncertainty in model parameters. To generate predictions, we have to take draws from the appropriate multivariate normal distribution. First, define a function to calculate distances (in km) among pairs of points&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calc_point_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(coordinates, coordinates2){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;missing&lt;/span&gt;(coordinates2)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pointDistance&lt;/span&gt;(coordinates, lonlat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    distances&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[upper.tri&lt;/span&gt;(distances)] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(distances)&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;[upper.tri&lt;/span&gt;(distances)]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pointDistance&lt;/span&gt;(coordinates, coordinates2, lonlat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Convert meters distance to kilometers&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;return&lt;/span&gt;(distances)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next, we need a function to predict from a GP for a grid of spatial points. This function takes the modeled datapoints (i.e. the &lt;code&gt;150&lt;/code&gt; that we used to train the model) and works out how to propagate the Gaussian Process from the modeled datapoints to a new set of prediction points. Don&amp;rsquo;t worry if you don&amp;rsquo;t understand the linear algebra. Just understand that we cannot predict for a new set of points without calculating the cross-covariance between fitted points and prediction points&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;predict_gp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(alpha, rho, obs_gp_function,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       obs_distances, pred_distances,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       obs_to_pred_distances){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Estimated covariance kernel for the fitted points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  K_obs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((obs_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diag&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1e-4&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(obs_distances)[1])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Cross-covariance between prediction points and fitted points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  K_new &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((obs_to_pred_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Estimated covariance kernel for prediction points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  K_star &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((pred_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diag&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1e-4&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(pred_distances)[1])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Estimated mean for prediction points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(K_new) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%*%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;solve&lt;/span&gt;(K_obs, obs_gp_function) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# One realisation of uncertainty for prediction points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(pred_distances)[1]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; K_star &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(K_new) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%*%&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;solve&lt;/span&gt;(K_obs, K_new))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next generate a spatial grid of &lt;code&gt;1000&lt;/code&gt; points covering the extent of the simulated study area&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pred_grid &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.data.frame&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;makegrid&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as&lt;/span&gt;(raster&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;extent&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;152.8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;153&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;-27.65&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;-27&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                       &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;SpatialPolygons&amp;#39;&lt;/span&gt;), n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colnames&lt;/span&gt;(pred_grid) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Longitude&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Latitude&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Calculate distances among fitted and prediction points (in km)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obs_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;calc_point_distances&lt;/span&gt;(coordinates &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; coords)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pred_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;calc_point_distances&lt;/span&gt;(coordinates &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred_grid)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obs_to_pred_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;calc_point_distances&lt;/span&gt;(coords, pred_grid)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Extract posterior estimates for the latent GP function that applied to the in-sample (fitted) observations&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obs_gp_function_posterior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; fit&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draws&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;gp_function&amp;#39;&lt;/span&gt;,format &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;df&amp;#34;&lt;/span&gt;)[,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;N]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Dropping &amp;#39;draws_df&amp;#39; class as required metadata was removed.&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Generate latent GP predictions using &lt;code&gt;5&lt;/code&gt; posterior draws. This computation can be sped up by parallelising the operation later on, but for now we just have to sit and wait. For a real analysis, we&amp;rsquo;d want at least &lt;code&gt;1000&lt;/code&gt; estimates so we could accurately quantify our uncertainty&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gp_preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(pred_grid))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(gp_preds)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cat&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Processing posterior draw&amp;#39;&lt;/span&gt;, i, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;of 5...\n&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  gp_preds[i,] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict_gp&lt;/span&gt;(obs_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; obs_distances,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             pred_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; pred_distances,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             obs_to_pred_distances &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; obs_to_pred_distances,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             obs_gp_function &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.matrix&lt;/span&gt;(obs_gp_function_posterior[i,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; alpha_posterior[i],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                             rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; rho_posterior[i])&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Processing posterior draw 1 of 5...&#xD;&#xA;## Processing posterior draw 2 of 5...&#xD;&#xA;## Processing posterior draw 3 of 5...&#xD;&#xA;## Processing posterior draw 4 of 5...&#xD;&#xA;## Processing posterior draw 5 of 5...&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Plot the posterior mean spatial GP predictions just for a quick visualisation&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grid2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(pred_grid)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grid2&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colMeans&lt;/span&gt;(gp_preds)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colnames&lt;/span&gt;(grid2) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Longitude&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Latitude&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;GP_function&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(grid2,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Latitude, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Longitude, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; GP_function)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(shape &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;21&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;, size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Highlight the original simulated points as larger circles&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# to ensure the spatial kriging makes sense&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(sim_y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_y,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        GP &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sim_gp,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        Longitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lon,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        Latitude &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lat),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Latitude, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Longitude, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; GP),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, shape &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;21&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;black&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_continuous&lt;/span&gt;(type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;viridis&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_minimal&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/stan-discrete-geostatistical/index_files/figure-html/unnamed-chunk-53-1.png&#34; alt=&#34;Stan geostatistical model predictions show adequate fit to the simulated data in R&#34; width=&#34;576&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;For complete predictions, we would need the covariate values (i.e. precipitation) at all of the spatial locations. The predictions would be just as fast, we would simply need to take posterior draws of &lt;code&gt;\(\beta_{precip}\)&lt;/code&gt;, multiply them by the covariate values at each point, then add those with the GP estimates to form the linear predictor for &lt;code&gt;\(log(\lambda)\)&lt;/code&gt;. We could then use &lt;code&gt;rpois(exp(prediction))&lt;/code&gt; to draw a Poisson realisation for each prediction point that satisfies &lt;code&gt;\(Poisson(\lambda)\)&lt;/code&gt;&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Distributed lags (and hierarchical distributed lags) using mgcv and mvgam</title>
  <link>https://ecogambler.netlify.app/blog/distributed-lags-mgcv/</link>
  <pubDate>Tue, 15 Aug 2023 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/distributed-lags-mgcv/</guid>
  <description>&lt;p&gt;Here we will use &lt;code&gt;mgcv&lt;/code&gt; to estimate parameters of nonlinear distributed lag models. These models are used to describe simultaneously non-linear and delayed functional relationships between a covariate and a response, and are sometimes referred to as exposure-lag-response models. If we assume &lt;code&gt;\(\tilde{\boldsymbol{y}}_{t}\)&lt;/code&gt; is the conditional expectation of a response variable &lt;code&gt;\(\boldsymbol{y}\)&lt;/code&gt; at time &lt;code&gt;\(\boldsymbol{t}\)&lt;/code&gt;, and that &lt;code&gt;\(g\)&lt;/code&gt; is a suitable inverse link function, the linear predictor for a distributed lag GAM with one lagged covariate is written as:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$$g(\tilde{\boldsymbol{y}}_{t})={\boldsymbol{B}}_0+\sum\limits_{k=1}^K{f}(\boldsymbol{b}_{k,t}\boldsymbol{x}_{k,t})\,$$&lt;/code&gt;&#xA;where &lt;code&gt;\(\boldsymbol{B}_{0}\)&lt;/code&gt; is the unknown intercept and the &lt;code&gt;\(\boldsymbol{b}\)&lt;/code&gt;&amp;rsquo;s are unknown spline coefficients estimating how the functional effect of covariate &lt;code&gt;\(\boldsymbol{x}\)&lt;/code&gt; on &lt;code&gt;\(g(\tilde{\boldsymbol{y}}_{t})\)&lt;/code&gt; changes over increasing lags (up to a maximum lag of &lt;code&gt;\(\boldsymbol{K}\)&lt;/code&gt;).&lt;/p&gt;&#xA;&lt;p&gt;We will work with time series of rodent captures from the Portal Project, &#xA;&lt;a href=&#34;https://portal.weecology.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a long-term monitoring study based near the town of Portal, Arizona&lt;/a&gt;. Researchers have been operating a standardized set of baited traps within 24 experimental plots at this site since the 1970&amp;rsquo;s. Sampling follows the lunar monthly cycle, with observations occurring on average about 28 days apart. However, missing observations do occur due to difficulties accessing the site (weather events, COVID disruptions etc..). You can read about the full sampling protocol &#xA;&lt;a href=&#34;https://www.biorxiv.org/content/10.1101/332783v3.full&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;in this preprint by Ernest et al on the Biorxiv&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;portal_plots.jpg&#34; alt=&#34;Portal Project sampling scheme in the desert near Portal, Arizona, USA; photo by SKM Ernest&#34;&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This tutorial relies on the following packages:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mvgam)           &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit, interrogate and forecast DGAMs&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(dplyr)           &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tidy and flexible data manipulation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ggplot2)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Flexible plotting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(gratia)          &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Graceful plotting of smooth terms&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(viridis)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Plotting colours&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(patchwork)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Combining ggplot objects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A custom &lt;code&gt;ggplot2&lt;/code&gt; theme; feel free to ignore if you have your own plot preferences&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_set&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;(base_size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;, base_family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;serif&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(axis.line.x.bottom &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                    size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  axis.line.y.left &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                  size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.&#xD;&#xA;## ℹ Please use the `linewidth` argument instead.&#xD;&#xA;## This warning is displayed once every 8 hours.&#xD;&#xA;## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was&#xD;&#xA;## generated.&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;options&lt;/span&gt;(ggplot2.discrete.colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                    &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F2727&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                    &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                    &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#630000&amp;#34;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ggplot2.discrete.fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#8F2727&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                  &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#630000&amp;#34;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;load-and-inspect-the-portal-data&#34;&gt;Load and inspect the Portal data&#xA;  &lt;a href=&#34;#load-and-inspect-the-portal-data&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;All data from the Portal Project are made openly available in near real-time so that they can provide the maximum benefit to scientific research and outreach (&#xA;&lt;a href=&#34;https://www.weecology.org/software-projects/portalr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a set of open-source software tools make data readily accessible&lt;/a&gt;). These data are extremely rich, containing monthly counts of rodent captures for &amp;gt;20 species. But rather than accessing the raw data, we will use some data that I have already processed and put into a simple, usable form&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;read.csv&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;https://raw.githubusercontent.com/nicholasjclark/EFI_seminar/main/data/portal_data.csv&amp;#39;&lt;/span&gt;, as.is &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#999&#34;&gt;T&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Inspect the data structure, which contains lunar monthly total captures across control plots for four different rodent species. It also contains a 12-month moving average of the unitless NDVI vegetation index, and monthly average minimum temperature (already scaled to unit variance)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glimpse&lt;/span&gt;(portal_ts)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Rows: 320&#xD;&#xA;## Columns: 5&#xD;&#xA;## $ captures  &amp;lt;int&amp;gt; 20, 2, 0, 0, NA, NA, NA, NA, 36, 5, 0, 0, 40, 3, 0, 1, 29, 3…&#xD;&#xA;## $ time      &amp;lt;int&amp;gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, …&#xD;&#xA;## $ species   &amp;lt;chr&amp;gt; &amp;#34;DM&amp;#34;, &amp;#34;DO&amp;#34;, &amp;#34;PB&amp;#34;, &amp;#34;PP&amp;#34;, &amp;#34;DM&amp;#34;, &amp;#34;DO&amp;#34;, &amp;#34;PB&amp;#34;, &amp;#34;PP&amp;#34;, &amp;#34;DM&amp;#34;, &amp;#34;DO&amp;#34;, …&#xD;&#xA;## $ ndvi_ma12 &amp;lt;dbl&amp;gt; -0.172144125, -0.172144125, -0.172144125, -0.172144125, -0.2…&#xD;&#xA;## $ mintemp   &amp;lt;dbl&amp;gt; -0.79633807, -0.79633807, -0.79633807, -0.79633807, -1.33471…&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The data contain 80 lunar monthly observations, though there are plenty of NAs in the number of total captures (NAs are shown as red bars in the below plot)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 80&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;image&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.na&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;t&lt;/span&gt;(portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;arrange&lt;/span&gt;(dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;desc&lt;/span&gt;(time)))), axes &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#999&#34;&gt;F&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;grey80&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;axis&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;, at &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, len &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(portal_ts)), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     labels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;colnames&lt;/span&gt;(portal_ts))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-6-1.png&#34; alt=&#34;Visualising features of time series data in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The data are already in &amp;rsquo;long&amp;rsquo; format, meaning each series x time observation has its own entry in the &lt;code&gt;data.frame&lt;/code&gt;. But {&lt;code&gt;mvgam&lt;/code&gt;} needs a &lt;code&gt;series&lt;/code&gt; column that acts as a factor indicator for the time series. Add one using {&lt;code&gt;dplyr&lt;/code&gt;} commands:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.factor&lt;/span&gt;(species)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&amp;gt;&lt;/span&gt; portal_ts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;glimpse&lt;/span&gt;(portal_ts)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Rows: 320&#xD;&#xA;## Columns: 6&#xD;&#xA;## $ captures  &amp;lt;int&amp;gt; 20, 2, 0, 0, NA, NA, NA, NA, 36, 5, 0, 0, 40, 3, 0, 1, 29, 3…&#xD;&#xA;## $ time      &amp;lt;int&amp;gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, …&#xD;&#xA;## $ species   &amp;lt;chr&amp;gt; &amp;#34;DM&amp;#34;, &amp;#34;DO&amp;#34;, &amp;#34;PB&amp;#34;, &amp;#34;PP&amp;#34;, &amp;#34;DM&amp;#34;, &amp;#34;DO&amp;#34;, &amp;#34;PB&amp;#34;, &amp;#34;PP&amp;#34;, &amp;#34;DM&amp;#34;, &amp;#34;DO&amp;#34;, …&#xD;&#xA;## $ ndvi_ma12 &amp;lt;dbl&amp;gt; -0.172144125, -0.172144125, -0.172144125, -0.172144125, -0.2…&#xD;&#xA;## $ mintemp   &amp;lt;dbl&amp;gt; -0.79633807, -0.79633807, -0.79633807, -0.79633807, -1.33471…&#xD;&#xA;## $ series    &amp;lt;fct&amp;gt; DM, DO, PB, PP, DM, DO, PB, PP, DM, DO, PB, PP, DM, DO, PB, …&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;levels&lt;/span&gt;(portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] &amp;#34;DM&amp;#34; &amp;#34;DO&amp;#34; &amp;#34;PB&amp;#34; &amp;#34;PP&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It is important that the number of levels matches the number of unique series in the data to ensure indexing across series works properly in the underlying modelling functions. For more information on how to format data for {&lt;code&gt;mvgam&lt;/code&gt;} modelling, see &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/articles/data_in_mvgam.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the data formatting vignette in the package&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Now we can plot all of the time series together, using the &lt;code&gt;captures&lt;/code&gt; measurement as our outcome variable&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;captures&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;all&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-8-1.png&#34; alt=&#34;Visualising features of time series data in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;We can also plot some more in-depth features for individual series&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;captures&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-9-1.png&#34; alt=&#34;Visualising features of time series data in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;captures&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-9-2.png&#34; alt=&#34;Visualising features of time series data in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;captures&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-9-3.png&#34; alt=&#34;Visualising features of time series data in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_mvgam_series&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;captures&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-9-4.png&#34; alt=&#34;Visualising features of time series data in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Inspect some associations between &lt;code&gt;log(captures + 1)&lt;/code&gt; and minimum temperature / NDVI moving average for each species to get a sense of how their relative abundances vary over seasons and with varying habitat conditions. First for &lt;strong&gt;DM&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DM&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mintemp, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DM&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log(captures)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Minimum temperature&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DM&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ndvi_ma12, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NULL&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;NDVI moving average&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-10-1.png&#34; alt=&#34;Visualising features of time series data in ggplot2 and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;And for &lt;strong&gt;PP&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PP&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mintemp, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PP&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log(captures)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Minimum temperature&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PP&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ndvi_ma12, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NULL&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;NDVI moving average&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-11-1.png&#34; alt=&#34;Visualising features of time series data in ggplot2 and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Next for &lt;strong&gt;PB&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PB&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mintemp, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PB&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log(captures)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Minimum temperature&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PB&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ndvi_ma12, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NULL&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;NDVI moving average&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-12-1.png&#34; alt=&#34;Visualising features of time series data in ggplot2 and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;And finally for &lt;strong&gt;DO&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DO&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mintemp, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(title &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DO&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;log(captures)&amp;#34;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Minimum temperature&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DO&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; ndvi_ma12, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;log&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;))) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;(method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;gam&amp;#34;&lt;/span&gt;, formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(x, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NULL&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;NDVI moving average&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing non-finite outside the scale range&#xD;&#xA;## (`stat_smooth()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Warning: Removed 17 rows containing missing values or values outside the scale range&#xD;&#xA;## (`geom_point()`).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-13-1.png&#34; alt=&#34;Visualising features of time series data in ggplot2 and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There may be some support for some nonlinear effects here, but we know that the rodents in this system do not show immediate responses to climatic or environmental changes. Rather, these responses are often &lt;em&gt;delayed&lt;/em&gt;, and can be thought of as &lt;em&gt;cumulative&lt;/em&gt; responses to varying conditions over a period of months. How can we capture these effects using GAMs? This is where distributed lag models come in.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;setting-up-lag-matrices&#34;&gt;Setting up lag matrices&#xA;  &lt;a href=&#34;#setting-up-lag-matrices&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;A lesser-known feature of &lt;code&gt;mgcv&lt;/code&gt; is its ability to handle data in &lt;code&gt;list&lt;/code&gt; format as opposed to the traditional &lt;code&gt;data.frame&lt;/code&gt; format that most regression packages in R use. This allows us to supply some (or all) of our covariates as &lt;code&gt;matrices&lt;/code&gt; rather than &lt;code&gt;vectors&lt;/code&gt;, and opens many possibilities for more complex modeling. You can read a bit more about this using &lt;code&gt;?gam.models&lt;/code&gt; and looking at the section on &lt;strong&gt;Linear functional terms&lt;/strong&gt;. We can make use of this to set up the objects needed for estimating nonlinear distributed lag functions.&lt;/p&gt;&#xA;&lt;p&gt;Below is an exact reproduction of Simon Wood&amp;rsquo;s lag matrix function (which he uses in his distributed lag example from his book &#xA;&lt;a href=&#34;https://www.taylorfrancis.com/books/mono/10.1201/9781315370279/generalized-additive-models-simon-wood&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Generalized Additive Models - An Introduction with R 2nd edition&lt;/a&gt;). To use this function we need to supply a vector and specify the maximum lag that we want, and it will return a matrix of dimension &lt;code&gt;length(x) * lag&lt;/code&gt;. Note that &lt;code&gt;NAs&lt;/code&gt; are used for the missing lag values at the beginning of the matrix. In essence, the matrix objects represent exposure histories, where each row represents the lagged values of the predictor that correspond to each observation in our outcome variable. By creating a &lt;em&gt;tensor product&lt;/em&gt; of this lagged covariate matrix and a matrix of equal dimensions that indicates which lag each cell in the covariate matrix represents, we can effectively set up a function that changes nonlinearly over lagged values of the covariate.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lagard &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x, n_lag &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(x)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  X &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, n, n_lag)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;n_lag){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    X[i&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;n, i] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; x[i&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  X&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can make use of this function to organise all data needed for modeling into a list. For this simple example we will use lags of up to six months in the past. Some bookkeeping is necessary, as we must ensure that we remove the first five observations &lt;em&gt;for each series&lt;/em&gt;. This is best achieved by arranging the data by &lt;code&gt;series&lt;/code&gt; and then by &lt;code&gt;time&lt;/code&gt;. I do this first to create the &lt;code&gt;mintemp&lt;/code&gt; matrix&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mintemp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;do.call&lt;/span&gt;(rbind, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq_along&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;levels&lt;/span&gt;(portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series)), &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;levels&lt;/span&gt;(portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series)[x]) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;arrange&lt;/span&gt;(time) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;select&lt;/span&gt;(mintemp, time) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;pull&lt;/span&gt;(mintemp) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&amp;gt;&lt;/span&gt; tempdat&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  lag_mat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lagard&lt;/span&gt;(tempdat, &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;tail&lt;/span&gt;(lag_mat, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(lag_mat) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(mintemp)[1]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 300&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The lagged &lt;code&gt;mintemp&lt;/code&gt; matrix now looks like this:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(mintemp, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##              [,1]        [,2]        [,3]        [,4]        [,5]        [,6]&#xD;&#xA;##  [6,]  0.06532892 -0.42447625 -1.08048145 -1.24166462 -1.33471597 -0.79633807&#xD;&#xA;##  [7,]  0.82279570  0.06532892 -0.42447625 -1.08048145 -1.24166462 -1.33471597&#xD;&#xA;##  [8,]  1.16043027  0.82279570  0.06532892 -0.42447625 -1.08048145 -1.24166462&#xD;&#xA;##  [9,]  1.35620578  1.16043027  0.82279570  0.06532892 -0.42447625 -1.08048145&#xD;&#xA;## [10,]  1.25417764  1.35620578  1.16043027  0.82279570  0.06532892 -0.42447625&#xD;&#xA;## [11,]  1.15421766  1.25417764  1.35620578  1.16043027  0.82279570  0.06532892&#xD;&#xA;## [12,] -0.17521991  1.15421766  1.25417764  1.35620578  1.16043027  0.82279570&#xD;&#xA;## [13,] -0.65285556 -0.17521991  1.15421766  1.25417764  1.35620578  1.16043027&#xD;&#xA;## [14,] -1.47224270 -0.65285556 -0.17521991  1.15421766  1.25417764  1.35620578&#xD;&#xA;## [15,] -1.26667509 -1.47224270 -0.65285556 -0.17521991  1.15421766  1.25417764&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we can arrange the data in the same way and pull necessary objects into the &lt;code&gt;list&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;portal_ts &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;arrange&lt;/span&gt;(series, time) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;filter&lt;/span&gt;(time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&amp;gt;&lt;/span&gt; portal_ts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data_all &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  lag &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nrow&lt;/span&gt;(portal_ts), &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;, byrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;captures,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ndvi_ma12 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;ndvi_ma12,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; portal_ts&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And add the &lt;code&gt;mintemp&lt;/code&gt; history matrix:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; mintemp&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The lag exposure history matrix looks as follows:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##      [,1] [,2] [,3] [,4] [,5] [,6]&#xD;&#xA;## [1,]    0    1    2    3    4    5&#xD;&#xA;## [2,]    0    1    2    3    4    5&#xD;&#xA;## [3,]    0    1    2    3    4    5&#xD;&#xA;## [4,]    0    1    2    3    4    5&#xD;&#xA;## [5,]    0    1    2    3    4    5&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;All other elements of the data list are in the usual vector format&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;captures, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 25 29 23 22 NA&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] DM DM DM DM DM&#xD;&#xA;## Levels: DM DO PB PP&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1]  6  7  8  9 10&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The dimensions of all the objects need to match up&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 300   6&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;dim&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 300   6&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## [1] 300&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;fitting-a-distributed-lag-model-for-one-species&#34;&gt;Fitting a distributed lag model for one species&#xA;  &lt;a href=&#34;#fitting-a-distributed-lag-model-for-one-species&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The setup we have now is fine for fitting a distributed lag model to captures of just a single species. To illustrate how this works and what these models estimate, we can subset the data to only include observations for &lt;strong&gt;PP&lt;/strong&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pp_inds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;which&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PP&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data_pp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(data_all, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.matrix&lt;/span&gt;(x)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x[pp_inds, ]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    x[pp_inds]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Setting up the model is now very straightforward. We simply wrap the &lt;code&gt;lag&lt;/code&gt; and &lt;code&gt;mintemp&lt;/code&gt; matrices in a call to &lt;code&gt;te()&lt;/code&gt;, which will set up a tensor product smoother (see &lt;code&gt;?mgcv::te&lt;/code&gt; for details). I also use a smooth term for &lt;code&gt;ndvi_ma12&lt;/code&gt; in this model, and stick with a Poisson observation model to keep things simple&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(ndvi_ma12),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; data_pp,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: poisson &#xD;&#xA;## Link function: log &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## captures ~ te(mintemp, lag, k = 6) + s(ndvi_ma12)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error z value Pr(&amp;gt;|z|)    &#xD;&#xA;## (Intercept)  1.36702    0.07786   17.56   &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##                    edf Ref.df Chi.sq p-value    &#xD;&#xA;## te(mintemp,lag) 19.009 21.686 127.94  &amp;lt;2e-16 ***&#xD;&#xA;## s(ndvi_ma12)     4.169  5.075  13.06  0.0219 *  &#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Rank: 44/45&#xD;&#xA;## R-sq.(adj) =   0.62   Deviance explained =   69%&#xD;&#xA;## -REML = 180.09  Scale est. = 1         n = 59&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There will surely be autocorrelation left in the residuals from this model, but we will ignore that for now and focus on how to interpret the distributed lag term. Plotting these terms is easy with &lt;code&gt;mgcv&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod1, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, scheme &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-24-1.png&#34; alt=&#34;Visualising distributed lag smooths in mgcv and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Here the brighter yellow colours indicate larger linear predictor values, while the darker red colours indicate smaller linear predictor values. We can get a nicer plot of this effect using &#xA;&lt;a href=&#34;https://gavinsimpson.github.io/gratia/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gavin Simpson&amp;rsquo;s {&lt;code&gt;gratia&lt;/code&gt;} package&lt;/a&gt;. Note, I am currently using the development version of this package that was recently installed from Github. This is necessary for accurate plots of nonlinear functionals that include &lt;code&gt;by&lt;/code&gt; terms (use &lt;code&gt;devtools::install_github(&#39;gavinsimpson/gratia&#39;)&lt;/code&gt; to get the latest version)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draw&lt;/span&gt;(mod1, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-25-1.png&#34; alt=&#34;Visualising distributed lag smooths in mgcv and Gavin Simpson&#39;s gratia package in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;To me these bivariate heatmaps are a bit difficult to interpret, but more on that later.&lt;/p&gt;&#xA;&lt;p&gt;Clearly there is support for a nonlinear effect of &lt;code&gt;mintemp&lt;/code&gt; that changes over different lags, which is sensible given what we know about population dynamics in this system. But how can we incorporate such effects for &lt;em&gt;all species&lt;/em&gt; in the model at once? The &lt;code&gt;by&lt;/code&gt; argument in &lt;code&gt;mgcv&lt;/code&gt; parlance can frequently be used to set up smoothers that vary across levels of a factor, and there are many extremely useful strategies for setting up hierarchical GAMs (&#xA;&lt;a href=&#34;https://peerj.com/articles/6876/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;see this paper by Pedersen et al for some more context and many useful examples&lt;/a&gt;). But this option doesn&amp;rsquo;t work when we are dealing with covariates that are stored in &lt;code&gt;matrix&lt;/code&gt; format. In fact, there was &#xA;&lt;a href=&#34;https://stackoverflow.com/questions/75376475/gam-distributed-lag-model-with-factor-smooth-interaction-by-variable&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a recent post on StackOverflow asking about this very issue&lt;/a&gt;:&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;stackoverflow_shot.png&#34; alt=&#34;StackOverflow request for help on setting up factor interactions for distributed lag effects&#34;&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;group-level-and-hierarchical-distributed-lags&#34;&gt;Group-level and hierarchical distributed lags&#xA;  &lt;a href=&#34;#group-level-and-hierarchical-distributed-lags&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;I banged my head against the desk for several hours trying to fit hierarchical distributed lag models in {&lt;code&gt;mgcv&lt;/code&gt;} for &#xA;&lt;a href=&#34;https://github.com/nicholasjclark/portal_VAR&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a recent paper using these very data&lt;/a&gt;. So I know exactly how the author of this post feels. Fortunately, I discovered that they are possible. The key of course is to carefully read the {&lt;code&gt;mgcv&lt;/code&gt;} documentation. If you look at the help for linear functionals (&lt;code&gt;?mgcv::linear.functional.terms&lt;/code&gt; and &lt;code&gt;?mgcv::gam.models&lt;/code&gt;), you will see that the &lt;code&gt;by&lt;/code&gt; variable is used in these cases as a &lt;em&gt;weighting matrix&lt;/em&gt;. The resulting smooth is therefore constructed as &lt;code&gt;rowSums(L * F)&lt;/code&gt;, where &lt;code&gt;F&lt;/code&gt; is the distributed lag smooth and &lt;code&gt;L&lt;/code&gt; is the weighting matrix. After reading this (several times) I finally realised that I needed to supply group-level distributed lag terms &lt;em&gt;for each group&lt;/em&gt; in the formula. In short, we can create weight matrices for each level of the grouping factor to set up group-level and hierarchical distributed lag terms by doing this:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;weights_dm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; weights_do &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; weights_pb &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; weights_pp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ncol&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag), nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nrow&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What we now have is a weighting matrix for each level of the grouping factor. Currently the weights are all set to &lt;code&gt;1&lt;/code&gt; for each row of the data:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;head&lt;/span&gt;(weights_dm)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##      [,1] [,2] [,3] [,4] [,5] [,6]&#xD;&#xA;## [1,]    1    1    1    1    1    1&#xD;&#xA;## [2,]    1    1    1    1    1    1&#xD;&#xA;## [3,]    1    1    1    1    1    1&#xD;&#xA;## [4,]    1    1    1    1    1    1&#xD;&#xA;## [5,]    1    1    1    1    1    1&#xD;&#xA;## [6,]    1    1    1    1    1    1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;But to set up the appropriate group-level tensor products, we need to change these appropriately. Essentially, for each level in the grouping factor, the rows in that level&amp;rsquo;s corresponding weighting matrix need to have &lt;code&gt;1&lt;/code&gt;s when the corresponding observation in the data matches that level, and &lt;code&gt;0&lt;/code&gt;s otherwise:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;weights_dm[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DM&amp;#39;&lt;/span&gt;), ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;weights_do[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;DO&amp;#39;&lt;/span&gt;), ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;weights_pb[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PB&amp;#39;&lt;/span&gt;), ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;weights_pp[&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;!&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;PP&amp;#39;&lt;/span&gt;), ] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Adding these weighting matrices to the data list gives us all we need to set up group-level or hierarchical distributed lag terms&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;weights_dm &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; weights_dm&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;weights_do &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; weights_do&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;weights_pb &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; weights_pb&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;weights_pp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; weights_pp&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&amp;rsquo;s try it out! We will fit a multispecies GAM that includes distributed lag terms of &lt;code&gt;mintemp&lt;/code&gt; for each species. It will also smooths of &lt;code&gt;ndvi_ma12&lt;/code&gt; for each species, random intercepts for each species and smooths of &lt;code&gt;time&lt;/code&gt; for each species. Again this model is probably not completely appropriate because it doesn&amp;rsquo;t take temporal autocorrelation into account very well (though the smooths of &lt;code&gt;time&lt;/code&gt; will help), but it is useful to illustrate some of these principles&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Hierarchical intercepts&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(series, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;re&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Smooths of time to try and capture autocorrelation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; series, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Smooths of ndvi_ma12&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(ndvi_ma12, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; series, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Distributed lags of mintemp&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_dm) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_do) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_pb) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_pp),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; data_all,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            control &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(nthreads &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## &#xD;&#xA;## Family: poisson &#xD;&#xA;## Link function: log &#xD;&#xA;## &#xD;&#xA;## Formula:&#xD;&#xA;## captures ~ s(series, bs = &amp;#34;re&amp;#34;) + s(time, by = series, k = 30) + &#xD;&#xA;##     s(ndvi_ma12, by = series, k = 5) + te(mintemp, lag, k = 4, &#xD;&#xA;##     by = weights_dm) + te(mintemp, lag, k = 4, by = weights_do) + &#xD;&#xA;##     te(mintemp, lag, k = 4, by = weights_pb) + te(mintemp, lag, &#xD;&#xA;##     k = 4, by = weights_pp)&#xD;&#xA;## &#xD;&#xA;## Parametric coefficients:&#xD;&#xA;##             Estimate Std. Error z value Pr(&amp;gt;|z|)&#xD;&#xA;## (Intercept)   0.0374     0.5223   0.072    0.943&#xD;&#xA;## &#xD;&#xA;## Approximate significance of smooth terms:&#xD;&#xA;##                                   edf Ref.df  Chi.sq  p-value    &#xD;&#xA;## s(series)                  -2.847e-16  4.000   0.000 0.045616 *  &#xD;&#xA;## s(time):seriesDM            3.971e+00  4.827  74.186  &amp;lt; 2e-16 ***&#xD;&#xA;## s(time):seriesDO            3.419e+00  4.173  39.097  &amp;lt; 2e-16 ***&#xD;&#xA;## s(time):seriesPB            5.460e+00  6.497  85.988  &amp;lt; 2e-16 ***&#xD;&#xA;## s(time):seriesPP            1.445e+01 17.310 100.348  &amp;lt; 2e-16 ***&#xD;&#xA;## s(ndvi_ma12):seriesDM       2.803e+00  3.268  15.759 0.002060 ** &#xD;&#xA;## s(ndvi_ma12):seriesDO       3.268e+00  3.689  10.113 0.034299 *  &#xD;&#xA;## s(ndvi_ma12):seriesPB       2.580e+00  2.993   5.629 0.140632    &#xD;&#xA;## s(ndvi_ma12):seriesPP       1.654e+00  1.929   2.139 0.268807    &#xD;&#xA;## te(mintemp,lag):weights_dm  4.614e+00  5.613  41.490 1.73e-06 ***&#xD;&#xA;## te(mintemp,lag):weights_do  4.135e+00  4.440  24.922 0.000106 ***&#xD;&#xA;## te(mintemp,lag):weights_pb  6.848e+00  8.307  19.273 0.017449 *  &#xD;&#xA;## te(mintemp,lag):weights_pp  3.000e+00  3.000  25.324 1.25e-05 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xD;&#xA;## &#xD;&#xA;## Rank: 196/201&#xD;&#xA;## R-sq.(adj) =  0.885   Deviance explained = 89.7%&#xD;&#xA;## -REML = 557.05  Scale est. = 1         n = 236&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Again, useful plots of the these smooth terms can be made using {&lt;code&gt;gratia&lt;/code&gt;}&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draw&lt;/span&gt;(mod2, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-31-1.png&#34; alt=&#34;Visualising nonlinear smooths in mgcv and Gavin Simpson&#39;s gratia package in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draw&lt;/span&gt;(mod2, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;9&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-32-1.png&#34; alt=&#34;Visualising nonlinear smooths in mgcv and Gavin Simpson&#39;s gratia package in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;draw&lt;/span&gt;(mod2, select &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;13&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-33-1.png&#34; alt=&#34;Visualising distributed lag smooths in mgcv and Gavin Simpson&#39;s gratia package in R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;visualising-distributed-lag-terms&#34;&gt;Visualising distributed lag terms&#xA;  &lt;a href=&#34;#visualising-distributed-lag-terms&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;If you are like me then you&amp;rsquo;ll find these bivariate heatmap plots of the distributed lag terms rather difficult to interpret. Again, the more intense yellow/white colours indicate higher predicted values, with the deeper red colours representing lower predicted values, but actually making sense of how the functional response is expected to change over different lags is not easy from these plots. However, we can use the &lt;code&gt;predict.gam()&lt;/code&gt; function to generate much more interpretable plots. To do so, we can generate a series of conditional predictions to visualise how the estimated function of &lt;code&gt;mintemp&lt;/code&gt; changes over different lags for each species. This is done by setting up prediction data that zeros out all covariates apart from the covariate of interest. Ordinarily I&amp;rsquo;d use the wonderful &#xA;&lt;a href=&#34;https://marginaleffects.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;{&lt;code&gt;marginaleffects&lt;/code&gt;} package&lt;/a&gt; to automate this process, but unfortunately it doesn&amp;rsquo;t work with data that are in &lt;code&gt;list&lt;/code&gt; format (yet). So here is a rather lengthy function that will do the work for us. It works by iterating over lags and keeping all &lt;code&gt;mintemp&lt;/code&gt; values at zero apart from the particular lag being predicted so that we can visualise how the predicted function changes over lags of &lt;code&gt;mintemp&lt;/code&gt;. Predictions are generated on the link scale in this case, though you could also use the response scale. Note that we need to first generate predictions with all covariates (including the &lt;code&gt;mintemp&lt;/code&gt; covariate) zeroed out to find the &amp;lsquo;baseline&amp;rsquo; prediction (which will centre around the species&amp;rsquo; expected average count, on the log scale) so that we can shift by this baseline for generating a zero-centred plot. That way our resulting plot will roughly follow the traditional &lt;code&gt;mgcv&lt;/code&gt; partial effect plots&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plot_dist_lags &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(model, data_all){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  all_species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;levels&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Loop across species to create the effect plot dataframe&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sp_plot_dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;do.call&lt;/span&gt;(rbind, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(all_species, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(sp){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Zero out all predictors to start the newdata&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(data_all, &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(x){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;is.matrix&lt;/span&gt;(x)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nrow&lt;/span&gt;(x), ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ncol&lt;/span&gt;(x))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      } &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(x))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    })&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Modify to only focus on the species of interest&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(sp, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nrow&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    which_weightmat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;grep&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;paste0&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;weights_&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;tolower&lt;/span&gt;(sp)), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;names&lt;/span&gt;(newdata))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    newdata[[which_weightmat]] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nrow&lt;/span&gt;(newdata[[which_weightmat]]),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                         ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ncol&lt;/span&gt;(newdata[[which_weightmat]]))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate predictions for when mintemp is zero to find the baseline&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# value for centring the plot&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;inherits&lt;/span&gt;(model, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;mvgam&amp;#39;&lt;/span&gt;)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(model, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newdata, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;, process_error &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, median)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(model, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newdata, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    offset &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mean&lt;/span&gt;(preds)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    plot_dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;do.call&lt;/span&gt;(rbind, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lapply&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;), &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(lag){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Set up prediction matrix for mintemp; &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# use a sequence of values across the full range of observed values&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ncol&lt;/span&gt;(newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;nrow&lt;/span&gt;(newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;lag))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp[,lag] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Predict on the link scale and shift by the offset &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# so that values are roughly centred at zero&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;inherits&lt;/span&gt;(model, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;mvgam&amp;#39;&lt;/span&gt;)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(model, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newdata, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;, process_error &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;apply&lt;/span&gt;(preds, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, median)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      } &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;else&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;predict&lt;/span&gt;(model, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; newdata,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;-&lt;/span&gt; offset&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(lag &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lag,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 preds &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; preds,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 mintemp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(data_all&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;mintemp),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(newdata&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    plot_dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;species &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; sp&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    plot_dat&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Build the facetted distributed lag plot&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; sp_plot_dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(lag &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.factor&lt;/span&gt;(lag)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mintemp, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; preds, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lag, fill &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; lag)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;facet_wrap&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; species, scales &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;free&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_hline&lt;/span&gt;(yintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Use geom_smooth, though beware these uncertainty&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# intervals aren&amp;#39;t necessarily correct&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_smooth&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_fill_viridis&lt;/span&gt;(discrete &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;scale_colour_viridis&lt;/span&gt;(discrete &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Minimum temperature (z-scored)&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Partial effect&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Plot the conditional &lt;code&gt;mintemp&lt;/code&gt; effects for each species&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_dist_lags&lt;/span&gt;(mod2, data_all)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## `geom_smooth()` using method = &amp;#39;loess&amp;#39; and formula = &amp;#39;y ~ x&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-35-1.png&#34; alt=&#34;Visualising nonlinear distributed lag smooths in mgcv and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There we have it. Now it is clear that some species show fairly strong responses to cumulative change in minimum temperature, while others do not. But the fact that we aren&amp;rsquo;t effectively capturing temporal autocorrelation could be influencing these estimates. What happens if we do model temporal dynamics appropriately?&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;using-mvgam-to-capture-dynamic-processes&#34;&gt;Using mvgam to capture dynamic processes&#xA;  &lt;a href=&#34;#using-mvgam-to-capture-dynamic-processes&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;Just as a quick illustration, I will show how the same model can be used in &lt;code&gt;mvgam&lt;/code&gt;, except that we replace the smooth functions of &lt;code&gt;time&lt;/code&gt; with more appropriate dynamic processes that can capture the temporal autocorrelation in the observations. This model uses very similar syntax to the above and can use the same data objects, so there is no need to change much here&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod3 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvgam&lt;/span&gt;(captures &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Hierarchical intercepts&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(series, bs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;re&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Smooths of ndvi_ma12&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(ndvi_ma12, by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; series, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Distributed lags of mintemp&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;), by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_dm) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;), by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_do) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;), by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_pb) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;te&lt;/span&gt;(mintemp, lag, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;), by &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; weights_pp),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Latent dynamic processes to capture autocorrelation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              trend_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;AR&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; data_all)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;summary&lt;/span&gt;(mod3, include_betas &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## GAM formula:&#xD;&#xA;## captures ~ s(ndvi_ma12, by = series, k = 5) + te(mintemp, lag, &#xD;&#xA;##     k = 4, by = weights_dm) + te(mintemp, lag, k = 4, by = weights_do) + &#xD;&#xA;##     te(mintemp, lag, k = 4, by = weights_pb) + te(mintemp, lag, &#xD;&#xA;##     k = 4, by = weights_pp) + s(series, bs = &amp;#34;re&amp;#34;)&#xD;&#xA;## &#xD;&#xA;## Family:&#xD;&#xA;## poisson&#xD;&#xA;## &#xD;&#xA;## Link function:&#xD;&#xA;## log&#xD;&#xA;## &#xD;&#xA;## Trend model:&#xD;&#xA;## AR()&#xD;&#xA;## &#xD;&#xA;## N series:&#xD;&#xA;## 4 &#xD;&#xA;## &#xD;&#xA;## N timepoints:&#xD;&#xA;## 80 &#xD;&#xA;## &#xD;&#xA;## Status:&#xD;&#xA;## Fitted using Stan &#xD;&#xA;## 4 chains, each with iter = 1000; warmup = 500; thin = 1 &#xD;&#xA;## Total post-warmup draws = 2000&#xD;&#xA;## &#xD;&#xA;## &#xD;&#xA;## GAM coefficient (beta) estimates:&#xD;&#xA;##              2.5% 50% 97.5% Rhat n_eff&#xD;&#xA;## (Intercept) -0.73 1.6   3.7    1  1478&#xD;&#xA;## &#xD;&#xA;## GAM group-level estimates:&#xD;&#xA;##                  2.5%   50% 97.5% Rhat n_eff&#xD;&#xA;## mean(s(series)) -1.80 0.013   1.8 1.00  2446&#xD;&#xA;## sd(s(series))    0.33 1.300   3.6 1.02   632&#xD;&#xA;## &#xD;&#xA;## Approximate significance of GAM smooths:&#xD;&#xA;##                              edf Ref.df Chi.sq p-value&#xD;&#xA;## s(ndvi_ma12):seriesDM      1.093      4   8.82     1.0&#xD;&#xA;## s(ndvi_ma12):seriesDO      1.048      4   2.93     1.0&#xD;&#xA;## s(ndvi_ma12):seriesPB      0.889      4   0.18     1.0&#xD;&#xA;## s(ndvi_ma12):seriesPP      1.037      4   3.30     1.0&#xD;&#xA;## te(mintemp,lag):weights_dm 8.649     16  11.57     1.0&#xD;&#xA;## te(mintemp,lag):weights_do 5.059     16  29.12     1.0&#xD;&#xA;## te(mintemp,lag):weights_pb 5.715     16  13.49     1.0&#xD;&#xA;## te(mintemp,lag):weights_pp 6.973     16 144.90     1.0&#xD;&#xA;## s(series)                  2.137      4  31.88     0.2&#xD;&#xA;## &#xD;&#xA;## Latent trend parameter AR estimates:&#xD;&#xA;##           2.5%  50% 97.5% Rhat n_eff&#xD;&#xA;## ar1[1]   0.760 0.95  1.00 1.04   144&#xD;&#xA;## ar1[2]   0.800 0.95  1.00 1.01   404&#xD;&#xA;## ar1[3]   0.850 0.96  1.00 1.00   651&#xD;&#xA;## ar1[4]   0.670 0.86  0.98 1.01   693&#xD;&#xA;## sigma[1] 0.075 0.14  0.24 1.07   105&#xD;&#xA;## sigma[2] 0.150 0.28  0.49 1.03   111&#xD;&#xA;## sigma[3] 0.270 0.47  0.72 1.02   185&#xD;&#xA;## sigma[4] 0.400 0.58  0.85 1.01   329&#xD;&#xA;## &#xD;&#xA;## Stan MCMC diagnostics:&#xD;&#xA;## n_eff / iter looks reasonable for all parameters&#xD;&#xA;## Rhats above 1.05 found for 1 parameters&#xD;&#xA;##  *Diagnose further to investigate why the chains have not mixed&#xD;&#xA;## 9 of 2000 iterations ended with a divergence (0.45%)&#xD;&#xA;##  *Try running with larger adapt_delta to remove the divergences&#xD;&#xA;## 0 of 2000 iterations saturated the maximum tree depth of 12 (0%)&#xD;&#xA;## Chain 1: E-FMI = 0.1879&#xD;&#xA;##  *E-FMI below 0.2 indicates you may need to reparameterize your model&#xD;&#xA;## &#xD;&#xA;## Samples were drawn using NUTS(diag_e) at Thu Apr 04 10:37:31 AM 2024.&#xD;&#xA;## For each parameter, n_eff is a crude measure of effective sample size,&#xD;&#xA;## and Rhat is the potential scale reduction factor on split MCMC chains&#xD;&#xA;## (at convergence, Rhat = 1)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Pay no attention to the approximate significances of these smooths, I&amp;rsquo;m still not convinced that they are being calculated correctly in {&lt;code&gt;mvgam&lt;/code&gt;}. But notice how the AR terms are all close to &lt;code&gt;1&lt;/code&gt;, suggesting there is a lot of unmodelled temporal autocorrelation in the data. Has this impacted our inferences of distributed lag effects? The same prediction function can be used to visualize the distributed lag effects of &lt;code&gt;mintemp&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_dist_lags&lt;/span&gt;(mod3, data_all)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## `geom_smooth()` using method = &amp;#39;loess&amp;#39; and formula = &amp;#39;y ~ x&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-39-1.png&#34; alt=&#34;Visualising nonlinear smooths in mgcv, mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These estimates are now more nonlinear, probably because we have more power to detect effects by effectively capturing temporal dynamics with the latent AR processes:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod3, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;trend&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-40-1.png&#34; alt=&#34;Visualising latent dynamic time series processes in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod3, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;trend&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-40-2.png&#34; alt=&#34;Visualising latent dynamic time series processes in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod3, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;trend&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-40-3.png&#34; alt=&#34;Visualising latent dynamic time series processes in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(mod3, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;trend&amp;#39;&lt;/span&gt;, series &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/index_files/figure-html/unnamed-chunk-40-4.png&#34; alt=&#34;Visualising latent dynamic time series processes in mvgam and R&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;We will leave it there for this post. Hopefully you find this useful at some point!&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material about Hierarchical Generalized Additive Models and distributed lag modeling&lt;/p&gt;&#xA;&lt;p&gt;Clark, N. J., Ernest, S. K. M., Senyondo, H., Simonis, J. L., White, E. P., Yennis, G. M., &amp;amp; Karunarathna, K. A. N. K. (2023). &#xA;&lt;a href=&#34;https://ecoevorxiv.org/repository/view/5143/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Multi-species dependencies improve forecasts of population dynamics in a long-term monitoring study&lt;/a&gt;. &lt;em&gt;Biorxiv&lt;/em&gt;, doi: &#xA;&lt;a href=&#34;https://doi.org/10.32942/X2TS34&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://doi.org/10.32942/X2TS34&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Gasparrini, A. (2014). &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/full/10.1002/sim.5963&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modeling exposure–lag–response associations with distributed lag non‐linear models&lt;/a&gt;. &lt;em&gt;Statistics in Medicine&lt;/em&gt;, 33(5), 881-899.&lt;/p&gt;&#xA;&lt;p&gt;Karunarathna, K. A. N. K., Wells, K., &amp;amp; Clark, N. J. (2024). &#xA;&lt;a href=&#34;https://www.sciencedirect.com/science/article/pii/S0304380024000371&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modelling nonlinear responses of a desert rodent species to environmental change with hierarchical dynamic generalized additive models&lt;/a&gt;. &lt;em&gt;Ecological Modelling&lt;/em&gt;, 490, 110648.&lt;/p&gt;&#xA;&lt;p&gt;Pedersen, E. J., Miller, D. L., Simpson, G. L., &amp;amp; Ross, N. (2019). &#xA;&lt;a href=&#34;https://peerj.com/articles/6876/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hierarchical generalized additive models in ecology: an introduction with mgcv&lt;/a&gt;. &lt;em&gt;PeerJ&lt;/em&gt;, 7, e6876.&lt;/p&gt;&#xA;</description>
  </item>
<item>
  <title>Temporal autocorrelation in GAMs and the mvgam package</title>
  <link>https://ecogambler.netlify.app/blog/autocorrelated-gams/</link>
  <pubDate>Sun, 16 Jul 2023 00:00:00 +0000</pubDate>
<guid>https://ecogambler.netlify.app/blog/autocorrelated-gams/</guid>
  <description>&lt;style type=&#34;text/css&#34;&gt;&#xD;&#xA;details &gt; summary {&#xD;&#xA;  padding: 4px;&#xD;&#xA;  background-color: #8F2727;&#xD;&#xA;  color: white;&#xD;&#xA;  border: none;&#xD;&#xA;  box-shadow: 1px 1px 2px #bbbbbb;&#xD;&#xA;  cursor: pointer;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;details &gt; summary:hover {&#xD;&#xA;  background-color: #DCBCBC;&#xD;&#xA;  color: #8F2727;&#xD;&#xA;}&#xD;&#xA;&lt;/style&gt;&#xD;&#xA;&lt;p&gt;Generalized Additive Models (GAMs) are flexible tools that have found particular application in the analysis of time series data. In ecology, a host of recent papers and workshops have drawn attention to the power of GAMs for addressing complex ecological analyses. For example, &#xA;&lt;a href=&#34;https://fromthebottomoftheheap.net/about/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gavin Simpson regularly hosts workshops on GAMs in R&lt;/a&gt;, and &#xA;&lt;a href=&#34;https://github.com/eric-pedersen/mgcv-esa-workshop&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;it is common to see GAMs on the workshop list for large international conferences in ecology and statistics&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;why-are-gams-useful-for-time-series-analysis&#34;&gt;Why are GAMs useful for time series analysis?&#xA;  &lt;a href=&#34;#why-are-gams-useful-for-time-series-analysis&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;There are several reasons we&amp;rsquo;d want to use a GAM, particularly one fitted in &#xA;&lt;a href=&#34;https://cran.r-project.org/web/packages/mgcv/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the {&lt;code&gt;mgcv&lt;/code&gt;} R package&lt;/a&gt;, to analyse time series:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;GAMs can be used to model non-linear trends in time series data&lt;/li&gt;&#xA;&lt;li&gt;GAMs can easily decompose time series into trend, seasonality and other components&lt;/li&gt;&#xA;&lt;li&gt;Smoothing splines can be used to identify periods of rapid historical change&lt;/li&gt;&#xA;&lt;li&gt;GAMs can incorporate complex random effects that are common in real time series&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Given the many ways that GAMs can model temporal data, it is tempting to extrapolate from their smooth functions to produce out of sample forecasts. Here I inspect how smoothing splines behave when extrapolating outside the training data to examine whether this can be useful in practice. I also discuss some of the pitfalls that tend to arise when trying to fit smoothing splines to temporally autocorrelated data. I then give a few solutions, most notably by making use of Bayesian Dynamic GAMs in the {&lt;code&gt;mvgam&lt;/code&gt;} R package.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;environment-setup&#34;&gt;Environment setup&#xA;  &lt;a href=&#34;#environment-setup&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This tutorial relies on the following packages:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(mvgam)           &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Fit, interrogate and forecast DGAMs&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(dplyr)           &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Tidy and flexible data manipulation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(marginaleffects) &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Compute conditional and marginal effects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(ggplot2)         &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Flexible plotting&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;library&lt;/span&gt;(patchwork)       &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Combining ggplot objects&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;First I design a custom &lt;code&gt;ggplot2&lt;/code&gt; theme; feel free to ignore if you have your own plot preferences&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_set&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme_classic&lt;/span&gt;(base_size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;, base_family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;serif&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;theme&lt;/span&gt;(axis.line.x.bottom &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                    size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  axis.line.y.left &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;element_line&lt;/span&gt;(colour &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;black&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                  size &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;what-are-generalized-additive-models-gams&#34;&gt;What are Generalized Additive Models (GAMs)?&#xA;  &lt;a href=&#34;#what-are-generalized-additive-models-gams&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The content of this post relates to some concepts I introduced in a recent webinar for the &#xA;&lt;a href=&#34;https://ecoforecast.org/workshops/statistical-methods-seminar-series/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ecological Forecasting Initiative&amp;rsquo;s and Ecological Society of America&amp;rsquo;s Statistical Methods Seminar Series&lt;/a&gt;. If you are completely unfamiliar with GAMs, it would be worth a watch to help you catch up on basic concepts.&lt;/p&gt;&#xA;&lt;center&gt;&#xD;&#xA;&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/0zZopLlomsQ?si=E93rOr7326dLCIyq?start=1&#34; data-external = &#34;1&#34; title=&#34;YouTube video player&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; allowfullscreen&gt;&lt;/iframe&gt;&#xD;&#xA;&lt;/center&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;wiggliness-and-autocorrelation&#34;&gt;Wiggliness and autocorrelation&#xA;  &lt;a href=&#34;#wiggliness-and-autocorrelation&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;A smoothing spline is composed of basis expansions whose coefficients, which must be estimated, control the functional relationship between a predictor variable and a conditional response. The size of the basis expansion limits the smooth’s potential complexity, with a larger set of basis functions allowing greater flexibility.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;basis_weights.gif&#34; alt=&#34;How basis functions can be used to build a smoothing spline in a GAM&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;All we need to do once we&amp;rsquo;ve constructed the basis expansion is estimate the weights. This allows us to fit arbitrarily-shaped functions that can &lt;em&gt;learn&lt;/em&gt; nonlinear relationships from data&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;smooth_to_data.gif&#34; alt=&#34;Fitting a Generalized Additive Model to data in R&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;The smoothness of the spline is controlled by a &#xA;&lt;a href=&#34;https://m-clark.github.io/generalized-additive-models/technical.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;smoothing penalty&lt;/a&gt;, which penalizes functions that are excessively wiggly. The animation below illustrates this process, where the penalty &lt;code&gt;\(\rho\)&lt;/code&gt; is chosen to maximise some penalized log(likelihood):&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;penalty_spline.gif&#34; alt=&#34;How a smoothing penalty leads to nonlinear effects in GAMs&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;Here I use an exaggerated example to show how a smooth tries to wiggle excessively, leading to overfitting. This can be done by fixing the smoothing penalty &lt;code&gt;\(λ\)&lt;/code&gt; in a GAM fit with {&lt;code&gt;mgcv&lt;/code&gt;}&amp;rsquo;s &lt;code&gt;gam()&lt;/code&gt; function in R. By fitting models with increasingly relaxed smooths, with &lt;code&gt;\(λ\)&lt;/code&gt; values approaching zero, we produce increasingly wiggly fits that tend toward fully unpenalized functions.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;par&lt;/span&gt;(mfrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    mgp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    mai&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.4&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.7&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data&lt;/span&gt;(mcycle, package &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;MASS&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(accel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(times, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mcycle, method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;, sp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(m1, scheme &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, residuals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;), xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     shade.col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;alpha&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(accel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(times, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mcycle, method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;, sp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(m2, scheme &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, residuals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;), xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     shade.col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;alpha&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m3 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(accel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(times, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mcycle, method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;, sp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.01&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(m3, scheme &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, residuals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.01&lt;/span&gt;), xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     shade.col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;alpha&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;m4 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(accel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(times, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; mcycle, method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;, sp &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.0000001&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(m4, scheme &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, residuals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, pch &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;16&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(lambda &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.0000001&lt;/span&gt;), xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     shade.col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; scales&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;alpha&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-5-1.png&#34; alt=&#34;Wiggliness and penalized smooths in mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Notice how wiggly the function becomes in the last plot when &lt;code&gt;\(λ\)&lt;/code&gt; is very small, indicating that the function is overfitting to the in-sample training data. Incidentally, this behaviour mirrors what often happens when we try to model an autocorrelated time series with a smooth function of &lt;code&gt;time&lt;/code&gt;. Unfortunately, &#xA;&lt;a href=&#34;https://fromthebottomoftheheap.net/2011/07/21/smoothing-temporally-correlated-data/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;smoothing splines often try to wiggle excessively to capture autocorrelation in a time series&lt;/a&gt;. This makes fitting GAMs to time series challenging in some ways. It also leads to poor predictions and forecasts.&lt;/p&gt;&#xA;&lt;p&gt;To demonstrate how challenging it can be to work with temporally autocorrelated data in GAMs, I&amp;rsquo;ll load some time series of counts. The data are from the {&lt;code&gt;tscount&lt;/code&gt;} package and represent the umber of campylobacterosis cases (reported every 28 days) in the North of Québec in Canada from January 1990 to the end of October 2000.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Download the campy data from the tscount package&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;load&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;url&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;https://github.com/cran/tscount/raw/master/data/campy.RData&amp;#39;&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Put data into a data.frame and visualize&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dat &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.vector&lt;/span&gt;(campy)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;%&amp;gt;%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mutate&lt;/span&gt;(time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;dplyr&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;n&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ggplot&lt;/span&gt;(dat, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;aes&lt;/span&gt;(time, count)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_point&lt;/span&gt;() &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_line&lt;/span&gt;()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Next I supply a few small convenience functions for inspecting model outputs.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Replicating mgcv::gam.check() but without the plots&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;small_check &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(model){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cat&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;Basis dimension (k) checking results. Low p-value (k-index &amp;lt; 1) may\n&amp;#34;&lt;/span&gt;) &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;cat&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;indicate that k is too low, especially if edf is close to k\&amp;#39;.\n\n&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;printCoefmat&lt;/span&gt;(mgcv&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;k.check&lt;/span&gt;(model), digits &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Call marginaleffects::plot_predictions to inspect model fits&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plot_fcs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(model, n_ahead &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; n_ahead)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   points &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(n_ahead &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  p&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plot_links &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(model, n_ahead &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_predictions&lt;/span&gt;(model, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;list&lt;/span&gt;(time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; n_ahead)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;ylab&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;linear predictor&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;if&lt;/span&gt;(n_ahead &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; p &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_vline&lt;/span&gt;(xintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time), &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  p&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now onto some GAMs. My goal is to smooth over the temporal trend in the data and inspect the behaviour of the &lt;code&gt;gam.check()&lt;/code&gt; function from {&lt;code&gt;mgcv&lt;/code&gt;}. First I impose a restricted smooth of &lt;code&gt;time&lt;/code&gt; with a very small number of possible basis functions (using the default thin plate basis). For this and all subsequent models, I stick with a &lt;code&gt;poisson()&lt;/code&gt; observation model as this will make it easier to illustrate how the estimated smooth changes as we increase &lt;code&gt;k&lt;/code&gt;. After fitting the model, I then check basis dimension and plot the response-scaled predictions&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod1 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;6&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;small_check&lt;/span&gt;(mod1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Basis dimension (k) checking results. Low p-value (k-index &amp;lt; 1) may&#xD;&#xA;## indicate that k is too low, especially if edf is close to k&amp;#39;.&#xD;&#xA;## &#xD;&#xA;##           k&amp;#39;  edf k-index p-value    &#xD;&#xA;## s(time) 5.00 4.81    0.61  &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-8-1.png&#34; alt=&#34;Autocorrelated time series and GAMs in mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;These results strongly indicate that &lt;code&gt;k&lt;/code&gt; was set too low (i.e. the &lt;code&gt;k-index&lt;/code&gt; is well below &lt;code&gt;1&lt;/code&gt; and the estimated degrees of freedom is nearly as large as the maximum allowed degrees of freedom). The plot also suggests that the function is not flexible enough to capture the long-term (or short-term) variation in the observed counts. Now for a second model that allows for more possible complexity&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;23&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;small_check&lt;/span&gt;(mod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Basis dimension (k) checking results. Low p-value (k-index &amp;lt; 1) may&#xD;&#xA;## indicate that k is too low, especially if edf is close to k&amp;#39;.&#xD;&#xA;## &#xD;&#xA;##           k&amp;#39;  edf k-index p-value    &#xD;&#xA;## s(time) 22.0 10.2    0.67  &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod2)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-9-1.png&#34; alt=&#34;Autocorrelated time series and GAMs in mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;A similar result, with the checking function suggesting that we need to increase &lt;code&gt;k&lt;/code&gt; further if we want to capture the patterns that are left in the model residuals. Now for the whole hog, increasing &lt;code&gt;k&lt;/code&gt; to the maximum allowed basis dimension&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod3 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gam&lt;/span&gt;(count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;140&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;REML&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;small_check&lt;/span&gt;(mod3)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Basis dimension (k) checking results. Low p-value (k-index &amp;lt; 1) may&#xD;&#xA;## indicate that k is too low, especially if edf is close to k&amp;#39;.&#xD;&#xA;## &#xD;&#xA;##          k&amp;#39; edf k-index p-value&#xD;&#xA;## s(time) 139  31    1.14    0.95&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod3)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-10-1.png&#34; alt=&#34;Autocorrelated time series and GAMs in mgcv&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Finally the check suggests the smooth was wiggly enough. But how does this wiggly smooth function behave if we want to extrapolate ahead? Here I predict ahead for &lt;code&gt;10&lt;/code&gt; timesteps from each of the above models to visualize extrapolation behaviours.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod1, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod2, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-11-2.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod3, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-11-3.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;The functions give fairly different forecasts for each model because these penalized splines extrapolate linearly into the future (i.e. if the function wiggled downward toward the end of the training data, the forecast will continue linearly downward forever). This is easier visualized on the link scale&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_links&lt;/span&gt;(mod1, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_links&lt;/span&gt;(mod2, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-12-2.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_links&lt;/span&gt;(mod3, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-12-3.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;autoregressive-residuals-in-mgcv&#34;&gt;Autoregressive residuals in &lt;code&gt;mgcv&lt;/code&gt;&#xA;  &lt;a href=&#34;#autoregressive-residuals-in-mgcv&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;This behaviour is unwanted, for several reasons. First is the very obvious and unwanted extrapolation behaviour. Not only are these extrapolations typically unrealistic and ignorant of the types of behaviours that occurred within the training data, they are also extremely volatile. Simply by changing &lt;code&gt;k&lt;/code&gt; to respect the warnings from &lt;code&gt;gam.check()&lt;/code&gt;, we end up with very different ideas about plausible futures. The second reason we don&amp;rsquo;t want this is that, even if we are not interested in forecasting, chasing autocorrelation with increasingly wiggly smooths increases computational complexity and leads to identifiability issues. Plus there will no doubt be situations in which we cannot capture all of this autocorrelation no matter how wiggly we allow our smooths of &lt;code&gt;time&lt;/code&gt; to be.&lt;/p&gt;&#xA;&lt;p&gt;An obvious solution then is to try and include some sort of residual autocorrelation process in the model. For Gaussian responses, this is fairly straightfoward using the &lt;code&gt;gamm()&lt;/code&gt; function, which allows us to supply a correlation argument like those provided by &lt;code&gt;nlme::lme()&lt;/code&gt;. We can specify several different forms of stochastic ARMA models that will be used to model the residuals. But we are not using a Gaussian observation model here because our data are non-negative integers. There are other options we can use within &lt;code&gt;gamm()&lt;/code&gt; that make use of &lt;code&gt;MASS::glmmPQL()&lt;/code&gt; to fit the model, but this can be temperamental and give unsatisfactory results. Finally though, we have the option to use &lt;code&gt;bam()&lt;/code&gt; and supply a fixed AR1 coefficient, which will be applied to the working residuals. I&amp;rsquo;ll illustrate here by fixing the coefficient to &lt;code&gt;0.6&lt;/code&gt; as a simple example&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod4 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;bam&lt;/span&gt;(count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;s&lt;/span&gt;(time, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;140&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0.6&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            method &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;fREML&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            discrete &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;small_check&lt;/span&gt;(mod4)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## Basis dimension (k) checking results. Low p-value (k-index &amp;lt; 1) may&#xD;&#xA;## indicate that k is too low, especially if edf is close to k&amp;#39;.&#xD;&#xA;## &#xD;&#xA;##             k&amp;#39;    edf k-index p-value    &#xD;&#xA;## s(time) 139.00   5.95    0.63  &amp;lt;2e-16 ***&#xD;&#xA;## ---&#xD;&#xA;## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod4)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-13-1.png&#34; alt=&#34;Autocorrelated time series and GAMs in mgcv with bam()&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This leads to a much smoother estimate of the smooth, which is good news. We still have the warnings from &lt;code&gt;gam.check()&lt;/code&gt; unfortunately, but that is preferable to fitting a smooth that bends all over the place to try and capture the autocorrelation. The extrapolation behaviours are more sensible as well:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_fcs&lt;/span&gt;(mod4, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-14-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_links&lt;/span&gt;(mod4, &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-14-2.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There are still several major downsides to this approach. We have to specify the AR1 coefficient, and if we are modeling several time series in a single joint model (which we very often want to do) we have to use the same AR1 dynamics for each series. We also have no way of incorporating more complex dynamics, such as AR2 or multivariate (VAR) processes. Missing values can cause small or very big problems (the residual AR1 model assumes there is a residual for every timepoint, but if you have missing observations these will be thrown out prior to model fitting). And finally, it is difficult to produce accurate forecasts from this model because our extrapolations do not incorporate the residual autoregressive process. To do so, we&amp;rsquo;d have to:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Extract working residuals from the fitted model&lt;/li&gt;&#xA;&lt;li&gt;Fit an AR1 model to these residuals using the &lt;code&gt;fixed&lt;/code&gt; argument in &lt;code&gt;arima()&lt;/code&gt; to ensure the coefficient is as we specified. This is necessary because we do not know what the variance parameter should be for the residual AR process (it is not returned anywhere in the &lt;code&gt;gam&lt;/code&gt; object&lt;/li&gt;&#xA;&lt;li&gt;Generate mean expectations (link scale) for the GAM model to cover the out-of-sample validation times&lt;/li&gt;&#xA;&lt;li&gt;Predict ahead for the residual AR model to cover the out-of-sample validation times&lt;/li&gt;&#xA;&lt;li&gt;Add the two together to generate the linear predictor values, take the inverse link function (using &lt;code&gt;exp()&lt;/code&gt; in this case for the log link) and then use them as the mean values for taking appropriate stochastic draws (using &lt;code&gt;rpois()&lt;/code&gt; in this case)&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;This process is tedious and error-prone. I won&amp;rsquo;t work through it here because there is a better way.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;dynamic-gams-using-mvgam&#34;&gt;Dynamic GAMs using &lt;code&gt;mvgam&lt;/code&gt;&#xA;  &lt;a href=&#34;#dynamic-gams-using-mvgam&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The &lt;code&gt;mvgam&lt;/code&gt; package was designed to solve these and many other problems we encounter when trying to model realistic time series, produce reliable inferences and generate accurate forecasts. There are many useful vignettes and case studies available (see &#xA;&lt;a href=&#34;https://nicholasjclark.github.io/mvgam/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;documentation on the package website&lt;/a&gt;). But I&amp;rsquo;ll quickly show how we can estimate nonlinear trends &lt;em&gt;and&lt;/em&gt; temporal autocorrelation in GAMs. This should allow us to do all the things we want with these models (i.e. calculate rates of change from the trend, interpolate over periods with missing data, produce accurate forecasts). This model uses quite a few of the advanced features of {&lt;code&gt;mvgam&lt;/code&gt;}, including:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;A State-Space representation for a more efficient treatment of process and observation error&lt;/li&gt;&#xA;&lt;li&gt;A low-rank Gaussian Process (with squared exponential kernel) to capture the nonlinear long-term trend (which will forecast &lt;em&gt;much&lt;/em&gt; better than penalized smooths will)&lt;/li&gt;&#xA;&lt;li&gt;A latent AR1 model to capture unmodelled autocorrelation in the process (with fully estimated AR1 and variance parameters)&lt;/li&gt;&#xA;&lt;li&gt;An informed prior on the length scale parameter &lt;code&gt;\((\rho)\)&lt;/code&gt; of the Gaussian Process, which encodes our belief that the trend should be smooth&lt;/li&gt;&#xA;&lt;li&gt;Full Bayesian inference using &#xA;&lt;a href=&#34;https://mc-stan.org/docs/reference-manual/mcmc.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hamiltonian Monte Carlo in &lt;code&gt;Stan&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mod5 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvgam&lt;/span&gt;(count &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              trend_formula &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;gp&lt;/span&gt;(time, c &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;4&lt;/span&gt;, k &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   scale &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              trend_model &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;AR&lt;/span&gt;(),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              priors &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;prior_string&lt;/span&gt;(prior &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;normal(16, 4)&amp;#39;&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                    class &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;rho_gp_trend(time)&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            data &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; dat,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            family &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;poisson&lt;/span&gt;())&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The model fits quickly and encounters few issues. The GP has done an excellent job capturing the nonlinear trend&amp;hellip;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_links&lt;/span&gt;(mod5)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-17-1.png&#34; alt=&#34;Latent Gaussian Processes to capture autocorrelated time series in GAMs&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;&amp;hellip;while also producing sensible extrapolation behaviour:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_links&lt;/span&gt;(mod5, n_ahead &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-18-1.png&#34; alt=&#34;Latent Gaussian Processes to capture autocorrelated time series in GAMs&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;why-use-gaussian-processes-instead-of-splines&#34;&gt;Why use Gaussian Processes instead of splines?&#xA;  &lt;a href=&#34;#why-use-gaussian-processes-instead-of-splines&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;&amp;ldquo;&lt;em&gt;A Gaussian process defines a probability distribution over functions; in other words every sample from a Gaussian Process is an entire function from the covariate space X to the real-valued output space.&lt;/em&gt;&amp;rdquo; (Betancourt; &#xA;&lt;a href=&#34;https://betanalpha.github.io/assets/case_studies/gaussian_processes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Robust Gaussian Process Modeling&lt;/a&gt;)&lt;/p&gt;&#xA;&lt;p&gt;In many time series analyses, we believe the power of past observations to explain current data is a function of &lt;em&gt;how long ago&lt;/em&gt; we observed those past observations. Gaussian Processes use covariance functions (often called &amp;lsquo;kernels&amp;rsquo;) that allow this to happen by specifying how correlations depend on the difference, in time, between observations. For our purposes we will rely on the squared exponential kernel, which depends on &lt;code&gt;\(\rho\)&lt;/code&gt; (often called the length scale parameter) to control how quickly correlations decay as a function of time. The functions also depend on a parameter &lt;code&gt;\(\alpha\)&lt;/code&gt;, which controls how much the term contributes to the linear predictor. Below we simulate from such a Gaussian Processes to get an idea of the kinds of functional shapes that can be produced as you vary the length scale  &lt;code&gt;\(\rho\)&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;details&gt;&#xD;&#xA;  &lt;summary&gt;Click here if you would like to see the `R` code used to produce Gaussian Process simulations &lt;/summary&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# set a seed for reproducibility&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;set.seed&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;2222&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# simulate from a fairly large length-scale parameter&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# set the alpha parameter to 1 for all simulations&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# simulate functions that span 50 time points&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;times &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# generate a sequence of prediction values&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;draw_seq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;min&lt;/span&gt;(times), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(times), length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# construct the temporal covariance matrix&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha^2 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;outer&lt;/span&gt;(draw_seq, draw_seq, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;diag&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1e-12&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(draw_seq))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# draw a single realization from the GP distribution&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gp_vals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(draw_seq)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Sigma)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# plot the single GP draw&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; draw_seq, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; gp_vals, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;f&lt;/span&gt;(Time)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time&amp;#39;&lt;/span&gt;, bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-3.2&lt;/span&gt;,&lt;span style=&#34;color:#099&#34;&gt;3.2&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     main &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;expression&lt;/span&gt;(alpha&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;=&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;; &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;rho&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;=&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# overlay an additional 10 possible functions using different colours&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  draw &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; MASS&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mvrnorm&lt;/span&gt;(n &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, mu &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;length&lt;/span&gt;(draw_seq)),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        Sigma &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; Sigma)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; draw_seq, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; draw, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;3.5&lt;/span&gt;, col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(x &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; draw_seq, y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; draw,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sample&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#DCBCBC&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#C79999&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#A25050&amp;#34;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#7C0000&amp;#34;&lt;/span&gt;), &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-19-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;/details&gt;&#xD;&#xA;&lt;br&gt;&#xD;&#xA;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-20-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;This plot shows that the temporal autocorrelations have a long &amp;lsquo;memory&amp;rsquo;, i.e. they tend to change slowly over time. In contrast, let&amp;rsquo;s see what happens when we simulate from a GP with a shorter length scale parameter (the same code as above was used, except the length scale was changed to 4)&#xA;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-21-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;These functions are much &amp;lsquo;wigglier&amp;rsquo; and can be useful for capturing temporal dynamics with short-term &amp;lsquo;memory&amp;rsquo;. A &lt;strong&gt;big advantage&lt;/strong&gt; of Gaussian Processes is that they can easily handle data that are irregularly sampled, much like splines can (and in contrast to autoregressive processes like we&amp;rsquo;ve been using so far). But although Gaussian Processes may look similar to splines in the functions they return, they are fundamentally different. In particular, a spline has local knowledge, meaning it has no principled way of understanding how the function itself is evolving across time. But a GP directly models how the function changes over time, which means it is better able to generate out-of-sample predictions.&lt;/p&gt;&#xA;&lt;p&gt;Another big advantage of Gaussian Processes is that their parameters are more directly interpretable than are spline parameters. For instance, the length scale parameter &lt;code&gt;\(\rho\)&lt;/code&gt; is related to the stationarity (or stability) of the system. By supplying a prior that pulled this parameter towards &lt;em&gt;larger&lt;/em&gt; values, our Bayesian model directly captured our belief that the trend should change smoothly over time (i.e. a long &amp;ldquo;memory&amp;rdquo;) and that any unmodelled short-term autocorrelation should be captured by the AR1 process. &#xA;&lt;a href=&#34;https://stats.stackexchange.com/questions/515873/how-to-account-for-temporal-autocorrelation-in-a-hierarchical-generalized-additi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;By contrast, encoding this sort of information when using splines is incredibly difficult&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h3 id=&#34;back-to-interrogating-our-dynamic-model&#34;&gt;Back to interrogating our dynamic model&#xA;  &lt;a href=&#34;#back-to-interrogating-our-dynamic-model&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&lt;p&gt;We can plot how covariance is expected to change over increasing distances in time to understand the long-range &amp;ldquo;memory&amp;rdquo; of the Gaussian Process. Those of you that have worked with variograms or semi-variograms before when analysing spatial data will be used to visualizing how semivariance decays over distance. Here we will visualize how covariance decays over time distances (i.e. how far apart in time to we need to be before our estimate from the GP no longer depends on another?). We can define a few helper functions to generate these plots, which will accept posterior estimates of GP parameters from a fitted &lt;code&gt;mvgam&lt;/code&gt; object, compute the estimted temporal covariance kernels, calculate posterior quantiles and then plot them:&lt;/p&gt;&#xA;&lt;details&gt;&#xD;&#xA;  &lt;summary&gt;Click here if you would like to see the `R` function `plot_kernels`, used to plot GP kernels &lt;/summary&gt;&#xD;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Compute the covariance kernel for a given draw&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# of GP alpha and rho parameters&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quad_kernel &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(rho, alpha, times){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  covs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; alpha ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;-0.5&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;*&lt;/span&gt; ((times &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;/&lt;/span&gt; rho) ^ &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;return&lt;/span&gt;(covs)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Compute kernels for each posterior draw&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;plot_kernels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(gp_ests, max_time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;50&lt;/span&gt;){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# set up an empty matrix to store the kernel estimates &lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# for each posterior draw&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  draw_seq &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;seq&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, max_time, length.out &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  kernels &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;matrix&lt;/span&gt;(&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;, nrow &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(gp_ests), ncol &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;100&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# use a for-loop to estimate the kernel for each draw using&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# our custom quad_kernel() function&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;for&lt;/span&gt;(i &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NROW&lt;/span&gt;(gp_ests)){&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    kernels[i,] &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quad_kernel&lt;/span&gt;(rho &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; gp_ests&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;`rho_gp_trend_time_`[i],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               alpha &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; gp_ests&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;`alpha_gp_trend_time_`[i],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               times &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; draw_seq)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Calculate posterior empirical quantiles of the kernels&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0.05&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.2&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.8&lt;/span&gt;, &lt;span style=&#34;color:#099&#34;&gt;0.95&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cred &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;sapply&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;NCOL&lt;/span&gt;(kernels),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;function&lt;/span&gt;(n) &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;quantile&lt;/span&gt;(kernels[,n],&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      probs &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; probs))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#998;font-style:italic&#34;&gt;# Plot the kernel uncertainty estimates&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  pred_vals &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; draw_seq&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;, xlim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, max_time), ylim &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(cred)), type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       xlab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Time difference&amp;#39;&lt;/span&gt;, ylab &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;Covariance&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;box&lt;/span&gt;(bty &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_vals, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_vals)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[1,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[5,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#DCBCBC&amp;#34;&lt;/span&gt;, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;polygon&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(pred_vals, &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(pred_vals)), &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(cred[2,], &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;rev&lt;/span&gt;(cred[4,])),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#B97C7C&amp;#34;&lt;/span&gt;, border &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;NA&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;lines&lt;/span&gt;(pred_vals, cred[3,], col &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#34;#7C0000&amp;#34;&lt;/span&gt;, lwd &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;2.5&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/details&gt;&#xD;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;Extract posterior estimates of the GP parameters using the &lt;code&gt;as.data.frame&lt;/code&gt; function that we&amp;rsquo;ve been using previously. You can then plot the posterior kernel estimates for model 5 to visualize how temporal error covariance is estimated to change as two time points are further apart. To do this, all we need to supply is the posterior estimates for the GP parameters in the form of a &lt;code&gt;data.frame&lt;/code&gt;:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gp_ests &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;as.data.frame&lt;/span&gt;(mod5, variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;rho_gp&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;alpha_gp&amp;#39;&lt;/span&gt;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         regex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_kernels&lt;/span&gt;(gp_ests &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; gp_ests, max_time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;30&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/Plot mvgam GP covariance kernels-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;Here we can see how correlations between timepoints decay smoothly as we move further apart in time.&#xD;&#xA;&lt;p&gt;This smooth function is not that complex but works well because we have adequately captured temporal autocorrelation using the latent AR1 process. Estimates of the AR1 parameters come with full uncertainties:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;mcmc_plot&lt;/span&gt;(mod5, variable &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;ar1&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;sigma&amp;#39;&lt;/span&gt;), regex &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;areas&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-22-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;Plotting the hindcasts and forecasts won&amp;rsquo;t work directly with {&lt;code&gt;marginaleffects&lt;/code&gt;} as we want to also include the AR1 process. But this is easy to do with {&lt;code&gt;mvgam&lt;/code&gt;} functionality&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;hindcast&lt;/span&gt;(mod5)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(hc)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-23-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## No non-missing values in test_observations; cannot calculate forecast score&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fc &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;forecast&lt;/span&gt;(mod5, newdata &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;data.frame&lt;/span&gt;(time &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;(&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;max&lt;/span&gt;(dat&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;$&lt;/span&gt;time) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;)))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot&lt;/span&gt;(fc)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-24-1.png&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;## No non-missing values in test_observations; cannot calculate forecast score&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If we wanted to ask targeted questions about the nonlinear trend, we could do this readily. For example, here is the 1st derivative (i.e. the marginal effect) of time, which we can use to ask when the trend was changing most rapidly (i.e. at which time points was the derivative &lt;em&gt;furthest&lt;/em&gt; from zero?)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;plot_slopes&lt;/span&gt;(mod5, variables &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;time&amp;#39;&lt;/span&gt;, condition &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;time&amp;#39;&lt;/span&gt;,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            type &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;link&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;labs&lt;/span&gt;(y &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;First derivative (slope) of linear predictor&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;+&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#900;font-weight:bold&#34;&gt;geom_hline&lt;/span&gt;(yintercept &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;, linetype &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d14&#34;&gt;&amp;#39;dashed&amp;#39;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;https://ecogambler.netlify.app/blog/autocorrelated-gams/index_files/figure-html/unnamed-chunk-25-1.png&#34; alt=&#34;Calculating rates of change from Dynamic GAMs fit to time series in mgcv and mvgam&#34; width=&#34;60%&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&#xD;&#xA;&lt;p&gt;There are many more options to capture temporal dynamics and nonlinear effects using dynamic GAMs. For example, my blog post on &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/blog/distributed-lags-mgcv/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;distributed lag nonlinear models using mgcv and mvgam&lt;/a&gt; gives some tips on how to fit lagged covariate effects in GAMs. &#xA;&lt;a href=&#34;https://ecogambler.netlify.app/talk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;My research seminar and webinar page&lt;/a&gt; also has some good resources and modeling ideas for time series analyses. But we&amp;rsquo;ll leave those for later posts&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;h2 id=&#34;further-reading&#34;&gt;Further reading&#xA;  &lt;a href=&#34;#further-reading&#34;&gt;&lt;svg class=&#34;anchor-symbol&#34; aria-hidden=&#34;true&#34; height=&#34;26&#34; width=&#34;26&#34; viewBox=&#34;0 0 22 22&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;&#xA;      &lt;path d=&#34;M0 0h24v24H0z&#34; fill=&#34;currentColor&#34;&gt;&lt;/path&gt;&#xA;      &lt;path d=&#34;M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z&#34;&gt;&lt;/path&gt;&#xA;    &lt;/svg&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;The following papers and resources offer useful material about modeling time series with Generalized Additive Models&lt;/p&gt;&#xA;&lt;p&gt;Clark, N. J., Ernest, S. K. M., Senyondo, H., Simonis, J. L., White, E. P., Yennis, G. M., &amp;amp; Karunarathna, K. A. N. K. (2023). &#xA;&lt;a href=&#34;https://ecoevorxiv.org/repository/view/5143/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Multi-species dependencies improve forecasts of population dynamics in a long-term monitoring study&lt;/a&gt;. &lt;em&gt;Biorxiv&lt;/em&gt;, doi: &#xA;&lt;a href=&#34;https://doi.org/10.32942/X2TS34&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://doi.org/10.32942/X2TS34&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Gasparrini, A. (2014). &#xA;&lt;a href=&#34;https://onlinelibrary.wiley.com/doi/full/10.1002/sim.5963&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modeling exposure–lag–response associations with distributed lag non‐linear models&lt;/a&gt;. &lt;em&gt;Statistics in Medicine&lt;/em&gt;, 33(5), 881-899.&lt;/p&gt;&#xA;&lt;p&gt;Pedersen, E. J., Miller, D. L., Simpson, G. L., &amp;amp; Ross, N. (2019). &#xA;&lt;a href=&#34;https://peerj.com/articles/6876/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hierarchical generalized additive models in ecology: an introduction with mgcv&lt;/a&gt;. &lt;em&gt;PeerJ&lt;/em&gt;, 7, e6876.&lt;/p&gt;&#xA;&lt;p&gt;Simpson, G. L. (2018). &#xA;&lt;a href=&#34;https://www.frontiersin.org/articles/10.3389/fevo.2018.00149/full&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modelling palaeoecological time series using generalised additive models&lt;/a&gt;. &lt;em&gt;Frontiers in Ecology and Evolution&lt;/em&gt;, 6, 149.&lt;/p&gt;&#xA;</description>
  </item>
</channel>
  </rss>
